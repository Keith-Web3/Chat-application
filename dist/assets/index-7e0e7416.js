function tie(t,e){for(var n=0;n<e.length;n++){const o=e[n];if(typeof o!="string"&&!Array.isArray(o)){for(const c in o)if(c!=="default"&&!(c in t)){const l=Object.getOwnPropertyDescriptor(o,c);l&&Object.defineProperty(t,c,l.get?l:{enumerable:!0,get:()=>o[c]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function n(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerpolicy&&(l.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?l.credentials="include":c.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(c){if(c.ep)return;c.ep=!0;const l=n(c);fetch(c.href,l)}})();var to=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mA(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var uf={},nie={get exports(){return uf},set exports(t){uf=t}},Gv={},te={},rie={get exports(){return te},set exports(t){te=t}},Mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yf=Symbol.for("react.element"),iie=Symbol.for("react.portal"),sie=Symbol.for("react.fragment"),oie=Symbol.for("react.strict_mode"),aie=Symbol.for("react.profiler"),cie=Symbol.for("react.provider"),uie=Symbol.for("react.context"),lie=Symbol.for("react.forward_ref"),die=Symbol.for("react.suspense"),hie=Symbol.for("react.memo"),pie=Symbol.for("react.lazy"),M4=Symbol.iterator;function fie(t){return t===null||typeof t!="object"?null:(t=M4&&t[M4]||t["@@iterator"],typeof t=="function"?t:null)}var uF={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lF=Object.assign,dF={};function uh(t,e,n){this.props=t,this.context=e,this.refs=dF,this.updater=n||uF}uh.prototype.isReactComponent={};uh.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};uh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function hF(){}hF.prototype=uh.prototype;function gA(t,e,n){this.props=t,this.context=e,this.refs=dF,this.updater=n||uF}var EA=gA.prototype=new hF;EA.constructor=gA;lF(EA,uh.prototype);EA.isPureReactComponent=!0;var x4=Array.isArray,pF=Object.prototype.hasOwnProperty,_A={current:null},fF={key:!0,ref:!0,__self:!0,__source:!0};function mF(t,e,n){var o,c={},l=null,f=null;if(e!=null)for(o in e.ref!==void 0&&(f=e.ref),e.key!==void 0&&(l=""+e.key),e)pF.call(e,o)&&!fF.hasOwnProperty(o)&&(c[o]=e[o]);var _=arguments.length-2;if(_===1)c.children=n;else if(1<_){for(var y=Array(_),S=0;S<_;S++)y[S]=arguments[S+2];c.children=y}if(t&&t.defaultProps)for(o in _=t.defaultProps,_)c[o]===void 0&&(c[o]=_[o]);return{$$typeof:Yf,type:t,key:l,ref:f,props:c,_owner:_A.current}}function mie(t,e){return{$$typeof:Yf,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vA(t){return typeof t=="object"&&t!==null&&t.$$typeof===Yf}function gie(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var U4=/\/+/g;function CR(t,e){return typeof t=="object"&&t!==null&&t.key!=null?gie(""+t.key):e.toString(36)}function QE(t,e,n,o,c){var l=typeof t;(l==="undefined"||l==="boolean")&&(t=null);var f=!1;if(t===null)f=!0;else switch(l){case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case Yf:case iie:f=!0}}if(f)return f=t,c=c(f),t=o===""?"."+CR(f,0):o,x4(c)?(n="",t!=null&&(n=t.replace(U4,"$&/")+"/"),QE(c,e,n,"",function(S){return S})):c!=null&&(vA(c)&&(c=mie(c,n+(!c.key||f&&f.key===c.key?"":(""+c.key).replace(U4,"$&/")+"/")+t)),e.push(c)),1;if(f=0,o=o===""?".":o+":",x4(t))for(var _=0;_<t.length;_++){l=t[_];var y=o+CR(l,_);f+=QE(l,e,n,y,c)}else if(y=fie(t),typeof y=="function")for(t=y.call(t),_=0;!(l=t.next()).done;)l=l.value,y=o+CR(l,_++),f+=QE(l,e,n,y,c);else if(l==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return f}function RE(t,e,n){if(t==null)return t;var o=[],c=0;return QE(t,o,"","",function(l){return e.call(n,l,c++)}),o}function Eie(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var yi={current:null},ZE={transition:null},_ie={ReactCurrentDispatcher:yi,ReactCurrentBatchConfig:ZE,ReactCurrentOwner:_A};Mt.Children={map:RE,forEach:function(t,e,n){RE(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return RE(t,function(){e++}),e},toArray:function(t){return RE(t,function(e){return e})||[]},only:function(t){if(!vA(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Mt.Component=uh;Mt.Fragment=sie;Mt.Profiler=aie;Mt.PureComponent=gA;Mt.StrictMode=oie;Mt.Suspense=die;Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_ie;Mt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var o=lF({},t.props),c=t.key,l=t.ref,f=t._owner;if(e!=null){if(e.ref!==void 0&&(l=e.ref,f=_A.current),e.key!==void 0&&(c=""+e.key),t.type&&t.type.defaultProps)var _=t.type.defaultProps;for(y in e)pF.call(e,y)&&!fF.hasOwnProperty(y)&&(o[y]=e[y]===void 0&&_!==void 0?_[y]:e[y])}var y=arguments.length-2;if(y===1)o.children=n;else if(1<y){_=Array(y);for(var S=0;S<y;S++)_[S]=arguments[S+2];o.children=_}return{$$typeof:Yf,type:t.type,key:c,ref:l,props:o,_owner:f}};Mt.createContext=function(t){return t={$$typeof:uie,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:cie,_context:t},t.Consumer=t};Mt.createElement=mF;Mt.createFactory=function(t){var e=mF.bind(null,t);return e.type=t,e};Mt.createRef=function(){return{current:null}};Mt.forwardRef=function(t){return{$$typeof:lie,render:t}};Mt.isValidElement=vA;Mt.lazy=function(t){return{$$typeof:pie,_payload:{_status:-1,_result:t},_init:Eie}};Mt.memo=function(t,e){return{$$typeof:hie,type:t,compare:e===void 0?null:e}};Mt.startTransition=function(t){var e=ZE.transition;ZE.transition={};try{t()}finally{ZE.transition=e}};Mt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Mt.useCallback=function(t,e){return yi.current.useCallback(t,e)};Mt.useContext=function(t){return yi.current.useContext(t)};Mt.useDebugValue=function(){};Mt.useDeferredValue=function(t){return yi.current.useDeferredValue(t)};Mt.useEffect=function(t,e){return yi.current.useEffect(t,e)};Mt.useId=function(){return yi.current.useId()};Mt.useImperativeHandle=function(t,e,n){return yi.current.useImperativeHandle(t,e,n)};Mt.useInsertionEffect=function(t,e){return yi.current.useInsertionEffect(t,e)};Mt.useLayoutEffect=function(t,e){return yi.current.useLayoutEffect(t,e)};Mt.useMemo=function(t,e){return yi.current.useMemo(t,e)};Mt.useReducer=function(t,e,n){return yi.current.useReducer(t,e,n)};Mt.useRef=function(t){return yi.current.useRef(t)};Mt.useState=function(t){return yi.current.useState(t)};Mt.useSyncExternalStore=function(t,e,n){return yi.current.useSyncExternalStore(t,e,n)};Mt.useTransition=function(){return yi.current.useTransition()};Mt.version="18.2.0";(function(t){t.exports=Mt})(rie);const lh=mA(te),sw=tie({__proto__:null,default:lh},[te]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vie=te,yie=Symbol.for("react.element"),Sie=Symbol.for("react.fragment"),Tie=Object.prototype.hasOwnProperty,Rie=vie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Iie={key:!0,ref:!0,__self:!0,__source:!0};function gF(t,e,n){var o,c={},l=null,f=null;n!==void 0&&(l=""+n),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(f=e.ref);for(o in e)Tie.call(e,o)&&!Iie.hasOwnProperty(o)&&(c[o]=e[o]);if(t&&t.defaultProps)for(o in e=t.defaultProps,e)c[o]===void 0&&(c[o]=e[o]);return{$$typeof:yie,type:t,key:l,ref:f,props:c,_owner:Rie.current}}Gv.Fragment=Sie;Gv.jsx=gF;Gv.jsxs=gF;(function(t){t.exports=Gv})(nie);const EF=uf.Fragment,ge=uf.jsx,Pt=uf.jsxs;var ow={},lf={},wie={get exports(){return lf},set exports(t){lf=t}},hs={},aw={},Cie={get exports(){return aw},set exports(t){aw=t}},_F={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Ue,rt){var st=Ue.length;Ue.push(rt);e:for(;0<st;){var bn=st-1>>>1,$n=Ue[bn];if(0<c($n,rt))Ue[bn]=rt,Ue[st]=$n,st=bn;else break e}}function n(Ue){return Ue.length===0?null:Ue[0]}function o(Ue){if(Ue.length===0)return null;var rt=Ue[0],st=Ue.pop();if(st!==rt){Ue[0]=st;e:for(var bn=0,$n=Ue.length,al=$n>>>1;bn<al;){var Fs=2*(bn+1)-1,Ah=Ue[Fs],ms=Fs+1,cl=Ue[ms];if(0>c(Ah,st))ms<$n&&0>c(cl,Ah)?(Ue[bn]=cl,Ue[ms]=st,bn=ms):(Ue[bn]=Ah,Ue[Fs]=st,bn=Fs);else if(ms<$n&&0>c(cl,st))Ue[bn]=cl,Ue[ms]=st,bn=ms;else break e}}return rt}function c(Ue,rt){var st=Ue.sortIndex-rt.sortIndex;return st!==0?st:Ue.id-rt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var f=Date,_=f.now();t.unstable_now=function(){return f.now()-_}}var y=[],S=[],R=1,w=null,b=3,k=!1,M=!1,F=!1,Y=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function K(Ue){for(var rt=n(S);rt!==null;){if(rt.callback===null)o(S);else if(rt.startTime<=Ue)o(S),rt.sortIndex=rt.expirationTime,e(y,rt);else break;rt=n(S)}}function z(Ue){if(F=!1,K(Ue),!M)if(n(y)!==null)M=!0,Hn(oe);else{var rt=n(S);rt!==null&&ur(z,rt.startTime-Ue)}}function oe(Ue,rt){M=!1,F&&(F=!1,H(we),we=-1),k=!0;var st=b;try{for(K(rt),w=n(y);w!==null&&(!(w.expirationTime>rt)||Ue&&!dt());){var bn=w.callback;if(typeof bn=="function"){w.callback=null,b=w.priorityLevel;var $n=bn(w.expirationTime<=rt);rt=t.unstable_now(),typeof $n=="function"?w.callback=$n:w===n(y)&&o(y),K(rt)}else o(y);w=n(y)}if(w!==null)var al=!0;else{var Fs=n(S);Fs!==null&&ur(z,Fs.startTime-rt),al=!1}return al}finally{w=null,b=st,k=!1}}var de=!1,Ee=null,we=-1,Fe=5,be=-1;function dt(){return!(t.unstable_now()-be<Fe)}function kn(){if(Ee!==null){var Ue=t.unstable_now();be=Ue;var rt=!0;try{rt=Ee(!0,Ue)}finally{rt?Vi():(de=!1,Ee=null)}}else de=!1}var Vi;if(typeof B=="function")Vi=function(){B(kn)};else if(typeof MessageChannel<"u"){var jn=new MessageChannel,sn=jn.port2;jn.port1.onmessage=kn,Vi=function(){sn.postMessage(null)}}else Vi=function(){Y(kn,0)};function Hn(Ue){Ee=Ue,de||(de=!0,Vi())}function ur(Ue,rt){we=Y(function(){Ue(t.unstable_now())},rt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ue){Ue.callback=null},t.unstable_continueExecution=function(){M||k||(M=!0,Hn(oe))},t.unstable_forceFrameRate=function(Ue){0>Ue||125<Ue?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Fe=0<Ue?Math.floor(1e3/Ue):5},t.unstable_getCurrentPriorityLevel=function(){return b},t.unstable_getFirstCallbackNode=function(){return n(y)},t.unstable_next=function(Ue){switch(b){case 1:case 2:case 3:var rt=3;break;default:rt=b}var st=b;b=rt;try{return Ue()}finally{b=st}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ue,rt){switch(Ue){case 1:case 2:case 3:case 4:case 5:break;default:Ue=3}var st=b;b=Ue;try{return rt()}finally{b=st}},t.unstable_scheduleCallback=function(Ue,rt,st){var bn=t.unstable_now();switch(typeof st=="object"&&st!==null?(st=st.delay,st=typeof st=="number"&&0<st?bn+st:bn):st=bn,Ue){case 1:var $n=-1;break;case 2:$n=250;break;case 5:$n=1073741823;break;case 4:$n=1e4;break;default:$n=5e3}return $n=st+$n,Ue={id:R++,callback:rt,priorityLevel:Ue,startTime:st,expirationTime:$n,sortIndex:-1},st>bn?(Ue.sortIndex=st,e(S,Ue),n(y)===null&&Ue===n(S)&&(F?(H(we),we=-1):F=!0,ur(z,st-bn))):(Ue.sortIndex=$n,e(y,Ue),M||k||(M=!0,Hn(oe))),Ue},t.unstable_shouldYield=dt,t.unstable_wrapCallback=function(Ue){var rt=b;return function(){var st=b;b=rt;try{return Ue.apply(this,arguments)}finally{b=st}}}})(_F);(function(t){t.exports=_F})(Cie);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vF=te,cs=aw;function Se(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yF=new Set,df={};function tl(t,e){Gd(t,e),Gd(t+"Capture",e)}function Gd(t,e){for(df[t]=e,t=0;t<e.length;t++)yF.add(e[t])}var Sa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cw=Object.prototype.hasOwnProperty,Aie=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,V4={},F4={};function bie(t){return cw.call(F4,t)?!0:cw.call(V4,t)?!1:Aie.test(t)?F4[t]=!0:(V4[t]=!0,!1)}function Oie(t,e,n,o){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return o?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Nie(t,e,n,o){if(e===null||typeof e>"u"||Oie(t,e,n,o))return!0;if(o)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Si(t,e,n,o,c,l,f){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=o,this.attributeNamespace=c,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=l,this.removeEmptyString=f}var Hr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Hr[t]=new Si(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Hr[e]=new Si(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Hr[t]=new Si(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Hr[t]=new Si(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Hr[t]=new Si(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Hr[t]=new Si(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Hr[t]=new Si(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Hr[t]=new Si(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Hr[t]=new Si(t,5,!1,t.toLowerCase(),null,!1,!1)});var yA=/[\-:]([a-z])/g;function SA(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(yA,SA);Hr[e]=new Si(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(yA,SA);Hr[e]=new Si(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(yA,SA);Hr[e]=new Si(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Hr[t]=new Si(t,1,!1,t.toLowerCase(),null,!1,!1)});Hr.xlinkHref=new Si("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Hr[t]=new Si(t,1,!1,t.toLowerCase(),null,!0,!0)});function TA(t,e,n,o){var c=Hr.hasOwnProperty(e)?Hr[e]:null;(c!==null?c.type!==0:o||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Nie(e,n,c,o)&&(n=null),o||c===null?bie(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):c.mustUseProperty?t[c.propertyName]=n===null?c.type===3?!1:"":n:(e=c.attributeName,o=c.attributeNamespace,n===null?t.removeAttribute(e):(c=c.type,n=c===3||c===4&&n===!0?"":""+n,o?t.setAttributeNS(o,e,n):t.setAttribute(e,n))))}var Da=vF.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,IE=Symbol.for("react.element"),pd=Symbol.for("react.portal"),fd=Symbol.for("react.fragment"),RA=Symbol.for("react.strict_mode"),uw=Symbol.for("react.profiler"),SF=Symbol.for("react.provider"),TF=Symbol.for("react.context"),IA=Symbol.for("react.forward_ref"),lw=Symbol.for("react.suspense"),dw=Symbol.for("react.suspense_list"),wA=Symbol.for("react.memo"),rc=Symbol.for("react.lazy"),RF=Symbol.for("react.offscreen"),j4=Symbol.iterator;function Ep(t){return t===null||typeof t!="object"?null:(t=j4&&t[j4]||t["@@iterator"],typeof t=="function"?t:null)}var Dn=Object.assign,AR;function bp(t){if(AR===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);AR=e&&e[1]||""}return`
`+AR+t}var bR=!1;function OR(t,e){if(!t||bR)return"";bR=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(S){var o=S}Reflect.construct(t,[],e)}else{try{e.call()}catch(S){o=S}t.call(e.prototype)}else{try{throw Error()}catch(S){o=S}t()}}catch(S){if(S&&o&&typeof S.stack=="string"){for(var c=S.stack.split(`
`),l=o.stack.split(`
`),f=c.length-1,_=l.length-1;1<=f&&0<=_&&c[f]!==l[_];)_--;for(;1<=f&&0<=_;f--,_--)if(c[f]!==l[_]){if(f!==1||_!==1)do if(f--,_--,0>_||c[f]!==l[_]){var y=`
`+c[f].replace(" at new "," at ");return t.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",t.displayName)),y}while(1<=f&&0<=_);break}}}finally{bR=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?bp(t):""}function Pie(t){switch(t.tag){case 5:return bp(t.type);case 16:return bp("Lazy");case 13:return bp("Suspense");case 19:return bp("SuspenseList");case 0:case 2:case 15:return t=OR(t.type,!1),t;case 11:return t=OR(t.type.render,!1),t;case 1:return t=OR(t.type,!0),t;default:return""}}function hw(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case fd:return"Fragment";case pd:return"Portal";case uw:return"Profiler";case RA:return"StrictMode";case lw:return"Suspense";case dw:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case TF:return(t.displayName||"Context")+".Consumer";case SF:return(t._context.displayName||"Context")+".Provider";case IA:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case wA:return e=t.displayName||null,e!==null?e:hw(t.type)||"Memo";case rc:e=t._payload,t=t._init;try{return hw(t(e))}catch{}}return null}function Die(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hw(e);case 8:return e===RA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Dc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function IF(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function kie(t){var e=IF(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),o=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var c=n.get,l=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return c.call(this)},set:function(f){o=""+f,l.call(this,f)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return o},setValue:function(f){o=""+f},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function wE(t){t._valueTracker||(t._valueTracker=kie(t))}function wF(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),o="";return t&&(o=IF(t)?t.checked?"true":"false":t.value),t=o,t!==n?(e.setValue(t),!0):!1}function w_(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function pw(t,e){var n=e.checked;return Dn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function B4(t,e){var n=e.defaultValue==null?"":e.defaultValue,o=e.checked!=null?e.checked:e.defaultChecked;n=Dc(e.value!=null?e.value:n),t._wrapperState={initialChecked:o,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function CF(t,e){e=e.checked,e!=null&&TA(t,"checked",e,!1)}function fw(t,e){CF(t,e);var n=Dc(e.value),o=e.type;if(n!=null)o==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(o==="submit"||o==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?mw(t,e.type,n):e.hasOwnProperty("defaultValue")&&mw(t,e.type,Dc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function G4(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var o=e.type;if(!(o!=="submit"&&o!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function mw(t,e,n){(e!=="number"||w_(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Op=Array.isArray;function Od(t,e,n,o){if(t=t.options,e){e={};for(var c=0;c<n.length;c++)e["$"+n[c]]=!0;for(n=0;n<t.length;n++)c=e.hasOwnProperty("$"+t[n].value),t[n].selected!==c&&(t[n].selected=c),c&&o&&(t[n].defaultSelected=!0)}else{for(n=""+Dc(n),e=null,c=0;c<t.length;c++){if(t[c].value===n){t[c].selected=!0,o&&(t[c].defaultSelected=!0);return}e!==null||t[c].disabled||(e=t[c])}e!==null&&(e.selected=!0)}}function gw(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Se(91));return Dn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function W4(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Se(92));if(Op(n)){if(1<n.length)throw Error(Se(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Dc(n)}}function AF(t,e){var n=Dc(e.value),o=Dc(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),o!=null&&(t.defaultValue=""+o)}function H4(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function bF(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ew(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?bF(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var CE,OF=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,o,c){MSApp.execUnsafeLocalFunction(function(){return t(e,n,o,c)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(CE=CE||document.createElement("div"),CE.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=CE.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function hf(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var jp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lie=["Webkit","ms","Moz","O"];Object.keys(jp).forEach(function(t){Lie.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),jp[e]=jp[t]})});function NF(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||jp.hasOwnProperty(t)&&jp[t]?(""+e).trim():e+"px"}function PF(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var o=n.indexOf("--")===0,c=NF(n,e[n],o);n==="float"&&(n="cssFloat"),o?t.setProperty(n,c):t[n]=c}}var Mie=Dn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _w(t,e){if(e){if(Mie[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Se(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Se(62))}}function vw(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yw=null;function CA(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Sw=null,Nd=null,Pd=null;function $4(t){if(t=Qf(t)){if(typeof Sw!="function")throw Error(Se(280));var e=t.stateNode;e&&(e=qv(e),Sw(t.stateNode,t.type,e))}}function DF(t){Nd?Pd?Pd.push(t):Pd=[t]:Nd=t}function kF(){if(Nd){var t=Nd,e=Pd;if(Pd=Nd=null,$4(t),e)for(t=0;t<e.length;t++)$4(e[t])}}function LF(t,e){return t(e)}function MF(){}var NR=!1;function xF(t,e,n){if(NR)return t(e,n);NR=!0;try{return LF(t,e,n)}finally{NR=!1,(Nd!==null||Pd!==null)&&(MF(),kF())}}function pf(t,e){var n=t.stateNode;if(n===null)return null;var o=qv(n);if(o===null)return null;n=o[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(t=t.type,o=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!o;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Se(231,e,typeof n));return n}var Tw=!1;if(Sa)try{var _p={};Object.defineProperty(_p,"passive",{get:function(){Tw=!0}}),window.addEventListener("test",_p,_p),window.removeEventListener("test",_p,_p)}catch{Tw=!1}function xie(t,e,n,o,c,l,f,_,y){var S=Array.prototype.slice.call(arguments,3);try{e.apply(n,S)}catch(R){this.onError(R)}}var Bp=!1,C_=null,A_=!1,Rw=null,Uie={onError:function(t){Bp=!0,C_=t}};function Vie(t,e,n,o,c,l,f,_,y){Bp=!1,C_=null,xie.apply(Uie,arguments)}function Fie(t,e,n,o,c,l,f,_,y){if(Vie.apply(this,arguments),Bp){if(Bp){var S=C_;Bp=!1,C_=null}else throw Error(Se(198));A_||(A_=!0,Rw=S)}}function nl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function UF(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function K4(t){if(nl(t)!==t)throw Error(Se(188))}function jie(t){var e=t.alternate;if(!e){if(e=nl(t),e===null)throw Error(Se(188));return e!==t?null:t}for(var n=t,o=e;;){var c=n.return;if(c===null)break;var l=c.alternate;if(l===null){if(o=c.return,o!==null){n=o;continue}break}if(c.child===l.child){for(l=c.child;l;){if(l===n)return K4(c),t;if(l===o)return K4(c),e;l=l.sibling}throw Error(Se(188))}if(n.return!==o.return)n=c,o=l;else{for(var f=!1,_=c.child;_;){if(_===n){f=!0,n=c,o=l;break}if(_===o){f=!0,o=c,n=l;break}_=_.sibling}if(!f){for(_=l.child;_;){if(_===n){f=!0,n=l,o=c;break}if(_===o){f=!0,o=l,n=c;break}_=_.sibling}if(!f)throw Error(Se(189))}}if(n.alternate!==o)throw Error(Se(190))}if(n.tag!==3)throw Error(Se(188));return n.stateNode.current===n?t:e}function VF(t){return t=jie(t),t!==null?FF(t):null}function FF(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=FF(t);if(e!==null)return e;t=t.sibling}return null}var jF=cs.unstable_scheduleCallback,q4=cs.unstable_cancelCallback,Bie=cs.unstable_shouldYield,Gie=cs.unstable_requestPaint,Wn=cs.unstable_now,Wie=cs.unstable_getCurrentPriorityLevel,AA=cs.unstable_ImmediatePriority,BF=cs.unstable_UserBlockingPriority,b_=cs.unstable_NormalPriority,Hie=cs.unstable_LowPriority,GF=cs.unstable_IdlePriority,Wv=null,bo=null;function $ie(t){if(bo&&typeof bo.onCommitFiberRoot=="function")try{bo.onCommitFiberRoot(Wv,t,void 0,(t.current.flags&128)===128)}catch{}}var ro=Math.clz32?Math.clz32:zie,Kie=Math.log,qie=Math.LN2;function zie(t){return t>>>=0,t===0?32:31-(Kie(t)/qie|0)|0}var AE=64,bE=4194304;function Np(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function O_(t,e){var n=t.pendingLanes;if(n===0)return 0;var o=0,c=t.suspendedLanes,l=t.pingedLanes,f=n&268435455;if(f!==0){var _=f&~c;_!==0?o=Np(_):(l&=f,l!==0&&(o=Np(l)))}else f=n&~c,f!==0?o=Np(f):l!==0&&(o=Np(l));if(o===0)return 0;if(e!==0&&e!==o&&!(e&c)&&(c=o&-o,l=e&-e,c>=l||c===16&&(l&4194240)!==0))return e;if(o&4&&(o|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=o;0<e;)n=31-ro(e),c=1<<n,o|=t[n],e&=~c;return o}function Yie(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xie(t,e){for(var n=t.suspendedLanes,o=t.pingedLanes,c=t.expirationTimes,l=t.pendingLanes;0<l;){var f=31-ro(l),_=1<<f,y=c[f];y===-1?(!(_&n)||_&o)&&(c[f]=Yie(_,e)):y<=e&&(t.expiredLanes|=_),l&=~_}}function Iw(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function WF(){var t=AE;return AE<<=1,!(AE&4194240)&&(AE=64),t}function PR(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Xf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ro(e),t[e]=n}function Jie(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var o=t.eventTimes;for(t=t.expirationTimes;0<n;){var c=31-ro(n),l=1<<c;e[c]=0,o[c]=-1,t[c]=-1,n&=~l}}function bA(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var o=31-ro(n),c=1<<o;c&e|t[o]&e&&(t[o]|=e),n&=~c}}var Qt=0;function HF(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var $F,OA,KF,qF,zF,ww=!1,OE=[],gc=null,Ec=null,_c=null,ff=new Map,mf=new Map,oc=[],Qie="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function z4(t,e){switch(t){case"focusin":case"focusout":gc=null;break;case"dragenter":case"dragleave":Ec=null;break;case"mouseover":case"mouseout":_c=null;break;case"pointerover":case"pointerout":ff.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":mf.delete(e.pointerId)}}function vp(t,e,n,o,c,l){return t===null||t.nativeEvent!==l?(t={blockedOn:e,domEventName:n,eventSystemFlags:o,nativeEvent:l,targetContainers:[c]},e!==null&&(e=Qf(e),e!==null&&OA(e)),t):(t.eventSystemFlags|=o,e=t.targetContainers,c!==null&&e.indexOf(c)===-1&&e.push(c),t)}function Zie(t,e,n,o,c){switch(e){case"focusin":return gc=vp(gc,t,e,n,o,c),!0;case"dragenter":return Ec=vp(Ec,t,e,n,o,c),!0;case"mouseover":return _c=vp(_c,t,e,n,o,c),!0;case"pointerover":var l=c.pointerId;return ff.set(l,vp(ff.get(l)||null,t,e,n,o,c)),!0;case"gotpointercapture":return l=c.pointerId,mf.set(l,vp(mf.get(l)||null,t,e,n,o,c)),!0}return!1}function YF(t){var e=bu(t.target);if(e!==null){var n=nl(e);if(n!==null){if(e=n.tag,e===13){if(e=UF(n),e!==null){t.blockedOn=e,zF(t.priority,function(){KF(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function e_(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Cw(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var o=new n.constructor(n.type,n);yw=o,n.target.dispatchEvent(o),yw=null}else return e=Qf(n),e!==null&&OA(e),t.blockedOn=n,!1;e.shift()}return!0}function Y4(t,e,n){e_(t)&&n.delete(e)}function ese(){ww=!1,gc!==null&&e_(gc)&&(gc=null),Ec!==null&&e_(Ec)&&(Ec=null),_c!==null&&e_(_c)&&(_c=null),ff.forEach(Y4),mf.forEach(Y4)}function yp(t,e){t.blockedOn===e&&(t.blockedOn=null,ww||(ww=!0,cs.unstable_scheduleCallback(cs.unstable_NormalPriority,ese)))}function gf(t){function e(c){return yp(c,t)}if(0<OE.length){yp(OE[0],t);for(var n=1;n<OE.length;n++){var o=OE[n];o.blockedOn===t&&(o.blockedOn=null)}}for(gc!==null&&yp(gc,t),Ec!==null&&yp(Ec,t),_c!==null&&yp(_c,t),ff.forEach(e),mf.forEach(e),n=0;n<oc.length;n++)o=oc[n],o.blockedOn===t&&(o.blockedOn=null);for(;0<oc.length&&(n=oc[0],n.blockedOn===null);)YF(n),n.blockedOn===null&&oc.shift()}var Dd=Da.ReactCurrentBatchConfig,N_=!0;function tse(t,e,n,o){var c=Qt,l=Dd.transition;Dd.transition=null;try{Qt=1,NA(t,e,n,o)}finally{Qt=c,Dd.transition=l}}function nse(t,e,n,o){var c=Qt,l=Dd.transition;Dd.transition=null;try{Qt=4,NA(t,e,n,o)}finally{Qt=c,Dd.transition=l}}function NA(t,e,n,o){if(N_){var c=Cw(t,e,n,o);if(c===null)BR(t,e,o,P_,n),z4(t,o);else if(Zie(c,t,e,n,o))o.stopPropagation();else if(z4(t,o),e&4&&-1<Qie.indexOf(t)){for(;c!==null;){var l=Qf(c);if(l!==null&&$F(l),l=Cw(t,e,n,o),l===null&&BR(t,e,o,P_,n),l===c)break;c=l}c!==null&&o.stopPropagation()}else BR(t,e,o,null,n)}}var P_=null;function Cw(t,e,n,o){if(P_=null,t=CA(o),t=bu(t),t!==null)if(e=nl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=UF(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return P_=t,null}function XF(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Wie()){case AA:return 1;case BF:return 4;case b_:case Hie:return 16;case GF:return 536870912;default:return 16}default:return 16}}var dc=null,PA=null,t_=null;function JF(){if(t_)return t_;var t,e=PA,n=e.length,o,c="value"in dc?dc.value:dc.textContent,l=c.length;for(t=0;t<n&&e[t]===c[t];t++);var f=n-t;for(o=1;o<=f&&e[n-o]===c[l-o];o++);return t_=c.slice(t,1<o?1-o:void 0)}function n_(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function NE(){return!0}function X4(){return!1}function ps(t){function e(n,o,c,l,f){this._reactName=n,this._targetInst=c,this.type=o,this.nativeEvent=l,this.target=f,this.currentTarget=null;for(var _ in t)t.hasOwnProperty(_)&&(n=t[_],this[_]=n?n(l):l[_]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?NE:X4,this.isPropagationStopped=X4,this}return Dn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=NE)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=NE)},persist:function(){},isPersistent:NE}),e}var dh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},DA=ps(dh),Jf=Dn({},dh,{view:0,detail:0}),rse=ps(Jf),DR,kR,Sp,Hv=Dn({},Jf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kA,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Sp&&(Sp&&t.type==="mousemove"?(DR=t.screenX-Sp.screenX,kR=t.screenY-Sp.screenY):kR=DR=0,Sp=t),DR)},movementY:function(t){return"movementY"in t?t.movementY:kR}}),J4=ps(Hv),ise=Dn({},Hv,{dataTransfer:0}),sse=ps(ise),ose=Dn({},Jf,{relatedTarget:0}),LR=ps(ose),ase=Dn({},dh,{animationName:0,elapsedTime:0,pseudoElement:0}),cse=ps(ase),use=Dn({},dh,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),lse=ps(use),dse=Dn({},dh,{data:0}),Q4=ps(dse),hse={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pse={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fse={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mse(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=fse[t])?!!e[t]:!1}function kA(){return mse}var gse=Dn({},Jf,{key:function(t){if(t.key){var e=hse[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=n_(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?pse[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kA,charCode:function(t){return t.type==="keypress"?n_(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?n_(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ese=ps(gse),_se=Dn({},Hv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Z4=ps(_se),vse=Dn({},Jf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kA}),yse=ps(vse),Sse=Dn({},dh,{propertyName:0,elapsedTime:0,pseudoElement:0}),Tse=ps(Sse),Rse=Dn({},Hv,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Ise=ps(Rse),wse=[9,13,27,32],LA=Sa&&"CompositionEvent"in window,Gp=null;Sa&&"documentMode"in document&&(Gp=document.documentMode);var Cse=Sa&&"TextEvent"in window&&!Gp,QF=Sa&&(!LA||Gp&&8<Gp&&11>=Gp),e5=String.fromCharCode(32),t5=!1;function ZF(t,e){switch(t){case"keyup":return wse.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function e9(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var md=!1;function Ase(t,e){switch(t){case"compositionend":return e9(e);case"keypress":return e.which!==32?null:(t5=!0,e5);case"textInput":return t=e.data,t===e5&&t5?null:t;default:return null}}function bse(t,e){if(md)return t==="compositionend"||!LA&&ZF(t,e)?(t=JF(),t_=PA=dc=null,md=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return QF&&e.locale!=="ko"?null:e.data;default:return null}}var Ose={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function n5(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Ose[t.type]:e==="textarea"}function t9(t,e,n,o){DF(o),e=D_(e,"onChange"),0<e.length&&(n=new DA("onChange","change",null,n,o),t.push({event:n,listeners:e}))}var Wp=null,Ef=null;function Nse(t){h9(t,0)}function $v(t){var e=_d(t);if(wF(e))return t}function Pse(t,e){if(t==="change")return e}var n9=!1;if(Sa){var MR;if(Sa){var xR="oninput"in document;if(!xR){var r5=document.createElement("div");r5.setAttribute("oninput","return;"),xR=typeof r5.oninput=="function"}MR=xR}else MR=!1;n9=MR&&(!document.documentMode||9<document.documentMode)}function i5(){Wp&&(Wp.detachEvent("onpropertychange",r9),Ef=Wp=null)}function r9(t){if(t.propertyName==="value"&&$v(Ef)){var e=[];t9(e,Ef,t,CA(t)),xF(Nse,e)}}function Dse(t,e,n){t==="focusin"?(i5(),Wp=e,Ef=n,Wp.attachEvent("onpropertychange",r9)):t==="focusout"&&i5()}function kse(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return $v(Ef)}function Lse(t,e){if(t==="click")return $v(e)}function Mse(t,e){if(t==="input"||t==="change")return $v(e)}function xse(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ao=typeof Object.is=="function"?Object.is:xse;function _f(t,e){if(ao(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(o=0;o<n.length;o++){var c=n[o];if(!cw.call(e,c)||!ao(t[c],e[c]))return!1}return!0}function s5(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function o5(t,e){var n=s5(t);t=0;for(var o;n;){if(n.nodeType===3){if(o=t+n.textContent.length,t<=e&&o>=e)return{node:n,offset:e-t};t=o}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=s5(n)}}function i9(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?i9(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function s9(){for(var t=window,e=w_();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=w_(t.document)}return e}function MA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Use(t){var e=s9(),n=t.focusedElem,o=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&i9(n.ownerDocument.documentElement,n)){if(o!==null&&MA(n)){if(e=o.start,t=o.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var c=n.textContent.length,l=Math.min(o.start,c);o=o.end===void 0?l:Math.min(o.end,c),!t.extend&&l>o&&(c=o,o=l,l=c),c=o5(n,l);var f=o5(n,o);c&&f&&(t.rangeCount!==1||t.anchorNode!==c.node||t.anchorOffset!==c.offset||t.focusNode!==f.node||t.focusOffset!==f.offset)&&(e=e.createRange(),e.setStart(c.node,c.offset),t.removeAllRanges(),l>o?(t.addRange(e),t.extend(f.node,f.offset)):(e.setEnd(f.node,f.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Vse=Sa&&"documentMode"in document&&11>=document.documentMode,gd=null,Aw=null,Hp=null,bw=!1;function a5(t,e,n){var o=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;bw||gd==null||gd!==w_(o)||(o=gd,"selectionStart"in o&&MA(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Hp&&_f(Hp,o)||(Hp=o,o=D_(Aw,"onSelect"),0<o.length&&(e=new DA("onSelect","select",null,e,n),t.push({event:e,listeners:o}),e.target=gd)))}function PE(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ed={animationend:PE("Animation","AnimationEnd"),animationiteration:PE("Animation","AnimationIteration"),animationstart:PE("Animation","AnimationStart"),transitionend:PE("Transition","TransitionEnd")},UR={},o9={};Sa&&(o9=document.createElement("div").style,"AnimationEvent"in window||(delete Ed.animationend.animation,delete Ed.animationiteration.animation,delete Ed.animationstart.animation),"TransitionEvent"in window||delete Ed.transitionend.transition);function Kv(t){if(UR[t])return UR[t];if(!Ed[t])return t;var e=Ed[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in o9)return UR[t]=e[n];return t}var a9=Kv("animationend"),c9=Kv("animationiteration"),u9=Kv("animationstart"),l9=Kv("transitionend"),d9=new Map,c5="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Gc(t,e){d9.set(t,e),tl(e,[t])}for(var VR=0;VR<c5.length;VR++){var FR=c5[VR],Fse=FR.toLowerCase(),jse=FR[0].toUpperCase()+FR.slice(1);Gc(Fse,"on"+jse)}Gc(a9,"onAnimationEnd");Gc(c9,"onAnimationIteration");Gc(u9,"onAnimationStart");Gc("dblclick","onDoubleClick");Gc("focusin","onFocus");Gc("focusout","onBlur");Gc(l9,"onTransitionEnd");Gd("onMouseEnter",["mouseout","mouseover"]);Gd("onMouseLeave",["mouseout","mouseover"]);Gd("onPointerEnter",["pointerout","pointerover"]);Gd("onPointerLeave",["pointerout","pointerover"]);tl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));tl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));tl("onBeforeInput",["compositionend","keypress","textInput","paste"]);tl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));tl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));tl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bse=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pp));function u5(t,e,n){var o=t.type||"unknown-event";t.currentTarget=n,Fie(o,e,void 0,t),t.currentTarget=null}function h9(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var o=t[n],c=o.event;o=o.listeners;e:{var l=void 0;if(e)for(var f=o.length-1;0<=f;f--){var _=o[f],y=_.instance,S=_.currentTarget;if(_=_.listener,y!==l&&c.isPropagationStopped())break e;u5(c,_,S),l=y}else for(f=0;f<o.length;f++){if(_=o[f],y=_.instance,S=_.currentTarget,_=_.listener,y!==l&&c.isPropagationStopped())break e;u5(c,_,S),l=y}}}if(A_)throw t=Rw,A_=!1,Rw=null,t}function yn(t,e){var n=e[kw];n===void 0&&(n=e[kw]=new Set);var o=t+"__bubble";n.has(o)||(p9(e,t,2,!1),n.add(o))}function jR(t,e,n){var o=0;e&&(o|=4),p9(n,t,o,e)}var DE="_reactListening"+Math.random().toString(36).slice(2);function vf(t){if(!t[DE]){t[DE]=!0,yF.forEach(function(n){n!=="selectionchange"&&(Bse.has(n)||jR(n,!1,t),jR(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[DE]||(e[DE]=!0,jR("selectionchange",!1,e))}}function p9(t,e,n,o){switch(XF(e)){case 1:var c=tse;break;case 4:c=nse;break;default:c=NA}n=c.bind(null,e,n,t),c=void 0,!Tw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(c=!0),o?c!==void 0?t.addEventListener(e,n,{capture:!0,passive:c}):t.addEventListener(e,n,!0):c!==void 0?t.addEventListener(e,n,{passive:c}):t.addEventListener(e,n,!1)}function BR(t,e,n,o,c){var l=o;if(!(e&1)&&!(e&2)&&o!==null)e:for(;;){if(o===null)return;var f=o.tag;if(f===3||f===4){var _=o.stateNode.containerInfo;if(_===c||_.nodeType===8&&_.parentNode===c)break;if(f===4)for(f=o.return;f!==null;){var y=f.tag;if((y===3||y===4)&&(y=f.stateNode.containerInfo,y===c||y.nodeType===8&&y.parentNode===c))return;f=f.return}for(;_!==null;){if(f=bu(_),f===null)return;if(y=f.tag,y===5||y===6){o=l=f;continue e}_=_.parentNode}}o=o.return}xF(function(){var S=l,R=CA(n),w=[];e:{var b=d9.get(t);if(b!==void 0){var k=DA,M=t;switch(t){case"keypress":if(n_(n)===0)break e;case"keydown":case"keyup":k=Ese;break;case"focusin":M="focus",k=LR;break;case"focusout":M="blur",k=LR;break;case"beforeblur":case"afterblur":k=LR;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":k=J4;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":k=sse;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":k=yse;break;case a9:case c9:case u9:k=cse;break;case l9:k=Tse;break;case"scroll":k=rse;break;case"wheel":k=Ise;break;case"copy":case"cut":case"paste":k=lse;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":k=Z4}var F=(e&4)!==0,Y=!F&&t==="scroll",H=F?b!==null?b+"Capture":null:b;F=[];for(var B=S,K;B!==null;){K=B;var z=K.stateNode;if(K.tag===5&&z!==null&&(K=z,H!==null&&(z=pf(B,H),z!=null&&F.push(yf(B,z,K)))),Y)break;B=B.return}0<F.length&&(b=new k(b,M,null,n,R),w.push({event:b,listeners:F}))}}if(!(e&7)){e:{if(b=t==="mouseover"||t==="pointerover",k=t==="mouseout"||t==="pointerout",b&&n!==yw&&(M=n.relatedTarget||n.fromElement)&&(bu(M)||M[Ta]))break e;if((k||b)&&(b=R.window===R?R:(b=R.ownerDocument)?b.defaultView||b.parentWindow:window,k?(M=n.relatedTarget||n.toElement,k=S,M=M?bu(M):null,M!==null&&(Y=nl(M),M!==Y||M.tag!==5&&M.tag!==6)&&(M=null)):(k=null,M=S),k!==M)){if(F=J4,z="onMouseLeave",H="onMouseEnter",B="mouse",(t==="pointerout"||t==="pointerover")&&(F=Z4,z="onPointerLeave",H="onPointerEnter",B="pointer"),Y=k==null?b:_d(k),K=M==null?b:_d(M),b=new F(z,B+"leave",k,n,R),b.target=Y,b.relatedTarget=K,z=null,bu(R)===S&&(F=new F(H,B+"enter",M,n,R),F.target=K,F.relatedTarget=Y,z=F),Y=z,k&&M)t:{for(F=k,H=M,B=0,K=F;K;K=ad(K))B++;for(K=0,z=H;z;z=ad(z))K++;for(;0<B-K;)F=ad(F),B--;for(;0<K-B;)H=ad(H),K--;for(;B--;){if(F===H||H!==null&&F===H.alternate)break t;F=ad(F),H=ad(H)}F=null}else F=null;k!==null&&l5(w,b,k,F,!1),M!==null&&Y!==null&&l5(w,Y,M,F,!0)}}e:{if(b=S?_d(S):window,k=b.nodeName&&b.nodeName.toLowerCase(),k==="select"||k==="input"&&b.type==="file")var oe=Pse;else if(n5(b))if(n9)oe=Mse;else{oe=kse;var de=Dse}else(k=b.nodeName)&&k.toLowerCase()==="input"&&(b.type==="checkbox"||b.type==="radio")&&(oe=Lse);if(oe&&(oe=oe(t,S))){t9(w,oe,n,R);break e}de&&de(t,b,S),t==="focusout"&&(de=b._wrapperState)&&de.controlled&&b.type==="number"&&mw(b,"number",b.value)}switch(de=S?_d(S):window,t){case"focusin":(n5(de)||de.contentEditable==="true")&&(gd=de,Aw=S,Hp=null);break;case"focusout":Hp=Aw=gd=null;break;case"mousedown":bw=!0;break;case"contextmenu":case"mouseup":case"dragend":bw=!1,a5(w,n,R);break;case"selectionchange":if(Vse)break;case"keydown":case"keyup":a5(w,n,R)}var Ee;if(LA)e:{switch(t){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else md?ZF(t,n)&&(we="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(we="onCompositionStart");we&&(QF&&n.locale!=="ko"&&(md||we!=="onCompositionStart"?we==="onCompositionEnd"&&md&&(Ee=JF()):(dc=R,PA="value"in dc?dc.value:dc.textContent,md=!0)),de=D_(S,we),0<de.length&&(we=new Q4(we,t,null,n,R),w.push({event:we,listeners:de}),Ee?we.data=Ee:(Ee=e9(n),Ee!==null&&(we.data=Ee)))),(Ee=Cse?Ase(t,n):bse(t,n))&&(S=D_(S,"onBeforeInput"),0<S.length&&(R=new Q4("onBeforeInput","beforeinput",null,n,R),w.push({event:R,listeners:S}),R.data=Ee))}h9(w,e)})}function yf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function D_(t,e){for(var n=e+"Capture",o=[];t!==null;){var c=t,l=c.stateNode;c.tag===5&&l!==null&&(c=l,l=pf(t,n),l!=null&&o.unshift(yf(t,l,c)),l=pf(t,e),l!=null&&o.push(yf(t,l,c))),t=t.return}return o}function ad(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function l5(t,e,n,o,c){for(var l=e._reactName,f=[];n!==null&&n!==o;){var _=n,y=_.alternate,S=_.stateNode;if(y!==null&&y===o)break;_.tag===5&&S!==null&&(_=S,c?(y=pf(n,l),y!=null&&f.unshift(yf(n,y,_))):c||(y=pf(n,l),y!=null&&f.push(yf(n,y,_)))),n=n.return}f.length!==0&&t.push({event:e,listeners:f})}var Gse=/\r\n?/g,Wse=/\u0000|\uFFFD/g;function d5(t){return(typeof t=="string"?t:""+t).replace(Gse,`
`).replace(Wse,"")}function kE(t,e,n){if(e=d5(e),d5(t)!==e&&n)throw Error(Se(425))}function k_(){}var Ow=null,Nw=null;function Pw(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Dw=typeof setTimeout=="function"?setTimeout:void 0,Hse=typeof clearTimeout=="function"?clearTimeout:void 0,h5=typeof Promise=="function"?Promise:void 0,$se=typeof queueMicrotask=="function"?queueMicrotask:typeof h5<"u"?function(t){return h5.resolve(null).then(t).catch(Kse)}:Dw;function Kse(t){setTimeout(function(){throw t})}function GR(t,e){var n=e,o=0;do{var c=n.nextSibling;if(t.removeChild(n),c&&c.nodeType===8)if(n=c.data,n==="/$"){if(o===0){t.removeChild(c),gf(e);return}o--}else n!=="$"&&n!=="$?"&&n!=="$!"||o++;n=c}while(n);gf(e)}function vc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function p5(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var hh=Math.random().toString(36).slice(2),wo="__reactFiber$"+hh,Sf="__reactProps$"+hh,Ta="__reactContainer$"+hh,kw="__reactEvents$"+hh,qse="__reactListeners$"+hh,zse="__reactHandles$"+hh;function bu(t){var e=t[wo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ta]||n[wo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=p5(t);t!==null;){if(n=t[wo])return n;t=p5(t)}return e}t=n,n=t.parentNode}return null}function Qf(t){return t=t[wo]||t[Ta],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _d(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Se(33))}function qv(t){return t[Sf]||null}var Lw=[],vd=-1;function Wc(t){return{current:t}}function Sn(t){0>vd||(t.current=Lw[vd],Lw[vd]=null,vd--)}function En(t,e){vd++,Lw[vd]=t.current,t.current=e}var kc={},ui=Wc(kc),ki=Wc(!1),Gu=kc;function Wd(t,e){var n=t.type.contextTypes;if(!n)return kc;var o=t.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===e)return o.__reactInternalMemoizedMaskedChildContext;var c={},l;for(l in n)c[l]=e[l];return o&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=c),c}function Li(t){return t=t.childContextTypes,t!=null}function L_(){Sn(ki),Sn(ui)}function f5(t,e,n){if(ui.current!==kc)throw Error(Se(168));En(ui,e),En(ki,n)}function f9(t,e,n){var o=t.stateNode;if(e=e.childContextTypes,typeof o.getChildContext!="function")return n;o=o.getChildContext();for(var c in o)if(!(c in e))throw Error(Se(108,Die(t)||"Unknown",c));return Dn({},n,o)}function M_(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||kc,Gu=ui.current,En(ui,t),En(ki,ki.current),!0}function m5(t,e,n){var o=t.stateNode;if(!o)throw Error(Se(169));n?(t=f9(t,e,Gu),o.__reactInternalMemoizedMergedChildContext=t,Sn(ki),Sn(ui),En(ui,t)):Sn(ki),En(ki,n)}var la=null,zv=!1,WR=!1;function m9(t){la===null?la=[t]:la.push(t)}function Yse(t){zv=!0,m9(t)}function Hc(){if(!WR&&la!==null){WR=!0;var t=0,e=Qt;try{var n=la;for(Qt=1;t<n.length;t++){var o=n[t];do o=o(!0);while(o!==null)}la=null,zv=!1}catch(c){throw la!==null&&(la=la.slice(t+1)),jF(AA,Hc),c}finally{Qt=e,WR=!1}}return null}var yd=[],Sd=0,x_=null,U_=0,Ns=[],Ps=0,Wu=null,pa=1,fa="";function Ru(t,e){yd[Sd++]=U_,yd[Sd++]=x_,x_=t,U_=e}function g9(t,e,n){Ns[Ps++]=pa,Ns[Ps++]=fa,Ns[Ps++]=Wu,Wu=t;var o=pa;t=fa;var c=32-ro(o)-1;o&=~(1<<c),n+=1;var l=32-ro(e)+c;if(30<l){var f=c-c%5;l=(o&(1<<f)-1).toString(32),o>>=f,c-=f,pa=1<<32-ro(e)+c|n<<c|o,fa=l+t}else pa=1<<l|n<<c|o,fa=t}function xA(t){t.return!==null&&(Ru(t,1),g9(t,1,0))}function UA(t){for(;t===x_;)x_=yd[--Sd],yd[Sd]=null,U_=yd[--Sd],yd[Sd]=null;for(;t===Wu;)Wu=Ns[--Ps],Ns[Ps]=null,fa=Ns[--Ps],Ns[Ps]=null,pa=Ns[--Ps],Ns[Ps]=null}var as=null,ss=null,wn=!1,Zs=null;function E9(t,e){var n=Ds(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function g5(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,as=t,ss=vc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,as=t,ss=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Wu!==null?{id:pa,overflow:fa}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Ds(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,as=t,ss=null,!0):!1;default:return!1}}function Mw(t){return(t.mode&1)!==0&&(t.flags&128)===0}function xw(t){if(wn){var e=ss;if(e){var n=e;if(!g5(t,e)){if(Mw(t))throw Error(Se(418));e=vc(n.nextSibling);var o=as;e&&g5(t,e)?E9(o,n):(t.flags=t.flags&-4097|2,wn=!1,as=t)}}else{if(Mw(t))throw Error(Se(418));t.flags=t.flags&-4097|2,wn=!1,as=t}}}function E5(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;as=t}function LE(t){if(t!==as)return!1;if(!wn)return E5(t),wn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Pw(t.type,t.memoizedProps)),e&&(e=ss)){if(Mw(t))throw _9(),Error(Se(418));for(;e;)E9(t,e),e=vc(e.nextSibling)}if(E5(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Se(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ss=vc(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ss=null}}else ss=as?vc(t.stateNode.nextSibling):null;return!0}function _9(){for(var t=ss;t;)t=vc(t.nextSibling)}function Hd(){ss=as=null,wn=!1}function VA(t){Zs===null?Zs=[t]:Zs.push(t)}var Xse=Da.ReactCurrentBatchConfig;function Js(t,e){if(t&&t.defaultProps){e=Dn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var V_=Wc(null),F_=null,Td=null,FA=null;function jA(){FA=Td=F_=null}function BA(t){var e=V_.current;Sn(V_),t._currentValue=e}function Uw(t,e,n){for(;t!==null;){var o=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,o!==null&&(o.childLanes|=e)):o!==null&&(o.childLanes&e)!==e&&(o.childLanes|=e),t===n)break;t=t.return}}function kd(t,e){F_=t,FA=Td=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Di=!0),t.firstContext=null)}function Ms(t){var e=t._currentValue;if(FA!==t)if(t={context:t,memoizedValue:e,next:null},Td===null){if(F_===null)throw Error(Se(308));Td=t,F_.dependencies={lanes:0,firstContext:t}}else Td=Td.next=t;return e}var Ou=null;function GA(t){Ou===null?Ou=[t]:Ou.push(t)}function v9(t,e,n,o){var c=e.interleaved;return c===null?(n.next=n,GA(e)):(n.next=c.next,c.next=n),e.interleaved=n,Ra(t,o)}function Ra(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ic=!1;function WA(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function y9(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function va(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function yc(t,e,n){var o=t.updateQueue;if(o===null)return null;if(o=o.shared,Bt&2){var c=o.pending;return c===null?e.next=e:(e.next=c.next,c.next=e),o.pending=e,Ra(t,n)}return c=o.interleaved,c===null?(e.next=e,GA(o)):(e.next=c.next,c.next=e),o.interleaved=e,Ra(t,n)}function r_(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var o=e.lanes;o&=t.pendingLanes,n|=o,e.lanes=n,bA(t,n)}}function _5(t,e){var n=t.updateQueue,o=t.alternate;if(o!==null&&(o=o.updateQueue,n===o)){var c=null,l=null;if(n=n.firstBaseUpdate,n!==null){do{var f={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};l===null?c=l=f:l=l.next=f,n=n.next}while(n!==null);l===null?c=l=e:l=l.next=e}else c=l=e;n={baseState:o.baseState,firstBaseUpdate:c,lastBaseUpdate:l,shared:o.shared,effects:o.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function j_(t,e,n,o){var c=t.updateQueue;ic=!1;var l=c.firstBaseUpdate,f=c.lastBaseUpdate,_=c.shared.pending;if(_!==null){c.shared.pending=null;var y=_,S=y.next;y.next=null,f===null?l=S:f.next=S,f=y;var R=t.alternate;R!==null&&(R=R.updateQueue,_=R.lastBaseUpdate,_!==f&&(_===null?R.firstBaseUpdate=S:_.next=S,R.lastBaseUpdate=y))}if(l!==null){var w=c.baseState;f=0,R=S=y=null,_=l;do{var b=_.lane,k=_.eventTime;if((o&b)===b){R!==null&&(R=R.next={eventTime:k,lane:0,tag:_.tag,payload:_.payload,callback:_.callback,next:null});e:{var M=t,F=_;switch(b=e,k=n,F.tag){case 1:if(M=F.payload,typeof M=="function"){w=M.call(k,w,b);break e}w=M;break e;case 3:M.flags=M.flags&-65537|128;case 0:if(M=F.payload,b=typeof M=="function"?M.call(k,w,b):M,b==null)break e;w=Dn({},w,b);break e;case 2:ic=!0}}_.callback!==null&&_.lane!==0&&(t.flags|=64,b=c.effects,b===null?c.effects=[_]:b.push(_))}else k={eventTime:k,lane:b,tag:_.tag,payload:_.payload,callback:_.callback,next:null},R===null?(S=R=k,y=w):R=R.next=k,f|=b;if(_=_.next,_===null){if(_=c.shared.pending,_===null)break;b=_,_=b.next,b.next=null,c.lastBaseUpdate=b,c.shared.pending=null}}while(1);if(R===null&&(y=w),c.baseState=y,c.firstBaseUpdate=S,c.lastBaseUpdate=R,e=c.shared.interleaved,e!==null){c=e;do f|=c.lane,c=c.next;while(c!==e)}else l===null&&(c.shared.lanes=0);$u|=f,t.lanes=f,t.memoizedState=w}}function v5(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var o=t[e],c=o.callback;if(c!==null){if(o.callback=null,o=n,typeof c!="function")throw Error(Se(191,c));c.call(o)}}}var S9=new vF.Component().refs;function Vw(t,e,n,o){e=t.memoizedState,n=n(o,e),n=n==null?e:Dn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Yv={isMounted:function(t){return(t=t._reactInternals)?nl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var o=_i(),c=Tc(t),l=va(o,c);l.payload=e,n!=null&&(l.callback=n),e=yc(t,l,c),e!==null&&(io(e,t,c,o),r_(e,t,c))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var o=_i(),c=Tc(t),l=va(o,c);l.tag=1,l.payload=e,n!=null&&(l.callback=n),e=yc(t,l,c),e!==null&&(io(e,t,c,o),r_(e,t,c))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=_i(),o=Tc(t),c=va(n,o);c.tag=2,e!=null&&(c.callback=e),e=yc(t,c,o),e!==null&&(io(e,t,o,n),r_(e,t,o))}};function y5(t,e,n,o,c,l,f){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(o,l,f):e.prototype&&e.prototype.isPureReactComponent?!_f(n,o)||!_f(c,l):!0}function T9(t,e,n){var o=!1,c=kc,l=e.contextType;return typeof l=="object"&&l!==null?l=Ms(l):(c=Li(e)?Gu:ui.current,o=e.contextTypes,l=(o=o!=null)?Wd(t,c):kc),e=new e(n,l),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Yv,t.stateNode=e,e._reactInternals=t,o&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=c,t.__reactInternalMemoizedMaskedChildContext=l),e}function S5(t,e,n,o){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,o),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,o),e.state!==t&&Yv.enqueueReplaceState(e,e.state,null)}function Fw(t,e,n,o){var c=t.stateNode;c.props=n,c.state=t.memoizedState,c.refs=S9,WA(t);var l=e.contextType;typeof l=="object"&&l!==null?c.context=Ms(l):(l=Li(e)?Gu:ui.current,c.context=Wd(t,l)),c.state=t.memoizedState,l=e.getDerivedStateFromProps,typeof l=="function"&&(Vw(t,e,l,n),c.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(e=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),e!==c.state&&Yv.enqueueReplaceState(c,c.state,null),j_(t,n,c,o),c.state=t.memoizedState),typeof c.componentDidMount=="function"&&(t.flags|=4194308)}function Tp(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Se(309));var o=n.stateNode}if(!o)throw Error(Se(147,t));var c=o,l=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===l?e.ref:(e=function(f){var _=c.refs;_===S9&&(_=c.refs={}),f===null?delete _[l]:_[l]=f},e._stringRef=l,e)}if(typeof t!="string")throw Error(Se(284));if(!n._owner)throw Error(Se(290,t))}return t}function ME(t,e){throw t=Object.prototype.toString.call(e),Error(Se(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function T5(t){var e=t._init;return e(t._payload)}function R9(t){function e(H,B){if(t){var K=H.deletions;K===null?(H.deletions=[B],H.flags|=16):K.push(B)}}function n(H,B){if(!t)return null;for(;B!==null;)e(H,B),B=B.sibling;return null}function o(H,B){for(H=new Map;B!==null;)B.key!==null?H.set(B.key,B):H.set(B.index,B),B=B.sibling;return H}function c(H,B){return H=Rc(H,B),H.index=0,H.sibling=null,H}function l(H,B,K){return H.index=K,t?(K=H.alternate,K!==null?(K=K.index,K<B?(H.flags|=2,B):K):(H.flags|=2,B)):(H.flags|=1048576,B)}function f(H){return t&&H.alternate===null&&(H.flags|=2),H}function _(H,B,K,z){return B===null||B.tag!==6?(B=XR(K,H.mode,z),B.return=H,B):(B=c(B,K),B.return=H,B)}function y(H,B,K,z){var oe=K.type;return oe===fd?R(H,B,K.props.children,z,K.key):B!==null&&(B.elementType===oe||typeof oe=="object"&&oe!==null&&oe.$$typeof===rc&&T5(oe)===B.type)?(z=c(B,K.props),z.ref=Tp(H,B,K),z.return=H,z):(z=u_(K.type,K.key,K.props,null,H.mode,z),z.ref=Tp(H,B,K),z.return=H,z)}function S(H,B,K,z){return B===null||B.tag!==4||B.stateNode.containerInfo!==K.containerInfo||B.stateNode.implementation!==K.implementation?(B=JR(K,H.mode,z),B.return=H,B):(B=c(B,K.children||[]),B.return=H,B)}function R(H,B,K,z,oe){return B===null||B.tag!==7?(B=Uu(K,H.mode,z,oe),B.return=H,B):(B=c(B,K),B.return=H,B)}function w(H,B,K){if(typeof B=="string"&&B!==""||typeof B=="number")return B=XR(""+B,H.mode,K),B.return=H,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case IE:return K=u_(B.type,B.key,B.props,null,H.mode,K),K.ref=Tp(H,null,B),K.return=H,K;case pd:return B=JR(B,H.mode,K),B.return=H,B;case rc:var z=B._init;return w(H,z(B._payload),K)}if(Op(B)||Ep(B))return B=Uu(B,H.mode,K,null),B.return=H,B;ME(H,B)}return null}function b(H,B,K,z){var oe=B!==null?B.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return oe!==null?null:_(H,B,""+K,z);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case IE:return K.key===oe?y(H,B,K,z):null;case pd:return K.key===oe?S(H,B,K,z):null;case rc:return oe=K._init,b(H,B,oe(K._payload),z)}if(Op(K)||Ep(K))return oe!==null?null:R(H,B,K,z,null);ME(H,K)}return null}function k(H,B,K,z,oe){if(typeof z=="string"&&z!==""||typeof z=="number")return H=H.get(K)||null,_(B,H,""+z,oe);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case IE:return H=H.get(z.key===null?K:z.key)||null,y(B,H,z,oe);case pd:return H=H.get(z.key===null?K:z.key)||null,S(B,H,z,oe);case rc:var de=z._init;return k(H,B,K,de(z._payload),oe)}if(Op(z)||Ep(z))return H=H.get(K)||null,R(B,H,z,oe,null);ME(B,z)}return null}function M(H,B,K,z){for(var oe=null,de=null,Ee=B,we=B=0,Fe=null;Ee!==null&&we<K.length;we++){Ee.index>we?(Fe=Ee,Ee=null):Fe=Ee.sibling;var be=b(H,Ee,K[we],z);if(be===null){Ee===null&&(Ee=Fe);break}t&&Ee&&be.alternate===null&&e(H,Ee),B=l(be,B,we),de===null?oe=be:de.sibling=be,de=be,Ee=Fe}if(we===K.length)return n(H,Ee),wn&&Ru(H,we),oe;if(Ee===null){for(;we<K.length;we++)Ee=w(H,K[we],z),Ee!==null&&(B=l(Ee,B,we),de===null?oe=Ee:de.sibling=Ee,de=Ee);return wn&&Ru(H,we),oe}for(Ee=o(H,Ee);we<K.length;we++)Fe=k(Ee,H,we,K[we],z),Fe!==null&&(t&&Fe.alternate!==null&&Ee.delete(Fe.key===null?we:Fe.key),B=l(Fe,B,we),de===null?oe=Fe:de.sibling=Fe,de=Fe);return t&&Ee.forEach(function(dt){return e(H,dt)}),wn&&Ru(H,we),oe}function F(H,B,K,z){var oe=Ep(K);if(typeof oe!="function")throw Error(Se(150));if(K=oe.call(K),K==null)throw Error(Se(151));for(var de=oe=null,Ee=B,we=B=0,Fe=null,be=K.next();Ee!==null&&!be.done;we++,be=K.next()){Ee.index>we?(Fe=Ee,Ee=null):Fe=Ee.sibling;var dt=b(H,Ee,be.value,z);if(dt===null){Ee===null&&(Ee=Fe);break}t&&Ee&&dt.alternate===null&&e(H,Ee),B=l(dt,B,we),de===null?oe=dt:de.sibling=dt,de=dt,Ee=Fe}if(be.done)return n(H,Ee),wn&&Ru(H,we),oe;if(Ee===null){for(;!be.done;we++,be=K.next())be=w(H,be.value,z),be!==null&&(B=l(be,B,we),de===null?oe=be:de.sibling=be,de=be);return wn&&Ru(H,we),oe}for(Ee=o(H,Ee);!be.done;we++,be=K.next())be=k(Ee,H,we,be.value,z),be!==null&&(t&&be.alternate!==null&&Ee.delete(be.key===null?we:be.key),B=l(be,B,we),de===null?oe=be:de.sibling=be,de=be);return t&&Ee.forEach(function(kn){return e(H,kn)}),wn&&Ru(H,we),oe}function Y(H,B,K,z){if(typeof K=="object"&&K!==null&&K.type===fd&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case IE:e:{for(var oe=K.key,de=B;de!==null;){if(de.key===oe){if(oe=K.type,oe===fd){if(de.tag===7){n(H,de.sibling),B=c(de,K.props.children),B.return=H,H=B;break e}}else if(de.elementType===oe||typeof oe=="object"&&oe!==null&&oe.$$typeof===rc&&T5(oe)===de.type){n(H,de.sibling),B=c(de,K.props),B.ref=Tp(H,de,K),B.return=H,H=B;break e}n(H,de);break}else e(H,de);de=de.sibling}K.type===fd?(B=Uu(K.props.children,H.mode,z,K.key),B.return=H,H=B):(z=u_(K.type,K.key,K.props,null,H.mode,z),z.ref=Tp(H,B,K),z.return=H,H=z)}return f(H);case pd:e:{for(de=K.key;B!==null;){if(B.key===de)if(B.tag===4&&B.stateNode.containerInfo===K.containerInfo&&B.stateNode.implementation===K.implementation){n(H,B.sibling),B=c(B,K.children||[]),B.return=H,H=B;break e}else{n(H,B);break}else e(H,B);B=B.sibling}B=JR(K,H.mode,z),B.return=H,H=B}return f(H);case rc:return de=K._init,Y(H,B,de(K._payload),z)}if(Op(K))return M(H,B,K,z);if(Ep(K))return F(H,B,K,z);ME(H,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,B!==null&&B.tag===6?(n(H,B.sibling),B=c(B,K),B.return=H,H=B):(n(H,B),B=XR(K,H.mode,z),B.return=H,H=B),f(H)):n(H,B)}return Y}var $d=R9(!0),I9=R9(!1),Zf={},Oo=Wc(Zf),Tf=Wc(Zf),Rf=Wc(Zf);function Nu(t){if(t===Zf)throw Error(Se(174));return t}function HA(t,e){switch(En(Rf,e),En(Tf,t),En(Oo,Zf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ew(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ew(e,t)}Sn(Oo),En(Oo,e)}function Kd(){Sn(Oo),Sn(Tf),Sn(Rf)}function w9(t){Nu(Rf.current);var e=Nu(Oo.current),n=Ew(e,t.type);e!==n&&(En(Tf,t),En(Oo,n))}function $A(t){Tf.current===t&&(Sn(Oo),Sn(Tf))}var Nn=Wc(0);function B_(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var HR=[];function KA(){for(var t=0;t<HR.length;t++)HR[t]._workInProgressVersionPrimary=null;HR.length=0}var i_=Da.ReactCurrentDispatcher,$R=Da.ReactCurrentBatchConfig,Hu=0,Pn=null,mr=null,Ar=null,G_=!1,$p=!1,If=0,Jse=0;function Zr(){throw Error(Se(321))}function qA(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ao(t[n],e[n]))return!1;return!0}function zA(t,e,n,o,c,l){if(Hu=l,Pn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,i_.current=t===null||t.memoizedState===null?toe:noe,t=n(o,c),$p){l=0;do{if($p=!1,If=0,25<=l)throw Error(Se(301));l+=1,Ar=mr=null,e.updateQueue=null,i_.current=roe,t=n(o,c)}while($p)}if(i_.current=W_,e=mr!==null&&mr.next!==null,Hu=0,Ar=mr=Pn=null,G_=!1,e)throw Error(Se(300));return t}function YA(){var t=If!==0;return If=0,t}function Ro(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ar===null?Pn.memoizedState=Ar=t:Ar=Ar.next=t,Ar}function xs(){if(mr===null){var t=Pn.alternate;t=t!==null?t.memoizedState:null}else t=mr.next;var e=Ar===null?Pn.memoizedState:Ar.next;if(e!==null)Ar=e,mr=t;else{if(t===null)throw Error(Se(310));mr=t,t={memoizedState:mr.memoizedState,baseState:mr.baseState,baseQueue:mr.baseQueue,queue:mr.queue,next:null},Ar===null?Pn.memoizedState=Ar=t:Ar=Ar.next=t}return Ar}function wf(t,e){return typeof e=="function"?e(t):e}function KR(t){var e=xs(),n=e.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=t;var o=mr,c=o.baseQueue,l=n.pending;if(l!==null){if(c!==null){var f=c.next;c.next=l.next,l.next=f}o.baseQueue=c=l,n.pending=null}if(c!==null){l=c.next,o=o.baseState;var _=f=null,y=null,S=l;do{var R=S.lane;if((Hu&R)===R)y!==null&&(y=y.next={lane:0,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null}),o=S.hasEagerState?S.eagerState:t(o,S.action);else{var w={lane:R,action:S.action,hasEagerState:S.hasEagerState,eagerState:S.eagerState,next:null};y===null?(_=y=w,f=o):y=y.next=w,Pn.lanes|=R,$u|=R}S=S.next}while(S!==null&&S!==l);y===null?f=o:y.next=_,ao(o,e.memoizedState)||(Di=!0),e.memoizedState=o,e.baseState=f,e.baseQueue=y,n.lastRenderedState=o}if(t=n.interleaved,t!==null){c=t;do l=c.lane,Pn.lanes|=l,$u|=l,c=c.next;while(c!==t)}else c===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function qR(t){var e=xs(),n=e.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=t;var o=n.dispatch,c=n.pending,l=e.memoizedState;if(c!==null){n.pending=null;var f=c=c.next;do l=t(l,f.action),f=f.next;while(f!==c);ao(l,e.memoizedState)||(Di=!0),e.memoizedState=l,e.baseQueue===null&&(e.baseState=l),n.lastRenderedState=l}return[l,o]}function C9(){}function A9(t,e){var n=Pn,o=xs(),c=e(),l=!ao(o.memoizedState,c);if(l&&(o.memoizedState=c,Di=!0),o=o.queue,XA(N9.bind(null,n,o,t),[t]),o.getSnapshot!==e||l||Ar!==null&&Ar.memoizedState.tag&1){if(n.flags|=2048,Cf(9,O9.bind(null,n,o,c,e),void 0,null),br===null)throw Error(Se(349));Hu&30||b9(n,e,c)}return c}function b9(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Pn.updateQueue,e===null?(e={lastEffect:null,stores:null},Pn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function O9(t,e,n,o){e.value=n,e.getSnapshot=o,P9(e)&&D9(t)}function N9(t,e,n){return n(function(){P9(e)&&D9(t)})}function P9(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ao(t,n)}catch{return!0}}function D9(t){var e=Ra(t,1);e!==null&&io(e,t,1,-1)}function R5(t){var e=Ro();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wf,lastRenderedState:t},e.queue=t,t=t.dispatch=eoe.bind(null,Pn,t),[e.memoizedState,t]}function Cf(t,e,n,o){return t={tag:t,create:e,destroy:n,deps:o,next:null},e=Pn.updateQueue,e===null?(e={lastEffect:null,stores:null},Pn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(o=n.next,n.next=t,t.next=o,e.lastEffect=t)),t}function k9(){return xs().memoizedState}function s_(t,e,n,o){var c=Ro();Pn.flags|=t,c.memoizedState=Cf(1|e,n,void 0,o===void 0?null:o)}function Xv(t,e,n,o){var c=xs();o=o===void 0?null:o;var l=void 0;if(mr!==null){var f=mr.memoizedState;if(l=f.destroy,o!==null&&qA(o,f.deps)){c.memoizedState=Cf(e,n,l,o);return}}Pn.flags|=t,c.memoizedState=Cf(1|e,n,l,o)}function I5(t,e){return s_(8390656,8,t,e)}function XA(t,e){return Xv(2048,8,t,e)}function L9(t,e){return Xv(4,2,t,e)}function M9(t,e){return Xv(4,4,t,e)}function x9(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function U9(t,e,n){return n=n!=null?n.concat([t]):null,Xv(4,4,x9.bind(null,e,t),n)}function JA(){}function V9(t,e){var n=xs();e=e===void 0?null:e;var o=n.memoizedState;return o!==null&&e!==null&&qA(e,o[1])?o[0]:(n.memoizedState=[t,e],t)}function F9(t,e){var n=xs();e=e===void 0?null:e;var o=n.memoizedState;return o!==null&&e!==null&&qA(e,o[1])?o[0]:(t=t(),n.memoizedState=[t,e],t)}function j9(t,e,n){return Hu&21?(ao(n,e)||(n=WF(),Pn.lanes|=n,$u|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Di=!0),t.memoizedState=n)}function Qse(t,e){var n=Qt;Qt=n!==0&&4>n?n:4,t(!0);var o=$R.transition;$R.transition={};try{t(!1),e()}finally{Qt=n,$R.transition=o}}function B9(){return xs().memoizedState}function Zse(t,e,n){var o=Tc(t);if(n={lane:o,action:n,hasEagerState:!1,eagerState:null,next:null},G9(t))W9(e,n);else if(n=v9(t,e,n,o),n!==null){var c=_i();io(n,t,o,c),H9(n,e,o)}}function eoe(t,e,n){var o=Tc(t),c={lane:o,action:n,hasEagerState:!1,eagerState:null,next:null};if(G9(t))W9(e,c);else{var l=t.alternate;if(t.lanes===0&&(l===null||l.lanes===0)&&(l=e.lastRenderedReducer,l!==null))try{var f=e.lastRenderedState,_=l(f,n);if(c.hasEagerState=!0,c.eagerState=_,ao(_,f)){var y=e.interleaved;y===null?(c.next=c,GA(e)):(c.next=y.next,y.next=c),e.interleaved=c;return}}catch{}finally{}n=v9(t,e,c,o),n!==null&&(c=_i(),io(n,t,o,c),H9(n,e,o))}}function G9(t){var e=t.alternate;return t===Pn||e!==null&&e===Pn}function W9(t,e){$p=G_=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function H9(t,e,n){if(n&4194240){var o=e.lanes;o&=t.pendingLanes,n|=o,e.lanes=n,bA(t,n)}}var W_={readContext:Ms,useCallback:Zr,useContext:Zr,useEffect:Zr,useImperativeHandle:Zr,useInsertionEffect:Zr,useLayoutEffect:Zr,useMemo:Zr,useReducer:Zr,useRef:Zr,useState:Zr,useDebugValue:Zr,useDeferredValue:Zr,useTransition:Zr,useMutableSource:Zr,useSyncExternalStore:Zr,useId:Zr,unstable_isNewReconciler:!1},toe={readContext:Ms,useCallback:function(t,e){return Ro().memoizedState=[t,e===void 0?null:e],t},useContext:Ms,useEffect:I5,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,s_(4194308,4,x9.bind(null,e,t),n)},useLayoutEffect:function(t,e){return s_(4194308,4,t,e)},useInsertionEffect:function(t,e){return s_(4,2,t,e)},useMemo:function(t,e){var n=Ro();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var o=Ro();return e=n!==void 0?n(e):e,o.memoizedState=o.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},o.queue=t,t=t.dispatch=Zse.bind(null,Pn,t),[o.memoizedState,t]},useRef:function(t){var e=Ro();return t={current:t},e.memoizedState=t},useState:R5,useDebugValue:JA,useDeferredValue:function(t){return Ro().memoizedState=t},useTransition:function(){var t=R5(!1),e=t[0];return t=Qse.bind(null,t[1]),Ro().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var o=Pn,c=Ro();if(wn){if(n===void 0)throw Error(Se(407));n=n()}else{if(n=e(),br===null)throw Error(Se(349));Hu&30||b9(o,e,n)}c.memoizedState=n;var l={value:n,getSnapshot:e};return c.queue=l,I5(N9.bind(null,o,l,t),[t]),o.flags|=2048,Cf(9,O9.bind(null,o,l,n,e),void 0,null),n},useId:function(){var t=Ro(),e=br.identifierPrefix;if(wn){var n=fa,o=pa;n=(o&~(1<<32-ro(o)-1)).toString(32)+n,e=":"+e+"R"+n,n=If++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Jse++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},noe={readContext:Ms,useCallback:V9,useContext:Ms,useEffect:XA,useImperativeHandle:U9,useInsertionEffect:L9,useLayoutEffect:M9,useMemo:F9,useReducer:KR,useRef:k9,useState:function(){return KR(wf)},useDebugValue:JA,useDeferredValue:function(t){var e=xs();return j9(e,mr.memoizedState,t)},useTransition:function(){var t=KR(wf)[0],e=xs().memoizedState;return[t,e]},useMutableSource:C9,useSyncExternalStore:A9,useId:B9,unstable_isNewReconciler:!1},roe={readContext:Ms,useCallback:V9,useContext:Ms,useEffect:XA,useImperativeHandle:U9,useInsertionEffect:L9,useLayoutEffect:M9,useMemo:F9,useReducer:qR,useRef:k9,useState:function(){return qR(wf)},useDebugValue:JA,useDeferredValue:function(t){var e=xs();return mr===null?e.memoizedState=t:j9(e,mr.memoizedState,t)},useTransition:function(){var t=qR(wf)[0],e=xs().memoizedState;return[t,e]},useMutableSource:C9,useSyncExternalStore:A9,useId:B9,unstable_isNewReconciler:!1};function qd(t,e){try{var n="",o=e;do n+=Pie(o),o=o.return;while(o);var c=n}catch(l){c=`
Error generating stack: `+l.message+`
`+l.stack}return{value:t,source:e,stack:c,digest:null}}function zR(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function jw(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var ioe=typeof WeakMap=="function"?WeakMap:Map;function $9(t,e,n){n=va(-1,n),n.tag=3,n.payload={element:null};var o=e.value;return n.callback=function(){$_||($_=!0,Xw=o),jw(t,e)},n}function K9(t,e,n){n=va(-1,n),n.tag=3;var o=t.type.getDerivedStateFromError;if(typeof o=="function"){var c=e.value;n.payload=function(){return o(c)},n.callback=function(){jw(t,e)}}var l=t.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(n.callback=function(){jw(t,e),typeof o!="function"&&(Sc===null?Sc=new Set([this]):Sc.add(this));var f=e.stack;this.componentDidCatch(e.value,{componentStack:f!==null?f:""})}),n}function w5(t,e,n){var o=t.pingCache;if(o===null){o=t.pingCache=new ioe;var c=new Set;o.set(e,c)}else c=o.get(e),c===void 0&&(c=new Set,o.set(e,c));c.has(n)||(c.add(n),t=_oe.bind(null,t,e,n),e.then(t,t))}function C5(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function A5(t,e,n,o,c){return t.mode&1?(t.flags|=65536,t.lanes=c,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=va(-1,1),e.tag=2,yc(n,e,1))),n.lanes|=1),t)}var soe=Da.ReactCurrentOwner,Di=!1;function gi(t,e,n,o){e.child=t===null?I9(e,null,n,o):$d(e,t.child,n,o)}function b5(t,e,n,o,c){n=n.render;var l=e.ref;return kd(e,c),o=zA(t,e,n,o,l,c),n=YA(),t!==null&&!Di?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,Ia(t,e,c)):(wn&&n&&xA(e),e.flags|=1,gi(t,e,o,c),e.child)}function O5(t,e,n,o,c){if(t===null){var l=n.type;return typeof l=="function"&&!sb(l)&&l.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=l,q9(t,e,l,o,c)):(t=u_(n.type,null,o,e,e.mode,c),t.ref=e.ref,t.return=e,e.child=t)}if(l=t.child,!(t.lanes&c)){var f=l.memoizedProps;if(n=n.compare,n=n!==null?n:_f,n(f,o)&&t.ref===e.ref)return Ia(t,e,c)}return e.flags|=1,t=Rc(l,o),t.ref=e.ref,t.return=e,e.child=t}function q9(t,e,n,o,c){if(t!==null){var l=t.memoizedProps;if(_f(l,o)&&t.ref===e.ref)if(Di=!1,e.pendingProps=o=l,(t.lanes&c)!==0)t.flags&131072&&(Di=!0);else return e.lanes=t.lanes,Ia(t,e,c)}return Bw(t,e,n,o,c)}function z9(t,e,n){var o=e.pendingProps,c=o.children,l=t!==null?t.memoizedState:null;if(o.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},En(Id,is),is|=n;else{if(!(n&1073741824))return t=l!==null?l.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,En(Id,is),is|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=l!==null?l.baseLanes:n,En(Id,is),is|=o}else l!==null?(o=l.baseLanes|n,e.memoizedState=null):o=n,En(Id,is),is|=o;return gi(t,e,c,n),e.child}function Y9(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Bw(t,e,n,o,c){var l=Li(n)?Gu:ui.current;return l=Wd(e,l),kd(e,c),n=zA(t,e,n,o,l,c),o=YA(),t!==null&&!Di?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,Ia(t,e,c)):(wn&&o&&xA(e),e.flags|=1,gi(t,e,n,c),e.child)}function N5(t,e,n,o,c){if(Li(n)){var l=!0;M_(e)}else l=!1;if(kd(e,c),e.stateNode===null)o_(t,e),T9(e,n,o),Fw(e,n,o,c),o=!0;else if(t===null){var f=e.stateNode,_=e.memoizedProps;f.props=_;var y=f.context,S=n.contextType;typeof S=="object"&&S!==null?S=Ms(S):(S=Li(n)?Gu:ui.current,S=Wd(e,S));var R=n.getDerivedStateFromProps,w=typeof R=="function"||typeof f.getSnapshotBeforeUpdate=="function";w||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(_!==o||y!==S)&&S5(e,f,o,S),ic=!1;var b=e.memoizedState;f.state=b,j_(e,o,f,c),y=e.memoizedState,_!==o||b!==y||ki.current||ic?(typeof R=="function"&&(Vw(e,n,R,o),y=e.memoizedState),(_=ic||y5(e,n,_,o,b,y,S))?(w||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(e.flags|=4194308)):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=o,e.memoizedState=y),f.props=o,f.state=y,f.context=S,o=_):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),o=!1)}else{f=e.stateNode,y9(t,e),_=e.memoizedProps,S=e.type===e.elementType?_:Js(e.type,_),f.props=S,w=e.pendingProps,b=f.context,y=n.contextType,typeof y=="object"&&y!==null?y=Ms(y):(y=Li(n)?Gu:ui.current,y=Wd(e,y));var k=n.getDerivedStateFromProps;(R=typeof k=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(_!==w||b!==y)&&S5(e,f,o,y),ic=!1,b=e.memoizedState,f.state=b,j_(e,o,f,c);var M=e.memoizedState;_!==w||b!==M||ki.current||ic?(typeof k=="function"&&(Vw(e,n,k,o),M=e.memoizedState),(S=ic||y5(e,n,S,o,b,M,y)||!1)?(R||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(o,M,y),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(o,M,y)),typeof f.componentDidUpdate=="function"&&(e.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof f.componentDidUpdate!="function"||_===t.memoizedProps&&b===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||_===t.memoizedProps&&b===t.memoizedState||(e.flags|=1024),e.memoizedProps=o,e.memoizedState=M),f.props=o,f.state=M,f.context=y,o=S):(typeof f.componentDidUpdate!="function"||_===t.memoizedProps&&b===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||_===t.memoizedProps&&b===t.memoizedState||(e.flags|=1024),o=!1)}return Gw(t,e,n,o,l,c)}function Gw(t,e,n,o,c,l){Y9(t,e);var f=(e.flags&128)!==0;if(!o&&!f)return c&&m5(e,n,!1),Ia(t,e,l);o=e.stateNode,soe.current=e;var _=f&&typeof n.getDerivedStateFromError!="function"?null:o.render();return e.flags|=1,t!==null&&f?(e.child=$d(e,t.child,null,l),e.child=$d(e,null,_,l)):gi(t,e,_,l),e.memoizedState=o.state,c&&m5(e,n,!0),e.child}function X9(t){var e=t.stateNode;e.pendingContext?f5(t,e.pendingContext,e.pendingContext!==e.context):e.context&&f5(t,e.context,!1),HA(t,e.containerInfo)}function P5(t,e,n,o,c){return Hd(),VA(c),e.flags|=256,gi(t,e,n,o),e.child}var Ww={dehydrated:null,treeContext:null,retryLane:0};function Hw(t){return{baseLanes:t,cachePool:null,transitions:null}}function J9(t,e,n){var o=e.pendingProps,c=Nn.current,l=!1,f=(e.flags&128)!==0,_;if((_=f)||(_=t!==null&&t.memoizedState===null?!1:(c&2)!==0),_?(l=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(c|=1),En(Nn,c&1),t===null)return xw(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(f=o.children,t=o.fallback,l?(o=e.mode,l=e.child,f={mode:"hidden",children:f},!(o&1)&&l!==null?(l.childLanes=0,l.pendingProps=f):l=Zv(f,o,0,null),t=Uu(t,o,n,null),l.return=e,t.return=e,l.sibling=t,e.child=l,e.child.memoizedState=Hw(n),e.memoizedState=Ww,t):QA(e,f));if(c=t.memoizedState,c!==null&&(_=c.dehydrated,_!==null))return ooe(t,e,f,o,_,c,n);if(l){l=o.fallback,f=e.mode,c=t.child,_=c.sibling;var y={mode:"hidden",children:o.children};return!(f&1)&&e.child!==c?(o=e.child,o.childLanes=0,o.pendingProps=y,e.deletions=null):(o=Rc(c,y),o.subtreeFlags=c.subtreeFlags&14680064),_!==null?l=Rc(_,l):(l=Uu(l,f,n,null),l.flags|=2),l.return=e,o.return=e,o.sibling=l,e.child=o,o=l,l=e.child,f=t.child.memoizedState,f=f===null?Hw(n):{baseLanes:f.baseLanes|n,cachePool:null,transitions:f.transitions},l.memoizedState=f,l.childLanes=t.childLanes&~n,e.memoizedState=Ww,o}return l=t.child,t=l.sibling,o=Rc(l,{mode:"visible",children:o.children}),!(e.mode&1)&&(o.lanes=n),o.return=e,o.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=o,e.memoizedState=null,o}function QA(t,e){return e=Zv({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function xE(t,e,n,o){return o!==null&&VA(o),$d(e,t.child,null,n),t=QA(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function ooe(t,e,n,o,c,l,f){if(n)return e.flags&256?(e.flags&=-257,o=zR(Error(Se(422))),xE(t,e,f,o)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(l=o.fallback,c=e.mode,o=Zv({mode:"visible",children:o.children},c,0,null),l=Uu(l,c,f,null),l.flags|=2,o.return=e,l.return=e,o.sibling=l,e.child=o,e.mode&1&&$d(e,t.child,null,f),e.child.memoizedState=Hw(f),e.memoizedState=Ww,l);if(!(e.mode&1))return xE(t,e,f,null);if(c.data==="$!"){if(o=c.nextSibling&&c.nextSibling.dataset,o)var _=o.dgst;return o=_,l=Error(Se(419)),o=zR(l,o,void 0),xE(t,e,f,o)}if(_=(f&t.childLanes)!==0,Di||_){if(o=br,o!==null){switch(f&-f){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(o.suspendedLanes|f)?0:c,c!==0&&c!==l.retryLane&&(l.retryLane=c,Ra(t,c),io(o,t,c,-1))}return ib(),o=zR(Error(Se(421))),xE(t,e,f,o)}return c.data==="$?"?(e.flags|=128,e.child=t.child,e=voe.bind(null,t),c._reactRetry=e,null):(t=l.treeContext,ss=vc(c.nextSibling),as=e,wn=!0,Zs=null,t!==null&&(Ns[Ps++]=pa,Ns[Ps++]=fa,Ns[Ps++]=Wu,pa=t.id,fa=t.overflow,Wu=e),e=QA(e,o.children),e.flags|=4096,e)}function D5(t,e,n){t.lanes|=e;var o=t.alternate;o!==null&&(o.lanes|=e),Uw(t.return,e,n)}function YR(t,e,n,o,c){var l=t.memoizedState;l===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:o,tail:n,tailMode:c}:(l.isBackwards=e,l.rendering=null,l.renderingStartTime=0,l.last=o,l.tail=n,l.tailMode=c)}function Q9(t,e,n){var o=e.pendingProps,c=o.revealOrder,l=o.tail;if(gi(t,e,o.children,n),o=Nn.current,o&2)o=o&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&D5(t,n,e);else if(t.tag===19)D5(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}o&=1}if(En(Nn,o),!(e.mode&1))e.memoizedState=null;else switch(c){case"forwards":for(n=e.child,c=null;n!==null;)t=n.alternate,t!==null&&B_(t)===null&&(c=n),n=n.sibling;n=c,n===null?(c=e.child,e.child=null):(c=n.sibling,n.sibling=null),YR(e,!1,c,n,l);break;case"backwards":for(n=null,c=e.child,e.child=null;c!==null;){if(t=c.alternate,t!==null&&B_(t)===null){e.child=c;break}t=c.sibling,c.sibling=n,n=c,c=t}YR(e,!0,n,null,l);break;case"together":YR(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function o_(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ia(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),$u|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Se(153));if(e.child!==null){for(t=e.child,n=Rc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Rc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function aoe(t,e,n){switch(e.tag){case 3:X9(e),Hd();break;case 5:w9(e);break;case 1:Li(e.type)&&M_(e);break;case 4:HA(e,e.stateNode.containerInfo);break;case 10:var o=e.type._context,c=e.memoizedProps.value;En(V_,o._currentValue),o._currentValue=c;break;case 13:if(o=e.memoizedState,o!==null)return o.dehydrated!==null?(En(Nn,Nn.current&1),e.flags|=128,null):n&e.child.childLanes?J9(t,e,n):(En(Nn,Nn.current&1),t=Ia(t,e,n),t!==null?t.sibling:null);En(Nn,Nn.current&1);break;case 19:if(o=(n&e.childLanes)!==0,t.flags&128){if(o)return Q9(t,e,n);e.flags|=128}if(c=e.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),En(Nn,Nn.current),o)break;return null;case 22:case 23:return e.lanes=0,z9(t,e,n)}return Ia(t,e,n)}var Z9,$w,ej,tj;Z9=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};$w=function(){};ej=function(t,e,n,o){var c=t.memoizedProps;if(c!==o){t=e.stateNode,Nu(Oo.current);var l=null;switch(n){case"input":c=pw(t,c),o=pw(t,o),l=[];break;case"select":c=Dn({},c,{value:void 0}),o=Dn({},o,{value:void 0}),l=[];break;case"textarea":c=gw(t,c),o=gw(t,o),l=[];break;default:typeof c.onClick!="function"&&typeof o.onClick=="function"&&(t.onclick=k_)}_w(n,o);var f;n=null;for(S in c)if(!o.hasOwnProperty(S)&&c.hasOwnProperty(S)&&c[S]!=null)if(S==="style"){var _=c[S];for(f in _)_.hasOwnProperty(f)&&(n||(n={}),n[f]="")}else S!=="dangerouslySetInnerHTML"&&S!=="children"&&S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(df.hasOwnProperty(S)?l||(l=[]):(l=l||[]).push(S,null));for(S in o){var y=o[S];if(_=c!=null?c[S]:void 0,o.hasOwnProperty(S)&&y!==_&&(y!=null||_!=null))if(S==="style")if(_){for(f in _)!_.hasOwnProperty(f)||y&&y.hasOwnProperty(f)||(n||(n={}),n[f]="");for(f in y)y.hasOwnProperty(f)&&_[f]!==y[f]&&(n||(n={}),n[f]=y[f])}else n||(l||(l=[]),l.push(S,n)),n=y;else S==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,_=_?_.__html:void 0,y!=null&&_!==y&&(l=l||[]).push(S,y)):S==="children"?typeof y!="string"&&typeof y!="number"||(l=l||[]).push(S,""+y):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&(df.hasOwnProperty(S)?(y!=null&&S==="onScroll"&&yn("scroll",t),l||_===y||(l=[])):(l=l||[]).push(S,y))}n&&(l=l||[]).push("style",n);var S=l;(e.updateQueue=S)&&(e.flags|=4)}};tj=function(t,e,n,o){n!==o&&(e.flags|=4)};function Rp(t,e){if(!wn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:o.sibling=null}}function ei(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,o=0;if(e)for(var c=t.child;c!==null;)n|=c.lanes|c.childLanes,o|=c.subtreeFlags&14680064,o|=c.flags&14680064,c.return=t,c=c.sibling;else for(c=t.child;c!==null;)n|=c.lanes|c.childLanes,o|=c.subtreeFlags,o|=c.flags,c.return=t,c=c.sibling;return t.subtreeFlags|=o,t.childLanes=n,e}function coe(t,e,n){var o=e.pendingProps;switch(UA(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ei(e),null;case 1:return Li(e.type)&&L_(),ei(e),null;case 3:return o=e.stateNode,Kd(),Sn(ki),Sn(ui),KA(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(LE(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Zs!==null&&(Zw(Zs),Zs=null))),$w(t,e),ei(e),null;case 5:$A(e);var c=Nu(Rf.current);if(n=e.type,t!==null&&e.stateNode!=null)ej(t,e,n,o,c),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!o){if(e.stateNode===null)throw Error(Se(166));return ei(e),null}if(t=Nu(Oo.current),LE(e)){o=e.stateNode,n=e.type;var l=e.memoizedProps;switch(o[wo]=e,o[Sf]=l,t=(e.mode&1)!==0,n){case"dialog":yn("cancel",o),yn("close",o);break;case"iframe":case"object":case"embed":yn("load",o);break;case"video":case"audio":for(c=0;c<Pp.length;c++)yn(Pp[c],o);break;case"source":yn("error",o);break;case"img":case"image":case"link":yn("error",o),yn("load",o);break;case"details":yn("toggle",o);break;case"input":B4(o,l),yn("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!l.multiple},yn("invalid",o);break;case"textarea":W4(o,l),yn("invalid",o)}_w(n,l),c=null;for(var f in l)if(l.hasOwnProperty(f)){var _=l[f];f==="children"?typeof _=="string"?o.textContent!==_&&(l.suppressHydrationWarning!==!0&&kE(o.textContent,_,t),c=["children",_]):typeof _=="number"&&o.textContent!==""+_&&(l.suppressHydrationWarning!==!0&&kE(o.textContent,_,t),c=["children",""+_]):df.hasOwnProperty(f)&&_!=null&&f==="onScroll"&&yn("scroll",o)}switch(n){case"input":wE(o),G4(o,l,!0);break;case"textarea":wE(o),H4(o);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(o.onclick=k_)}o=c,e.updateQueue=o,o!==null&&(e.flags|=4)}else{f=c.nodeType===9?c:c.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=bF(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=f.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof o.is=="string"?t=f.createElement(n,{is:o.is}):(t=f.createElement(n),n==="select"&&(f=t,o.multiple?f.multiple=!0:o.size&&(f.size=o.size))):t=f.createElementNS(t,n),t[wo]=e,t[Sf]=o,Z9(t,e,!1,!1),e.stateNode=t;e:{switch(f=vw(n,o),n){case"dialog":yn("cancel",t),yn("close",t),c=o;break;case"iframe":case"object":case"embed":yn("load",t),c=o;break;case"video":case"audio":for(c=0;c<Pp.length;c++)yn(Pp[c],t);c=o;break;case"source":yn("error",t),c=o;break;case"img":case"image":case"link":yn("error",t),yn("load",t),c=o;break;case"details":yn("toggle",t),c=o;break;case"input":B4(t,o),c=pw(t,o),yn("invalid",t);break;case"option":c=o;break;case"select":t._wrapperState={wasMultiple:!!o.multiple},c=Dn({},o,{value:void 0}),yn("invalid",t);break;case"textarea":W4(t,o),c=gw(t,o),yn("invalid",t);break;default:c=o}_w(n,c),_=c;for(l in _)if(_.hasOwnProperty(l)){var y=_[l];l==="style"?PF(t,y):l==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&OF(t,y)):l==="children"?typeof y=="string"?(n!=="textarea"||y!=="")&&hf(t,y):typeof y=="number"&&hf(t,""+y):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(df.hasOwnProperty(l)?y!=null&&l==="onScroll"&&yn("scroll",t):y!=null&&TA(t,l,y,f))}switch(n){case"input":wE(t),G4(t,o,!1);break;case"textarea":wE(t),H4(t);break;case"option":o.value!=null&&t.setAttribute("value",""+Dc(o.value));break;case"select":t.multiple=!!o.multiple,l=o.value,l!=null?Od(t,!!o.multiple,l,!1):o.defaultValue!=null&&Od(t,!!o.multiple,o.defaultValue,!0);break;default:typeof c.onClick=="function"&&(t.onclick=k_)}switch(n){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ei(e),null;case 6:if(t&&e.stateNode!=null)tj(t,e,t.memoizedProps,o);else{if(typeof o!="string"&&e.stateNode===null)throw Error(Se(166));if(n=Nu(Rf.current),Nu(Oo.current),LE(e)){if(o=e.stateNode,n=e.memoizedProps,o[wo]=e,(l=o.nodeValue!==n)&&(t=as,t!==null))switch(t.tag){case 3:kE(o.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&kE(o.nodeValue,n,(t.mode&1)!==0)}l&&(e.flags|=4)}else o=(n.nodeType===9?n:n.ownerDocument).createTextNode(o),o[wo]=e,e.stateNode=o}return ei(e),null;case 13:if(Sn(Nn),o=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(wn&&ss!==null&&e.mode&1&&!(e.flags&128))_9(),Hd(),e.flags|=98560,l=!1;else if(l=LE(e),o!==null&&o.dehydrated!==null){if(t===null){if(!l)throw Error(Se(318));if(l=e.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(Se(317));l[wo]=e}else Hd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ei(e),l=!1}else Zs!==null&&(Zw(Zs),Zs=null),l=!0;if(!l)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(o=o!==null,o!==(t!==null&&t.memoizedState!==null)&&o&&(e.child.flags|=8192,e.mode&1&&(t===null||Nn.current&1?Er===0&&(Er=3):ib())),e.updateQueue!==null&&(e.flags|=4),ei(e),null);case 4:return Kd(),$w(t,e),t===null&&vf(e.stateNode.containerInfo),ei(e),null;case 10:return BA(e.type._context),ei(e),null;case 17:return Li(e.type)&&L_(),ei(e),null;case 19:if(Sn(Nn),l=e.memoizedState,l===null)return ei(e),null;if(o=(e.flags&128)!==0,f=l.rendering,f===null)if(o)Rp(l,!1);else{if(Er!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(f=B_(t),f!==null){for(e.flags|=128,Rp(l,!1),o=f.updateQueue,o!==null&&(e.updateQueue=o,e.flags|=4),e.subtreeFlags=0,o=n,n=e.child;n!==null;)l=n,t=o,l.flags&=14680066,f=l.alternate,f===null?(l.childLanes=0,l.lanes=t,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=f.childLanes,l.lanes=f.lanes,l.child=f.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=f.memoizedProps,l.memoizedState=f.memoizedState,l.updateQueue=f.updateQueue,l.type=f.type,t=f.dependencies,l.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return En(Nn,Nn.current&1|2),e.child}t=t.sibling}l.tail!==null&&Wn()>zd&&(e.flags|=128,o=!0,Rp(l,!1),e.lanes=4194304)}else{if(!o)if(t=B_(f),t!==null){if(e.flags|=128,o=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Rp(l,!0),l.tail===null&&l.tailMode==="hidden"&&!f.alternate&&!wn)return ei(e),null}else 2*Wn()-l.renderingStartTime>zd&&n!==1073741824&&(e.flags|=128,o=!0,Rp(l,!1),e.lanes=4194304);l.isBackwards?(f.sibling=e.child,e.child=f):(n=l.last,n!==null?n.sibling=f:e.child=f,l.last=f)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=Wn(),e.sibling=null,n=Nn.current,En(Nn,o?n&1|2:n&1),e):(ei(e),null);case 22:case 23:return rb(),o=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==o&&(e.flags|=8192),o&&e.mode&1?is&1073741824&&(ei(e),e.subtreeFlags&6&&(e.flags|=8192)):ei(e),null;case 24:return null;case 25:return null}throw Error(Se(156,e.tag))}function uoe(t,e){switch(UA(e),e.tag){case 1:return Li(e.type)&&L_(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Kd(),Sn(ki),Sn(ui),KA(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return $A(e),null;case 13:if(Sn(Nn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Se(340));Hd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Sn(Nn),null;case 4:return Kd(),null;case 10:return BA(e.type._context),null;case 22:case 23:return rb(),null;case 24:return null;default:return null}}var UE=!1,ri=!1,loe=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function Rd(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(o){Un(t,e,o)}else n.current=null}function Kw(t,e,n){try{n()}catch(o){Un(t,e,o)}}var k5=!1;function doe(t,e){if(Ow=N_,t=s9(),MA(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var o=n.getSelection&&n.getSelection();if(o&&o.rangeCount!==0){n=o.anchorNode;var c=o.anchorOffset,l=o.focusNode;o=o.focusOffset;try{n.nodeType,l.nodeType}catch{n=null;break e}var f=0,_=-1,y=-1,S=0,R=0,w=t,b=null;t:for(;;){for(var k;w!==n||c!==0&&w.nodeType!==3||(_=f+c),w!==l||o!==0&&w.nodeType!==3||(y=f+o),w.nodeType===3&&(f+=w.nodeValue.length),(k=w.firstChild)!==null;)b=w,w=k;for(;;){if(w===t)break t;if(b===n&&++S===c&&(_=f),b===l&&++R===o&&(y=f),(k=w.nextSibling)!==null)break;w=b,b=w.parentNode}w=k}n=_===-1||y===-1?null:{start:_,end:y}}else n=null}n=n||{start:0,end:0}}else n=null;for(Nw={focusedElem:t,selectionRange:n},N_=!1,Ve=e;Ve!==null;)if(e=Ve,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ve=t;else for(;Ve!==null;){e=Ve;try{var M=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var F=M.memoizedProps,Y=M.memoizedState,H=e.stateNode,B=H.getSnapshotBeforeUpdate(e.elementType===e.type?F:Js(e.type,F),Y);H.__reactInternalSnapshotBeforeUpdate=B}break;case 3:var K=e.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Se(163))}}catch(z){Un(e,e.return,z)}if(t=e.sibling,t!==null){t.return=e.return,Ve=t;break}Ve=e.return}return M=k5,k5=!1,M}function Kp(t,e,n){var o=e.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&t)===t){var l=c.destroy;c.destroy=void 0,l!==void 0&&Kw(e,n,l)}c=c.next}while(c!==o)}}function Jv(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var o=n.create;n.destroy=o()}n=n.next}while(n!==e)}}function qw(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function nj(t){var e=t.alternate;e!==null&&(t.alternate=null,nj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[wo],delete e[Sf],delete e[kw],delete e[qse],delete e[zse])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function rj(t){return t.tag===5||t.tag===3||t.tag===4}function L5(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||rj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function zw(t,e,n){var o=t.tag;if(o===5||o===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=k_));else if(o!==4&&(t=t.child,t!==null))for(zw(t,e,n),t=t.sibling;t!==null;)zw(t,e,n),t=t.sibling}function Yw(t,e,n){var o=t.tag;if(o===5||o===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(o!==4&&(t=t.child,t!==null))for(Yw(t,e,n),t=t.sibling;t!==null;)Yw(t,e,n),t=t.sibling}var Fr=null,Qs=!1;function ec(t,e,n){for(n=n.child;n!==null;)ij(t,e,n),n=n.sibling}function ij(t,e,n){if(bo&&typeof bo.onCommitFiberUnmount=="function")try{bo.onCommitFiberUnmount(Wv,n)}catch{}switch(n.tag){case 5:ri||Rd(n,e);case 6:var o=Fr,c=Qs;Fr=null,ec(t,e,n),Fr=o,Qs=c,Fr!==null&&(Qs?(t=Fr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Fr.removeChild(n.stateNode));break;case 18:Fr!==null&&(Qs?(t=Fr,n=n.stateNode,t.nodeType===8?GR(t.parentNode,n):t.nodeType===1&&GR(t,n),gf(t)):GR(Fr,n.stateNode));break;case 4:o=Fr,c=Qs,Fr=n.stateNode.containerInfo,Qs=!0,ec(t,e,n),Fr=o,Qs=c;break;case 0:case 11:case 14:case 15:if(!ri&&(o=n.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){c=o=o.next;do{var l=c,f=l.destroy;l=l.tag,f!==void 0&&(l&2||l&4)&&Kw(n,e,f),c=c.next}while(c!==o)}ec(t,e,n);break;case 1:if(!ri&&(Rd(n,e),o=n.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=n.memoizedProps,o.state=n.memoizedState,o.componentWillUnmount()}catch(_){Un(n,e,_)}ec(t,e,n);break;case 21:ec(t,e,n);break;case 22:n.mode&1?(ri=(o=ri)||n.memoizedState!==null,ec(t,e,n),ri=o):ec(t,e,n);break;default:ec(t,e,n)}}function M5(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new loe),e.forEach(function(o){var c=yoe.bind(null,t,o);n.has(o)||(n.add(o),o.then(c,c))})}}function Ys(t,e){var n=e.deletions;if(n!==null)for(var o=0;o<n.length;o++){var c=n[o];try{var l=t,f=e,_=f;e:for(;_!==null;){switch(_.tag){case 5:Fr=_.stateNode,Qs=!1;break e;case 3:Fr=_.stateNode.containerInfo,Qs=!0;break e;case 4:Fr=_.stateNode.containerInfo,Qs=!0;break e}_=_.return}if(Fr===null)throw Error(Se(160));ij(l,f,c),Fr=null,Qs=!1;var y=c.alternate;y!==null&&(y.return=null),c.return=null}catch(S){Un(c,e,S)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)sj(e,t),e=e.sibling}function sj(t,e){var n=t.alternate,o=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ys(e,t),To(t),o&4){try{Kp(3,t,t.return),Jv(3,t)}catch(F){Un(t,t.return,F)}try{Kp(5,t,t.return)}catch(F){Un(t,t.return,F)}}break;case 1:Ys(e,t),To(t),o&512&&n!==null&&Rd(n,n.return);break;case 5:if(Ys(e,t),To(t),o&512&&n!==null&&Rd(n,n.return),t.flags&32){var c=t.stateNode;try{hf(c,"")}catch(F){Un(t,t.return,F)}}if(o&4&&(c=t.stateNode,c!=null)){var l=t.memoizedProps,f=n!==null?n.memoizedProps:l,_=t.type,y=t.updateQueue;if(t.updateQueue=null,y!==null)try{_==="input"&&l.type==="radio"&&l.name!=null&&CF(c,l),vw(_,f);var S=vw(_,l);for(f=0;f<y.length;f+=2){var R=y[f],w=y[f+1];R==="style"?PF(c,w):R==="dangerouslySetInnerHTML"?OF(c,w):R==="children"?hf(c,w):TA(c,R,w,S)}switch(_){case"input":fw(c,l);break;case"textarea":AF(c,l);break;case"select":var b=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!l.multiple;var k=l.value;k!=null?Od(c,!!l.multiple,k,!1):b!==!!l.multiple&&(l.defaultValue!=null?Od(c,!!l.multiple,l.defaultValue,!0):Od(c,!!l.multiple,l.multiple?[]:"",!1))}c[Sf]=l}catch(F){Un(t,t.return,F)}}break;case 6:if(Ys(e,t),To(t),o&4){if(t.stateNode===null)throw Error(Se(162));c=t.stateNode,l=t.memoizedProps;try{c.nodeValue=l}catch(F){Un(t,t.return,F)}}break;case 3:if(Ys(e,t),To(t),o&4&&n!==null&&n.memoizedState.isDehydrated)try{gf(e.containerInfo)}catch(F){Un(t,t.return,F)}break;case 4:Ys(e,t),To(t);break;case 13:Ys(e,t),To(t),c=t.child,c.flags&8192&&(l=c.memoizedState!==null,c.stateNode.isHidden=l,!l||c.alternate!==null&&c.alternate.memoizedState!==null||(tb=Wn())),o&4&&M5(t);break;case 22:if(R=n!==null&&n.memoizedState!==null,t.mode&1?(ri=(S=ri)||R,Ys(e,t),ri=S):Ys(e,t),To(t),o&8192){if(S=t.memoizedState!==null,(t.stateNode.isHidden=S)&&!R&&t.mode&1)for(Ve=t,R=t.child;R!==null;){for(w=Ve=R;Ve!==null;){switch(b=Ve,k=b.child,b.tag){case 0:case 11:case 14:case 15:Kp(4,b,b.return);break;case 1:Rd(b,b.return);var M=b.stateNode;if(typeof M.componentWillUnmount=="function"){o=b,n=b.return;try{e=o,M.props=e.memoizedProps,M.state=e.memoizedState,M.componentWillUnmount()}catch(F){Un(o,n,F)}}break;case 5:Rd(b,b.return);break;case 22:if(b.memoizedState!==null){U5(w);continue}}k!==null?(k.return=b,Ve=k):U5(w)}R=R.sibling}e:for(R=null,w=t;;){if(w.tag===5){if(R===null){R=w;try{c=w.stateNode,S?(l=c.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(_=w.stateNode,y=w.memoizedProps.style,f=y!=null&&y.hasOwnProperty("display")?y.display:null,_.style.display=NF("display",f))}catch(F){Un(t,t.return,F)}}}else if(w.tag===6){if(R===null)try{w.stateNode.nodeValue=S?"":w.memoizedProps}catch(F){Un(t,t.return,F)}}else if((w.tag!==22&&w.tag!==23||w.memoizedState===null||w===t)&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===t)break e;for(;w.sibling===null;){if(w.return===null||w.return===t)break e;R===w&&(R=null),w=w.return}R===w&&(R=null),w.sibling.return=w.return,w=w.sibling}}break;case 19:Ys(e,t),To(t),o&4&&M5(t);break;case 21:break;default:Ys(e,t),To(t)}}function To(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(rj(n)){var o=n;break e}n=n.return}throw Error(Se(160))}switch(o.tag){case 5:var c=o.stateNode;o.flags&32&&(hf(c,""),o.flags&=-33);var l=L5(t);Yw(t,l,c);break;case 3:case 4:var f=o.stateNode.containerInfo,_=L5(t);zw(t,_,f);break;default:throw Error(Se(161))}}catch(y){Un(t,t.return,y)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function hoe(t,e,n){Ve=t,oj(t)}function oj(t,e,n){for(var o=(t.mode&1)!==0;Ve!==null;){var c=Ve,l=c.child;if(c.tag===22&&o){var f=c.memoizedState!==null||UE;if(!f){var _=c.alternate,y=_!==null&&_.memoizedState!==null||ri;_=UE;var S=ri;if(UE=f,(ri=y)&&!S)for(Ve=c;Ve!==null;)f=Ve,y=f.child,f.tag===22&&f.memoizedState!==null?V5(c):y!==null?(y.return=f,Ve=y):V5(c);for(;l!==null;)Ve=l,oj(l),l=l.sibling;Ve=c,UE=_,ri=S}x5(t)}else c.subtreeFlags&8772&&l!==null?(l.return=c,Ve=l):x5(t)}}function x5(t){for(;Ve!==null;){var e=Ve;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ri||Jv(5,e);break;case 1:var o=e.stateNode;if(e.flags&4&&!ri)if(n===null)o.componentDidMount();else{var c=e.elementType===e.type?n.memoizedProps:Js(e.type,n.memoizedProps);o.componentDidUpdate(c,n.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var l=e.updateQueue;l!==null&&v5(e,l,o);break;case 3:var f=e.updateQueue;if(f!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}v5(e,f,n)}break;case 5:var _=e.stateNode;if(n===null&&e.flags&4){n=_;var y=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&n.focus();break;case"img":y.src&&(n.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var S=e.alternate;if(S!==null){var R=S.memoizedState;if(R!==null){var w=R.dehydrated;w!==null&&gf(w)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Se(163))}ri||e.flags&512&&qw(e)}catch(b){Un(e,e.return,b)}}if(e===t){Ve=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ve=n;break}Ve=e.return}}function U5(t){for(;Ve!==null;){var e=Ve;if(e===t){Ve=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ve=n;break}Ve=e.return}}function V5(t){for(;Ve!==null;){var e=Ve;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Jv(4,e)}catch(y){Un(e,n,y)}break;case 1:var o=e.stateNode;if(typeof o.componentDidMount=="function"){var c=e.return;try{o.componentDidMount()}catch(y){Un(e,c,y)}}var l=e.return;try{qw(e)}catch(y){Un(e,l,y)}break;case 5:var f=e.return;try{qw(e)}catch(y){Un(e,f,y)}}}catch(y){Un(e,e.return,y)}if(e===t){Ve=null;break}var _=e.sibling;if(_!==null){_.return=e.return,Ve=_;break}Ve=e.return}}var poe=Math.ceil,H_=Da.ReactCurrentDispatcher,ZA=Da.ReactCurrentOwner,Ls=Da.ReactCurrentBatchConfig,Bt=0,br=null,ar=null,Gr=0,is=0,Id=Wc(0),Er=0,Af=null,$u=0,Qv=0,eb=0,qp=null,Ni=null,tb=0,zd=1/0,ua=null,$_=!1,Xw=null,Sc=null,VE=!1,hc=null,K_=0,zp=0,Jw=null,a_=-1,c_=0;function _i(){return Bt&6?Wn():a_!==-1?a_:a_=Wn()}function Tc(t){return t.mode&1?Bt&2&&Gr!==0?Gr&-Gr:Xse.transition!==null?(c_===0&&(c_=WF()),c_):(t=Qt,t!==0||(t=window.event,t=t===void 0?16:XF(t.type)),t):1}function io(t,e,n,o){if(50<zp)throw zp=0,Jw=null,Error(Se(185));Xf(t,n,o),(!(Bt&2)||t!==br)&&(t===br&&(!(Bt&2)&&(Qv|=n),Er===4&&ac(t,Gr)),Mi(t,o),n===1&&Bt===0&&!(e.mode&1)&&(zd=Wn()+500,zv&&Hc()))}function Mi(t,e){var n=t.callbackNode;Xie(t,e);var o=O_(t,t===br?Gr:0);if(o===0)n!==null&&q4(n),t.callbackNode=null,t.callbackPriority=0;else if(e=o&-o,t.callbackPriority!==e){if(n!=null&&q4(n),e===1)t.tag===0?Yse(F5.bind(null,t)):m9(F5.bind(null,t)),$se(function(){!(Bt&6)&&Hc()}),n=null;else{switch(HF(o)){case 1:n=AA;break;case 4:n=BF;break;case 16:n=b_;break;case 536870912:n=GF;break;default:n=b_}n=fj(n,aj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function aj(t,e){if(a_=-1,c_=0,Bt&6)throw Error(Se(327));var n=t.callbackNode;if(Ld()&&t.callbackNode!==n)return null;var o=O_(t,t===br?Gr:0);if(o===0)return null;if(o&30||o&t.expiredLanes||e)e=q_(t,o);else{e=o;var c=Bt;Bt|=2;var l=uj();(br!==t||Gr!==e)&&(ua=null,zd=Wn()+500,xu(t,e));do try{goe();break}catch(_){cj(t,_)}while(1);jA(),H_.current=l,Bt=c,ar!==null?e=0:(br=null,Gr=0,e=Er)}if(e!==0){if(e===2&&(c=Iw(t),c!==0&&(o=c,e=Qw(t,c))),e===1)throw n=Af,xu(t,0),ac(t,o),Mi(t,Wn()),n;if(e===6)ac(t,o);else{if(c=t.current.alternate,!(o&30)&&!foe(c)&&(e=q_(t,o),e===2&&(l=Iw(t),l!==0&&(o=l,e=Qw(t,l))),e===1))throw n=Af,xu(t,0),ac(t,o),Mi(t,Wn()),n;switch(t.finishedWork=c,t.finishedLanes=o,e){case 0:case 1:throw Error(Se(345));case 2:Iu(t,Ni,ua);break;case 3:if(ac(t,o),(o&130023424)===o&&(e=tb+500-Wn(),10<e)){if(O_(t,0)!==0)break;if(c=t.suspendedLanes,(c&o)!==o){_i(),t.pingedLanes|=t.suspendedLanes&c;break}t.timeoutHandle=Dw(Iu.bind(null,t,Ni,ua),e);break}Iu(t,Ni,ua);break;case 4:if(ac(t,o),(o&4194240)===o)break;for(e=t.eventTimes,c=-1;0<o;){var f=31-ro(o);l=1<<f,f=e[f],f>c&&(c=f),o&=~l}if(o=c,o=Wn()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*poe(o/1960))-o,10<o){t.timeoutHandle=Dw(Iu.bind(null,t,Ni,ua),o);break}Iu(t,Ni,ua);break;case 5:Iu(t,Ni,ua);break;default:throw Error(Se(329))}}}return Mi(t,Wn()),t.callbackNode===n?aj.bind(null,t):null}function Qw(t,e){var n=qp;return t.current.memoizedState.isDehydrated&&(xu(t,e).flags|=256),t=q_(t,e),t!==2&&(e=Ni,Ni=n,e!==null&&Zw(e)),t}function Zw(t){Ni===null?Ni=t:Ni.push.apply(Ni,t)}function foe(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var o=0;o<n.length;o++){var c=n[o],l=c.getSnapshot;c=c.value;try{if(!ao(l(),c))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ac(t,e){for(e&=~eb,e&=~Qv,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ro(e),o=1<<n;t[n]=-1,e&=~o}}function F5(t){if(Bt&6)throw Error(Se(327));Ld();var e=O_(t,0);if(!(e&1))return Mi(t,Wn()),null;var n=q_(t,e);if(t.tag!==0&&n===2){var o=Iw(t);o!==0&&(e=o,n=Qw(t,o))}if(n===1)throw n=Af,xu(t,0),ac(t,e),Mi(t,Wn()),n;if(n===6)throw Error(Se(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Iu(t,Ni,ua),Mi(t,Wn()),null}function nb(t,e){var n=Bt;Bt|=1;try{return t(e)}finally{Bt=n,Bt===0&&(zd=Wn()+500,zv&&Hc())}}function Ku(t){hc!==null&&hc.tag===0&&!(Bt&6)&&Ld();var e=Bt;Bt|=1;var n=Ls.transition,o=Qt;try{if(Ls.transition=null,Qt=1,t)return t()}finally{Qt=o,Ls.transition=n,Bt=e,!(Bt&6)&&Hc()}}function rb(){is=Id.current,Sn(Id)}function xu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Hse(n)),ar!==null)for(n=ar.return;n!==null;){var o=n;switch(UA(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&L_();break;case 3:Kd(),Sn(ki),Sn(ui),KA();break;case 5:$A(o);break;case 4:Kd();break;case 13:Sn(Nn);break;case 19:Sn(Nn);break;case 10:BA(o.type._context);break;case 22:case 23:rb()}n=n.return}if(br=t,ar=t=Rc(t.current,null),Gr=is=e,Er=0,Af=null,eb=Qv=$u=0,Ni=qp=null,Ou!==null){for(e=0;e<Ou.length;e++)if(n=Ou[e],o=n.interleaved,o!==null){n.interleaved=null;var c=o.next,l=n.pending;if(l!==null){var f=l.next;l.next=c,o.next=f}n.pending=o}Ou=null}return t}function cj(t,e){do{var n=ar;try{if(jA(),i_.current=W_,G_){for(var o=Pn.memoizedState;o!==null;){var c=o.queue;c!==null&&(c.pending=null),o=o.next}G_=!1}if(Hu=0,Ar=mr=Pn=null,$p=!1,If=0,ZA.current=null,n===null||n.return===null){Er=1,Af=e,ar=null;break}e:{var l=t,f=n.return,_=n,y=e;if(e=Gr,_.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var S=y,R=_,w=R.tag;if(!(R.mode&1)&&(w===0||w===11||w===15)){var b=R.alternate;b?(R.updateQueue=b.updateQueue,R.memoizedState=b.memoizedState,R.lanes=b.lanes):(R.updateQueue=null,R.memoizedState=null)}var k=C5(f);if(k!==null){k.flags&=-257,A5(k,f,_,l,e),k.mode&1&&w5(l,S,e),e=k,y=S;var M=e.updateQueue;if(M===null){var F=new Set;F.add(y),e.updateQueue=F}else M.add(y);break e}else{if(!(e&1)){w5(l,S,e),ib();break e}y=Error(Se(426))}}else if(wn&&_.mode&1){var Y=C5(f);if(Y!==null){!(Y.flags&65536)&&(Y.flags|=256),A5(Y,f,_,l,e),VA(qd(y,_));break e}}l=y=qd(y,_),Er!==4&&(Er=2),qp===null?qp=[l]:qp.push(l),l=f;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e;var H=$9(l,y,e);_5(l,H);break e;case 1:_=y;var B=l.type,K=l.stateNode;if(!(l.flags&128)&&(typeof B.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(Sc===null||!Sc.has(K)))){l.flags|=65536,e&=-e,l.lanes|=e;var z=K9(l,_,e);_5(l,z);break e}}l=l.return}while(l!==null)}dj(n)}catch(oe){e=oe,ar===n&&n!==null&&(ar=n=n.return);continue}break}while(1)}function uj(){var t=H_.current;return H_.current=W_,t===null?W_:t}function ib(){(Er===0||Er===3||Er===2)&&(Er=4),br===null||!($u&268435455)&&!(Qv&268435455)||ac(br,Gr)}function q_(t,e){var n=Bt;Bt|=2;var o=uj();(br!==t||Gr!==e)&&(ua=null,xu(t,e));do try{moe();break}catch(c){cj(t,c)}while(1);if(jA(),Bt=n,H_.current=o,ar!==null)throw Error(Se(261));return br=null,Gr=0,Er}function moe(){for(;ar!==null;)lj(ar)}function goe(){for(;ar!==null&&!Bie();)lj(ar)}function lj(t){var e=pj(t.alternate,t,is);t.memoizedProps=t.pendingProps,e===null?dj(t):ar=e,ZA.current=null}function dj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=uoe(n,e),n!==null){n.flags&=32767,ar=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Er=6,ar=null;return}}else if(n=coe(n,e,is),n!==null){ar=n;return}if(e=e.sibling,e!==null){ar=e;return}ar=e=t}while(e!==null);Er===0&&(Er=5)}function Iu(t,e,n){var o=Qt,c=Ls.transition;try{Ls.transition=null,Qt=1,Eoe(t,e,n,o)}finally{Ls.transition=c,Qt=o}return null}function Eoe(t,e,n,o){do Ld();while(hc!==null);if(Bt&6)throw Error(Se(327));n=t.finishedWork;var c=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Se(177));t.callbackNode=null,t.callbackPriority=0;var l=n.lanes|n.childLanes;if(Jie(t,l),t===br&&(ar=br=null,Gr=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||VE||(VE=!0,fj(b_,function(){return Ld(),null})),l=(n.flags&15990)!==0,n.subtreeFlags&15990||l){l=Ls.transition,Ls.transition=null;var f=Qt;Qt=1;var _=Bt;Bt|=4,ZA.current=null,doe(t,n),sj(n,t),Use(Nw),N_=!!Ow,Nw=Ow=null,t.current=n,hoe(n),Gie(),Bt=_,Qt=f,Ls.transition=l}else t.current=n;if(VE&&(VE=!1,hc=t,K_=c),l=t.pendingLanes,l===0&&(Sc=null),$ie(n.stateNode),Mi(t,Wn()),e!==null)for(o=t.onRecoverableError,n=0;n<e.length;n++)c=e[n],o(c.value,{componentStack:c.stack,digest:c.digest});if($_)throw $_=!1,t=Xw,Xw=null,t;return K_&1&&t.tag!==0&&Ld(),l=t.pendingLanes,l&1?t===Jw?zp++:(zp=0,Jw=t):zp=0,Hc(),null}function Ld(){if(hc!==null){var t=HF(K_),e=Ls.transition,n=Qt;try{if(Ls.transition=null,Qt=16>t?16:t,hc===null)var o=!1;else{if(t=hc,hc=null,K_=0,Bt&6)throw Error(Se(331));var c=Bt;for(Bt|=4,Ve=t.current;Ve!==null;){var l=Ve,f=l.child;if(Ve.flags&16){var _=l.deletions;if(_!==null){for(var y=0;y<_.length;y++){var S=_[y];for(Ve=S;Ve!==null;){var R=Ve;switch(R.tag){case 0:case 11:case 15:Kp(8,R,l)}var w=R.child;if(w!==null)w.return=R,Ve=w;else for(;Ve!==null;){R=Ve;var b=R.sibling,k=R.return;if(nj(R),R===S){Ve=null;break}if(b!==null){b.return=k,Ve=b;break}Ve=k}}}var M=l.alternate;if(M!==null){var F=M.child;if(F!==null){M.child=null;do{var Y=F.sibling;F.sibling=null,F=Y}while(F!==null)}}Ve=l}}if(l.subtreeFlags&2064&&f!==null)f.return=l,Ve=f;else e:for(;Ve!==null;){if(l=Ve,l.flags&2048)switch(l.tag){case 0:case 11:case 15:Kp(9,l,l.return)}var H=l.sibling;if(H!==null){H.return=l.return,Ve=H;break e}Ve=l.return}}var B=t.current;for(Ve=B;Ve!==null;){f=Ve;var K=f.child;if(f.subtreeFlags&2064&&K!==null)K.return=f,Ve=K;else e:for(f=B;Ve!==null;){if(_=Ve,_.flags&2048)try{switch(_.tag){case 0:case 11:case 15:Jv(9,_)}}catch(oe){Un(_,_.return,oe)}if(_===f){Ve=null;break e}var z=_.sibling;if(z!==null){z.return=_.return,Ve=z;break e}Ve=_.return}}if(Bt=c,Hc(),bo&&typeof bo.onPostCommitFiberRoot=="function")try{bo.onPostCommitFiberRoot(Wv,t)}catch{}o=!0}return o}finally{Qt=n,Ls.transition=e}}return!1}function j5(t,e,n){e=qd(n,e),e=$9(t,e,1),t=yc(t,e,1),e=_i(),t!==null&&(Xf(t,1,e),Mi(t,e))}function Un(t,e,n){if(t.tag===3)j5(t,t,n);else for(;e!==null;){if(e.tag===3){j5(e,t,n);break}else if(e.tag===1){var o=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(Sc===null||!Sc.has(o))){t=qd(n,t),t=K9(e,t,1),e=yc(e,t,1),t=_i(),e!==null&&(Xf(e,1,t),Mi(e,t));break}}e=e.return}}function _oe(t,e,n){var o=t.pingCache;o!==null&&o.delete(e),e=_i(),t.pingedLanes|=t.suspendedLanes&n,br===t&&(Gr&n)===n&&(Er===4||Er===3&&(Gr&130023424)===Gr&&500>Wn()-tb?xu(t,0):eb|=n),Mi(t,e)}function hj(t,e){e===0&&(t.mode&1?(e=bE,bE<<=1,!(bE&130023424)&&(bE=4194304)):e=1);var n=_i();t=Ra(t,e),t!==null&&(Xf(t,e,n),Mi(t,n))}function voe(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),hj(t,n)}function yoe(t,e){var n=0;switch(t.tag){case 13:var o=t.stateNode,c=t.memoizedState;c!==null&&(n=c.retryLane);break;case 19:o=t.stateNode;break;default:throw Error(Se(314))}o!==null&&o.delete(e),hj(t,n)}var pj;pj=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ki.current)Di=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Di=!1,aoe(t,e,n);Di=!!(t.flags&131072)}else Di=!1,wn&&e.flags&1048576&&g9(e,U_,e.index);switch(e.lanes=0,e.tag){case 2:var o=e.type;o_(t,e),t=e.pendingProps;var c=Wd(e,ui.current);kd(e,n),c=zA(null,e,o,t,c,n);var l=YA();return e.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Li(o)?(l=!0,M_(e)):l=!1,e.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,WA(e),c.updater=Yv,e.stateNode=c,c._reactInternals=e,Fw(e,o,t,n),e=Gw(null,e,o,!0,l,n)):(e.tag=0,wn&&l&&xA(e),gi(null,e,c,n),e=e.child),e;case 16:o=e.elementType;e:{switch(o_(t,e),t=e.pendingProps,c=o._init,o=c(o._payload),e.type=o,c=e.tag=Toe(o),t=Js(o,t),c){case 0:e=Bw(null,e,o,t,n);break e;case 1:e=N5(null,e,o,t,n);break e;case 11:e=b5(null,e,o,t,n);break e;case 14:e=O5(null,e,o,Js(o.type,t),n);break e}throw Error(Se(306,o,""))}return e;case 0:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Js(o,c),Bw(t,e,o,c,n);case 1:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Js(o,c),N5(t,e,o,c,n);case 3:e:{if(X9(e),t===null)throw Error(Se(387));o=e.pendingProps,l=e.memoizedState,c=l.element,y9(t,e),j_(e,o,null,n);var f=e.memoizedState;if(o=f.element,l.isDehydrated)if(l={element:o,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},e.updateQueue.baseState=l,e.memoizedState=l,e.flags&256){c=qd(Error(Se(423)),e),e=P5(t,e,o,n,c);break e}else if(o!==c){c=qd(Error(Se(424)),e),e=P5(t,e,o,n,c);break e}else for(ss=vc(e.stateNode.containerInfo.firstChild),as=e,wn=!0,Zs=null,n=I9(e,null,o,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Hd(),o===c){e=Ia(t,e,n);break e}gi(t,e,o,n)}e=e.child}return e;case 5:return w9(e),t===null&&xw(e),o=e.type,c=e.pendingProps,l=t!==null?t.memoizedProps:null,f=c.children,Pw(o,c)?f=null:l!==null&&Pw(o,l)&&(e.flags|=32),Y9(t,e),gi(t,e,f,n),e.child;case 6:return t===null&&xw(e),null;case 13:return J9(t,e,n);case 4:return HA(e,e.stateNode.containerInfo),o=e.pendingProps,t===null?e.child=$d(e,null,o,n):gi(t,e,o,n),e.child;case 11:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Js(o,c),b5(t,e,o,c,n);case 7:return gi(t,e,e.pendingProps,n),e.child;case 8:return gi(t,e,e.pendingProps.children,n),e.child;case 12:return gi(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(o=e.type._context,c=e.pendingProps,l=e.memoizedProps,f=c.value,En(V_,o._currentValue),o._currentValue=f,l!==null)if(ao(l.value,f)){if(l.children===c.children&&!ki.current){e=Ia(t,e,n);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var _=l.dependencies;if(_!==null){f=l.child;for(var y=_.firstContext;y!==null;){if(y.context===o){if(l.tag===1){y=va(-1,n&-n),y.tag=2;var S=l.updateQueue;if(S!==null){S=S.shared;var R=S.pending;R===null?y.next=y:(y.next=R.next,R.next=y),S.pending=y}}l.lanes|=n,y=l.alternate,y!==null&&(y.lanes|=n),Uw(l.return,n,e),_.lanes|=n;break}y=y.next}}else if(l.tag===10)f=l.type===e.type?null:l.child;else if(l.tag===18){if(f=l.return,f===null)throw Error(Se(341));f.lanes|=n,_=f.alternate,_!==null&&(_.lanes|=n),Uw(f,n,e),f=l.sibling}else f=l.child;if(f!==null)f.return=l;else for(f=l;f!==null;){if(f===e){f=null;break}if(l=f.sibling,l!==null){l.return=f.return,f=l;break}f=f.return}l=f}gi(t,e,c.children,n),e=e.child}return e;case 9:return c=e.type,o=e.pendingProps.children,kd(e,n),c=Ms(c),o=o(c),e.flags|=1,gi(t,e,o,n),e.child;case 14:return o=e.type,c=Js(o,e.pendingProps),c=Js(o.type,c),O5(t,e,o,c,n);case 15:return q9(t,e,e.type,e.pendingProps,n);case 17:return o=e.type,c=e.pendingProps,c=e.elementType===o?c:Js(o,c),o_(t,e),e.tag=1,Li(o)?(t=!0,M_(e)):t=!1,kd(e,n),T9(e,o,c),Fw(e,o,c,n),Gw(null,e,o,!0,t,n);case 19:return Q9(t,e,n);case 22:return z9(t,e,n)}throw Error(Se(156,e.tag))};function fj(t,e){return jF(t,e)}function Soe(t,e,n,o){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ds(t,e,n,o){return new Soe(t,e,n,o)}function sb(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Toe(t){if(typeof t=="function")return sb(t)?1:0;if(t!=null){if(t=t.$$typeof,t===IA)return 11;if(t===wA)return 14}return 2}function Rc(t,e){var n=t.alternate;return n===null?(n=Ds(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function u_(t,e,n,o,c,l){var f=2;if(o=t,typeof t=="function")sb(t)&&(f=1);else if(typeof t=="string")f=5;else e:switch(t){case fd:return Uu(n.children,c,l,e);case RA:f=8,c|=8;break;case uw:return t=Ds(12,n,e,c|2),t.elementType=uw,t.lanes=l,t;case lw:return t=Ds(13,n,e,c),t.elementType=lw,t.lanes=l,t;case dw:return t=Ds(19,n,e,c),t.elementType=dw,t.lanes=l,t;case RF:return Zv(n,c,l,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case SF:f=10;break e;case TF:f=9;break e;case IA:f=11;break e;case wA:f=14;break e;case rc:f=16,o=null;break e}throw Error(Se(130,t==null?t:typeof t,""))}return e=Ds(f,n,e,c),e.elementType=t,e.type=o,e.lanes=l,e}function Uu(t,e,n,o){return t=Ds(7,t,o,e),t.lanes=n,t}function Zv(t,e,n,o){return t=Ds(22,t,o,e),t.elementType=RF,t.lanes=n,t.stateNode={isHidden:!1},t}function XR(t,e,n){return t=Ds(6,t,null,e),t.lanes=n,t}function JR(t,e,n){return e=Ds(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Roe(t,e,n,o,c){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=PR(0),this.expirationTimes=PR(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=PR(0),this.identifierPrefix=o,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function ob(t,e,n,o,c,l,f,_,y){return t=new Roe(t,e,n,_,y),e===1?(e=1,l===!0&&(e|=8)):e=0,l=Ds(3,null,null,e),t.current=l,l.stateNode=t,l.memoizedState={element:o,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},WA(l),t}function Ioe(t,e,n){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pd,key:o==null?null:""+o,children:t,containerInfo:e,implementation:n}}function mj(t){if(!t)return kc;t=t._reactInternals;e:{if(nl(t)!==t||t.tag!==1)throw Error(Se(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Li(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Se(171))}if(t.tag===1){var n=t.type;if(Li(n))return f9(t,n,e)}return e}function gj(t,e,n,o,c,l,f,_,y){return t=ob(n,o,!0,t,c,l,f,_,y),t.context=mj(null),n=t.current,o=_i(),c=Tc(n),l=va(o,c),l.callback=e??null,yc(n,l,c),t.current.lanes=c,Xf(t,c,o),Mi(t,o),t}function e1(t,e,n,o){var c=e.current,l=_i(),f=Tc(c);return n=mj(n),e.context===null?e.context=n:e.pendingContext=n,e=va(l,f),e.payload={element:t},o=o===void 0?null:o,o!==null&&(e.callback=o),t=yc(c,e,f),t!==null&&(io(t,c,f,l),r_(t,c,f)),f}function z_(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function B5(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ab(t,e){B5(t,e),(t=t.alternate)&&B5(t,e)}function woe(){return null}var Ej=typeof reportError=="function"?reportError:function(t){console.error(t)};function cb(t){this._internalRoot=t}t1.prototype.render=cb.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Se(409));e1(t,e,null,null)};t1.prototype.unmount=cb.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ku(function(){e1(null,t,null,null)}),e[Ta]=null}};function t1(t){this._internalRoot=t}t1.prototype.unstable_scheduleHydration=function(t){if(t){var e=qF();t={blockedOn:null,target:t,priority:e};for(var n=0;n<oc.length&&e!==0&&e<oc[n].priority;n++);oc.splice(n,0,t),n===0&&YF(t)}};function ub(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function n1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function G5(){}function Coe(t,e,n,o,c){if(c){if(typeof o=="function"){var l=o;o=function(){var S=z_(f);l.call(S)}}var f=gj(e,o,t,0,null,!1,!1,"",G5);return t._reactRootContainer=f,t[Ta]=f.current,vf(t.nodeType===8?t.parentNode:t),Ku(),f}for(;c=t.lastChild;)t.removeChild(c);if(typeof o=="function"){var _=o;o=function(){var S=z_(y);_.call(S)}}var y=ob(t,0,!1,null,null,!1,!1,"",G5);return t._reactRootContainer=y,t[Ta]=y.current,vf(t.nodeType===8?t.parentNode:t),Ku(function(){e1(e,y,n,o)}),y}function r1(t,e,n,o,c){var l=n._reactRootContainer;if(l){var f=l;if(typeof c=="function"){var _=c;c=function(){var y=z_(f);_.call(y)}}e1(e,f,t,c)}else f=Coe(n,e,t,c,o);return z_(f)}$F=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Np(e.pendingLanes);n!==0&&(bA(e,n|1),Mi(e,Wn()),!(Bt&6)&&(zd=Wn()+500,Hc()))}break;case 13:Ku(function(){var o=Ra(t,1);if(o!==null){var c=_i();io(o,t,1,c)}}),ab(t,1)}};OA=function(t){if(t.tag===13){var e=Ra(t,134217728);if(e!==null){var n=_i();io(e,t,134217728,n)}ab(t,134217728)}};KF=function(t){if(t.tag===13){var e=Tc(t),n=Ra(t,e);if(n!==null){var o=_i();io(n,t,e,o)}ab(t,e)}};qF=function(){return Qt};zF=function(t,e){var n=Qt;try{return Qt=t,e()}finally{Qt=n}};Sw=function(t,e,n){switch(e){case"input":if(fw(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var o=n[e];if(o!==t&&o.form===t.form){var c=qv(o);if(!c)throw Error(Se(90));wF(o),fw(o,c)}}}break;case"textarea":AF(t,n);break;case"select":e=n.value,e!=null&&Od(t,!!n.multiple,e,!1)}};LF=nb;MF=Ku;var Aoe={usingClientEntryPoint:!1,Events:[Qf,_d,qv,DF,kF,nb]},Ip={findFiberByHostInstance:bu,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},boe={bundleType:Ip.bundleType,version:Ip.version,rendererPackageName:Ip.rendererPackageName,rendererConfig:Ip.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Da.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=VF(t),t===null?null:t.stateNode},findFiberByHostInstance:Ip.findFiberByHostInstance||woe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var FE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!FE.isDisabled&&FE.supportsFiber)try{Wv=FE.inject(boe),bo=FE}catch{}}hs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Aoe;hs.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ub(e))throw Error(Se(200));return Ioe(t,e,null,n)};hs.createRoot=function(t,e){if(!ub(t))throw Error(Se(299));var n=!1,o="",c=Ej;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(o=e.identifierPrefix),e.onRecoverableError!==void 0&&(c=e.onRecoverableError)),e=ob(t,1,!1,null,null,n,!1,o,c),t[Ta]=e.current,vf(t.nodeType===8?t.parentNode:t),new cb(e)};hs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Se(188)):(t=Object.keys(t).join(","),Error(Se(268,t)));return t=VF(e),t=t===null?null:t.stateNode,t};hs.flushSync=function(t){return Ku(t)};hs.hydrate=function(t,e,n){if(!n1(e))throw Error(Se(200));return r1(null,t,e,!0,n)};hs.hydrateRoot=function(t,e,n){if(!ub(t))throw Error(Se(405));var o=n!=null&&n.hydratedSources||null,c=!1,l="",f=Ej;if(n!=null&&(n.unstable_strictMode===!0&&(c=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onRecoverableError!==void 0&&(f=n.onRecoverableError)),e=gj(e,null,t,1,n??null,c,!1,l,f),t[Ta]=e.current,vf(t),o)for(t=0;t<o.length;t++)n=o[t],c=n._getVersion,c=c(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,c]:e.mutableSourceEagerHydrationData.push(n,c);return new t1(e)};hs.render=function(t,e,n){if(!n1(e))throw Error(Se(200));return r1(null,t,e,!1,n)};hs.unmountComponentAtNode=function(t){if(!n1(t))throw Error(Se(40));return t._reactRootContainer?(Ku(function(){r1(null,null,t,!1,function(){t._reactRootContainer=null,t[Ta]=null})}),!0):!1};hs.unstable_batchedUpdates=nb;hs.unstable_renderSubtreeIntoContainer=function(t,e,n,o){if(!n1(n))throw Error(Se(200));if(t==null||t._reactInternals===void 0)throw Error(Se(38));return r1(t,e,n,!1,o)};hs.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=hs})(wie);const Ooe=mA(lf);var W5=lf;ow.createRoot=W5.createRoot,ow.hydrateRoot=W5.hydrateRoot;/**
 * @remix-run/router v1.3.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bf(){return bf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},bf.apply(this,arguments)}var pc;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(pc||(pc={}));const H5="popstate";function Noe(t){t===void 0&&(t={});function e(o,c){let{pathname:l,search:f,hash:_}=o.location;return eC("",{pathname:l,search:f,hash:_},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function n(o,c){return typeof c=="string"?c:Y_(c)}return Doe(e,n,null,t)}function cr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Poe(){return Math.random().toString(36).substr(2,8)}function $5(t,e){return{usr:t.state,key:t.key,idx:e}}function eC(t,e,n,o){return n===void 0&&(n=null),bf({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?ph(e):e,{state:n,key:e&&e.key||o||Poe()})}function Y_(t){let{pathname:e="/",search:n="",hash:o=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),o&&o!=="#"&&(e+=o.charAt(0)==="#"?o:"#"+o),e}function ph(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let o=t.indexOf("?");o>=0&&(e.search=t.substr(o),t=t.substr(0,o)),t&&(e.pathname=t)}return e}function Doe(t,e,n,o){o===void 0&&(o={});let{window:c=document.defaultView,v5Compat:l=!1}=o,f=c.history,_=pc.Pop,y=null,S=R();S==null&&(S=0,f.replaceState(bf({},f.state,{idx:S}),""));function R(){return(f.state||{idx:null}).idx}function w(){_=pc.Pop;let Y=R(),H=Y==null?null:Y-S;S=Y,y&&y({action:_,location:F.location,delta:H})}function b(Y,H){_=pc.Push;let B=eC(F.location,Y,H);n&&n(B,Y),S=R()+1;let K=$5(B,S),z=F.createHref(B);try{f.pushState(K,"",z)}catch{c.location.assign(z)}l&&y&&y({action:_,location:F.location,delta:1})}function k(Y,H){_=pc.Replace;let B=eC(F.location,Y,H);n&&n(B,Y),S=R();let K=$5(B,S),z=F.createHref(B);f.replaceState(K,"",z),l&&y&&y({action:_,location:F.location,delta:0})}function M(Y){let H=c.location.origin!=="null"?c.location.origin:c.location.href,B=typeof Y=="string"?Y:Y_(Y);return cr(H,"No window.location.(origin|href) available to create URL for href: "+B),new URL(B,H)}let F={get action(){return _},get location(){return t(c,f)},listen(Y){if(y)throw new Error("A history only accepts one active listener");return c.addEventListener(H5,w),y=Y,()=>{c.removeEventListener(H5,w),y=null}},createHref(Y){return e(c,Y)},createURL:M,encodeLocation(Y){let H=M(Y);return{pathname:H.pathname,search:H.search,hash:H.hash}},push:b,replace:k,go(Y){return f.go(Y)}};return F}var K5;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(K5||(K5={}));function koe(t,e,n){n===void 0&&(n="/");let o=typeof e=="string"?ph(e):e,c=yj(o.pathname||"/",n);if(c==null)return null;let l=_j(t);Loe(l);let f=null;for(let _=0;f==null&&_<l.length;++_)f=Woe(l[_],Koe(c));return f}function _j(t,e,n,o){e===void 0&&(e=[]),n===void 0&&(n=[]),o===void 0&&(o="");let c=(l,f,_)=>{let y={relativePath:_===void 0?l.path||"":_,caseSensitive:l.caseSensitive===!0,childrenIndex:f,route:l};y.relativePath.startsWith("/")&&(cr(y.relativePath.startsWith(o),'Absolute route path "'+y.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),y.relativePath=y.relativePath.slice(o.length));let S=Ic([o,y.relativePath]),R=n.concat(y);l.children&&l.children.length>0&&(cr(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+S+'".')),_j(l.children,e,R,S)),!(l.path==null&&!l.index)&&e.push({path:S,score:Boe(S,l.index),routesMeta:R})};return t.forEach((l,f)=>{var _;if(l.path===""||!((_=l.path)!=null&&_.includes("?")))c(l,f);else for(let y of vj(l.path))c(l,f,y)}),e}function vj(t){let e=t.split("/");if(e.length===0)return[];let[n,...o]=e,c=n.endsWith("?"),l=n.replace(/\?$/,"");if(o.length===0)return c?[l,""]:[l];let f=vj(o.join("/")),_=[];return _.push(...f.map(y=>y===""?l:[l,y].join("/"))),c&&_.push(...f),_.map(y=>t.startsWith("/")&&y===""?"/":y)}function Loe(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Goe(e.routesMeta.map(o=>o.childrenIndex),n.routesMeta.map(o=>o.childrenIndex)))}const Moe=/^:\w+$/,xoe=3,Uoe=2,Voe=1,Foe=10,joe=-2,q5=t=>t==="*";function Boe(t,e){let n=t.split("/"),o=n.length;return n.some(q5)&&(o+=joe),e&&(o+=Uoe),n.filter(c=>!q5(c)).reduce((c,l)=>c+(Moe.test(l)?xoe:l===""?Voe:Foe),o)}function Goe(t,e){return t.length===e.length&&t.slice(0,-1).every((o,c)=>o===e[c])?t[t.length-1]-e[e.length-1]:0}function Woe(t,e){let{routesMeta:n}=t,o={},c="/",l=[];for(let f=0;f<n.length;++f){let _=n[f],y=f===n.length-1,S=c==="/"?e:e.slice(c.length)||"/",R=Hoe({path:_.relativePath,caseSensitive:_.caseSensitive,end:y},S);if(!R)return null;Object.assign(o,R.params);let w=_.route;l.push({params:o,pathname:Ic([c,R.pathname]),pathnameBase:Xoe(Ic([c,R.pathnameBase])),route:w}),R.pathnameBase!=="/"&&(c=Ic([c,R.pathnameBase]))}return l}function Hoe(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,o]=$oe(t.path,t.caseSensitive,t.end),c=e.match(n);if(!c)return null;let l=c[0],f=l.replace(/(.)\/+$/,"$1"),_=c.slice(1);return{params:o.reduce((S,R,w)=>{if(R==="*"){let b=_[w]||"";f=l.slice(0,l.length-b.length).replace(/(.)\/+$/,"$1")}return S[R]=qoe(_[w]||"",R),S},{}),pathname:l,pathnameBase:f,pattern:t}}function $oe(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),lb(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let o=[],c="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(f,_)=>(o.push(_),"/([^\\/]+)"));return t.endsWith("*")?(o.push("*"),c+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?c+="\\/*$":t!==""&&t!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),o]}function Koe(t){try{return decodeURI(t)}catch(e){return lb(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function qoe(t,e){try{return decodeURIComponent(t)}catch(n){return lb(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+n+").")),t}}function yj(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,o=t.charAt(n);return o&&o!=="/"?null:t.slice(n)||"/"}function lb(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function zoe(t,e){e===void 0&&(e="/");let{pathname:n,search:o="",hash:c=""}=typeof t=="string"?ph(t):t;return{pathname:n?n.startsWith("/")?n:Yoe(n,e):e,search:Joe(o),hash:Qoe(c)}}function Yoe(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(c=>{c===".."?n.length>1&&n.pop():c!=="."&&n.push(c)}),n.length>1?n.join("/"):"/"}function QR(t,e,n,o){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Sj(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Tj(t,e,n,o){o===void 0&&(o=!1);let c;typeof t=="string"?c=ph(t):(c=bf({},t),cr(!c.pathname||!c.pathname.includes("?"),QR("?","pathname","search",c)),cr(!c.pathname||!c.pathname.includes("#"),QR("#","pathname","hash",c)),cr(!c.search||!c.search.includes("#"),QR("#","search","hash",c)));let l=t===""||c.pathname==="",f=l?"/":c.pathname,_;if(o||f==null)_=n;else{let w=e.length-1;if(f.startsWith("..")){let b=f.split("/");for(;b[0]==="..";)b.shift(),w-=1;c.pathname=b.join("/")}_=w>=0?e[w]:"/"}let y=zoe(c,_),S=f&&f!=="/"&&f.endsWith("/"),R=(l||f===".")&&n.endsWith("/");return!y.pathname.endsWith("/")&&(S||R)&&(y.pathname+="/"),y}const Ic=t=>t.join("/").replace(/\/\/+/g,"/"),Xoe=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Joe=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Qoe=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Zoe(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const eae=["post","put","patch","delete"];[...eae];/**
 * React Router v6.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tC(){return tC=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},tC.apply(this,arguments)}function tae(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}const nae=typeof Object.is=="function"?Object.is:tae,{useState:rae,useEffect:iae,useLayoutEffect:sae,useDebugValue:oae}=sw;function aae(t,e,n){const o=e(),[{inst:c},l]=rae({inst:{value:o,getSnapshot:e}});return sae(()=>{c.value=o,c.getSnapshot=e,ZR(c)&&l({inst:c})},[t,o,e]),iae(()=>(ZR(c)&&l({inst:c}),t(()=>{ZR(c)&&l({inst:c})})),[t]),oae(o),o}function ZR(t){const e=t.getSnapshot,n=t.value;try{const o=e();return!nae(n,o)}catch{return!0}}function cae(t,e,n){return e()}const uae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",lae=!uae,dae=lae?cae:aae;"useSyncExternalStore"in sw&&(t=>t.useSyncExternalStore)(sw);const Rj=te.createContext(null),db=te.createContext(null),i1=te.createContext(null),s1=te.createContext(null),$c=te.createContext({outlet:null,matches:[]}),Ij=te.createContext(null);function hae(t,e){let{relative:n}=e===void 0?{}:e;fh()||cr(!1);let{basename:o,navigator:c}=te.useContext(i1),{hash:l,pathname:f,search:_}=wj(t,{relative:n}),y=f;return o!=="/"&&(y=f==="/"?o:Ic([o,f])),c.createHref({pathname:y,search:_,hash:l})}function fh(){return te.useContext(s1)!=null}function o1(){return fh()||cr(!1),te.useContext(s1).location}function co(){fh()||cr(!1);let{basename:t,navigator:e}=te.useContext(i1),{matches:n}=te.useContext($c),{pathname:o}=o1(),c=JSON.stringify(Sj(n).map(_=>_.pathnameBase)),l=te.useRef(!1);return te.useEffect(()=>{l.current=!0}),te.useCallback(function(_,y){if(y===void 0&&(y={}),!l.current)return;if(typeof _=="number"){e.go(_);return}let S=Tj(_,JSON.parse(c),o,y.relative==="path");t!=="/"&&(S.pathname=S.pathname==="/"?t:Ic([t,S.pathname])),(y.replace?e.replace:e.push)(S,y.state,y)},[t,e,c,o])}const pae=te.createContext(null);function fae(t){let e=te.useContext($c).outlet;return e&&te.createElement(pae.Provider,{value:t},e)}function mae(){let{matches:t}=te.useContext($c),e=t[t.length-1];return e?e.params:{}}function wj(t,e){let{relative:n}=e===void 0?{}:e,{matches:o}=te.useContext($c),{pathname:c}=o1(),l=JSON.stringify(Sj(o).map(f=>f.pathnameBase));return te.useMemo(()=>Tj(t,JSON.parse(l),c,n==="path"),[t,l,c,n])}function gae(t,e){fh()||cr(!1);let{navigator:n}=te.useContext(i1),o=te.useContext(db),{matches:c}=te.useContext($c),l=c[c.length-1],f=l?l.params:{};l&&l.pathname;let _=l?l.pathnameBase:"/";l&&l.route;let y=o1(),S;if(e){var R;let F=typeof e=="string"?ph(e):e;_==="/"||(R=F.pathname)!=null&&R.startsWith(_)||cr(!1),S=F}else S=y;let w=S.pathname||"/",b=_==="/"?w:w.slice(_.length)||"/",k=koe(t,{pathname:b}),M=yae(k&&k.map(F=>Object.assign({},F,{params:Object.assign({},f,F.params),pathname:Ic([_,n.encodeLocation?n.encodeLocation(F.pathname).pathname:F.pathname]),pathnameBase:F.pathnameBase==="/"?_:Ic([_,n.encodeLocation?n.encodeLocation(F.pathnameBase).pathname:F.pathnameBase])})),c,o||void 0);return e&&M?te.createElement(s1.Provider,{value:{location:tC({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:pc.Pop}},M):M}function Eae(){let t=Iae(),e=Zoe(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},l=null;return te.createElement(te.Fragment,null,te.createElement("h2",null,"Unexpected Application Error!"),te.createElement("h3",{style:{fontStyle:"italic"}},e),n?te.createElement("pre",{style:c},n):null,l)}class _ae extends te.Component{constructor(e){super(e),this.state={location:e.location,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location?{error:e.error,location:e.location}:{error:e.error||n.error,location:n.location}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error?te.createElement($c.Provider,{value:this.props.routeContext},te.createElement(Ij.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function vae(t){let{routeContext:e,match:n,children:o}=t,c=te.useContext(Rj);return c&&c.static&&c.staticContext&&n.route.errorElement&&(c.staticContext._deepestRenderedBoundaryId=n.route.id),te.createElement($c.Provider,{value:e},o)}function yae(t,e,n){if(e===void 0&&(e=[]),t==null)if(n!=null&&n.errors)t=n.matches;else return null;let o=t,c=n==null?void 0:n.errors;if(c!=null){let l=o.findIndex(f=>f.route.id&&(c==null?void 0:c[f.route.id]));l>=0||cr(!1),o=o.slice(0,Math.min(o.length,l+1))}return o.reduceRight((l,f,_)=>{let y=f.route.id?c==null?void 0:c[f.route.id]:null,S=n?f.route.errorElement||te.createElement(Eae,null):null,R=e.concat(o.slice(0,_+1)),w=()=>te.createElement(vae,{match:f,routeContext:{outlet:l,matches:R}},y?S:f.route.element!==void 0?f.route.element:l);return n&&(f.route.errorElement||_===0)?te.createElement(_ae,{location:n.location,component:S,error:y,children:w(),routeContext:{outlet:null,matches:R}}):w()},null)}var z5;(function(t){t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator"})(z5||(z5={}));var X_;(function(t){t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator"})(X_||(X_={}));function Sae(t){let e=te.useContext(db);return e||cr(!1),e}function Tae(t){let e=te.useContext($c);return e||cr(!1),e}function Rae(t){let e=Tae(),n=e.matches[e.matches.length-1];return n.route.id||cr(!1),n.route.id}function Iae(){var t;let e=te.useContext(Ij),n=Sae(X_.UseRouteError),o=Rae(X_.UseRouteError);return e||((t=n.errors)==null?void 0:t[o])}function wae(t){let{to:e,replace:n,state:o,relative:c}=t;fh()||cr(!1);let l=te.useContext(db),f=co();return te.useEffect(()=>{l&&l.navigation.state!=="idle"||f(e,{replace:n,state:o,relative:c})}),null}function Cae(t){return fae(t.context)}function ca(t){cr(!1)}function Aae(t){let{basename:e="/",children:n=null,location:o,navigationType:c=pc.Pop,navigator:l,static:f=!1}=t;fh()&&cr(!1);let _=e.replace(/^\/*/,"/"),y=te.useMemo(()=>({basename:_,navigator:l,static:f}),[_,l,f]);typeof o=="string"&&(o=ph(o));let{pathname:S="/",search:R="",hash:w="",state:b=null,key:k="default"}=o,M=te.useMemo(()=>{let F=yj(S,_);return F==null?null:{pathname:F,search:R,hash:w,state:b,key:k}},[_,S,R,w,b,k]);return M==null?null:te.createElement(i1.Provider,{value:y},te.createElement(s1.Provider,{children:n,value:{location:M,navigationType:c}}))}function bae(t){let{children:e,location:n}=t,o=te.useContext(Rj),c=o&&!e?o.router.routes:nC(e);return gae(c,n)}var Y5;(function(t){t[t.pending=0]="pending",t[t.success=1]="success",t[t.error=2]="error"})(Y5||(Y5={}));new Promise(()=>{});function nC(t,e){e===void 0&&(e=[]);let n=[];return te.Children.forEach(t,(o,c)=>{if(!te.isValidElement(o))return;if(o.type===te.Fragment){n.push.apply(n,nC(o.props.children,e));return}o.type!==ca&&cr(!1),!o.props.index||!o.props.children||cr(!1);let l=[...e,c],f={id:o.props.id||l.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,hasErrorBoundary:o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle};o.props.children&&(f.children=nC(o.props.children,l)),n.push(f)}),n}/**
 * React Router DOM v6.8.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rC(){return rC=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},rC.apply(this,arguments)}function Oae(t,e){if(t==null)return{};var n={},o=Object.keys(t),c,l;for(l=0;l<o.length;l++)c=o[l],!(e.indexOf(c)>=0)&&(n[c]=t[c]);return n}function Nae(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Pae(t,e){return t.button===0&&(!e||e==="_self")&&!Nae(t)}const Dae=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"];function kae(t){let{basename:e,children:n,window:o}=t,c=te.useRef();c.current==null&&(c.current=Noe({window:o,v5Compat:!0}));let l=c.current,[f,_]=te.useState({action:l.action,location:l.location});return te.useLayoutEffect(()=>l.listen(_),[l]),te.createElement(Aae,{basename:e,children:n,location:f.location,navigationType:f.action,navigator:l})}const Lae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Cj=te.forwardRef(function(e,n){let{onClick:o,relative:c,reloadDocument:l,replace:f,state:_,target:y,to:S,preventScrollReset:R}=e,w=Oae(e,Dae),b,k=!1;if(Lae&&typeof S=="string"&&/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i.test(S)){b=S;let H=new URL(window.location.href),B=S.startsWith("//")?new URL(H.protocol+S):new URL(S);B.origin===H.origin?S=B.pathname+B.search+B.hash:k=!0}let M=hae(S,{relative:c}),F=Mae(S,{replace:f,state:_,target:y,preventScrollReset:R,relative:c});function Y(H){o&&o(H),H.defaultPrevented||F(H)}return te.createElement("a",rC({},w,{href:b||M,onClick:k||l?o:Y,ref:n,target:y}))});var X5;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmitImpl="useSubmitImpl",t.UseFetcher="useFetcher"})(X5||(X5={}));var J5;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(J5||(J5={}));function Mae(t,e){let{target:n,replace:o,state:c,preventScrollReset:l,relative:f}=e===void 0?{}:e,_=co(),y=o1(),S=wj(t,{relative:f});return te.useCallback(R=>{if(Pae(R,n)){R.preventDefault();let w=o!==void 0?o:Y_(y)===Y_(S);_(t,{replace:w,state:c,preventScrollReset:l,relative:f})}},[y,_,S,o,c,n,t,l,f])}var iC={},xae={get exports(){return iC},set exports(t){iC=t}},Aj={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yd=te;function Uae(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Vae=typeof Object.is=="function"?Object.is:Uae,Fae=Yd.useState,jae=Yd.useEffect,Bae=Yd.useLayoutEffect,Gae=Yd.useDebugValue;function Wae(t,e){var n=e(),o=Fae({inst:{value:n,getSnapshot:e}}),c=o[0].inst,l=o[1];return Bae(function(){c.value=n,c.getSnapshot=e,eI(c)&&l({inst:c})},[t,n,e]),jae(function(){return eI(c)&&l({inst:c}),t(function(){eI(c)&&l({inst:c})})},[t]),Gae(n),n}function eI(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Vae(t,n)}catch{return!0}}function Hae(t,e){return e()}var $ae=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Hae:Wae;Aj.useSyncExternalStore=Yd.useSyncExternalStore!==void 0?Yd.useSyncExternalStore:$ae;(function(t){t.exports=Aj})(xae);var sC={},Kae={get exports(){return sC},set exports(t){sC=t}},bj={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a1=te,qae=iC;function zae(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Yae=typeof Object.is=="function"?Object.is:zae,Xae=qae.useSyncExternalStore,Jae=a1.useRef,Qae=a1.useEffect,Zae=a1.useMemo,ece=a1.useDebugValue;bj.useSyncExternalStoreWithSelector=function(t,e,n,o,c){var l=Jae(null);if(l.current===null){var f={hasValue:!1,value:null};l.current=f}else f=l.current;l=Zae(function(){function y(k){if(!S){if(S=!0,R=k,k=o(k),c!==void 0&&f.hasValue){var M=f.value;if(c(M,k))return w=M}return w=k}if(M=w,Yae(R,k))return M;var F=o(k);return c!==void 0&&c(M,F)?M:(R=k,w=F)}var S=!1,R,w,b=n===void 0?null:n;return[function(){return y(e())},b===null?void 0:function(){return y(b())}]},[e,n,o,c]);var _=Xae(t,l[0],l[1]);return Qae(function(){f.hasValue=!0,f.value=_},[_]),ece(_),_};(function(t){t.exports=bj})(Kae);function tce(t){t()}let Oj=tce;const nce=t=>Oj=t,rce=()=>Oj,Lc=te.createContext(null);function Nj(){return te.useContext(Lc)}const ice=()=>{throw new Error("uSES not initialized!")};let Pj=ice;const sce=t=>{Pj=t},oce=(t,e)=>t===e;function ace(t=Lc){const e=t===Lc?Nj:()=>te.useContext(t);return function(o,c=oce){const{store:l,subscription:f,getServerState:_}=e(),y=Pj(f.addNestedSub,l.getState,_||l.getState,o,c);return te.useDebugValue(y),y}}const oC=ace();var aC={},cce={get exports(){return aC},set exports(t){aC=t}},Zt={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nr=typeof Symbol=="function"&&Symbol.for,hb=Nr?Symbol.for("react.element"):60103,pb=Nr?Symbol.for("react.portal"):60106,c1=Nr?Symbol.for("react.fragment"):60107,u1=Nr?Symbol.for("react.strict_mode"):60108,l1=Nr?Symbol.for("react.profiler"):60114,d1=Nr?Symbol.for("react.provider"):60109,h1=Nr?Symbol.for("react.context"):60110,fb=Nr?Symbol.for("react.async_mode"):60111,p1=Nr?Symbol.for("react.concurrent_mode"):60111,f1=Nr?Symbol.for("react.forward_ref"):60112,m1=Nr?Symbol.for("react.suspense"):60113,uce=Nr?Symbol.for("react.suspense_list"):60120,g1=Nr?Symbol.for("react.memo"):60115,E1=Nr?Symbol.for("react.lazy"):60116,lce=Nr?Symbol.for("react.block"):60121,dce=Nr?Symbol.for("react.fundamental"):60117,hce=Nr?Symbol.for("react.responder"):60118,pce=Nr?Symbol.for("react.scope"):60119;function fs(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case hb:switch(t=t.type,t){case fb:case p1:case c1:case l1:case u1:case m1:return t;default:switch(t=t&&t.$$typeof,t){case h1:case f1:case E1:case g1:case d1:return t;default:return e}}case pb:return e}}}function Dj(t){return fs(t)===p1}Zt.AsyncMode=fb;Zt.ConcurrentMode=p1;Zt.ContextConsumer=h1;Zt.ContextProvider=d1;Zt.Element=hb;Zt.ForwardRef=f1;Zt.Fragment=c1;Zt.Lazy=E1;Zt.Memo=g1;Zt.Portal=pb;Zt.Profiler=l1;Zt.StrictMode=u1;Zt.Suspense=m1;Zt.isAsyncMode=function(t){return Dj(t)||fs(t)===fb};Zt.isConcurrentMode=Dj;Zt.isContextConsumer=function(t){return fs(t)===h1};Zt.isContextProvider=function(t){return fs(t)===d1};Zt.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===hb};Zt.isForwardRef=function(t){return fs(t)===f1};Zt.isFragment=function(t){return fs(t)===c1};Zt.isLazy=function(t){return fs(t)===E1};Zt.isMemo=function(t){return fs(t)===g1};Zt.isPortal=function(t){return fs(t)===pb};Zt.isProfiler=function(t){return fs(t)===l1};Zt.isStrictMode=function(t){return fs(t)===u1};Zt.isSuspense=function(t){return fs(t)===m1};Zt.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===c1||t===p1||t===l1||t===u1||t===m1||t===uce||typeof t=="object"&&t!==null&&(t.$$typeof===E1||t.$$typeof===g1||t.$$typeof===d1||t.$$typeof===h1||t.$$typeof===f1||t.$$typeof===dce||t.$$typeof===hce||t.$$typeof===pce||t.$$typeof===lce)};Zt.typeOf=fs;(function(t){t.exports=Zt})(cce);var kj=aC,fce={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},mce={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Lj={};Lj[kj.ForwardRef]=fce;Lj[kj.Memo]=mce;var Q5={},gce={get exports(){return Q5},set exports(t){Q5=t}},en={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mb=Symbol.for("react.element"),gb=Symbol.for("react.portal"),_1=Symbol.for("react.fragment"),v1=Symbol.for("react.strict_mode"),y1=Symbol.for("react.profiler"),S1=Symbol.for("react.provider"),T1=Symbol.for("react.context"),Ece=Symbol.for("react.server_context"),R1=Symbol.for("react.forward_ref"),I1=Symbol.for("react.suspense"),w1=Symbol.for("react.suspense_list"),C1=Symbol.for("react.memo"),A1=Symbol.for("react.lazy"),_ce=Symbol.for("react.offscreen"),Mj;Mj=Symbol.for("react.module.reference");function Vs(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case mb:switch(t=t.type,t){case _1:case y1:case v1:case I1:case w1:return t;default:switch(t=t&&t.$$typeof,t){case Ece:case T1:case R1:case A1:case C1:case S1:return t;default:return e}}case gb:return e}}}en.ContextConsumer=T1;en.ContextProvider=S1;en.Element=mb;en.ForwardRef=R1;en.Fragment=_1;en.Lazy=A1;en.Memo=C1;en.Portal=gb;en.Profiler=y1;en.StrictMode=v1;en.Suspense=I1;en.SuspenseList=w1;en.isAsyncMode=function(){return!1};en.isConcurrentMode=function(){return!1};en.isContextConsumer=function(t){return Vs(t)===T1};en.isContextProvider=function(t){return Vs(t)===S1};en.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===mb};en.isForwardRef=function(t){return Vs(t)===R1};en.isFragment=function(t){return Vs(t)===_1};en.isLazy=function(t){return Vs(t)===A1};en.isMemo=function(t){return Vs(t)===C1};en.isPortal=function(t){return Vs(t)===gb};en.isProfiler=function(t){return Vs(t)===y1};en.isStrictMode=function(t){return Vs(t)===v1};en.isSuspense=function(t){return Vs(t)===I1};en.isSuspenseList=function(t){return Vs(t)===w1};en.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===_1||t===y1||t===v1||t===I1||t===w1||t===_ce||typeof t=="object"&&t!==null&&(t.$$typeof===A1||t.$$typeof===C1||t.$$typeof===S1||t.$$typeof===T1||t.$$typeof===R1||t.$$typeof===Mj||t.getModuleId!==void 0)};en.typeOf=Vs;(function(t){t.exports=en})(gce);function vce(){const t=rce();let e=null,n=null;return{clear(){e=null,n=null},notify(){t(()=>{let o=e;for(;o;)o.callback(),o=o.next})},get(){let o=[],c=e;for(;c;)o.push(c),c=c.next;return o},subscribe(o){let c=!0,l=n={callback:o,next:null,prev:n};return l.prev?l.prev.next=l:e=l,function(){!c||e===null||(c=!1,l.next?l.next.prev=l.prev:n=l.prev,l.prev?l.prev.next=l.next:e=l.next)}}}}const Z5={notify(){},get:()=>[]};function yce(t,e){let n,o=Z5;function c(w){return y(),o.subscribe(w)}function l(){o.notify()}function f(){R.onStateChange&&R.onStateChange()}function _(){return Boolean(n)}function y(){n||(n=e?e.addNestedSub(f):t.subscribe(f),o=vce())}function S(){n&&(n(),n=void 0,o.clear(),o=Z5)}const R={addNestedSub:c,notifyNestedSubs:l,handleChangeWrapper:f,isSubscribed:_,trySubscribe:y,tryUnsubscribe:S,getListeners:()=>o};return R}const Sce=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Tce=Sce?te.useLayoutEffect:te.useEffect;function Rce({store:t,context:e,children:n,serverState:o}){const c=te.useMemo(()=>{const _=yce(t);return{store:t,subscription:_,getServerState:o?()=>o:void 0}},[t,o]),l=te.useMemo(()=>t.getState(),[t]);Tce(()=>{const{subscription:_}=c;return _.onStateChange=_.notifyNestedSubs,_.trySubscribe(),l!==t.getState()&&_.notifyNestedSubs(),()=>{_.tryUnsubscribe(),_.onStateChange=void 0}},[c,l]);const f=e||Lc;return lh.createElement(f.Provider,{value:c},n)}function xj(t=Lc){const e=t===Lc?Nj:()=>te.useContext(t);return function(){const{store:o}=e();return o}}const Ice=xj();function wce(t=Lc){const e=t===Lc?Ice:xj(t);return function(){return e().dispatch}}const mh=wce();sce(sC.useSyncExternalStoreWithSelector);nce(lf.unstable_batchedUpdates);function eo(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(c){return"'"+c+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Mc(t){return!!t&&!!t[In]}function wa(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var o=Object.getPrototypeOf(n);if(o===null)return!0;var c=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return c===Object||typeof c=="function"&&Function.toString.call(c)===Lce}(t)||Array.isArray(t)||!!t[oV]||!!(!((e=t.constructor)===null||e===void 0)&&e[oV])||Eb(t)||_b(t))}function qu(t,e,n){n===void 0&&(n=!1),gh(t)===0?(n?Object.keys:xd)(t).forEach(function(o){n&&typeof o=="symbol"||e(o,t[o],t)}):t.forEach(function(o,c){return e(c,o,t)})}function gh(t){var e=t[In];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:Eb(t)?2:_b(t)?3:0}function Md(t,e){return gh(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Cce(t,e){return gh(t)===2?t.get(e):t[e]}function Uj(t,e,n){var o=gh(t);o===2?t.set(e,n):o===3?t.add(n):t[e]=n}function Vj(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function Eb(t){return Dce&&t instanceof Map}function _b(t){return kce&&t instanceof Set}function wu(t){return t.o||t.t}function vb(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=jj(t);delete e[In];for(var n=xd(e),o=0;o<n.length;o++){var c=n[o],l=e[c];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(e[c]={configurable:!0,writable:!0,enumerable:l.enumerable,value:t[c]})}return Object.create(Object.getPrototypeOf(t),e)}function yb(t,e){return e===void 0&&(e=!1),Sb(t)||Mc(t)||!wa(t)||(gh(t)>1&&(t.set=t.add=t.clear=t.delete=Ace),Object.freeze(t),e&&qu(t,function(n,o){return yb(o,!0)},!0)),t}function Ace(){eo(2)}function Sb(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function No(t){var e=dC[t];return e||eo(18,t),e}function bce(t,e){dC[t]||(dC[t]=e)}function cC(){return Of}function tI(t,e){e&&(No("Patches"),t.u=[],t.s=[],t.v=e)}function J_(t){uC(t),t.p.forEach(Oce),t.p=null}function uC(t){t===Of&&(Of=t.l)}function eV(t){return Of={p:[],l:Of,h:t,m:!0,_:0}}function Oce(t){var e=t[In];e.i===0||e.i===1?e.j():e.O=!0}function nI(t,e){e._=e.p.length;var n=e.p[0],o=t!==void 0&&t!==n;return e.h.g||No("ES5").S(e,t,o),o?(n[In].P&&(J_(e),eo(4)),wa(t)&&(t=Q_(e,t),e.l||Z_(e,t)),e.u&&No("Patches").M(n[In].t,t,e.u,e.s)):t=Q_(e,n,[]),J_(e),e.u&&e.v(e.u,e.s),t!==Fj?t:void 0}function Q_(t,e,n){if(Sb(e))return e;var o=e[In];if(!o)return qu(e,function(_,y){return tV(t,o,e,_,y,n)},!0),e;if(o.A!==t)return e;if(!o.P)return Z_(t,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var c=o.i===4||o.i===5?o.o=vb(o.k):o.o,l=c,f=!1;o.i===3&&(l=new Set(c),c.clear(),f=!0),qu(l,function(_,y){return tV(t,o,c,_,y,n,f)}),Z_(t,c,!1),n&&t.u&&No("Patches").N(o,n,t.u,t.s)}return o.o}function tV(t,e,n,o,c,l,f){if(Mc(c)){var _=Q_(t,c,l&&e&&e.i!==3&&!Md(e.R,o)?l.concat(o):void 0);if(Uj(n,o,_),!Mc(_))return;t.m=!1}else f&&n.add(c);if(wa(c)&&!Sb(c)){if(!t.h.D&&t._<1)return;Q_(t,c),e&&e.A.l||Z_(t,c)}}function Z_(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&yb(e,n)}function rI(t,e){var n=t[In];return(n?wu(n):t)[e]}function nV(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var o=Object.getOwnPropertyDescriptor(n,e);if(o)return o;n=Object.getPrototypeOf(n)}}function cc(t){t.P||(t.P=!0,t.l&&cc(t.l))}function iI(t){t.o||(t.o=vb(t.t))}function lC(t,e,n){var o=Eb(e)?No("MapSet").F(e,n):_b(e)?No("MapSet").T(e,n):t.g?function(c,l){var f=Array.isArray(c),_={i:f?1:0,A:l?l.A:cC(),P:!1,I:!1,R:{},l,t:c,k:null,o:null,j:null,C:!1},y=_,S=Nf;f&&(y=[_],S=Dp);var R=Proxy.revocable(y,S),w=R.revoke,b=R.proxy;return _.k=b,_.j=w,b}(e,n):No("ES5").J(e,n);return(n?n.A:cC()).p.push(o),o}function Nce(t){return Mc(t)||eo(22,t),function e(n){if(!wa(n))return n;var o,c=n[In],l=gh(n);if(c){if(!c.P&&(c.i<4||!No("ES5").K(c)))return c.t;c.I=!0,o=rV(n,l),c.I=!1}else o=rV(n,l);return qu(o,function(f,_){c&&Cce(c.t,f)===_||Uj(o,f,e(_))}),l===3?new Set(o):o}(t)}function rV(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return vb(t)}function Pce(){function t(l,f){var _=c[l];return _?_.enumerable=f:c[l]=_={configurable:!0,enumerable:f,get:function(){var y=this[In];return Nf.get(y,l)},set:function(y){var S=this[In];Nf.set(S,l,y)}},_}function e(l){for(var f=l.length-1;f>=0;f--){var _=l[f][In];if(!_.P)switch(_.i){case 5:o(_)&&cc(_);break;case 4:n(_)&&cc(_)}}}function n(l){for(var f=l.t,_=l.k,y=xd(_),S=y.length-1;S>=0;S--){var R=y[S];if(R!==In){var w=f[R];if(w===void 0&&!Md(f,R))return!0;var b=_[R],k=b&&b[In];if(k?k.t!==w:!Vj(b,w))return!0}}var M=!!f[In];return y.length!==xd(f).length+(M?0:1)}function o(l){var f=l.k;if(f.length!==l.t.length)return!0;var _=Object.getOwnPropertyDescriptor(f,f.length-1);if(_&&!_.get)return!0;for(var y=0;y<f.length;y++)if(!f.hasOwnProperty(y))return!0;return!1}var c={};bce("ES5",{J:function(l,f){var _=Array.isArray(l),y=function(R,w){if(R){for(var b=Array(w.length),k=0;k<w.length;k++)Object.defineProperty(b,""+k,t(k,!0));return b}var M=jj(w);delete M[In];for(var F=xd(M),Y=0;Y<F.length;Y++){var H=F[Y];M[H]=t(H,R||!!M[H].enumerable)}return Object.create(Object.getPrototypeOf(w),M)}(_,l),S={i:_?5:4,A:f?f.A:cC(),P:!1,I:!1,R:{},l:f,t:l,k:y,o:null,O:!1,C:!1};return Object.defineProperty(y,In,{value:S,writable:!0}),y},S:function(l,f,_){_?Mc(f)&&f[In].A===l&&e(l.p):(l.u&&function y(S){if(S&&typeof S=="object"){var R=S[In];if(R){var w=R.t,b=R.k,k=R.R,M=R.i;if(M===4)qu(b,function(K){K!==In&&(w[K]!==void 0||Md(w,K)?k[K]||y(b[K]):(k[K]=!0,cc(R)))}),qu(w,function(K){b[K]!==void 0||Md(b,K)||(k[K]=!1,cc(R))});else if(M===5){if(o(R)&&(cc(R),k.length=!0),b.length<w.length)for(var F=b.length;F<w.length;F++)k[F]=!1;else for(var Y=w.length;Y<b.length;Y++)k[Y]=!0;for(var H=Math.min(b.length,w.length),B=0;B<H;B++)b.hasOwnProperty(B)||(k[B]=!0),k[B]===void 0&&y(b[B])}}}}(l.p[0]),e(l.p))},K:function(l){return l.i===4?n(l):o(l)}})}var iV,Of,Tb=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Dce=typeof Map<"u",kce=typeof Set<"u",sV=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Fj=Tb?Symbol.for("immer-nothing"):((iV={})["immer-nothing"]=!0,iV),oV=Tb?Symbol.for("immer-draftable"):"__$immer_draftable",In=Tb?Symbol.for("immer-state"):"__$immer_state",Lce=""+Object.prototype.constructor,xd=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,jj=Object.getOwnPropertyDescriptors||function(t){var e={};return xd(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},dC={},Nf={get:function(t,e){if(e===In)return t;var n=wu(t);if(!Md(n,e))return function(c,l,f){var _,y=nV(l,f);return y?"value"in y?y.value:(_=y.get)===null||_===void 0?void 0:_.call(c.k):void 0}(t,n,e);var o=n[e];return t.I||!wa(o)?o:o===rI(t.t,e)?(iI(t),t.o[e]=lC(t.A.h,o,t)):o},has:function(t,e){return e in wu(t)},ownKeys:function(t){return Reflect.ownKeys(wu(t))},set:function(t,e,n){var o=nV(wu(t),e);if(o!=null&&o.set)return o.set.call(t.k,n),!0;if(!t.P){var c=rI(wu(t),e),l=c==null?void 0:c[In];if(l&&l.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(Vj(n,c)&&(n!==void 0||Md(t.t,e)))return!0;iI(t),cc(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return rI(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,iI(t),cc(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=wu(t),o=Reflect.getOwnPropertyDescriptor(n,e);return o&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:o.enumerable,value:n[e]}},defineProperty:function(){eo(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){eo(12)}},Dp={};qu(Nf,function(t,e){Dp[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),Dp.deleteProperty=function(t,e){return Dp.set.call(this,t,e,void 0)},Dp.set=function(t,e,n){return Nf.set.call(this,t[0],e,n,t[0])};var Mce=function(){function t(n){var o=this;this.g=sV,this.D=!0,this.produce=function(c,l,f){if(typeof c=="function"&&typeof l!="function"){var _=l;l=c;var y=o;return function(F){var Y=this;F===void 0&&(F=_);for(var H=arguments.length,B=Array(H>1?H-1:0),K=1;K<H;K++)B[K-1]=arguments[K];return y.produce(F,function(z){var oe;return(oe=l).call.apply(oe,[Y,z].concat(B))})}}var S;if(typeof l!="function"&&eo(6),f!==void 0&&typeof f!="function"&&eo(7),wa(c)){var R=eV(o),w=lC(o,c,void 0),b=!0;try{S=l(w),b=!1}finally{b?J_(R):uC(R)}return typeof Promise<"u"&&S instanceof Promise?S.then(function(F){return tI(R,f),nI(F,R)},function(F){throw J_(R),F}):(tI(R,f),nI(S,R))}if(!c||typeof c!="object"){if((S=l(c))===void 0&&(S=c),S===Fj&&(S=void 0),o.D&&yb(S,!0),f){var k=[],M=[];No("Patches").M(c,S,k,M),f(k,M)}return S}eo(21,c)},this.produceWithPatches=function(c,l){if(typeof c=="function")return function(S){for(var R=arguments.length,w=Array(R>1?R-1:0),b=1;b<R;b++)w[b-1]=arguments[b];return o.produceWithPatches(S,function(k){return c.apply(void 0,[k].concat(w))})};var f,_,y=o.produce(c,l,function(S,R){f=S,_=R});return typeof Promise<"u"&&y instanceof Promise?y.then(function(S){return[S,f,_]}):[y,f,_]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){wa(n)||eo(8),Mc(n)&&(n=Nce(n));var o=eV(this),c=lC(this,n,void 0);return c[In].C=!0,uC(o),c},e.finishDraft=function(n,o){var c=n&&n[In],l=c.A;return tI(l,o),nI(void 0,l)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!sV&&eo(20),this.g=n},e.applyPatches=function(n,o){var c;for(c=o.length-1;c>=0;c--){var l=o[c];if(l.path.length===0&&l.op==="replace"){n=l.value;break}}c>-1&&(o=o.slice(c+1));var f=No("Patches").$;return Mc(n)?f(n,o):this.produce(n,function(_){return f(_,o)})},t}(),us=new Mce,Bj=us.produce;us.produceWithPatches.bind(us);us.setAutoFreeze.bind(us);us.setUseProxies.bind(us);us.applyPatches.bind(us);us.createDraft.bind(us);us.finishDraft.bind(us);function Pf(t){return Pf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pf(t)}function xce(t,e){if(Pf(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var o=n.call(t,e||"default");if(Pf(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Uce(t){var e=xce(t,"string");return Pf(e)==="symbol"?e:String(e)}function Vce(t,e,n){return e=Uce(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function aV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),n.push.apply(n,o)}return n}function cV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?aV(Object(n),!0).forEach(function(o){Vce(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aV(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function ti(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}var uV=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),sI=function(){return Math.random().toString(36).substring(7).split("").join(".")},ev={INIT:"@@redux/INIT"+sI(),REPLACE:"@@redux/REPLACE"+sI(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+sI()}};function Fce(t){if(typeof t!="object"||t===null)return!1;for(var e=t;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function Gj(t,e,n){var o;if(typeof e=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(ti(0));if(typeof e=="function"&&typeof n>"u"&&(n=e,e=void 0),typeof n<"u"){if(typeof n!="function")throw new Error(ti(1));return n(Gj)(t,e)}if(typeof t!="function")throw new Error(ti(2));var c=t,l=e,f=[],_=f,y=!1;function S(){_===f&&(_=f.slice())}function R(){if(y)throw new Error(ti(3));return l}function w(F){if(typeof F!="function")throw new Error(ti(4));if(y)throw new Error(ti(5));var Y=!0;return S(),_.push(F),function(){if(Y){if(y)throw new Error(ti(6));Y=!1,S();var B=_.indexOf(F);_.splice(B,1),f=null}}}function b(F){if(!Fce(F))throw new Error(ti(7));if(typeof F.type>"u")throw new Error(ti(8));if(y)throw new Error(ti(9));try{y=!0,l=c(l,F)}finally{y=!1}for(var Y=f=_,H=0;H<Y.length;H++){var B=Y[H];B()}return F}function k(F){if(typeof F!="function")throw new Error(ti(10));c=F,b({type:ev.REPLACE})}function M(){var F,Y=w;return F={subscribe:function(B){if(typeof B!="object"||B===null)throw new Error(ti(11));function K(){B.next&&B.next(R())}K();var z=Y(K);return{unsubscribe:z}}},F[uV]=function(){return this},F}return b({type:ev.INIT}),o={dispatch:b,subscribe:w,getState:R,replaceReducer:k},o[uV]=M,o}function jce(t){Object.keys(t).forEach(function(e){var n=t[e],o=n(void 0,{type:ev.INIT});if(typeof o>"u")throw new Error(ti(12));if(typeof n(void 0,{type:ev.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(ti(13))})}function Bce(t){for(var e=Object.keys(t),n={},o=0;o<e.length;o++){var c=e[o];typeof t[c]=="function"&&(n[c]=t[c])}var l=Object.keys(n),f;try{jce(n)}catch(_){f=_}return function(y,S){if(y===void 0&&(y={}),f)throw f;for(var R=!1,w={},b=0;b<l.length;b++){var k=l[b],M=n[k],F=y[k],Y=M(F,S);if(typeof Y>"u")throw S&&S.type,new Error(ti(14));w[k]=Y,R=R||Y!==F}return R=R||l.length!==Object.keys(y).length,R?w:y}}function tv(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===0?function(o){return o}:e.length===1?e[0]:e.reduce(function(o,c){return function(){return o(c.apply(void 0,arguments))}})}function Gce(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(o){return function(){var c=o.apply(void 0,arguments),l=function(){throw new Error(ti(15))},f={getState:c.getState,dispatch:function(){return l.apply(void 0,arguments)}},_=e.map(function(y){return y(f)});return l=tv.apply(void 0,_)(c.dispatch),cV(cV({},c),{},{dispatch:l})}}}function Wj(t){var e=function(o){var c=o.dispatch,l=o.getState;return function(f){return function(_){return typeof _=="function"?_(c,l,t):f(_)}}};return e}var Hj=Wj();Hj.withExtraArgument=Wj;const hC=Hj;var Wce=globalThis&&globalThis.__extends||function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,c){o.__proto__=c}||function(o,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(o[l]=c[l])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function o(){this.constructor=e}e.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}}(),Hce=globalThis&&globalThis.__generator||function(t,e){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},o,c,l,f;return f={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function _(S){return function(R){return y([S,R])}}function y(S){if(o)throw new TypeError("Generator is already executing.");for(;n;)try{if(o=1,c&&(l=S[0]&2?c.return:S[0]?c.throw||((l=c.return)&&l.call(c),0):c.next)&&!(l=l.call(c,S[1])).done)return l;switch(c=0,l&&(S=[S[0]&2,l.value]),S[0]){case 0:case 1:l=S;break;case 4:return n.label++,{value:S[1],done:!1};case 5:n.label++,c=S[1],S=[0];continue;case 7:S=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(S[0]===6||S[0]===2)){n=0;continue}if(S[0]===3&&(!l||S[1]>l[0]&&S[1]<l[3])){n.label=S[1];break}if(S[0]===6&&n.label<l[1]){n.label=l[1],l=S;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(S);break}l[2]&&n.ops.pop(),n.trys.pop();continue}S=e.call(t,n)}catch(R){S=[6,R],c=0}finally{o=l=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}},nv=globalThis&&globalThis.__spreadArray||function(t,e){for(var n=0,o=e.length,c=t.length;n<o;n++,c++)t[c]=e[n];return t},$ce=Object.defineProperty,Kce=Object.defineProperties,qce=Object.getOwnPropertyDescriptors,lV=Object.getOwnPropertySymbols,zce=Object.prototype.hasOwnProperty,Yce=Object.prototype.propertyIsEnumerable,dV=function(t,e,n){return e in t?$ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n},wc=function(t,e){for(var n in e||(e={}))zce.call(e,n)&&dV(t,n,e[n]);if(lV)for(var o=0,c=lV(e);o<c.length;o++){var n=c[o];Yce.call(e,n)&&dV(t,n,e[n])}return t},oI=function(t,e){return Kce(t,qce(e))},Xce=function(t,e,n){return new Promise(function(o,c){var l=function(y){try{_(n.next(y))}catch(S){c(S)}},f=function(y){try{_(n.throw(y))}catch(S){c(S)}},_=function(y){return y.done?o(y.value):Promise.resolve(y.value).then(l,f)};_((n=n.apply(t,e)).next())})},Jce=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?tv:tv.apply(null,arguments)};function Qce(t){if(typeof t!="object"||t===null)return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(var n=e;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return e===n}var Zce=function(t){Wce(e,t);function e(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var c=t.apply(this,n)||this;return Object.setPrototypeOf(c,e.prototype),c}return Object.defineProperty(e,Symbol.species,{get:function(){return e},enumerable:!1,configurable:!0}),e.prototype.concat=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return t.prototype.concat.apply(this,n)},e.prototype.prepend=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return n.length===1&&Array.isArray(n[0])?new(e.bind.apply(e,nv([void 0],n[0].concat(this)))):new(e.bind.apply(e,nv([void 0],n.concat(this))))},e}(Array);function pC(t){return wa(t)?Bj(t,function(){}):t}function eue(t){return typeof t=="boolean"}function tue(){return function(e){return nue(e)}}function nue(t){t===void 0&&(t={});var e=t.thunk,n=e===void 0?!0:e;t.immutableCheck,t.serializableCheck;var o=new Zce;return n&&(eue(n)?o.push(hC):o.push(hC.withExtraArgument(n.extraArgument))),o}var rue=!0;function iue(t){var e=tue(),n=t||{},o=n.reducer,c=o===void 0?void 0:o,l=n.middleware,f=l===void 0?e():l,_=n.devTools,y=_===void 0?!0:_,S=n.preloadedState,R=S===void 0?void 0:S,w=n.enhancers,b=w===void 0?void 0:w,k;if(typeof c=="function")k=c;else if(Qce(c))k=Bce(c);else throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');var M=f;typeof M=="function"&&(M=M(e));var F=Gce.apply(void 0,M),Y=tv;y&&(Y=Jce(wc({trace:!rue},typeof y=="object"&&y)));var H=[F];Array.isArray(b)?H=nv([F],b):typeof b=="function"&&(H=b(H));var B=Y.apply(void 0,H);return Gj(k,R,B)}function Cc(t,e){function n(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];if(e){var l=e.apply(void 0,o);if(!l)throw new Error("prepareAction did not return an object");return wc(wc({type:t,payload:l.payload},"meta"in l&&{meta:l.meta}),"error"in l&&{error:l.error})}return{type:t,payload:o[0]}}return n.toString=function(){return""+t},n.type=t,n.match=function(o){return o.type===t},n}function $j(t){var e={},n=[],o,c={addCase:function(l,f){var _=typeof l=="string"?l:l.type;if(_ in e)throw new Error("addCase cannot be called with two reducers for the same action type");return e[_]=f,c},addMatcher:function(l,f){return n.push({matcher:l,reducer:f}),c},addDefaultCase:function(l){return o=l,c}};return t(c),[e,n,o]}function sue(t){return typeof t=="function"}function oue(t,e,n,o){n===void 0&&(n=[]);var c=typeof e=="function"?$j(e):[e,n,o],l=c[0],f=c[1],_=c[2],y;if(sue(t))y=function(){return pC(t())};else{var S=pC(t);y=function(){return S}}function R(w,b){w===void 0&&(w=y());var k=nv([l[b.type]],f.filter(function(M){var F=M.matcher;return F(b)}).map(function(M){var F=M.reducer;return F}));return k.filter(function(M){return!!M}).length===0&&(k=[_]),k.reduce(function(M,F){if(F)if(Mc(M)){var Y=M,H=F(Y,b);return H===void 0?M:H}else{if(wa(M))return Bj(M,function(B){return F(B,b)});var H=F(M,b);if(H===void 0){if(M===null)return M;throw Error("A case reducer on a non-draftable value must not return undefined")}return H}return M},w)}return R.getInitialState=y,R}function aue(t,e){return t+"/"+e}function cue(t){var e=t.name;if(!e)throw new Error("`name` is a required option for createSlice");typeof process<"u";var n=typeof t.initialState=="function"?t.initialState:pC(t.initialState),o=t.reducers||{},c=Object.keys(o),l={},f={},_={};c.forEach(function(R){var w=o[R],b=aue(e,R),k,M;"reducer"in w?(k=w.reducer,M=w.prepare):k=w,l[R]=k,f[b]=k,_[R]=M?Cc(b,M):Cc(b)});function y(){var R=typeof t.extraReducers=="function"?$j(t.extraReducers):[t.extraReducers],w=R[0],b=w===void 0?{}:w,k=R[1],M=k===void 0?[]:k,F=R[2],Y=F===void 0?void 0:F,H=wc(wc({},b),f);return oue(n,function(B){for(var K in H)B.addCase(K,H[K]);for(var z=0,oe=M;z<oe.length;z++){var de=oe[z];B.addMatcher(de.matcher,de.reducer)}Y&&B.addDefaultCase(Y)})}var S;return{name:e,reducer:function(R,w){return S||(S=y()),S(R,w)},actions:_,caseReducers:l,getInitialState:function(){return S||(S=y()),S.getInitialState()}}}var uue="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Rb=function(t){t===void 0&&(t=21);for(var e="",n=t;n--;)e+=uue[Math.random()*64|0];return e},lue=["name","message","stack","code"],aI=function(){function t(e,n){this.payload=e,this.meta=n}return t}(),hV=function(){function t(e,n){this.payload=e,this.meta=n}return t}(),due=function(t){if(typeof t=="object"&&t!==null){for(var e={},n=0,o=lue;n<o.length;n++){var c=o[n];typeof t[c]=="string"&&(e[c]=t[c])}return e}return{message:String(t)}};(function(){function t(e,n,o){var c=Cc(e+"/fulfilled",function(S,R,w,b){return{payload:S,meta:oI(wc({},b||{}),{arg:w,requestId:R,requestStatus:"fulfilled"})}}),l=Cc(e+"/pending",function(S,R,w){return{payload:void 0,meta:oI(wc({},w||{}),{arg:R,requestId:S,requestStatus:"pending"})}}),f=Cc(e+"/rejected",function(S,R,w,b,k){return{payload:b,error:(o&&o.serializeError||due)(S||"Rejected"),meta:oI(wc({},k||{}),{arg:w,requestId:R,rejectedWithValue:!!b,requestStatus:"rejected",aborted:(S==null?void 0:S.name)==="AbortError",condition:(S==null?void 0:S.name)==="ConditionError"})}}),_=typeof AbortController<"u"?AbortController:function(){function S(){this.signal={aborted:!1,addEventListener:function(){},dispatchEvent:function(){return!1},onabort:function(){},removeEventListener:function(){},reason:void 0,throwIfAborted:function(){}}}return S.prototype.abort=function(){},S}();function y(S){return function(R,w,b){var k=o!=null&&o.idGenerator?o.idGenerator(S):Rb(),M=new _,F;function Y(B){F=B,M.abort()}var H=function(){return Xce(this,null,function(){var B,K,z,oe,de,Ee,we;return Hce(this,function(Fe){switch(Fe.label){case 0:return Fe.trys.push([0,4,,5]),oe=(B=o==null?void 0:o.condition)==null?void 0:B.call(o,S,{getState:w,extra:b}),pue(oe)?[4,oe]:[3,2];case 1:oe=Fe.sent(),Fe.label=2;case 2:if(oe===!1||M.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};return de=new Promise(function(be,dt){return M.signal.addEventListener("abort",function(){return dt({name:"AbortError",message:F||"Aborted"})})}),R(l(k,S,(K=o==null?void 0:o.getPendingMeta)==null?void 0:K.call(o,{requestId:k,arg:S},{getState:w,extra:b}))),[4,Promise.race([de,Promise.resolve(n(S,{dispatch:R,getState:w,extra:b,requestId:k,signal:M.signal,abort:Y,rejectWithValue:function(be,dt){return new aI(be,dt)},fulfillWithValue:function(be,dt){return new hV(be,dt)}})).then(function(be){if(be instanceof aI)throw be;return be instanceof hV?c(be.payload,k,S,be.meta):c(be,k,S)})])];case 3:return z=Fe.sent(),[3,5];case 4:return Ee=Fe.sent(),z=Ee instanceof aI?f(null,k,S,Ee.payload,Ee.meta):f(Ee,k,S),[3,5];case 5:return we=o&&!o.dispatchConditionRejection&&f.match(z)&&z.meta.condition,we||R(z),[2,z]}})})}();return Object.assign(H,{abort:Y,requestId:k,arg:S,unwrap:function(){return H.then(hue)}})}}return Object.assign(y,{pending:l,rejected:f,fulfilled:c,typePrefix:e})}return t.withTypes=function(){return t},t})();function hue(t){if(t.meta&&t.meta.rejectedWithValue)throw t.payload;if(t.error)throw t.error;return t.payload}function pue(t){return t!==null&&typeof t=="object"&&typeof t.then=="function"}var Ib="listenerMiddleware";Cc(Ib+"/add");Cc(Ib+"/removeAll");Cc(Ib+"/remove");var pV;typeof queueMicrotask=="function"&&queueMicrotask.bind(typeof window<"u"?window:typeof global<"u"?global:globalThis);Pce();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kj=function(t){const e=[];let n=0;for(let o=0;o<t.length;o++){let c=t.charCodeAt(o);c<128?e[n++]=c:c<2048?(e[n++]=c>>6|192,e[n++]=c&63|128):(c&64512)===55296&&o+1<t.length&&(t.charCodeAt(o+1)&64512)===56320?(c=65536+((c&1023)<<10)+(t.charCodeAt(++o)&1023),e[n++]=c>>18|240,e[n++]=c>>12&63|128,e[n++]=c>>6&63|128,e[n++]=c&63|128):(e[n++]=c>>12|224,e[n++]=c>>6&63|128,e[n++]=c&63|128)}return e},fue=function(t){const e=[];let n=0,o=0;for(;n<t.length;){const c=t[n++];if(c<128)e[o++]=String.fromCharCode(c);else if(c>191&&c<224){const l=t[n++];e[o++]=String.fromCharCode((c&31)<<6|l&63)}else if(c>239&&c<365){const l=t[n++],f=t[n++],_=t[n++],y=((c&7)<<18|(l&63)<<12|(f&63)<<6|_&63)-65536;e[o++]=String.fromCharCode(55296+(y>>10)),e[o++]=String.fromCharCode(56320+(y&1023))}else{const l=t[n++],f=t[n++];e[o++]=String.fromCharCode((c&15)<<12|(l&63)<<6|f&63)}}return e.join("")},qj={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let c=0;c<t.length;c+=3){const l=t[c],f=c+1<t.length,_=f?t[c+1]:0,y=c+2<t.length,S=y?t[c+2]:0,R=l>>2,w=(l&3)<<4|_>>4;let b=(_&15)<<2|S>>6,k=S&63;y||(k=64,f||(b=64)),o.push(n[R],n[w],n[b],n[k])}return o.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Kj(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):fue(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let c=0;c<t.length;){const l=n[t.charAt(c++)],_=c<t.length?n[t.charAt(c)]:0;++c;const S=c<t.length?n[t.charAt(c)]:64;++c;const w=c<t.length?n[t.charAt(c)]:64;if(++c,l==null||_==null||S==null||w==null)throw Error();const b=l<<2|_>>4;if(o.push(b),S!==64){const k=_<<4&240|S>>2;if(o.push(k),w!==64){const M=S<<6&192|w;o.push(M)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},mue=function(t){const e=Kj(t);return qj.encodeByteArray(e,!0)},rv=function(t){return mue(t).replace(/\./g,"")},zj=function(t){try{return qj.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gue(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eue=()=>gue().__FIREBASE_DEFAULTS__,_ue=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},vue=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&zj(t[1]);return e&&JSON.parse(e)},wb=()=>{try{return Eue()||_ue()||vue()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Yj=t=>{var e,n;return(n=(e=wb())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},Xj=t=>{const e=Yj(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),o]:[e.substring(0,n),o]},yue=()=>{var t;return(t=wb())===null||t===void 0?void 0:t.config},Jj=t=>{var e;return(e=wb())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sue{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,o)=>{n?this.reject(n):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qj(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},o=e||"demo-project",c=t.iat||0,l=t.sub||t.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:c,exp:c+3600,auth_time:c,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}}},t),_="";return[rv(JSON.stringify(n)),rv(JSON.stringify(f)),_].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function li(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Tue(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(li())}function Rue(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Iue(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function wue(){const t=li();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Cue(){try{return typeof indexedDB=="object"}catch{return!1}}function Aue(){return new Promise((t,e)=>{try{let n=!0;const o="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(o);c.onsuccess=()=>{c.result.close(),n||self.indexedDB.deleteDatabase(o),t(!0)},c.onupgradeneeded=()=>{n=!1},c.onerror=()=>{var l;e(((l=c.error)===null||l===void 0?void 0:l.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bue="FirebaseError";class Fo extends Error{constructor(e,n,o){super(n),this.code=e,this.customData=o,this.name=bue,Object.setPrototypeOf(this,Fo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,em.prototype.create)}}class em{constructor(e,n,o){this.service=e,this.serviceName=n,this.errors=o}create(e,...n){const o=n[0]||{},c=`${this.service}/${e}`,l=this.errors[e],f=l?Oue(l,o):"Error",_=`${this.serviceName}: ${f} (${c}).`;return new Fo(c,_,o)}}function Oue(t,e){return t.replace(Nue,(n,o)=>{const c=e[o];return c!=null?String(c):`<${o}?>`})}const Nue=/\{\$([^}]+)}/g;function Pue(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function iv(t,e){if(t===e)return!0;const n=Object.keys(t),o=Object.keys(e);for(const c of n){if(!o.includes(c))return!1;const l=t[c],f=e[c];if(fV(l)&&fV(f)){if(!iv(l,f))return!1}else if(l!==f)return!1}for(const c of o)if(!n.includes(c))return!1;return!0}function fV(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tm(t){const e=[];for(const[n,o]of Object.entries(t))Array.isArray(o)?o.forEach(c=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function kp(t){const e={};return t.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[c,l]=o.split("=");e[decodeURIComponent(c)]=decodeURIComponent(l)}}),e}function Lp(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function Due(t,e){const n=new kue(t,e);return n.subscribe.bind(n)}class kue{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,o){let c;if(e===void 0&&n===void 0&&o===void 0)throw new Error("Missing Observer.");Lue(e,["next","error","complete"])?c=e:c={next:e,error:n,complete:o},c.next===void 0&&(c.next=cI),c.error===void 0&&(c.error=cI),c.complete===void 0&&(c.complete=cI);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Lue(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function cI(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yr(t){return t&&t._delegate?t._delegate:t}class xc{constructor(e,n,o){this.name=e,this.instanceFactory=n,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mue{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const o=new Sue;if(this.instancesDeferred.set(n,o),this.isInitialized(n)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:n});c&&o.resolve(c)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(l){if(c)return null;throw l}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Uue(e))try{this.getOrInitializeService({instanceIdentifier:Cu})}catch{}for(const[n,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(n);try{const l=this.getOrInitializeService({instanceIdentifier:c});o.resolve(l)}catch{}}}}clearInstance(e=Cu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Cu){return this.instances.has(e)}getOptions(e=Cu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:o,options:n});for(const[l,f]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(l);o===_&&f.resolve(c)}return c}onInit(e,n){var o;const c=this.normalizeInstanceIdentifier(n),l=(o=this.onInitCallbacks.get(c))!==null&&o!==void 0?o:new Set;l.add(e),this.onInitCallbacks.set(c,l);const f=this.instances.get(c);return f&&e(f,c),()=>{l.delete(e)}}invokeOnInitCallbacks(e,n){const o=this.onInitCallbacks.get(n);if(o)for(const c of o)try{c(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:xue(e),options:n}),this.instances.set(e,o),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Cu){return this.component?this.component.multipleInstances?e:Cu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function xue(t){return t===Cu?void 0:t}function Uue(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vue{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Mue(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Kt||(Kt={}));const Fue={debug:Kt.DEBUG,verbose:Kt.VERBOSE,info:Kt.INFO,warn:Kt.WARN,error:Kt.ERROR,silent:Kt.SILENT},jue=Kt.INFO,Bue={[Kt.DEBUG]:"log",[Kt.VERBOSE]:"log",[Kt.INFO]:"info",[Kt.WARN]:"warn",[Kt.ERROR]:"error"},Gue=(t,e,...n)=>{if(e<t.logLevel)return;const o=new Date().toISOString(),c=Bue[e];if(c)console[c](`[${o}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Cb{constructor(e){this.name=e,this._logLevel=jue,this._logHandler=Gue,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Kt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Fue[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Kt.DEBUG,...e),this._logHandler(this,Kt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Kt.VERBOSE,...e),this._logHandler(this,Kt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Kt.INFO,...e),this._logHandler(this,Kt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Kt.WARN,...e),this._logHandler(this,Kt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Kt.ERROR,...e),this._logHandler(this,Kt.ERROR,...e)}}const Wue=(t,e)=>e.some(n=>t instanceof n);let mV,gV;function Hue(){return mV||(mV=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function $ue(){return gV||(gV=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Zj=new WeakMap,fC=new WeakMap,e7=new WeakMap,uI=new WeakMap,Ab=new WeakMap;function Kue(t){const e=new Promise((n,o)=>{const c=()=>{t.removeEventListener("success",l),t.removeEventListener("error",f)},l=()=>{n(Ac(t.result)),c()},f=()=>{o(t.error),c()};t.addEventListener("success",l),t.addEventListener("error",f)});return e.then(n=>{n instanceof IDBCursor&&Zj.set(n,t)}).catch(()=>{}),Ab.set(e,t),e}function que(t){if(fC.has(t))return;const e=new Promise((n,o)=>{const c=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",f),t.removeEventListener("abort",f)},l=()=>{n(),c()},f=()=>{o(t.error||new DOMException("AbortError","AbortError")),c()};t.addEventListener("complete",l),t.addEventListener("error",f),t.addEventListener("abort",f)});fC.set(t,e)}let mC={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return fC.get(t);if(e==="objectStoreNames")return t.objectStoreNames||e7.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ac(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function zue(t){mC=t(mC)}function Yue(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const o=t.call(lI(this),e,...n);return e7.set(o,e.sort?e.sort():[e]),Ac(o)}:$ue().includes(t)?function(...e){return t.apply(lI(this),e),Ac(Zj.get(this))}:function(...e){return Ac(t.apply(lI(this),e))}}function Xue(t){return typeof t=="function"?Yue(t):(t instanceof IDBTransaction&&que(t),Wue(t,Hue())?new Proxy(t,mC):t)}function Ac(t){if(t instanceof IDBRequest)return Kue(t);if(uI.has(t))return uI.get(t);const e=Xue(t);return e!==t&&(uI.set(t,e),Ab.set(e,t)),e}const lI=t=>Ab.get(t);function Jue(t,e,{blocked:n,upgrade:o,blocking:c,terminated:l}={}){const f=indexedDB.open(t,e),_=Ac(f);return o&&f.addEventListener("upgradeneeded",y=>{o(Ac(f.result),y.oldVersion,y.newVersion,Ac(f.transaction))}),n&&f.addEventListener("blocked",()=>n()),_.then(y=>{l&&y.addEventListener("close",()=>l()),c&&y.addEventListener("versionchange",()=>c())}).catch(()=>{}),_}const Que=["get","getKey","getAll","getAllKeys","count"],Zue=["put","add","delete","clear"],dI=new Map;function EV(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(dI.get(e))return dI.get(e);const n=e.replace(/FromIndex$/,""),o=e!==n,c=Zue.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(c||Que.includes(n)))return;const l=async function(f,..._){const y=this.transaction(f,c?"readwrite":"readonly");let S=y.store;return o&&(S=S.index(_.shift())),(await Promise.all([S[n](..._),c&&y.done]))[0]};return dI.set(e,l),l}zue(t=>({...t,get:(e,n,o)=>EV(e,n)||t.get(e,n,o),has:(e,n)=>!!EV(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ele{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(tle(n)){const o=n.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(n=>n).join(" ")}}function tle(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const gC="@firebase/app",_V="0.9.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zu=new Cb("@firebase/app"),nle="@firebase/app-compat",rle="@firebase/analytics-compat",ile="@firebase/analytics",sle="@firebase/app-check-compat",ole="@firebase/app-check",ale="@firebase/auth",cle="@firebase/auth-compat",ule="@firebase/database",lle="@firebase/database-compat",dle="@firebase/functions",hle="@firebase/functions-compat",ple="@firebase/installations",fle="@firebase/installations-compat",mle="@firebase/messaging",gle="@firebase/messaging-compat",Ele="@firebase/performance",_le="@firebase/performance-compat",vle="@firebase/remote-config",yle="@firebase/remote-config-compat",Sle="@firebase/storage",Tle="@firebase/storage-compat",Rle="@firebase/firestore",Ile="@firebase/firestore-compat",wle="firebase",Cle="9.17.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EC="[DEFAULT]",Ale={[gC]:"fire-core",[nle]:"fire-core-compat",[ile]:"fire-analytics",[rle]:"fire-analytics-compat",[ole]:"fire-app-check",[sle]:"fire-app-check-compat",[ale]:"fire-auth",[cle]:"fire-auth-compat",[ule]:"fire-rtdb",[lle]:"fire-rtdb-compat",[dle]:"fire-fn",[hle]:"fire-fn-compat",[ple]:"fire-iid",[fle]:"fire-iid-compat",[mle]:"fire-fcm",[gle]:"fire-fcm-compat",[Ele]:"fire-perf",[_le]:"fire-perf-compat",[vle]:"fire-rc",[yle]:"fire-rc-compat",[Sle]:"fire-gcs",[Tle]:"fire-gcs-compat",[Rle]:"fire-fst",[Ile]:"fire-fst-compat","fire-js":"fire-js",[wle]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sv=new Map,_C=new Map;function ble(t,e){try{t.container.addComponent(e)}catch(n){zu.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Yu(t){const e=t.name;if(_C.has(e))return zu.debug(`There were multiple attempts to register component ${e}.`),!1;_C.set(e,t);for(const n of sv.values())ble(n,t);return!0}function b1(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ole={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},bc=new em("app","Firebase",Ole);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nle{constructor(e,n,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new xc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw bc.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eh=Cle;function t7(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const o=Object.assign({name:EC,automaticDataCollectionEnabled:!1},e),c=o.name;if(typeof c!="string"||!c)throw bc.create("bad-app-name",{appName:String(c)});if(n||(n=yue()),!n)throw bc.create("no-options");const l=sv.get(c);if(l){if(iv(n,l.options)&&iv(o,l.config))return l;throw bc.create("duplicate-app",{appName:c})}const f=new Vue(c);for(const y of _C.values())f.addComponent(y);const _=new Nle(n,o,f);return sv.set(c,_),_}function bb(t=EC){const e=sv.get(t);if(!e&&t===EC)return t7();if(!e)throw bc.create("no-app",{appName:t});return e}function Po(t,e,n){var o;let c=(o=Ale[t])!==null&&o!==void 0?o:t;n&&(c+=`-${n}`);const l=c.match(/\s|\//),f=e.match(/\s|\//);if(l||f){const _=[`Unable to register library "${c}" with version "${e}":`];l&&_.push(`library name "${c}" contains illegal characters (whitespace or "/")`),l&&f&&_.push("and"),f&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),zu.warn(_.join(" "));return}Yu(new xc(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ple="firebase-heartbeat-database",Dle=1,Df="firebase-heartbeat-store";let hI=null;function n7(){return hI||(hI=Jue(Ple,Dle,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Df)}}}).catch(t=>{throw bc.create("idb-open",{originalErrorMessage:t.message})})),hI}async function kle(t){try{return(await n7()).transaction(Df).objectStore(Df).get(r7(t))}catch(e){if(e instanceof Fo)zu.warn(e.message);else{const n=bc.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});zu.warn(n.message)}}}async function vV(t,e){try{const o=(await n7()).transaction(Df,"readwrite");return await o.objectStore(Df).put(e,r7(t)),o.done}catch(n){if(n instanceof Fo)zu.warn(n.message);else{const o=bc.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});zu.warn(o.message)}}}function r7(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lle=1024,Mle=30*24*60*60*1e3;class xle{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Vle(n),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=yV();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(c=>c.date===o)))return this._heartbeatsCache.heartbeats.push({date:o,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(c=>{const l=new Date(c.date).valueOf();return Date.now()-l<=Mle}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=yV(),{heartbeatsToSend:n,unsentEntries:o}=Ule(this._heartbeatsCache.heartbeats),c=rv(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,o.length>0?(this._heartbeatsCache.heartbeats=o,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),c}}function yV(){return new Date().toISOString().substring(0,10)}function Ule(t,e=Lle){const n=[];let o=t.slice();for(const c of t){const l=n.find(f=>f.agent===c.agent);if(l){if(l.dates.push(c.date),SV(n)>e){l.dates.pop();break}}else if(n.push({agent:c.agent,dates:[c.date]}),SV(n)>e){n.pop();break}o=o.slice(1)}return{heartbeatsToSend:n,unsentEntries:o}}class Vle{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Cue()?Aue().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await kle(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const c=await this.read();return vV(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const c=await this.read();return vV(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function SV(t){return rv(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fle(t){Yu(new xc("platform-logger",e=>new ele(e),"PRIVATE")),Yu(new xc("heartbeat",e=>new xle(e),"PRIVATE")),Po(gC,_V,t),Po(gC,_V,"esm2017"),Po("fire-js","")}Fle("");function Ob(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(t);c<o.length;c++)e.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(t,o[c])&&(n[o[c]]=t[o[c]]);return n}function i7(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jle=i7,s7=new em("auth","Firebase",i7());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TV=new Cb("@firebase/auth");function l_(t,...e){TV.logLevel<=Kt.ERROR&&TV.error(`Auth (${Eh}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Us(t,...e){throw Nb(t,...e)}function Do(t,...e){return Nb(t,...e)}function o7(t,e,n){const o=Object.assign(Object.assign({},jle()),{[e]:n});return new em("auth","Firebase",o).create(e,{appName:t.name})}function Ble(t,e,n){const o=n;if(!(e instanceof o))throw o.name!==e.constructor.name&&Us(t,"argument-error"),o7(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Nb(t,...e){if(typeof t!="string"){const n=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=t.name),t._errorFactory.create(n,...o)}return s7.create(t,...e)}function it(t,e,...n){if(!t)throw Nb(e,...n)}function ma(t){const e="INTERNAL ASSERTION FAILED: "+t;throw l_(e),new Error(e)}function Ca(t,e){t||ma(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RV=new Map;function ga(t){Ca(t instanceof Function,"Expected a class definition");let e=RV.get(t);return e?(Ca(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,RV.set(t,e),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gle(t,e){const n=b1(t,"auth");if(n.isInitialized()){const c=n.getImmediate(),l=n.getOptions();if(iv(l,e??{}))return c;Us(c,"already-initialized")}return n.initialize({options:e})}function Wle(t,e){const n=(e==null?void 0:e.persistence)||[],o=(Array.isArray(n)?n:[n]).map(ga);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vC(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Hle(){return IV()==="http:"||IV()==="https:"}function IV(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $le(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Hle()||Rue()||"connection"in navigator)?navigator.onLine:!0}function Kle(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e,n){this.shortDelay=e,this.longDelay=n,Ca(n>e,"Short delay should be less than long delay!"),this.isMobile=Tue()||Iue()}get(){return $le()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pb(t,e){Ca(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a7{static initialize(e,n,o){this.fetchImpl=e,n&&(this.headersImpl=n),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;ma("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;ma("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;ma("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qle={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zle=new nm(3e4,6e4);function rm(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function im(t,e,n,o,c={}){return c7(t,c,async()=>{let l={},f={};o&&(e==="GET"?f=o:l={body:JSON.stringify(o)});const _=tm(Object.assign({key:t.config.apiKey},f)).slice(1),y=await t._getAdditionalHeaders();return y["Content-Type"]="application/json",t.languageCode&&(y["X-Firebase-Locale"]=t.languageCode),a7.fetch()(u7(t,t.config.apiHost,n,_),Object.assign({method:e,headers:y,referrerPolicy:"no-referrer"},l))})}async function c7(t,e,n){t._canInitEmulator=!1;const o=Object.assign(Object.assign({},qle),e);try{const c=new Yle(t),l=await Promise.race([n(),c.promise]);c.clearNetworkTimeout();const f=await l.json();if("needConfirmation"in f)throw jE(t,"account-exists-with-different-credential",f);if(l.ok&&!("errorMessage"in f))return f;{const _=l.ok?f.errorMessage:f.error.message,[y,S]=_.split(" : ");if(y==="FEDERATED_USER_ID_ALREADY_LINKED")throw jE(t,"credential-already-in-use",f);if(y==="EMAIL_EXISTS")throw jE(t,"email-already-in-use",f);if(y==="USER_DISABLED")throw jE(t,"user-disabled",f);const R=o[y]||y.toLowerCase().replace(/[_\s]+/g,"-");if(S)throw o7(t,R,S);Us(t,R)}}catch(c){if(c instanceof Fo)throw c;Us(t,"network-request-failed")}}async function sm(t,e,n,o,c={}){const l=await im(t,e,n,o,c);return"mfaPendingCredential"in l&&Us(t,"multi-factor-auth-required",{_serverResponse:l}),l}function u7(t,e,n,o){const c=`${e}${n}?${o}`;return t.config.emulator?Pb(t.config,c):`${t.config.apiScheme}://${c}`}class Yle{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,o)=>{this.timer=setTimeout(()=>o(Do(this.auth,"network-request-failed")),zle.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function jE(t,e,n){const o={appName:t.name};n.email&&(o.email=n.email),n.phoneNumber&&(o.phoneNumber=n.phoneNumber);const c=Do(t,e,o);return c.customData._tokenResponse=n,c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xle(t,e){return im(t,"POST","/v1/accounts:delete",e)}async function Jle(t,e){return im(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yp(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Qle(t,e=!1){const n=yr(t),o=await n.getIdToken(e),c=Db(o);it(c&&c.exp&&c.auth_time&&c.iat,n.auth,"internal-error");const l=typeof c.firebase=="object"?c.firebase:void 0,f=l==null?void 0:l.sign_in_provider;return{claims:c,token:o,authTime:Yp(pI(c.auth_time)),issuedAtTime:Yp(pI(c.iat)),expirationTime:Yp(pI(c.exp)),signInProvider:f||null,signInSecondFactor:(l==null?void 0:l.sign_in_second_factor)||null}}function pI(t){return Number(t)*1e3}function Db(t){const[e,n,o]=t.split(".");if(e===void 0||n===void 0||o===void 0)return l_("JWT malformed, contained fewer than 3 sections"),null;try{const c=zj(n);return c?JSON.parse(c):(l_("Failed to decode base64 JWT payload"),null)}catch(c){return l_("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function Zle(t){const e=Db(t);return it(e,"internal-error"),it(typeof e.exp<"u","internal-error"),it(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kf(t,e,n=!1){if(n)return e;try{return await e}catch(o){throw o instanceof Fo&&ede(o)&&t.auth.currentUser===t&&await t.auth.signOut(),o}}function ede({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tde{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const c=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l7{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Yp(this.lastLoginAt),this.creationTime=Yp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ov(t){var e;const n=t.auth,o=await t.getIdToken(),c=await kf(t,Jle(n,{idToken:o}));it(c==null?void 0:c.users.length,n,"internal-error");const l=c.users[0];t._notifyReloadListener(l);const f=!((e=l.providerUserInfo)===null||e===void 0)&&e.length?ide(l.providerUserInfo):[],_=rde(t.providerData,f),y=t.isAnonymous,S=!(t.email&&l.passwordHash)&&!(_!=null&&_.length),R=y?S:!1,w={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:_,metadata:new l7(l.createdAt,l.lastLoginAt),isAnonymous:R};Object.assign(t,w)}async function nde(t){const e=yr(t);await ov(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function rde(t,e){return[...t.filter(o=>!e.some(c=>c.providerId===o.providerId)),...e]}function ide(t){return t.map(e=>{var{providerId:n}=e,o=Ob(e,["providerId"]);return{providerId:n,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sde(t,e){const n=await c7(t,{},async()=>{const o=tm({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:l}=t.config,f=u7(t,c,"/v1/token",`key=${l}`),_=await t._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",a7.fetch()(f,{method:"POST",headers:_,body:o})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){it(e.idToken,"internal-error"),it(typeof e.idToken<"u","internal-error"),it(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Zle(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,n=!1){return it(!this.accessToken||this.refreshToken,e,"user-token-expired"),!n&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:o,refreshToken:c,expiresIn:l}=await sde(e,n);this.updateTokensAndExpiration(o,c,Number(l))}updateTokensAndExpiration(e,n,o){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,n){const{refreshToken:o,accessToken:c,expirationTime:l}=n,f=new Lf;return o&&(it(typeof o=="string","internal-error",{appName:e}),f.refreshToken=o),c&&(it(typeof c=="string","internal-error",{appName:e}),f.accessToken=c),l&&(it(typeof l=="number","internal-error",{appName:e}),f.expirationTime=l),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Lf,this.toJSON())}_performRefresh(){return ma("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(t,e){it(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Vu{constructor(e){var{uid:n,auth:o,stsTokenManager:c}=e,l=Ob(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tde(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=o,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=l.displayName||null,this.email=l.email||null,this.emailVerified=l.emailVerified||!1,this.phoneNumber=l.phoneNumber||null,this.photoURL=l.photoURL||null,this.isAnonymous=l.isAnonymous||!1,this.tenantId=l.tenantId||null,this.providerData=l.providerData?[...l.providerData]:[],this.metadata=new l7(l.createdAt||void 0,l.lastLoginAt||void 0)}async getIdToken(e){const n=await kf(this,this.stsTokenManager.getToken(this.auth,e));return it(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return Qle(this,e)}reload(){return nde(this)}_assign(e){this!==e&&(it(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Vu(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){it(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),n&&await ov(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await kf(this,Xle(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var o,c,l,f,_,y,S,R;const w=(o=n.displayName)!==null&&o!==void 0?o:void 0,b=(c=n.email)!==null&&c!==void 0?c:void 0,k=(l=n.phoneNumber)!==null&&l!==void 0?l:void 0,M=(f=n.photoURL)!==null&&f!==void 0?f:void 0,F=(_=n.tenantId)!==null&&_!==void 0?_:void 0,Y=(y=n._redirectEventId)!==null&&y!==void 0?y:void 0,H=(S=n.createdAt)!==null&&S!==void 0?S:void 0,B=(R=n.lastLoginAt)!==null&&R!==void 0?R:void 0,{uid:K,emailVerified:z,isAnonymous:oe,providerData:de,stsTokenManager:Ee}=n;it(K&&Ee,e,"internal-error");const we=Lf.fromJSON(this.name,Ee);it(typeof K=="string",e,"internal-error"),tc(w,e.name),tc(b,e.name),it(typeof z=="boolean",e,"internal-error"),it(typeof oe=="boolean",e,"internal-error"),tc(k,e.name),tc(M,e.name),tc(F,e.name),tc(Y,e.name),tc(H,e.name),tc(B,e.name);const Fe=new Vu({uid:K,auth:e,email:b,emailVerified:z,displayName:w,isAnonymous:oe,photoURL:M,phoneNumber:k,tenantId:F,stsTokenManager:we,createdAt:H,lastLoginAt:B});return de&&Array.isArray(de)&&(Fe.providerData=de.map(be=>Object.assign({},be))),Y&&(Fe._redirectEventId=Y),Fe}static async _fromIdTokenResponse(e,n,o=!1){const c=new Lf;c.updateFromServerResponse(n);const l=new Vu({uid:n.localId,auth:e,stsTokenManager:c,isAnonymous:o});return await ov(l),l}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d7{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}d7.type="NONE";const wV=d7;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d_(t,e,n){return`firebase:${t}:${e}:${n}`}class Ud{constructor(e,n,o){this.persistence=e,this.auth=n,this.userKey=o;const{config:c,name:l}=this.auth;this.fullUserKey=d_(this.userKey,c.apiKey,l),this.fullPersistenceKey=d_("persistence",c.apiKey,l),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Vu._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,o="authUser"){if(!n.length)return new Ud(ga(wV),e,o);const c=(await Promise.all(n.map(async S=>{if(await S._isAvailable())return S}))).filter(S=>S);let l=c[0]||ga(wV);const f=d_(o,e.config.apiKey,e.name);let _=null;for(const S of n)try{const R=await S._get(f);if(R){const w=Vu._fromJSON(e,R);S!==l&&(_=w),l=S;break}}catch{}const y=c.filter(S=>S._shouldAllowMigration);return!l._shouldAllowMigration||!y.length?new Ud(l,e,o):(l=y[0],_&&await l._set(f,_.toJSON()),await Promise.all(n.map(async S=>{if(S!==l)try{await S._remove(f)}catch{}})),new Ud(l,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CV(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(f7(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(h7(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(g7(e))return"Blackberry";if(E7(e))return"Webos";if(kb(e))return"Safari";if((e.includes("chrome/")||p7(e))&&!e.includes("edge/"))return"Chrome";if(m7(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=t.match(n);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function h7(t=li()){return/firefox\//i.test(t)}function kb(t=li()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function p7(t=li()){return/crios\//i.test(t)}function f7(t=li()){return/iemobile/i.test(t)}function m7(t=li()){return/android/i.test(t)}function g7(t=li()){return/blackberry/i.test(t)}function E7(t=li()){return/webos/i.test(t)}function O1(t=li()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function ode(t=li()){var e;return O1(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function ade(){return wue()&&document.documentMode===10}function _7(t=li()){return O1(t)||m7(t)||E7(t)||g7(t)||/windows phone/i.test(t)||f7(t)}function cde(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v7(t,e=[]){let n;switch(t){case"Browser":n=CV(li());break;case"Worker":n=`${CV(li())}-${t}`;break;default:n=t}const o=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Eh}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ude{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const o=l=>new Promise((f,_)=>{try{const y=e(l);f(y)}catch(y){_(y)}});o.onAbort=n,this.queue.push(o);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const o of this.queue)await o(e),o.onAbort&&n.push(o.onAbort)}catch(o){n.reverse();for(const c of n)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lde{constructor(e,n,o){this.app=e,this.heartbeatServiceProvider=n,this.config=o,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new AV(this),this.idTokenSubscription=new AV(this),this.beforeStateQueue=new ude(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=s7,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=o.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ga(n)),this._initializationPromise=this.queue(async()=>{var o,c;if(!this._deleted&&(this.persistenceManager=await Ud.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var n;const o=await this.assertedPersistence.getCurrentUser();let c=o,l=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,_=c==null?void 0:c._redirectEventId,y=await this.tryRedirectSignIn(e);(!f||f===_)&&(y!=null&&y.user)&&(c=y.user,l=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(l)try{await this.beforeStateQueue.runMiddleware(c)}catch(f){c=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return it(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await ov(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Kle()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const n=e?yr(e):null;return n&&it(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&it(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(ga(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new em("auth","Firebase",e())}onAuthStateChanged(e,n,o){return this.registerStateListener(this.authStateSubscription,e,n,o)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,o){return this.registerStateListener(this.idTokenSubscription,e,n,o)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const o=await this.getOrInitRedirectPersistenceManager(n);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ga(e)||this._popupRedirectResolver;it(n,this,"argument-error"),this.redirectPersistenceManager=await Ud.create(this,[ga(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,o;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,o,c){if(this._deleted)return()=>{};const l=typeof n=="function"?n:n.next.bind(n),f=this._isInitialized?Promise.resolve():this._initializationPromise;return it(f,this,"internal-error"),f.then(()=>l(this.currentUser)),typeof n=="function"?e.addObserver(n,o,c):e.addObserver(n)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return it(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=v7(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());return o&&(n["X-Firebase-Client"]=o),n}}function _h(t){return yr(t)}class AV{constructor(e){this.auth=e,this.observer=null,this.addObserver=Due(n=>this.observer=n)}get next(){return it(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function dde(t,e,n){const o=_h(t);it(o._canInitEmulator,o,"emulator-config-failed"),it(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const c=!!(n!=null&&n.disableWarnings),l=y7(e),{host:f,port:_}=hde(e),y=_===null?"":`:${_}`;o.config.emulator={url:`${l}//${f}${y}/`},o.settings.appVerificationDisabledForTesting=!0,o.emulatorConfig=Object.freeze({host:f,port:_,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:c})}),c||pde()}function y7(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function hde(t){const e=y7(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const o=n[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(o);if(c){const l=c[1];return{host:l,port:bV(o.substr(l.length+1))}}else{const[l,f]=o.split(":");return{host:l,port:bV(f)}}}function bV(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function pde(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ma("not implemented")}_getIdTokenResponse(e){return ma("not implemented")}_linkToIdToken(e,n){return ma("not implemented")}_getReauthenticationResolver(e){return ma("not implemented")}}async function fde(t,e){return im(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mde(t,e){return sm(t,"POST","/v1/accounts:signInWithPassword",rm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gde(t,e){return sm(t,"POST","/v1/accounts:signInWithEmailLink",rm(t,e))}async function Ede(t,e){return sm(t,"POST","/v1/accounts:signInWithEmailLink",rm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf extends Lb{constructor(e,n,o,c=null){super("password",o),this._email=e,this._password=n,this._tenantId=c}static _fromEmailAndPassword(e,n){return new Mf(e,n,"password")}static _fromEmailAndCode(e,n,o=null){return new Mf(e,n,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return mde(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return gde(e,{email:this._email,oobCode:this._password});default:Us(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":return fde(e,{idToken:n,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Ede(e,{idToken:n,email:this._email,oobCode:this._password});default:Us(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vd(t,e){return sm(t,"POST","/v1/accounts:signInWithIdp",rm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _de="http://localhost";class Xu extends Lb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Xu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Us("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:c}=n,l=Ob(n,["providerId","signInMethod"]);if(!o||!c)return null;const f=new Xu(o,c);return f.idToken=l.idToken||void 0,f.accessToken=l.accessToken||void 0,f.secret=l.secret,f.nonce=l.nonce,f.pendingToken=l.pendingToken||null,f}_getIdTokenResponse(e){const n=this.buildRequest();return Vd(e,n)}_linkToIdToken(e,n){const o=this.buildRequest();return o.idToken=n,Vd(e,o)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Vd(e,n)}buildRequest(){const e={requestUri:_de,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=tm(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vde(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function yde(t){const e=kp(Lp(t)).link,n=e?kp(Lp(e)).deep_link_id:null,o=kp(Lp(t)).deep_link_id;return(o?kp(Lp(o)).link:null)||o||n||e||t}class Mb{constructor(e){var n,o,c,l,f,_;const y=kp(Lp(e)),S=(n=y.apiKey)!==null&&n!==void 0?n:null,R=(o=y.oobCode)!==null&&o!==void 0?o:null,w=vde((c=y.mode)!==null&&c!==void 0?c:null);it(S&&R&&w,"argument-error"),this.apiKey=S,this.operation=w,this.code=R,this.continueUrl=(l=y.continueUrl)!==null&&l!==void 0?l:null,this.languageCode=(f=y.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(_=y.tenantId)!==null&&_!==void 0?_:null}static parseLink(e){const n=yde(e);try{return new Mb(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(){this.providerId=vh.PROVIDER_ID}static credential(e,n){return Mf._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const o=Mb.parseLink(n);return it(o,"argument-error"),Mf._fromEmailAndCode(e,o.code,o.tenantId)}}vh.PROVIDER_ID="password";vh.EMAIL_PASSWORD_SIGN_IN_METHOD="password";vh.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om extends xb{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da extends om{constructor(){super("facebook.com")}static credential(e){return Xu._fromParams({providerId:da.PROVIDER_ID,signInMethod:da.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return da.credentialFromTaggedObject(e)}static credentialFromError(e){return da.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return da.credential(e.oauthAccessToken)}catch{return null}}}da.FACEBOOK_SIGN_IN_METHOD="facebook.com";da.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha extends om{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Xu._fromParams({providerId:ha.PROVIDER_ID,signInMethod:ha.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ha.credentialFromTaggedObject(e)}static credentialFromError(e){return ha.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:o}=e;if(!n&&!o)return null;try{return ha.credential(n,o)}catch{return null}}}ha.GOOGLE_SIGN_IN_METHOD="google.com";ha.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc extends om{constructor(){super("github.com")}static credential(e){return Xu._fromParams({providerId:uc.PROVIDER_ID,signInMethod:uc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return uc.credentialFromTaggedObject(e)}static credentialFromError(e){return uc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return uc.credential(e.oauthAccessToken)}catch{return null}}}uc.GITHUB_SIGN_IN_METHOD="github.com";uc.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc extends om{constructor(){super("twitter.com")}static credential(e,n){return Xu._fromParams({providerId:lc.PROVIDER_ID,signInMethod:lc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return lc.credentialFromTaggedObject(e)}static credentialFromError(e){return lc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:o}=e;if(!n||!o)return null;try{return lc.credential(n,o)}catch{return null}}}lc.TWITTER_SIGN_IN_METHOD="twitter.com";lc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sde(t,e){return sm(t,"POST","/v1/accounts:signUp",rm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,o,c=!1){const l=await Vu._fromIdTokenResponse(e,o,c),f=OV(o);return new Ju({user:l,providerId:f,_tokenResponse:o,operationType:n})}static async _forOperation(e,n,o){await e._updateTokensIfNecessary(o,!0);const c=OV(o);return new Ju({user:e,providerId:c,_tokenResponse:o,operationType:n})}}function OV(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av extends Fo{constructor(e,n,o,c){var l;super(n.code,n.message),this.operationType=o,this.user=c,Object.setPrototypeOf(this,av.prototype),this.customData={appName:e.name,tenantId:(l=e.tenantId)!==null&&l!==void 0?l:void 0,_serverResponse:n.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,n,o,c){return new av(e,n,o,c)}}function S7(t,e,n,o){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?av._fromErrorAndOperation(t,l,e,o):l})}async function Tde(t,e,n=!1){const o=await kf(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ju._forOperation(t,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rde(t,e,n=!1){const{auth:o}=t,c="reauthenticate";try{const l=await kf(t,S7(o,c,e,t),n);it(l.idToken,o,"internal-error");const f=Db(l.idToken);it(f,o,"internal-error");const{sub:_}=f;return it(t.uid===_,o,"user-mismatch"),Ju._forOperation(t,c,l)}catch(l){throw(l==null?void 0:l.code)==="auth/user-not-found"&&Us(o,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T7(t,e,n=!1){const o="signIn",c=await S7(t,o,e),l=await Ju._fromIdTokenResponse(t,o,c);return n||await t._updateCurrentUser(l.user),l}async function Ide(t,e){return T7(_h(t),e)}async function wde(t,e,n){const o=_h(t),c=await Sde(o,{returnSecureToken:!0,email:e,password:n}),l=await Ju._fromIdTokenResponse(o,"signIn",c);return await o._updateCurrentUser(l.user),l}function Cde(t,e,n){return Ide(yr(t),vh.credential(e,n))}function Ade(t,e,n,o){return yr(t).onIdTokenChanged(e,n,o)}function bde(t,e,n){return yr(t).beforeAuthStateChanged(e,n)}function Ode(t,e,n,o){return yr(t).onAuthStateChanged(e,n,o)}function Nde(t){return yr(t).signOut()}const cv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R7{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(cv,"1"),this.storage.removeItem(cv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pde(){const t=li();return kb(t)||O1(t)}const Dde=1e3,kde=10;class I7 extends R7{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=Pde()&&cde(),this.fallbackToPolling=_7(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const o=this.storage.getItem(n),c=this.localCache[n];o!==c&&e(n,c,o)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((f,_,y)=>{this.notifyListeners(f,y)});return}const o=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const f=this.storage.getItem(o);if(e.newValue!==f)e.newValue!==null?this.storage.setItem(o,e.newValue):this.storage.removeItem(o);else if(this.localCache[o]===e.newValue&&!n)return}const c=()=>{const f=this.storage.getItem(o);!n&&this.localCache[o]===f||this.notifyListeners(o,f)},l=this.storage.getItem(o);ade()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,kde):c()}notifyListeners(e,n){this.localCache[e]=n;const o=this.listeners[e];if(o)for(const c of Array.from(o))c(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:o}),!0)})},Dde)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}I7.type="LOCAL";const Lde=I7;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w7 extends R7{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}w7.type="SESSION";const C7=w7;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mde(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(c=>c.isListeningto(e));if(n)return n;const o=new N1(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:o,eventType:c,data:l}=n.data,f=this.handlersMap[c];if(!(f!=null&&f.size))return;n.ports[0].postMessage({status:"ack",eventId:o,eventType:c});const _=Array.from(f).map(async S=>S(n.origin,l)),y=await Mde(_);n.ports[0].postMessage({status:"done",eventId:o,eventType:c,response:y})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}N1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ub(t="",e=10){let n="";for(let o=0;o<e;o++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xde{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,o=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let l,f;return new Promise((_,y)=>{const S=Ub("",20);c.port1.start();const R=setTimeout(()=>{y(new Error("unsupported_event"))},o);f={messageChannel:c,onMessage(w){const b=w;if(b.data.eventId===S)switch(b.data.status){case"ack":clearTimeout(R),l=setTimeout(()=>{y(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),_(b.data.response);break;default:clearTimeout(R),clearTimeout(l),y(new Error("invalid_response"));break}}},this.handlers.add(f),c.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:S,data:n},[c.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ko(){return window}function Ude(t){ko().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A7(){return typeof ko().WorkerGlobalScope<"u"&&typeof ko().importScripts=="function"}async function Vde(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Fde(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function jde(){return A7()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b7="firebaseLocalStorageDb",Bde=1,uv="firebaseLocalStorage",O7="fbase_key";class am{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function P1(t,e){return t.transaction([uv],e?"readwrite":"readonly").objectStore(uv)}function Gde(){const t=indexedDB.deleteDatabase(b7);return new am(t).toPromise()}function yC(){const t=indexedDB.open(b7,Bde);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const o=t.result;try{o.createObjectStore(uv,{keyPath:O7})}catch(c){n(c)}}),t.addEventListener("success",async()=>{const o=t.result;o.objectStoreNames.contains(uv)?e(o):(o.close(),await Gde(),e(await yC()))})})}async function NV(t,e,n){const o=P1(t,!0).put({[O7]:e,value:n});return new am(o).toPromise()}async function Wde(t,e){const n=P1(t,!1).get(e),o=await new am(n).toPromise();return o===void 0?null:o.value}function PV(t,e){const n=P1(t,!0).delete(e);return new am(n).toPromise()}const Hde=800,$de=3;class N7{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await yC(),this.db)}async _withRetries(e){let n=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(n++>$de)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return A7()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=N1._getInstance(jde()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await Vde(),!this.activeServiceWorker)return;this.sender=new xde(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((n=o[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Fde()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await yC();return await NV(e,cv,"1"),await PV(e,cv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(o=>NV(o,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(o=>Wde(o,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>PV(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const l=P1(c,!1).getAll();return new am(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],o=new Set;for(const{fbase_key:c,value:l}of e)o.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(l)&&(this.notifyListeners(c,l),n.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!o.has(c)&&(this.notifyListeners(c,null),n.push(c));return n}notifyListeners(e,n){this.localCache[e]=n;const o=this.listeners[e];if(o)for(const c of Array.from(o))c(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Hde)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}N7.type="LOCAL";const Kde=N7;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qde(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function zde(t){return new Promise((e,n)=>{const o=document.createElement("script");o.setAttribute("src",t),o.onload=e,o.onerror=c=>{const l=Do("internal-error");l.customData=c,n(l)},o.type="text/javascript",o.charset="UTF-8",qde().appendChild(o)})}function Yde(t){return`__${t}${Math.floor(Math.random()*1e6)}`}new nm(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P7(t,e){return e?ga(e):(it(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb extends Lb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Vd(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Vd(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Vd(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function Xde(t){return T7(t.auth,new Vb(t),t.bypassAuthState)}function Jde(t){const{auth:e,user:n}=t;return it(n,e,"internal-error"),Rde(n,new Vb(t),t.bypassAuthState)}async function Qde(t){const{auth:e,user:n}=t;return it(n,e,"internal-error"),Tde(n,new Vb(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D7{constructor(e,n,o,c,l=!1){this.auth=e,this.resolver=o,this.user=c,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:o,postBody:c,tenantId:l,error:f,type:_}=e;if(f){this.reject(f);return}const y={auth:this.auth,requestUri:n,sessionId:o,tenantId:l||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(y))}catch(S){this.reject(S)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Xde;case"linkViaPopup":case"linkViaRedirect":return Qde;case"reauthViaPopup":case"reauthViaRedirect":return Jde;default:Us(this.auth,"internal-error")}}resolve(e){Ca(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ca(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zde=new nm(2e3,1e4);async function ehe(t,e,n){const o=_h(t);Ble(t,e,xb);const c=P7(o,n);return new Pu(o,"signInViaPopup",e,c).executeNotNull()}class Pu extends D7{constructor(e,n,o,c,l){super(e,n,c,l),this.provider=o,this.authWindow=null,this.pollId=null,Pu.currentPopupAction&&Pu.currentPopupAction.cancel(),Pu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return it(e,this.auth,"internal-error"),e}async onExecution(){Ca(this.filter.length===1,"Popup operations only handle one event");const e=Ub();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Do(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Do(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Pu.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,o;if(!((o=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Do(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,Zde.get())};e()}}Pu.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const the="pendingRedirect",h_=new Map;class nhe extends D7{constructor(e,n,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,o),this.eventId=null}async execute(){let e=h_.get(this.auth._key());if(!e){try{const o=await rhe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(n){e=()=>Promise.reject(n)}h_.set(this.auth._key(),e)}return this.bypassAuthState||h_.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function rhe(t,e){const n=ohe(e),o=she(t);if(!await o._isAvailable())return!1;const c=await o._get(n)==="true";return await o._remove(n),c}function ihe(t,e){h_.set(t._key(),e)}function she(t){return ga(t._redirectPersistence)}function ohe(t){return d_(the,t.config.apiKey,t.name)}async function ahe(t,e,n=!1){const o=_h(t),c=P7(o,e),f=await new nhe(o,c,n).execute();return f&&!n&&(delete f.user._redirectEventId,await o._persistUserIfCurrent(f.user),await o._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const che=10*60*1e3;class uhe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(n=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!lhe(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var o;if(e.error&&!k7(e)){const c=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";n.onError(Do(this.auth,c))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const o=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=che&&this.cachedEventUids.clear(),this.cachedEventUids.has(DV(e))}saveEventToCache(e){this.cachedEventUids.add(DV(e)),this.lastProcessedEventTime=Date.now()}}function DV(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function k7({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function lhe(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return k7(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dhe(t,e={}){return im(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hhe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,phe=/^https?/;async function fhe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await dhe(t);for(const n of e)try{if(mhe(n))return}catch{}Us(t,"unauthorized-domain")}function mhe(t){const e=vC(),{protocol:n,hostname:o}=new URL(e);if(t.startsWith("chrome-extension://")){const f=new URL(t);return f.hostname===""&&o===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&f.hostname===o}if(!phe.test(n))return!1;if(hhe.test(t))return o===t;const c=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ghe=new nm(3e4,6e4);function kV(){const t=ko().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function Ehe(t){return new Promise((e,n)=>{var o,c,l;function f(){kV(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{kV(),n(Do(t,"network-request-failed"))},timeout:ghe.get()})}if(!((c=(o=ko().gapi)===null||o===void 0?void 0:o.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((l=ko().gapi)===null||l===void 0)&&l.load)f();else{const _=Yde("iframefcb");return ko()[_]=()=>{gapi.load?f():n(Do(t,"network-request-failed"))},zde(`https://apis.google.com/js/api.js?onload=${_}`).catch(y=>n(y))}}).catch(e=>{throw p_=null,e})}let p_=null;function _he(t){return p_=p_||Ehe(t),p_}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vhe=new nm(5e3,15e3),yhe="__/auth/iframe",She="emulator/auth/iframe",The={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Rhe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ihe(t){const e=t.config;it(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Pb(e,She):`https://${t.config.authDomain}/${yhe}`,o={apiKey:e.apiKey,appName:t.name,v:Eh},c=Rhe.get(t.config.apiHost);c&&(o.eid=c);const l=t._getFrameworks();return l.length&&(o.fw=l.join(",")),`${n}?${tm(o).slice(1)}`}async function whe(t){const e=await _he(t),n=ko().gapi;return it(n,t,"internal-error"),e.open({where:document.body,url:Ihe(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:The,dontclear:!0},o=>new Promise(async(c,l)=>{await o.restyle({setHideOnLeave:!1});const f=Do(t,"network-request-failed"),_=ko().setTimeout(()=>{l(f)},vhe.get());function y(){ko().clearTimeout(_),c(o)}o.ping(y).then(y,()=>{l(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Che={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Ahe=500,bhe=600,Ohe="_blank",Nhe="http://localhost";class LV{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Phe(t,e,n,o=Ahe,c=bhe){const l=Math.max((window.screen.availHeight-c)/2,0).toString(),f=Math.max((window.screen.availWidth-o)/2,0).toString();let _="";const y=Object.assign(Object.assign({},Che),{width:o.toString(),height:c.toString(),top:l,left:f}),S=li().toLowerCase();n&&(_=p7(S)?Ohe:n),h7(S)&&(e=e||Nhe,y.scrollbars="yes");const R=Object.entries(y).reduce((b,[k,M])=>`${b}${k}=${M},`,"");if(ode(S)&&_!=="_self")return Dhe(e||"",_),new LV(null);const w=window.open(e||"",_,R);it(w,t,"popup-blocked");try{w.focus()}catch{}return new LV(w)}function Dhe(t,e){const n=document.createElement("a");n.href=t,n.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const khe="__/auth/handler",Lhe="emulator/auth/handler";function MV(t,e,n,o,c,l){it(t.config.authDomain,t,"auth-domain-config-required"),it(t.config.apiKey,t,"invalid-api-key");const f={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:o,v:Eh,eventId:c};if(e instanceof xb){e.setDefaultLanguage(t.languageCode),f.providerId=e.providerId||"",Pue(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[y,S]of Object.entries(l||{}))f[y]=S}if(e instanceof om){const y=e.getScopes().filter(S=>S!=="");y.length>0&&(f.scopes=y.join(","))}t.tenantId&&(f.tid=t.tenantId);const _=f;for(const y of Object.keys(_))_[y]===void 0&&delete _[y];return`${Mhe(t)}?${tm(_).slice(1)}`}function Mhe({config:t}){return t.emulator?Pb(t,Lhe):`https://${t.authDomain}/${khe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fI="webStorageSupport";class xhe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=C7,this._completeRedirectFn=ahe,this._overrideRedirectResult=ihe}async _openPopup(e,n,o,c){var l;Ca((l=this.eventManagers[e._key()])===null||l===void 0?void 0:l.manager,"_initialize() not called before _openPopup()");const f=MV(e,n,o,vC(),c);return Phe(e,f,Ub())}async _openRedirect(e,n,o,c){return await this._originValidation(e),Ude(MV(e,n,o,vC(),c)),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:c,promise:l}=this.eventManagers[n];return c?Promise.resolve(c):(Ca(l,"If manager is not set, promise should be"),l)}const o=this.initAndGetManager(e);return this.eventManagers[n]={promise:o},o.catch(()=>{delete this.eventManagers[n]}),o}async initAndGetManager(e){const n=await whe(e),o=new uhe(e);return n.register("authEvent",c=>(it(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:o.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=n,o}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(fI,{type:fI},c=>{var l;const f=(l=c==null?void 0:c[0])===null||l===void 0?void 0:l[fI];f!==void 0&&n(!!f),Us(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=fhe(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return _7()||kb()||O1()}}const Uhe=xhe;var xV="@firebase/auth",UV="0.21.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vhe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){it(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fhe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function jhe(t){Yu(new xc("auth",(e,{options:n})=>{const o=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),{apiKey:l,authDomain:f}=o.options;return((_,y)=>{it(l&&!l.includes(":"),"invalid-api-key",{appName:_.name}),it(!(f!=null&&f.includes(":")),"argument-error",{appName:_.name});const S={apiKey:l,authDomain:f,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:v7(t)},R=new lde(_,y,S);return Wle(R,n),R})(o,c)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,o)=>{e.getProvider("auth-internal").initialize()})),Yu(new xc("auth-internal",e=>{const n=_h(e.getProvider("auth").getImmediate());return(o=>new Vhe(o))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Po(xV,UV,Fhe(t)),Po(xV,UV,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bhe=5*60,Ghe=Jj("authIdTokenMaxAge")||Bhe;let VV=null;const Whe=t=>async e=>{const n=e&&await e.getIdTokenResult(),o=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(o&&o>Ghe)return;const c=n==null?void 0:n.token;VV!==c&&(VV=c,await fetch(t,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function Hhe(t=bb()){const e=b1(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Gle(t,{popupRedirectResolver:Uhe,persistence:[Kde,Lde,C7]}),o=Jj("authTokenSyncURL");if(o){const l=Whe(o);bde(n,l,()=>l(n.currentUser)),Ade(n,f=>l(f))}const c=Yj("auth");return c&&dde(n,`http://${c}`),n}jhe("Browser");var $he=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},We,Fb=Fb||{},ft=$he||self;function lv(){}function D1(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function cm(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function Khe(t){return Object.prototype.hasOwnProperty.call(t,mI)&&t[mI]||(t[mI]=++qhe)}var mI="closure_uid_"+(1e9*Math.random()>>>0),qhe=0;function zhe(t,e,n){return t.call.apply(t.bind,arguments)}function Yhe(t,e,n){if(!t)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,o),t.apply(e,c)}}return function(){return t.apply(e,arguments)}}function oi(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?oi=zhe:oi=Yhe,oi.apply(null,arguments)}function BE(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var o=n.slice();return o.push.apply(o,arguments),t.apply(this,o)}}function $r(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Wb=function(o,c,l){for(var f=Array(arguments.length-2),_=2;_<arguments.length;_++)f[_-2]=arguments[_];return e.prototype[c].apply(o,f)}}function Kc(){this.s=this.s,this.o=this.o}var Xhe=0;Kc.prototype.s=!1;Kc.prototype.na=function(){!this.s&&(this.s=!0,this.M(),Xhe!=0)&&Khe(this)};Kc.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const L7=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function jb(t){const e=t.length;if(0<e){const n=Array(e);for(let o=0;o<e;o++)n[o]=t[o];return n}return[]}function FV(t,e){for(let n=1;n<arguments.length;n++){const o=arguments[n];if(D1(o)){const c=t.length||0,l=o.length||0;t.length=c+l;for(let f=0;f<l;f++)t[c+f]=o[f]}else t.push(o)}}function ai(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}ai.prototype.h=function(){this.defaultPrevented=!0};var Jhe=function(){if(!ft.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ft.addEventListener("test",lv,e),ft.removeEventListener("test",lv,e)}catch{}return t}();function dv(t){return/^[\s\xa0]*$/.test(t)}var jV=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function gI(t,e){return t<e?-1:t>e?1:0}function k1(){var t=ft.navigator;return t&&(t=t.userAgent)?t:""}function Co(t){return k1().indexOf(t)!=-1}function Bb(t){return Bb[" "](t),t}Bb[" "]=lv;function Qhe(t){var e=tpe;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}var Zhe=Co("Opera"),Xd=Co("Trident")||Co("MSIE"),M7=Co("Edge"),SC=M7||Xd,x7=Co("Gecko")&&!(k1().toLowerCase().indexOf("webkit")!=-1&&!Co("Edge"))&&!(Co("Trident")||Co("MSIE"))&&!Co("Edge"),epe=k1().toLowerCase().indexOf("webkit")!=-1&&!Co("Edge");function U7(){var t=ft.document;return t?t.documentMode:void 0}var hv;e:{var EI="",_I=function(){var t=k1();if(x7)return/rv:([^\);]+)(\)|;)/.exec(t);if(M7)return/Edge\/([\d\.]+)/.exec(t);if(Xd)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(epe)return/WebKit\/(\S+)/.exec(t);if(Zhe)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(_I&&(EI=_I?_I[1]:""),Xd){var vI=U7();if(vI!=null&&vI>parseFloat(EI)){hv=String(vI);break e}}hv=EI}var tpe={};function npe(){return Qhe(function(){let t=0;const e=jV(String(hv)).split("."),n=jV("9").split("."),o=Math.max(e.length,n.length);for(let f=0;t==0&&f<o;f++){var c=e[f]||"",l=n[f]||"";do{if(c=/(\d*)(\D*)(.*)/.exec(c)||["","","",""],l=/(\d*)(\D*)(.*)/.exec(l)||["","","",""],c[0].length==0&&l[0].length==0)break;t=gI(c[1].length==0?0:parseInt(c[1],10),l[1].length==0?0:parseInt(l[1],10))||gI(c[2].length==0,l[2].length==0)||gI(c[2],l[2]),c=c[3],l=l[3]}while(t==0)}return 0<=t})}var TC;if(ft.document&&Xd){var BV=U7();TC=BV||parseInt(hv,10)||void 0}else TC=void 0;var rpe=TC;function xf(t,e){if(ai.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,o=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(x7){e:{try{Bb(e.nodeName);var c=!0;break e}catch{}c=!1}c||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,o?(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:ipe[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&xf.X.h.call(this)}}$r(xf,ai);var ipe={2:"touch",3:"pen",4:"mouse"};xf.prototype.h=function(){xf.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var um="closure_listenable_"+(1e6*Math.random()|0),spe=0;function ope(t,e,n,o,c){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!o,this.ha=c,this.key=++spe,this.ba=this.ea=!1}function L1(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function Gb(t,e,n){for(const o in t)e.call(n,t[o],o,t)}function V7(t){const e={};for(const n in t)e[n]=t[n];return e}const GV="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F7(t,e){let n,o;for(let c=1;c<arguments.length;c++){o=arguments[c];for(n in o)t[n]=o[n];for(let l=0;l<GV.length;l++)n=GV[l],Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}}function M1(t){this.src=t,this.g={},this.h=0}M1.prototype.add=function(t,e,n,o,c){var l=t.toString();t=this.g[l],t||(t=this.g[l]=[],this.h++);var f=IC(t,e,o,c);return-1<f?(e=t[f],n||(e.ea=!1)):(e=new ope(e,this.src,l,!!o,c),e.ea=n,t.push(e)),e};function RC(t,e){var n=e.type;if(n in t.g){var o=t.g[n],c=L7(o,e),l;(l=0<=c)&&Array.prototype.splice.call(o,c,1),l&&(L1(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function IC(t,e,n,o){for(var c=0;c<t.length;++c){var l=t[c];if(!l.ba&&l.listener==e&&l.capture==!!n&&l.ha==o)return c}return-1}var Wb="closure_lm_"+(1e6*Math.random()|0),yI={};function j7(t,e,n,o,c){if(o&&o.once)return G7(t,e,n,o,c);if(Array.isArray(e)){for(var l=0;l<e.length;l++)j7(t,e[l],n,o,c);return null}return n=Kb(n),t&&t[um]?t.N(e,n,cm(o)?!!o.capture:!!o,c):B7(t,e,n,!1,o,c)}function B7(t,e,n,o,c,l){if(!e)throw Error("Invalid event type");var f=cm(c)?!!c.capture:!!c,_=$b(t);if(_||(t[Wb]=_=new M1(t)),n=_.add(e,n,o,f,l),n.proxy)return n;if(o=ape(),n.proxy=o,o.src=t,o.listener=n,t.addEventListener)Jhe||(c=f),c===void 0&&(c=!1),t.addEventListener(e.toString(),o,c);else if(t.attachEvent)t.attachEvent(H7(e.toString()),o);else if(t.addListener&&t.removeListener)t.addListener(o);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ape(){function t(n){return e.call(t.src,t.listener,n)}const e=cpe;return t}function G7(t,e,n,o,c){if(Array.isArray(e)){for(var l=0;l<e.length;l++)G7(t,e[l],n,o,c);return null}return n=Kb(n),t&&t[um]?t.O(e,n,cm(o)?!!o.capture:!!o,c):B7(t,e,n,!0,o,c)}function W7(t,e,n,o,c){if(Array.isArray(e))for(var l=0;l<e.length;l++)W7(t,e[l],n,o,c);else o=cm(o)?!!o.capture:!!o,n=Kb(n),t&&t[um]?(t=t.i,e=String(e).toString(),e in t.g&&(l=t.g[e],n=IC(l,n,o,c),-1<n&&(L1(l[n]),Array.prototype.splice.call(l,n,1),l.length==0&&(delete t.g[e],t.h--)))):t&&(t=$b(t))&&(e=t.g[e.toString()],t=-1,e&&(t=IC(e,n,o,c)),(n=-1<t?e[t]:null)&&Hb(n))}function Hb(t){if(typeof t!="number"&&t&&!t.ba){var e=t.src;if(e&&e[um])RC(e.i,t);else{var n=t.type,o=t.proxy;e.removeEventListener?e.removeEventListener(n,o,t.capture):e.detachEvent?e.detachEvent(H7(n),o):e.addListener&&e.removeListener&&e.removeListener(o),(n=$b(e))?(RC(n,t),n.h==0&&(n.src=null,e[Wb]=null)):L1(t)}}}function H7(t){return t in yI?yI[t]:yI[t]="on"+t}function cpe(t,e){if(t.ba)t=!0;else{e=new xf(e,this);var n=t.listener,o=t.ha||t.src;t.ea&&Hb(t),t=n.call(o,e)}return t}function $b(t){return t=t[Wb],t instanceof M1?t:null}var SI="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kb(t){return typeof t=="function"?t:(t[SI]||(t[SI]=function(e){return t.handleEvent(e)}),t[SI])}function Or(){Kc.call(this),this.i=new M1(this),this.P=this,this.I=null}$r(Or,Kc);Or.prototype[um]=!0;Or.prototype.removeEventListener=function(t,e,n,o){W7(this,t,e,n,o)};function Wr(t,e){var n,o=t.I;if(o)for(n=[];o;o=o.I)n.push(o);if(t=t.P,o=e.type||e,typeof e=="string")e=new ai(e,t);else if(e instanceof ai)e.target=e.target||t;else{var c=e;e=new ai(o,t),F7(e,c)}if(c=!0,n)for(var l=n.length-1;0<=l;l--){var f=e.g=n[l];c=GE(f,o,!0,e)&&c}if(f=e.g=t,c=GE(f,o,!0,e)&&c,c=GE(f,o,!1,e)&&c,n)for(l=0;l<n.length;l++)f=e.g=n[l],c=GE(f,o,!1,e)&&c}Or.prototype.M=function(){if(Or.X.M.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],o=0;o<n.length;o++)L1(n[o]);delete t.g[e],t.h--}}this.I=null};Or.prototype.N=function(t,e,n,o){return this.i.add(String(t),e,!1,n,o)};Or.prototype.O=function(t,e,n,o){return this.i.add(String(t),e,!0,n,o)};function GE(t,e,n,o){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var c=!0,l=0;l<e.length;++l){var f=e[l];if(f&&!f.ba&&f.capture==n){var _=f.listener,y=f.ha||f.src;f.ea&&RC(t.i,f),c=_.call(y,o)!==!1&&c}}return c&&!o.defaultPrevented}var qb=ft.JSON.stringify;function upe(){var t=q7;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class lpe{constructor(){this.h=this.g=null}add(e,n){const o=$7.get();o.set(e,n),this.h?this.h.next=o:this.g=o,this.h=o}}var $7=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new dpe,t=>t.reset());class dpe{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function hpe(t){ft.setTimeout(()=>{throw t},0)}function K7(t,e){wC||ppe(),CC||(wC(),CC=!0),q7.add(t,e)}var wC;function ppe(){var t=ft.Promise.resolve(void 0);wC=function(){t.then(fpe)}}var CC=!1,q7=new lpe;function fpe(){for(var t;t=upe();){try{t.h.call(t.g)}catch(n){hpe(n)}var e=$7;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}CC=!1}function x1(t,e){Or.call(this),this.h=t||1,this.g=e||ft,this.j=oi(this.lb,this),this.l=Date.now()}$r(x1,Or);We=x1.prototype;We.ca=!1;We.R=null;We.lb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Wr(this,"tick"),this.ca&&(zb(this),this.start()))}};We.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function zb(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}We.M=function(){x1.X.M.call(this),zb(this),delete this.g};function Yb(t,e,n){if(typeof t=="function")n&&(t=oi(t,n));else if(t&&typeof t.handleEvent=="function")t=oi(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:ft.setTimeout(t,e||0)}function z7(t){t.g=Yb(()=>{t.g=null,t.i&&(t.i=!1,z7(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class mpe extends Kc{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:z7(this)}M(){super.M(),this.g&&(ft.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Uf(t){Kc.call(this),this.h=t,this.g={}}$r(Uf,Kc);var WV=[];function Y7(t,e,n,o){Array.isArray(n)||(n&&(WV[0]=n.toString()),n=WV);for(var c=0;c<n.length;c++){var l=j7(e,n[c],o||t.handleEvent,!1,t.h||t);if(!l)break;t.g[l.key]=l}}function X7(t){Gb(t.g,function(e,n){this.g.hasOwnProperty(n)&&Hb(e)},t),t.g={}}Uf.prototype.M=function(){Uf.X.M.call(this),X7(this)};Uf.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function U1(){this.g=!0}U1.prototype.Aa=function(){this.g=!1};function gpe(t,e,n,o,c,l){t.info(function(){if(t.g)if(l)for(var f="",_=l.split("&"),y=0;y<_.length;y++){var S=_[y].split("=");if(1<S.length){var R=S[0];S=S[1];var w=R.split("_");f=2<=w.length&&w[1]=="type"?f+(R+"="+S+"&"):f+(R+"=redacted&")}}else f=null;else f=l;return"XMLHTTP REQ ("+o+") [attempt "+c+"]: "+e+`
`+n+`
`+f})}function Epe(t,e,n,o,c,l,f){t.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+c+"]: "+e+`
`+n+`
`+l+" "+f})}function wd(t,e,n,o){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+vpe(t,n)+(o?" "+o:"")})}function _pe(t,e){t.info(function(){return"TIMEOUT: "+e})}U1.prototype.info=function(){};function vpe(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var o=n[t];if(!(2>o.length)){var c=o[1];if(Array.isArray(c)&&!(1>c.length)){var l=c[0];if(l!="noop"&&l!="stop"&&l!="close")for(var f=1;f<c.length;f++)c[f]=""}}}}return qb(n)}catch{return e}}var rl={},HV=null;function V1(){return HV=HV||new Or}rl.Pa="serverreachability";function J7(t){ai.call(this,rl.Pa,t)}$r(J7,ai);function Vf(t){const e=V1();Wr(e,new J7(e))}rl.STAT_EVENT="statevent";function Q7(t,e){ai.call(this,rl.STAT_EVENT,t),this.stat=e}$r(Q7,ai);function Ei(t){const e=V1();Wr(e,new Q7(e,t))}rl.Qa="timingevent";function Z7(t,e){ai.call(this,rl.Qa,t),this.size=e}$r(Z7,ai);function lm(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return ft.setTimeout(function(){t()},e)}var F1={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},eB={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Xb(){}Xb.prototype.h=null;function $V(t){return t.h||(t.h=t.i())}function tB(){}var dm={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Jb(){ai.call(this,"d")}$r(Jb,ai);function Qb(){ai.call(this,"c")}$r(Qb,ai);var AC;function j1(){}$r(j1,Xb);j1.prototype.g=function(){return new XMLHttpRequest};j1.prototype.i=function(){return{}};AC=new j1;function hm(t,e,n,o){this.l=t,this.j=e,this.m=n,this.U=o||1,this.S=new Uf(this),this.O=ype,t=SC?125:void 0,this.T=new x1(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new nB}function nB(){this.i=null,this.g="",this.h=!1}var ype=45e3,bC={},pv={};We=hm.prototype;We.setTimeout=function(t){this.O=t};function OC(t,e,n){t.K=1,t.v=G1(Aa(e)),t.s=n,t.P=!0,rB(t,null)}function rB(t,e){t.F=Date.now(),pm(t),t.A=Aa(t.v);var n=t.A,o=t.U;Array.isArray(o)||(o=[String(o)]),dB(n.i,"t",o),t.C=0,n=t.l.H,t.h=new nB,t.g=DB(t.l,n?e:null,!t.s),0<t.N&&(t.L=new mpe(oi(t.La,t,t.g),t.N)),Y7(t.S,t.g,"readystatechange",t.ib),e=t.H?V7(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),Vf(),gpe(t.j,t.u,t.A,t.m,t.U,t.s)}We.ib=function(t){t=t.target;const e=this.L;e&&Ea(t)==3?e.l():this.La(t)};We.La=function(t){try{if(t==this.g)e:{const R=Ea(this.g);var e=this.g.Ea();const w=this.g.aa();if(!(3>R)&&(R!=3||SC||this.g&&(this.h.h||this.g.fa()||YV(this.g)))){this.I||R!=4||e==7||(e==8||0>=w?Vf(3):Vf(2)),B1(this);var n=this.g.aa();this.Y=n;t:if(iB(this)){var o=YV(this.g);t="";var c=o.length,l=Ea(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Du(this),Xp(this);var f="";break t}this.h.i=new ft.TextDecoder}for(e=0;e<c;e++)this.h.h=!0,t+=this.h.i.decode(o[e],{stream:l&&e==c-1});o.splice(0,c),this.h.g+=t,this.C=0,f=this.h.g}else f=this.g.fa();if(this.i=n==200,Epe(this.j,this.u,this.A,this.m,this.U,R,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var _,y=this.g;if((_=y.g?y.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!dv(_)){var S=_;break t}}S=null}if(n=S)wd(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,NC(this,n);else{this.i=!1,this.o=3,Ei(12),Du(this),Xp(this);break e}}this.P?(sB(this,R,f),SC&&this.i&&R==3&&(Y7(this.S,this.T,"tick",this.hb),this.T.start())):(wd(this.j,this.m,f,null),NC(this,f)),R==4&&Du(this),this.i&&!this.I&&(R==4?bB(this.l,this):(this.i=!1,pm(this)))}else n==400&&0<f.indexOf("Unknown SID")?(this.o=3,Ei(12)):(this.o=0,Ei(13)),Du(this),Xp(this)}}}catch{}finally{}};function iB(t){return t.g?t.u=="GET"&&t.K!=2&&t.l.Da:!1}function sB(t,e,n){let o=!0,c;for(;!t.I&&t.C<n.length;)if(c=Spe(t,n),c==pv){e==4&&(t.o=4,Ei(14),o=!1),wd(t.j,t.m,null,"[Incomplete Response]");break}else if(c==bC){t.o=4,Ei(15),wd(t.j,t.m,n,"[Invalid Chunk]"),o=!1;break}else wd(t.j,t.m,c,null),NC(t,c);iB(t)&&c!=pv&&c!=bC&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,Ei(16),o=!1),t.i=t.i&&o,o?0<n.length&&!t.$&&(t.$=!0,e=t.l,e.g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),sO(e),e.K=!0,Ei(11))):(wd(t.j,t.m,n,"[Invalid Chunked Response]"),Du(t),Xp(t))}We.hb=function(){if(this.g){var t=Ea(this.g),e=this.g.fa();this.C<e.length&&(B1(this),sB(this,t,e),this.i&&t!=4&&pm(this))}};function Spe(t,e){var n=t.C,o=e.indexOf(`
`,n);return o==-1?pv:(n=Number(e.substring(n,o)),isNaN(n)?bC:(o+=1,o+n>e.length?pv:(e=e.substr(o,n),t.C=o+n,e)))}We.cancel=function(){this.I=!0,Du(this)};function pm(t){t.V=Date.now()+t.O,oB(t,t.O)}function oB(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=lm(oi(t.gb,t),e)}function B1(t){t.B&&(ft.clearTimeout(t.B),t.B=null)}We.gb=function(){this.B=null;const t=Date.now();0<=t-this.V?(_pe(this.j,this.A),this.K!=2&&(Vf(),Ei(17)),Du(this),this.o=2,Xp(this)):oB(this,this.V-t)};function Xp(t){t.l.G==0||t.I||bB(t.l,t)}function Du(t){B1(t);var e=t.L;e&&typeof e.na=="function"&&e.na(),t.L=null,zb(t.T),X7(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function NC(t,e){try{var n=t.l;if(n.G!=0&&(n.g==t||PC(n.h,t))){if(!t.J&&PC(n.h,t)&&n.G==3){try{var o=n.Fa.g.parse(e)}catch{o=null}if(Array.isArray(o)&&o.length==3){var c=o;if(c[0]==0){e:if(!n.u){if(n.g)if(n.g.F+3e3<t.F)gv(n),$1(n);else break e;iO(n),Ei(18)}}else n.Ba=c[1],0<n.Ba-n.T&&37500>c[2]&&n.L&&n.A==0&&!n.v&&(n.v=lm(oi(n.cb,n),6e3));if(1>=fB(n.h)&&n.ja){try{n.ja()}catch{}n.ja=void 0}}else ku(n,11)}else if((t.J||n.g==t)&&gv(n),!dv(e))for(c=n.Fa.g.parse(e),e=0;e<c.length;e++){let S=c[e];if(n.T=S[0],S=S[1],n.G==2)if(S[0]=="c"){n.I=S[1],n.ka=S[2];const R=S[3];R!=null&&(n.ma=R,n.j.info("VER="+n.ma));const w=S[4];w!=null&&(n.Ca=w,n.j.info("SVER="+n.Ca));const b=S[5];b!=null&&typeof b=="number"&&0<b&&(o=1.5*b,n.J=o,n.j.info("backChannelRequestTimeoutMs_="+o)),o=n;const k=t.g;if(k){const M=k.g?k.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(M){var l=o.h;l.g||M.indexOf("spdy")==-1&&M.indexOf("quic")==-1&&M.indexOf("h2")==-1||(l.j=l.l,l.g=new Set,l.h&&(Zb(l,l.h),l.h=null))}if(o.D){const F=k.g?k.g.getResponseHeader("X-HTTP-Session-Id"):null;F&&(o.za=F,Cn(o.F,o.D,F))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms")),o=n;var f=t;if(o.sa=PB(o,o.H?o.ka:null,o.V),f.J){mB(o.h,f);var _=f,y=o.J;y&&_.setTimeout(y),_.B&&(B1(_),pm(_)),o.g=f}else CB(o);0<n.i.length&&K1(n)}else S[0]!="stop"&&S[0]!="close"||ku(n,7);else n.G==3&&(S[0]=="stop"||S[0]=="close"?S[0]=="stop"?ku(n,7):rO(n):S[0]!="noop"&&n.l&&n.l.wa(S),n.A=0)}}Vf(4)}catch{}}function Tpe(t){if(t.W&&typeof t.W=="function")return t.W();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(D1(t)){for(var e=[],n=t.length,o=0;o<n;o++)e.push(t[o]);return e}e=[],n=0;for(o in t)e[n++]=t[o];return e}function Rpe(t){if(t.oa&&typeof t.oa=="function")return t.oa();if(!t.W||typeof t.W!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(D1(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const o in t)e[n++]=o;return e}}}function aB(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(D1(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=Rpe(t),o=Tpe(t),c=o.length,l=0;l<c;l++)e.call(void 0,o[l],n&&n[l],t)}var cB=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ipe(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var o=t[n].indexOf("="),c=null;if(0<=o){var l=t[n].substring(0,o);c=t[n].substring(o+1)}else l=t[n];e(l,c?decodeURIComponent(c.replace(/\+/g," ")):"")}}}function Fu(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Fu){this.h=e!==void 0?e:t.h,fv(this,t.j),this.s=t.s,this.g=t.g,mv(this,t.m),this.l=t.l,e=t.i;var n=new Ff;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),KV(this,n),this.o=t.o}else t&&(n=String(t).match(cB))?(this.h=!!e,fv(this,n[1]||"",!0),this.s=Mp(n[2]||""),this.g=Mp(n[3]||"",!0),mv(this,n[4]),this.l=Mp(n[5]||"",!0),KV(this,n[6]||"",!0),this.o=Mp(n[7]||"")):(this.h=!!e,this.i=new Ff(null,this.h))}Fu.prototype.toString=function(){var t=[],e=this.j;e&&t.push(xp(e,qV,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(xp(e,qV,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(xp(n,n.charAt(0)=="/"?Ape:Cpe,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",xp(n,Ope)),t.join("")};function Aa(t){return new Fu(t)}function fv(t,e,n){t.j=n?Mp(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function mv(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function KV(t,e,n){e instanceof Ff?(t.i=e,Npe(t.i,t.h)):(n||(e=xp(e,bpe)),t.i=new Ff(e,t.h))}function Cn(t,e,n){t.i.set(e,n)}function G1(t){return Cn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Mp(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function xp(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,wpe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function wpe(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var qV=/[#\/\?@]/g,Cpe=/[#\?:]/g,Ape=/[#\?]/g,bpe=/[#\?@]/g,Ope=/#/g;function Ff(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function qc(t){t.g||(t.g=new Map,t.h=0,t.i&&Ipe(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}We=Ff.prototype;We.add=function(t,e){qc(this),this.i=null,t=yh(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function uB(t,e){qc(t),e=yh(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function lB(t,e){return qc(t),e=yh(t,e),t.g.has(e)}We.forEach=function(t,e){qc(this),this.g.forEach(function(n,o){n.forEach(function(c){t.call(e,c,o,this)},this)},this)};We.oa=function(){qc(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let o=0;o<e.length;o++){const c=t[o];for(let l=0;l<c.length;l++)n.push(e[o])}return n};We.W=function(t){qc(this);let e=[];if(typeof t=="string")lB(this,t)&&(e=e.concat(this.g.get(yh(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};We.set=function(t,e){return qc(this),this.i=null,t=yh(this,t),lB(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};We.get=function(t,e){return t?(t=this.W(t),0<t.length?String(t[0]):e):e};function dB(t,e,n){uB(t,e),0<n.length&&(t.i=null,t.g.set(yh(t,e),jb(n)),t.h+=n.length)}We.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var o=e[n];const l=encodeURIComponent(String(o)),f=this.W(o);for(o=0;o<f.length;o++){var c=l;f[o]!==""&&(c+="="+encodeURIComponent(String(f[o]))),t.push(c)}}return this.i=t.join("&")};function yh(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Npe(t,e){e&&!t.j&&(qc(t),t.i=null,t.g.forEach(function(n,o){var c=o.toLowerCase();o!=c&&(uB(this,o),dB(this,c,n))},t)),t.j=e}var Ppe=class{constructor(e,n){this.h=e,this.g=n}};function hB(t){this.l=t||Dpe,ft.PerformanceNavigationTiming?(t=ft.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(ft.g&&ft.g.Ga&&ft.g.Ga()&&ft.g.Ga().$b),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Dpe=10;function pB(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function fB(t){return t.h?1:t.g?t.g.size:0}function PC(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function Zb(t,e){t.g?t.g.add(e):t.h=e}function mB(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}hB.prototype.cancel=function(){if(this.i=gB(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function gB(t){if(t.h!=null)return t.i.concat(t.h.D);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return jb(t.i)}function eO(){}eO.prototype.stringify=function(t){return ft.JSON.stringify(t,void 0)};eO.prototype.parse=function(t){return ft.JSON.parse(t,void 0)};function kpe(){this.g=new eO}function Lpe(t,e,n){const o=n||"";try{aB(t,function(c,l){let f=c;cm(c)&&(f=qb(c)),e.push(o+l+"="+encodeURIComponent(f))})}catch(c){throw e.push(o+"type="+encodeURIComponent("_badmap")),c}}function Mpe(t,e){const n=new U1;if(ft.Image){const o=new Image;o.onload=BE(WE,n,o,"TestLoadImage: loaded",!0,e),o.onerror=BE(WE,n,o,"TestLoadImage: error",!1,e),o.onabort=BE(WE,n,o,"TestLoadImage: abort",!1,e),o.ontimeout=BE(WE,n,o,"TestLoadImage: timeout",!1,e),ft.setTimeout(function(){o.ontimeout&&o.ontimeout()},1e4),o.src=t}else e(!1)}function WE(t,e,n,o,c){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,c(o)}catch{}}function fm(t){this.l=t.ac||null,this.j=t.jb||!1}$r(fm,Xb);fm.prototype.g=function(){return new W1(this.l,this.j)};fm.prototype.i=function(t){return function(){return t}}({});function W1(t,e){Or.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=tO,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}$r(W1,Or);var tO=0;We=W1.prototype;We.open=function(t,e){if(this.readyState!=tO)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,jf(this)};We.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||ft).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))};We.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,mm(this)),this.readyState=tO};We.Wa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,jf(this)),this.g&&(this.readyState=3,jf(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof ft.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;EB(this)}else t.text().then(this.Va.bind(this),this.ga.bind(this))};function EB(t){t.j.read().then(t.Ta.bind(t)).catch(t.ga.bind(t))}We.Ta=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?mm(this):jf(this),this.readyState==3&&EB(this)}};We.Va=function(t){this.g&&(this.response=this.responseText=t,mm(this))};We.Ua=function(t){this.g&&(this.response=t,mm(this))};We.ga=function(){this.g&&mm(this)};function mm(t){t.readyState=4,t.l=null,t.j=null,t.A=null,jf(t)}We.setRequestHeader=function(t,e){this.v.append(t,e)};We.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};We.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function jf(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(W1.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var xpe=ft.JSON.parse;function Fn(t){Or.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=_B,this.K=this.L=!1}$r(Fn,Or);var _B="",Upe=/^https?$/i,Vpe=["POST","PUT"];We=Fn.prototype;We.Ka=function(t){this.L=t};We.da=function(t,e,n,o){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():AC.g(),this.C=this.u?$V(this.u):$V(AC),this.g.onreadystatechange=oi(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(l){zV(this,l);return}if(t=n||"",n=new Map(this.headers),o)if(Object.getPrototypeOf(o)===Object.prototype)for(var c in o)n.set(c,o[c]);else if(typeof o.keys=="function"&&typeof o.get=="function")for(const l of o.keys())n.set(l,o.get(l));else throw Error("Unknown input type for opt_headers: "+String(o));o=Array.from(n.keys()).find(l=>l.toLowerCase()=="content-type"),c=ft.FormData&&t instanceof ft.FormData,!(0<=L7(Vpe,e))||o||c||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[l,f]of n)this.g.setRequestHeader(l,f);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{SB(this),0<this.B&&((this.K=Fpe(this.g))?(this.g.timeout=this.B,this.g.ontimeout=oi(this.qa,this)):this.A=Yb(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(l){zV(this,l)}};function Fpe(t){return Xd&&npe()&&typeof t.timeout=="number"&&t.ontimeout!==void 0}We.qa=function(){typeof Fb<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Wr(this,"timeout"),this.abort(8))};function zV(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,vB(t),H1(t)}function vB(t){t.D||(t.D=!0,Wr(t,"complete"),Wr(t,"error"))}We.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Wr(this,"complete"),Wr(this,"abort"),H1(this))};We.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),H1(this,!0)),Fn.X.M.call(this)};We.Ha=function(){this.s||(this.F||this.v||this.l?yB(this):this.fb())};We.fb=function(){yB(this)};function yB(t){if(t.h&&typeof Fb<"u"&&(!t.C[1]||Ea(t)!=4||t.aa()!=2)){if(t.v&&Ea(t)==4)Yb(t.Ha,0,t);else if(Wr(t,"readystatechange"),Ea(t)==4){t.h=!1;try{const _=t.aa();e:switch(_){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var o;if(o=_===0){var c=String(t.H).match(cB)[1]||null;if(!c&&ft.self&&ft.self.location){var l=ft.self.location.protocol;c=l.substr(0,l.length-1)}o=!Upe.test(c?c.toLowerCase():"")}n=o}if(n)Wr(t,"complete"),Wr(t,"success");else{t.m=6;try{var f=2<Ea(t)?t.g.statusText:""}catch{f=""}t.j=f+" ["+t.aa()+"]",vB(t)}}finally{H1(t)}}}}function H1(t,e){if(t.g){SB(t);const n=t.g,o=t.C[0]?lv:null;t.g=null,t.C=null,e||Wr(t,"ready");try{n.onreadystatechange=o}catch{}}}function SB(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(ft.clearTimeout(t.A),t.A=null)}function Ea(t){return t.g?t.g.readyState:0}We.aa=function(){try{return 2<Ea(this)?this.g.status:-1}catch{return-1}};We.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};We.Sa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),xpe(e)}};function YV(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case _B:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}We.Ea=function(){return this.m};We.Oa=function(){return typeof this.j=="string"?this.j:String(this.j)};function TB(t){let e="";return Gb(t,function(n,o){e+=o,e+=":",e+=n,e+=`\r
`}),e}function nO(t,e,n){e:{for(o in n){var o=!1;break e}o=!0}o||(n=TB(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):Cn(t,e,n))}function wp(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function RB(t){this.Ca=0,this.i=[],this.j=new U1,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=wp("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=wp("baseRetryDelayMs",5e3,t),this.bb=wp("retryDelaySeedMs",1e4,t),this.$a=wp("forwardChannelMaxRetries",2,t),this.ta=wp("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Zb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new hB(t&&t.concurrentRequestLimit),this.Fa=new kpe,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=t&&t.Xb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}We=RB.prototype;We.ma=8;We.G=1;function rO(t){if(IB(t),t.G==3){var e=t.U++,n=Aa(t.F);Cn(n,"SID",t.I),Cn(n,"RID",e),Cn(n,"TYPE","terminate"),gm(t,n),e=new hm(t,t.j,e,void 0),e.K=2,e.v=G1(Aa(n)),n=!1,ft.navigator&&ft.navigator.sendBeacon&&(n=ft.navigator.sendBeacon(e.v.toString(),"")),!n&&ft.Image&&(new Image().src=e.v,n=!0),n||(e.g=DB(e.l,null),e.g.da(e.v)),e.F=Date.now(),pm(e)}NB(t)}function $1(t){t.g&&(sO(t),t.g.cancel(),t.g=null)}function IB(t){$1(t),t.u&&(ft.clearTimeout(t.u),t.u=null),gv(t),t.h.cancel(),t.m&&(typeof t.m=="number"&&ft.clearTimeout(t.m),t.m=null)}function K1(t){pB(t.h)||t.m||(t.m=!0,K7(t.Ja,t),t.C=0)}function jpe(t,e){return fB(t.h)>=t.h.j-(t.m?1:0)?!1:t.m?(t.i=e.D.concat(t.i),!0):t.G==1||t.G==2||t.C>=(t.Za?0:t.$a)?!1:(t.m=lm(oi(t.Ja,t,e),OB(t,t.C)),t.C++,!0)}We.Ja=function(t){if(this.m)if(this.m=null,this.G==1){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const c=new hm(this,this.j,t,void 0);let l=this.s;if(this.S&&(l?(l=V7(l),F7(l,this.S)):l=this.S),this.o!==null||this.N||(c.H=l,l=null),this.O)e:{for(var e=0,n=0;n<this.i.length;n++){t:{var o=this.i[n];if("__data__"in o.g&&(o=o.g.__data__,typeof o=="string")){o=o.length;break t}o=void 0}if(o===void 0)break;if(e+=o,4096<e){e=n;break e}if(e===4096||n===this.i.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=wB(this,c,e),n=Aa(this.F),Cn(n,"RID",t),Cn(n,"CVER",22),this.D&&Cn(n,"X-HTTP-Session-Id",this.D),gm(this,n),l&&(this.N?e="headers="+encodeURIComponent(String(TB(l)))+"&"+e:this.o&&nO(n,this.o,l)),Zb(this.h,c),this.Ya&&Cn(n,"TYPE","init"),this.O?(Cn(n,"$req",e),Cn(n,"SID","null"),c.Z=!0,OC(c,n,null)):OC(c,n,e),this.G=2}}else this.G==3&&(t?XV(this,t):this.i.length==0||pB(this.h)||XV(this))};function XV(t,e){var n;e?n=e.m:n=t.U++;const o=Aa(t.F);Cn(o,"SID",t.I),Cn(o,"RID",n),Cn(o,"AID",t.T),gm(t,o),t.o&&t.s&&nO(o,t.o,t.s),n=new hm(t,t.j,n,t.C+1),t.o===null&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=wB(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),Zb(t.h,n),OC(n,o,e)}function gm(t,e){t.ia&&Gb(t.ia,function(n,o){Cn(e,o,n)}),t.l&&aB({},function(n,o){Cn(e,o,n)})}function wB(t,e,n){n=Math.min(t.i.length,n);var o=t.l?oi(t.l.Ra,t.l,t):null;e:{var c=t.i;let l=-1;for(;;){const f=["count="+n];l==-1?0<n?(l=c[0].h,f.push("ofs="+l)):l=0:f.push("ofs="+l);let _=!0;for(let y=0;y<n;y++){let S=c[y].h;const R=c[y].g;if(S-=l,0>S)l=Math.max(0,c[y].h-100),_=!1;else try{Lpe(R,f,"req"+S+"_")}catch{o&&o(R)}}if(_){o=f.join("&");break e}}}return t=t.i.splice(0,n),e.D=t,o}function CB(t){t.g||t.u||(t.Z=1,K7(t.Ia,t),t.A=0)}function iO(t){return t.g||t.u||3<=t.A?!1:(t.Z++,t.u=lm(oi(t.Ia,t),OB(t,t.A)),t.A++,!0)}We.Ia=function(){if(this.u=null,AB(this),this.$&&!(this.K||this.g==null||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=lm(oi(this.eb,this),t)}};We.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ei(10),$1(this),AB(this))};function sO(t){t.B!=null&&(ft.clearTimeout(t.B),t.B=null)}function AB(t){t.g=new hm(t,t.j,"rpc",t.Z),t.o===null&&(t.g.H=t.s),t.g.N=0;var e=Aa(t.sa);Cn(e,"RID","rpc"),Cn(e,"SID",t.I),Cn(e,"CI",t.L?"0":"1"),Cn(e,"AID",t.T),Cn(e,"TYPE","xmlhttp"),gm(t,e),t.o&&t.s&&nO(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=G1(Aa(e)),n.s=null,n.P=!0,rB(n,t)}We.cb=function(){this.v!=null&&(this.v=null,$1(this),iO(this),Ei(19))};function gv(t){t.v!=null&&(ft.clearTimeout(t.v),t.v=null)}function bB(t,e){var n=null;if(t.g==e){gv(t),sO(t),t.g=null;var o=2}else if(PC(t.h,e))n=e.D,mB(t.h,e),o=1;else return;if(t.G!=0){if(t.pa=e.Y,e.i)if(o==1){n=e.s?e.s.length:0,e=Date.now()-e.F;var c=t.C;o=V1(),Wr(o,new Z7(o,n)),K1(t)}else CB(t);else if(c=e.o,c==3||c==0&&0<t.pa||!(o==1&&jpe(t,e)||o==2&&iO(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),c){case 1:ku(t,5);break;case 4:ku(t,10);break;case 3:ku(t,6);break;default:ku(t,2)}}}function OB(t,e){let n=t.Xa+Math.floor(Math.random()*t.bb);return t.l||(n*=2),n*e}function ku(t,e){if(t.j.info("Error code "+e),e==2){var n=null;t.l&&(n=null);var o=oi(t.kb,t);n||(n=new Fu("//www.google.com/images/cleardot.gif"),ft.location&&ft.location.protocol=="http"||fv(n,"https"),G1(n)),Mpe(n.toString(),o)}else Ei(2);t.G=0,t.l&&t.l.va(e),NB(t),IB(t)}We.kb=function(t){t?(this.j.info("Successfully pinged google.com"),Ei(2)):(this.j.info("Failed to ping google.com"),Ei(1))};function NB(t){if(t.G=0,t.la=[],t.l){const e=gB(t.h);(e.length!=0||t.i.length!=0)&&(FV(t.la,e),FV(t.la,t.i),t.h.i.length=0,jb(t.i),t.i.length=0),t.l.ua()}}function PB(t,e,n){var o=n instanceof Fu?Aa(n):new Fu(n,void 0);if(o.g!="")e&&(o.g=e+"."+o.g),mv(o,o.m);else{var c=ft.location;o=c.protocol,e=e?e+"."+c.hostname:c.hostname,c=+c.port;var l=new Fu(null,void 0);o&&fv(l,o),e&&(l.g=e),c&&mv(l,c),n&&(l.l=n),o=l}return n=t.D,e=t.za,n&&e&&Cn(o,n,e),Cn(o,"VER",t.ma),gm(t,o),o}function DB(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Da&&!t.ra?new Fn(new fm({jb:!0})):new Fn(t.ra),e.Ka(t.H),e}function kB(){}We=kB.prototype;We.xa=function(){};We.wa=function(){};We.va=function(){};We.ua=function(){};We.Ra=function(){};function Ev(){if(Xd&&!(10<=Number(rpe)))throw Error("Environmental error: no available transport.")}Ev.prototype.g=function(t,e){return new ls(t,e)};function ls(t,e){Or.call(this),this.g=new RB(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Yb)&&!dv(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!dv(e)&&(this.g.D=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Sh(this)}$r(ls,Or);ls.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;Ei(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=PB(t,null,t.V),K1(t)};ls.prototype.close=function(){rO(this.g)};ls.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=qb(t),t=n);e.i.push(new Ppe(e.ab++,t)),e.G==3&&K1(e)};ls.prototype.M=function(){this.g.l=null,delete this.j,rO(this.g),delete this.g,ls.X.M.call(this)};function LB(t){Jb.call(this);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}$r(LB,Jb);function MB(){Qb.call(this),this.status=1}$r(MB,Qb);function Sh(t){this.g=t}$r(Sh,kB);Sh.prototype.xa=function(){Wr(this.g,"a")};Sh.prototype.wa=function(t){Wr(this.g,new LB(t))};Sh.prototype.va=function(t){Wr(this.g,new MB)};Sh.prototype.ua=function(){Wr(this.g,"b")};Ev.prototype.createWebChannel=Ev.prototype.g;ls.prototype.send=ls.prototype.u;ls.prototype.open=ls.prototype.m;ls.prototype.close=ls.prototype.close;F1.NO_ERROR=0;F1.TIMEOUT=8;F1.HTTP_ERROR=6;eB.COMPLETE="complete";tB.EventType=dm;dm.OPEN="a";dm.CLOSE="b";dm.ERROR="c";dm.MESSAGE="d";Or.prototype.listen=Or.prototype.N;Fn.prototype.listenOnce=Fn.prototype.O;Fn.prototype.getLastError=Fn.prototype.Oa;Fn.prototype.getLastErrorCode=Fn.prototype.Ea;Fn.prototype.getStatus=Fn.prototype.aa;Fn.prototype.getResponseJson=Fn.prototype.Sa;Fn.prototype.getResponseText=Fn.prototype.fa;Fn.prototype.send=Fn.prototype.da;Fn.prototype.setWithCredentials=Fn.prototype.Ka;var Bpe=function(){return new Ev},Gpe=function(){return V1()},TI=F1,Wpe=eB,Hpe=rl,JV={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},$pe=fm,HE=tB,Kpe=Fn;const QV="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ni.UNAUTHENTICATED=new ni(null),ni.GOOGLE_CREDENTIALS=new ni("google-credentials-uid"),ni.FIRST_PARTY=new ni("first-party-uid"),ni.MOCK_USER=new ni("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Th="9.17.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qu=new Cb("@firebase/firestore");function ZV(){return Qu.logLevel}function $e(t,...e){if(Qu.logLevel<=Kt.DEBUG){const n=e.map(oO);Qu.debug(`Firestore (${Th}): ${t}`,...n)}}function ba(t,...e){if(Qu.logLevel<=Kt.ERROR){const n=e.map(oO);Qu.error(`Firestore (${Th}): ${t}`,...n)}}function DC(t,...e){if(Qu.logLevel<=Kt.WARN){const n=e.map(oO);Qu.warn(`Firestore (${Th}): ${t}`,...n)}}function oO(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lt(t="Unexpected state"){const e=`FIRESTORE (${Th}) INTERNAL ASSERTION FAILED: `+t;throw ba(e),new Error(e)}function _n(t,e){t||lt()}function St(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ye={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qe extends Fo{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xB{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qpe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(ni.UNAUTHENTICATED))}shutdown(){}}class zpe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class Ype{constructor(e){this.t=e,this.currentUser=ni.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let o=this.i;const c=y=>this.i!==o?(o=this.i,n(y)):Promise.resolve();let l=new Oc;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new Oc,e.enqueueRetryable(()=>c(this.currentUser))};const f=()=>{const y=l;e.enqueueRetryable(async()=>{await y.promise,await c(this.currentUser)})},_=y=>{$e("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=y,this.auth.addAuthTokenListener(this.o),f()};this.t.onInit(y=>_(y)),setTimeout(()=>{if(!this.auth){const y=this.t.getImmediate({optional:!0});y?_(y):($e("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new Oc)}},0),f()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(o=>this.i!==e?($e("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(_n(typeof o.accessToken=="string"),new xB(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return _n(e===null||typeof e=="string"),new ni(e)}}class Xpe{constructor(e,n,o,c){this.h=e,this.l=n,this.m=o,this.g=c,this.type="FirstParty",this.user=ni.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(_n(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Jpe{constructor(e,n,o,c){this.h=e,this.l=n,this.m=o,this.g=c}getToken(){return Promise.resolve(new Xpe(this.h,this.l,this.m,this.g))}start(e,n){e.enqueueRetryable(()=>n(ni.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Qpe{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zpe{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,n){const o=l=>{l.error!=null&&$e("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const f=l.token!==this.A;return this.A=l.token,$e("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?n(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable(()=>o(l))};const c=l=>{$e("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.appCheck.addTokenListener(this.o)};this.T.onInit(l=>c(l)),setTimeout(()=>{if(!this.appCheck){const l=this.T.getImmediate({optional:!0});l?c(l):$e("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(_n(typeof n.token=="string"),this.A=n.token,new Qpe(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function efe(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let o=0;o<t;o++)n[o]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UB{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let o="";for(;o.length<20;){const c=efe(40);for(let l=0;l<c.length;++l)o.length<20&&c[l]<n&&(o+=e.charAt(c[l]%e.length))}return o}}function Yt(t,e){return t<e?-1:t>e?1:0}function Jd(t,e,n){return t.length===e.length&&t.every((o,c)=>n(o,e[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new qe(ye.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new qe(ye.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new qe(ye.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new qe(ye.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return _r.fromMillis(Date.now())}static fromDate(e){return _r.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*n));return new _r(n,o)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Yt(this.nanoseconds,e.nanoseconds):Yt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e){this.timestamp=e}static fromTimestamp(e){return new yt(e)}static min(){return new yt(new _r(0,0))}static max(){return new yt(new _r(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(e,n,o){n===void 0?n=0:n>e.length&&lt(),o===void 0?o=e.length-n:o>e.length-n&&lt(),this.segments=e,this.offset=n,this.len=o}get length(){return this.len}isEqual(e){return Bf.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Bf?e.forEach(o=>{n.push(o)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,o=this.limit();n<o;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const o=Math.min(e.length,n.length);for(let c=0;c<o;c++){const l=e.get(c),f=n.get(c);if(l<f)return-1;if(l>f)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class An extends Bf{construct(e,n,o){return new An(e,n,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const o of e){if(o.indexOf("//")>=0)throw new qe(ye.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);n.push(...o.split("/").filter(c=>c.length>0))}return new An(n)}static emptyPath(){return new An([])}}const tfe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class si extends Bf{construct(e,n,o){return new si(e,n,o)}static isValidIdentifier(e){return tfe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),si.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new si(["__name__"])}static fromServerFormat(e){const n=[];let o="",c=0;const l=()=>{if(o.length===0)throw new qe(ye.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(o),o=""};let f=!1;for(;c<e.length;){const _=e[c];if(_==="\\"){if(c+1===e.length)throw new qe(ye.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const y=e[c+1];if(y!=="\\"&&y!=="."&&y!=="`")throw new qe(ye.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=y,c+=2}else _==="`"?(f=!f,c++):_!=="."||f?(o+=_,c++):(l(),c++)}if(l(),f)throw new qe(ye.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new si(n)}static emptyPath(){return new si([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(e){this.path=e}static fromPath(e){return new ze(An.fromString(e))}static fromName(e){return new ze(An.fromString(e).popFirst(5))}static empty(){return new ze(An.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&An.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return An.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ze(new An(e.slice()))}}function nfe(t,e){const n=t.toTimestamp().seconds,o=t.toTimestamp().nanoseconds+1,c=yt.fromTimestamp(o===1e9?new _r(n+1,0):new _r(n,o));return new Uc(c,ze.empty(),e)}function rfe(t){return new Uc(t.readTime,t.key,-1)}class Uc{constructor(e,n,o){this.readTime=e,this.documentKey=n,this.largestBatchId=o}static min(){return new Uc(yt.min(),ze.empty(),-1)}static max(){return new Uc(yt.max(),ze.empty(),-1)}}function ife(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ze.comparator(t.documentKey,e.documentKey),n!==0?n:Yt(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sfe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ofe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Em(t){if(t.code!==ye.FAILED_PRECONDITION||t.message!==sfe)throw t;$e("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&lt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Re((o,c)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(o,c)},this.catchCallback=l=>{this.wrapFailure(n,l).next(o,c)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof Re?n:Re.resolve(n)}catch(n){return Re.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):Re.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):Re.reject(n)}static resolve(e){return new Re((n,o)=>{n(e)})}static reject(e){return new Re((n,o)=>{o(e)})}static waitFor(e){return new Re((n,o)=>{let c=0,l=0,f=!1;e.forEach(_=>{++c,_.next(()=>{++l,f&&l===c&&n()},y=>o(y))}),f=!0,l===c&&n()})}static or(e){let n=Re.resolve(!1);for(const o of e)n=n.next(c=>c?Re.resolve(c):o());return n}static forEach(e,n){const o=[];return e.forEach((c,l)=>{o.push(n.call(this,c,l))}),this.waitFor(o)}static mapArray(e,n){return new Re((o,c)=>{const l=e.length,f=new Array(l);let _=0;for(let y=0;y<l;y++){const S=y;n(e[S]).next(R=>{f[S]=R,++_,_===l&&o(f)},R=>c(R))}})}static doWhile(e,n){return new Re((o,c)=>{const l=()=>{e()===!0?n().next(()=>{l()},c):o()};l()})}}function _m(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=o=>this.ut(o),this.ct=o=>n.writeSequenceNumber(o))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}aO.at=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class afe{constructor(e,n,o,c,l,f,_,y){this.databaseId=e,this.appId=n,this.persistenceKey=o,this.host=c,this.ssl=l,this.forceLongPolling=f,this.autoDetectLongPolling=_,this.useFetchStreams=y}}class Gf{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Gf("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Gf&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e6(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function il(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function VB(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q1(t){return t==null}function _v(t){return t===0&&1/t==-1/0}function cfe(t){return typeof t=="number"&&Number.isInteger(t)&&!_v(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e){this.binaryString=e}static fromBase64String(e){const n=atob(e);return new di(n)}static fromUint8Array(e){const n=function(o){let c="";for(let l=0;l<o.length;++l)c+=String.fromCharCode(o[l]);return c}(e);return new di(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Yt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}di.EMPTY_BYTE_STRING=new di("");const ufe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vc(t){if(_n(!!t),typeof t=="string"){let e=0;const n=ufe.exec(t);if(_n(!!n),n[1]){let c=n[1];c=(c+"000000000").substr(0,9),e=Number(c)}const o=new Date(t);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:or(t.seconds),nanos:or(t.nanos)}}function or(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Qd(t){return typeof t=="string"?di.fromBase64String(t):di.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FB(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function jB(t){const e=t.mapValue.fields.__previous_value__;return FB(e)?jB(e):e}function Wf(t){const e=Vc(t.mapValue.fields.__local_write_time__.timestampValue);return new _r(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $E={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Zu(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?FB(t)?4:lfe(t)?9007199254740991:10:lt()}function xo(t,e){if(t===e)return!0;const n=Zu(t);if(n!==Zu(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Wf(t).isEqual(Wf(e));case 3:return function(o,c){if(typeof o.timestampValue=="string"&&typeof c.timestampValue=="string"&&o.timestampValue.length===c.timestampValue.length)return o.timestampValue===c.timestampValue;const l=Vc(o.timestampValue),f=Vc(c.timestampValue);return l.seconds===f.seconds&&l.nanos===f.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(o,c){return Qd(o.bytesValue).isEqual(Qd(c.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(o,c){return or(o.geoPointValue.latitude)===or(c.geoPointValue.latitude)&&or(o.geoPointValue.longitude)===or(c.geoPointValue.longitude)}(t,e);case 2:return function(o,c){if("integerValue"in o&&"integerValue"in c)return or(o.integerValue)===or(c.integerValue);if("doubleValue"in o&&"doubleValue"in c){const l=or(o.doubleValue),f=or(c.doubleValue);return l===f?_v(l)===_v(f):isNaN(l)&&isNaN(f)}return!1}(t,e);case 9:return Jd(t.arrayValue.values||[],e.arrayValue.values||[],xo);case 10:return function(o,c){const l=o.mapValue.fields||{},f=c.mapValue.fields||{};if(e6(l)!==e6(f))return!1;for(const _ in l)if(l.hasOwnProperty(_)&&(f[_]===void 0||!xo(l[_],f[_])))return!1;return!0}(t,e);default:return lt()}}function Hf(t,e){return(t.values||[]).find(n=>xo(n,e))!==void 0}function Zd(t,e){if(t===e)return 0;const n=Zu(t),o=Zu(e);if(n!==o)return Yt(n,o);switch(n){case 0:case 9007199254740991:return 0;case 1:return Yt(t.booleanValue,e.booleanValue);case 2:return function(c,l){const f=or(c.integerValue||c.doubleValue),_=or(l.integerValue||l.doubleValue);return f<_?-1:f>_?1:f===_?0:isNaN(f)?isNaN(_)?0:-1:1}(t,e);case 3:return t6(t.timestampValue,e.timestampValue);case 4:return t6(Wf(t),Wf(e));case 5:return Yt(t.stringValue,e.stringValue);case 6:return function(c,l){const f=Qd(c),_=Qd(l);return f.compareTo(_)}(t.bytesValue,e.bytesValue);case 7:return function(c,l){const f=c.split("/"),_=l.split("/");for(let y=0;y<f.length&&y<_.length;y++){const S=Yt(f[y],_[y]);if(S!==0)return S}return Yt(f.length,_.length)}(t.referenceValue,e.referenceValue);case 8:return function(c,l){const f=Yt(or(c.latitude),or(l.latitude));return f!==0?f:Yt(or(c.longitude),or(l.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(c,l){const f=c.values||[],_=l.values||[];for(let y=0;y<f.length&&y<_.length;++y){const S=Zd(f[y],_[y]);if(S)return S}return Yt(f.length,_.length)}(t.arrayValue,e.arrayValue);case 10:return function(c,l){if(c===$E.mapValue&&l===$E.mapValue)return 0;if(c===$E.mapValue)return 1;if(l===$E.mapValue)return-1;const f=c.fields||{},_=Object.keys(f),y=l.fields||{},S=Object.keys(y);_.sort(),S.sort();for(let R=0;R<_.length&&R<S.length;++R){const w=Yt(_[R],S[R]);if(w!==0)return w;const b=Zd(f[_[R]],y[S[R]]);if(b!==0)return b}return Yt(_.length,S.length)}(t.mapValue,e.mapValue);default:throw lt()}}function t6(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Yt(t,e);const n=Vc(t),o=Vc(e),c=Yt(n.seconds,o.seconds);return c!==0?c:Yt(n.nanos,o.nanos)}function eh(t){return kC(t)}function kC(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(o){const c=Vc(o);return`time(${c.seconds},${c.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Qd(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ze.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(o){let c="[",l=!0;for(const f of o.values||[])l?l=!1:c+=",",c+=kC(f);return c+"]"}(t.arrayValue):"mapValue"in t?function(o){const c=Object.keys(o.fields||{}).sort();let l="{",f=!0;for(const _ of c)f?f=!1:l+=",",l+=`${_}:${kC(o.fields[_])}`;return l+"}"}(t.mapValue):lt();var e,n}function LC(t){return!!t&&"integerValue"in t}function cO(t){return!!t&&"arrayValue"in t}function n6(t){return!!t&&"nullValue"in t}function r6(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function f_(t){return!!t&&"mapValue"in t}function Jp(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return il(t.mapValue.fields,(n,o)=>e.mapValue.fields[n]=Jp(o)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Jp(t.arrayValue.values[n]);return e}return Object.assign({},t)}function lfe(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,n){this.position=e,this.inclusive=n}}function i6(t,e,n){let o=0;for(let c=0;c<t.position.length;c++){const l=e[c],f=t.position[c];if(l.field.isKeyField()?o=ze.comparator(ze.fromName(f.referenceValue),n.key):o=Zd(f,n.data.field(l.field)),l.dir==="desc"&&(o*=-1),o!==0)break}return o}function s6(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!xo(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BB{}class gr extends BB{constructor(e,n,o){super(),this.field=e,this.op=n,this.value=o}static create(e,n,o){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,o):new hfe(e,n,o):n==="array-contains"?new mfe(e,o):n==="in"?new gfe(e,o):n==="not-in"?new Efe(e,o):n==="array-contains-any"?new _fe(e,o):new gr(e,n,o)}static createKeyFieldInFilter(e,n,o){return n==="in"?new pfe(e,o):new ffe(e,o)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Zd(n,this.value)):n!==null&&Zu(this.value)===Zu(n)&&this.matchesComparison(Zd(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return lt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Uo extends BB{constructor(e,n){super(),this.filters=e,this.op=n,this.ht=null}static create(e,n){return new Uo(e,n)}matches(e){return GB(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ht!==null||(this.ht=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(n=>n.isInequality());return e!==null?e.field:null}lt(e){for(const n of this.getFlattenedFilters())if(e(n))return n;return null}}function GB(t){return t.op==="and"}function WB(t){return dfe(t)&&GB(t)}function dfe(t){for(const e of t.filters)if(e instanceof Uo)return!1;return!0}function MC(t){if(t instanceof gr)return t.field.canonicalString()+t.op.toString()+eh(t.value);if(WB(t))return t.filters.map(e=>MC(e)).join(",");{const e=t.filters.map(n=>MC(n)).join(",");return`${t.op}(${e})`}}function HB(t,e){return t instanceof gr?function(n,o){return o instanceof gr&&n.op===o.op&&n.field.isEqual(o.field)&&xo(n.value,o.value)}(t,e):t instanceof Uo?function(n,o){return o instanceof Uo&&n.op===o.op&&n.filters.length===o.filters.length?n.filters.reduce((c,l,f)=>c&&HB(l,o.filters[f]),!0):!1}(t,e):void lt()}function $B(t){return t instanceof gr?function(e){return`${e.field.canonicalString()} ${e.op} ${eh(e.value)}`}(t):t instanceof Uo?function(e){return e.op.toString()+" {"+e.getFilters().map($B).join(" ,")+"}"}(t):"Filter"}class hfe extends gr{constructor(e,n,o){super(e,n,o),this.key=ze.fromName(o.referenceValue)}matches(e){const n=ze.comparator(e.key,this.key);return this.matchesComparison(n)}}class pfe extends gr{constructor(e,n){super(e,"in",n),this.keys=KB("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class ffe extends gr{constructor(e,n){super(e,"not-in",n),this.keys=KB("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function KB(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(o=>ze.fromName(o.referenceValue))}class mfe extends gr{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return cO(n)&&Hf(n.arrayValue,this.value)}}class gfe extends gr{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Hf(this.value.arrayValue,n)}}class Efe extends gr{constructor(e,n){super(e,"not-in",n)}matches(e){if(Hf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Hf(this.value.arrayValue,n)}}class _fe extends gr{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!cO(n)||!n.arrayValue.values)&&n.arrayValue.values.some(o=>Hf(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,n="asc"){this.field=e,this.dir=n}}function vfe(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e,n){this.comparator=e,this.root=n||Br.EMPTY}insert(e,n){return new Sr(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Br.BLACK,null,null))}remove(e){return new Sr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Br.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const o=this.comparator(e,n.key);if(o===0)return n.value;o<0?n=n.left:o>0&&(n=n.right)}return null}indexOf(e){let n=0,o=this.root;for(;!o.isEmpty();){const c=this.comparator(e,o.key);if(c===0)return n+o.left.size;c<0?o=o.left:(n+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,o)=>(e(n,o),!1))}toString(){const e=[];return this.inorderTraversal((n,o)=>(e.push(`${n}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new KE(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new KE(this.root,e,this.comparator,!1)}getReverseIterator(){return new KE(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new KE(this.root,e,this.comparator,!0)}}class KE{constructor(e,n,o,c){this.isReverse=c,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=n?o(e.key,n):1,n&&c&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Br{constructor(e,n,o,c,l){this.key=e,this.value=n,this.color=o??Br.RED,this.left=c??Br.EMPTY,this.right=l??Br.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,o,c,l){return new Br(e??this.key,n??this.value,o??this.color,c??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,o){let c=this;const l=o(e,c.key);return c=l<0?c.copy(null,null,null,c.left.insert(e,n,o),null):l===0?c.copy(null,n,null,null,null):c.copy(null,null,null,null,c.right.insert(e,n,o)),c.fixUp()}removeMin(){if(this.left.isEmpty())return Br.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let o,c=this;if(n(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,n),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),n(e,c.key)===0){if(c.right.isEmpty())return Br.EMPTY;o=c.right.min(),c=c.copy(o.key,o.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,n))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Br.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Br.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw lt();const e=this.left.check();if(e!==this.right.check())throw lt();return e+(this.isRed()?0:1)}}Br.EMPTY=null,Br.RED=!0,Br.BLACK=!1;Br.EMPTY=new class{constructor(){this.size=0}get key(){throw lt()}get value(){throw lt()}get color(){throw lt()}get left(){throw lt()}get right(){throw lt()}copy(t,e,n,o,c){return this}insert(t,e,n){return new Br(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e){this.comparator=e,this.data=new Sr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,o)=>(e(n),!1))}forEachInRange(e,n){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const c=o.getNext();if(this.comparator(c.key,e[1])>=0)return;n(c.key)}}forEachWhile(e,n){let o;for(o=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new o6(this.data.getIterator())}getIteratorFrom(e){return new o6(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(o=>{n=n.add(o)}),n}isEqual(e){if(!(e instanceof vr)||this.size!==e.size)return!1;const n=this.data.getIterator(),o=e.data.getIterator();for(;n.hasNext();){const c=n.getNext().key,l=o.getNext().key;if(this.comparator(c,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new vr(this.comparator);return n.data=e,n}}class o6{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e){this.fields=e,e.sort(si.comparator)}static empty(){return new os([])}unionWith(e){let n=new vr(si.comparator);for(const o of this.fields)n=n.add(o);for(const o of e)n=n.add(o);return new os(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Jd(this.fields,e.fields,(n,o)=>n.isEqual(o))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e){this.value=e}static empty(){return new Pi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let o=0;o<e.length-1;++o)if(n=(n.mapValue.fields||{})[e.get(o)],!f_(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Jp(n)}setAll(e){let n=si.emptyPath(),o={},c=[];e.forEach((f,_)=>{if(!n.isImmediateParentOf(_)){const y=this.getFieldsMap(n);this.applyChanges(y,o,c),o={},c=[],n=_.popLast()}f?o[_.lastSegment()]=Jp(f):c.push(_.lastSegment())});const l=this.getFieldsMap(n);this.applyChanges(l,o,c)}delete(e){const n=this.field(e.popLast());f_(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return xo(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let o=0;o<e.length;++o){let c=n.mapValue.fields[e.get(o)];f_(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},n.mapValue.fields[e.get(o)]=c),n=c}return n.mapValue.fields}applyChanges(e,n,o){il(n,(c,l)=>e[c]=l);for(const c of o)delete e[c]}clone(){return new Pi(Jp(this.value))}}function qB(t){const e=[];return il(t.fields,(n,o)=>{const c=new si([n]);if(f_(o)){const l=qB(o.mapValue).fields;if(l.length===0)e.push(c);else for(const f of l)e.push(c.child(f))}else e.push(c)}),new os(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,n,o,c,l,f,_){this.key=e,this.documentType=n,this.version=o,this.readTime=c,this.createTime=l,this.data=f,this.documentState=_}static newInvalidDocument(e){return new ii(e,0,yt.min(),yt.min(),yt.min(),Pi.empty(),0)}static newFoundDocument(e,n,o,c){return new ii(e,1,n,yt.min(),o,c,0)}static newNoDocument(e,n){return new ii(e,2,n,yt.min(),yt.min(),Pi.empty(),0)}static newUnknownDocument(e,n){return new ii(e,3,n,yt.min(),yt.min(),Pi.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(yt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=yt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ii&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ii(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yfe{constructor(e,n=null,o=[],c=[],l=null,f=null,_=null){this.path=e,this.collectionGroup=n,this.orderBy=o,this.filters=c,this.limit=l,this.startAt=f,this.endAt=_,this.ft=null}}function a6(t,e=null,n=[],o=[],c=null,l=null,f=null){return new yfe(t,e,n,o,c,l,f)}function uO(t){const e=St(t);if(e.ft===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(o=>MC(o)).join(","),n+="|ob:",n+=e.orderBy.map(o=>function(c){return c.field.canonicalString()+c.dir}(o)).join(","),q1(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(o=>eh(o)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(o=>eh(o)).join(",")),e.ft=n}return e.ft}function lO(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!vfe(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!HB(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!s6(t.startAt,e.startAt)&&s6(t.endAt,e.endAt)}function xC(t){return ze.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1{constructor(e,n=null,o=[],c=[],l=null,f="F",_=null,y=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=o,this.filters=c,this.limit=l,this.limitType=f,this.startAt=_,this.endAt=y,this.dt=null,this._t=null,this.startAt,this.endAt}}function Sfe(t,e,n,o,c,l,f,_){return new z1(t,e,n,o,c,l,f,_)}function Y1(t){return new z1(t)}function c6(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Tfe(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Rfe(t){for(const e of t.filters){const n=e.getFirstInequalityField();if(n!==null)return n}return null}function Ife(t){return t.collectionGroup!==null}function Fd(t){const e=St(t);if(e.dt===null){e.dt=[];const n=Rfe(e),o=Tfe(e);if(n!==null&&o===null)n.isKeyField()||e.dt.push(new Qp(n)),e.dt.push(new Qp(si.keyField(),"asc"));else{let c=!1;for(const l of e.explicitOrderBy)e.dt.push(l),l.field.isKeyField()&&(c=!0);if(!c){const l=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new Qp(si.keyField(),l))}}}return e.dt}function Oa(t){const e=St(t);if(!e._t)if(e.limitType==="F")e._t=a6(e.path,e.collectionGroup,Fd(e),e.filters,e.limit,e.startAt,e.endAt);else{const n=[];for(const l of Fd(e)){const f=l.dir==="desc"?"asc":"desc";n.push(new Qp(l.field,f))}const o=e.endAt?new vv(e.endAt.position,e.endAt.inclusive):null,c=e.startAt?new vv(e.startAt.position,e.startAt.inclusive):null;e._t=a6(e.path,e.collectionGroup,n,e.filters,e.limit,o,c)}return e._t}function UC(t,e,n){return new z1(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function X1(t,e){return lO(Oa(t),Oa(e))&&t.limitType===e.limitType}function zB(t){return`${uO(Oa(t))}|lt:${t.limitType}`}function VC(t){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(o=>$B(o)).join(", ")}]`),q1(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(o=>function(c){return`${c.field.canonicalString()} (${c.dir})`}(o)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(o=>eh(o)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(o=>eh(o)).join(",")),`Target(${n})`}(Oa(t))}; limitType=${t.limitType})`}function J1(t,e){return e.isFoundDocument()&&function(n,o){const c=o.key.path;return n.collectionGroup!==null?o.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(c):ze.isDocumentKey(n.path)?n.path.isEqual(c):n.path.isImmediateParentOf(c)}(t,e)&&function(n,o){for(const c of Fd(n))if(!c.field.isKeyField()&&o.data.field(c.field)===null)return!1;return!0}(t,e)&&function(n,o){for(const c of n.filters)if(!c.matches(o))return!1;return!0}(t,e)&&function(n,o){return!(n.startAt&&!function(c,l,f){const _=i6(c,l,f);return c.inclusive?_<=0:_<0}(n.startAt,Fd(n),o)||n.endAt&&!function(c,l,f){const _=i6(c,l,f);return c.inclusive?_>=0:_>0}(n.endAt,Fd(n),o))}(t,e)}function wfe(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function YB(t){return(e,n)=>{let o=!1;for(const c of Fd(t)){const l=Cfe(c,e,n);if(l!==0)return l;o=o||c.field.isKeyField()}return 0}}function Cfe(t,e,n){const o=t.field.isKeyField()?ze.comparator(e.key,n.key):function(c,l,f){const _=l.data.field(c),y=f.data.field(c);return _!==null&&y!==null?Zd(_,y):lt()}(t.field,e,n);switch(t.dir){case"asc":return o;case"desc":return-1*o;default:return lt()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XB(t,e){if(t.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_v(e)?"-0":e}}function JB(t){return{integerValue:""+t}}function Afe(t,e){return cfe(e)?JB(e):XB(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q1{constructor(){this._=void 0}}function bfe(t,e,n){return t instanceof yv?function(o,c){const l={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return c&&(l.fields.__previous_value__=c),{mapValue:l}}(n,e):t instanceof th?ZB(t,e):t instanceof nh?eG(t,e):function(o,c){const l=QB(o,c),f=u6(l)+u6(o.gt);return LC(l)&&LC(o.gt)?JB(f):XB(o.yt,f)}(t,e)}function Ofe(t,e,n){return t instanceof th?ZB(t,e):t instanceof nh?eG(t,e):n}function QB(t,e){return t instanceof Sv?LC(n=e)||function(o){return!!o&&"doubleValue"in o}(n)?e:{integerValue:0}:null;var n}class yv extends Q1{}class th extends Q1{constructor(e){super(),this.elements=e}}function ZB(t,e){const n=tG(e);for(const o of t.elements)n.some(c=>xo(c,o))||n.push(o);return{arrayValue:{values:n}}}class nh extends Q1{constructor(e){super(),this.elements=e}}function eG(t,e){let n=tG(e);for(const o of t.elements)n=n.filter(c=>!xo(c,o));return{arrayValue:{values:n}}}class Sv extends Q1{constructor(e,n){super(),this.yt=e,this.gt=n}}function u6(t){return or(t.integerValue||t.doubleValue)}function tG(t){return cO(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nG{constructor(e,n){this.field=e,this.transform=n}}function Nfe(t,e){return t.field.isEqual(e.field)&&function(n,o){return n instanceof th&&o instanceof th||n instanceof nh&&o instanceof nh?Jd(n.elements,o.elements,xo):n instanceof Sv&&o instanceof Sv?xo(n.gt,o.gt):n instanceof yv&&o instanceof yv}(t.transform,e.transform)}class Pfe{constructor(e,n){this.version=e,this.transformResults=n}}class so{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new so}static exists(e){return new so(void 0,e)}static updateTime(e){return new so(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function m_(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Z1{}function rG(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new dO(t.key,so.none()):new vm(t.key,t.data,so.none());{const n=t.data,o=Pi.empty();let c=new vr(si.comparator);for(let l of e.fields)if(!c.has(l)){let f=n.field(l);f===null&&l.length>1&&(l=l.popLast(),f=n.field(l)),f===null?o.delete(l):o.set(l,f),c=c.add(l)}return new zc(t.key,o,new os(c.toArray()),so.none())}}function Dfe(t,e,n){t instanceof vm?function(o,c,l){const f=o.value.clone(),_=d6(o.fieldTransforms,c,l.transformResults);f.setAll(_),c.convertToFoundDocument(l.version,f).setHasCommittedMutations()}(t,e,n):t instanceof zc?function(o,c,l){if(!m_(o.precondition,c))return void c.convertToUnknownDocument(l.version);const f=d6(o.fieldTransforms,c,l.transformResults),_=c.data;_.setAll(iG(o)),_.setAll(f),c.convertToFoundDocument(l.version,_).setHasCommittedMutations()}(t,e,n):function(o,c,l){c.convertToNoDocument(l.version).setHasCommittedMutations()}(0,e,n)}function Zp(t,e,n,o){return t instanceof vm?function(c,l,f,_){if(!m_(c.precondition,l))return f;const y=c.value.clone(),S=h6(c.fieldTransforms,_,l);return y.setAll(S),l.convertToFoundDocument(l.version,y).setHasLocalMutations(),null}(t,e,n,o):t instanceof zc?function(c,l,f,_){if(!m_(c.precondition,l))return f;const y=h6(c.fieldTransforms,_,l),S=l.data;return S.setAll(iG(c)),S.setAll(y),l.convertToFoundDocument(l.version,S).setHasLocalMutations(),f===null?null:f.unionWith(c.fieldMask.fields).unionWith(c.fieldTransforms.map(R=>R.field))}(t,e,n,o):function(c,l,f){return m_(c.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):f}(t,e,n)}function kfe(t,e){let n=null;for(const o of t.fieldTransforms){const c=e.data.field(o.field),l=QB(o.transform,c||null);l!=null&&(n===null&&(n=Pi.empty()),n.set(o.field,l))}return n||null}function l6(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,o){return n===void 0&&o===void 0||!(!n||!o)&&Jd(n,o,(c,l)=>Nfe(c,l))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class vm extends Z1{constructor(e,n,o,c=[]){super(),this.key=e,this.value=n,this.precondition=o,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class zc extends Z1{constructor(e,n,o,c,l=[]){super(),this.key=e,this.data=n,this.fieldMask=o,this.precondition=c,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function iG(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const o=t.data.field(n);e.set(n,o)}}),e}function d6(t,e,n){const o=new Map;_n(t.length===n.length);for(let c=0;c<n.length;c++){const l=t[c],f=l.transform,_=e.data.field(l.field);o.set(l.field,Ofe(f,_,n[c]))}return o}function h6(t,e,n){const o=new Map;for(const c of t){const l=c.transform,f=n.data.field(c.field);o.set(c.field,bfe(l,f,e))}return o}class dO extends Z1{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Lfe extends Z1{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mfe{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sr,Vt;function xfe(t){switch(t){default:return lt();case ye.CANCELLED:case ye.UNKNOWN:case ye.DEADLINE_EXCEEDED:case ye.RESOURCE_EXHAUSTED:case ye.INTERNAL:case ye.UNAVAILABLE:case ye.UNAUTHENTICATED:return!1;case ye.INVALID_ARGUMENT:case ye.NOT_FOUND:case ye.ALREADY_EXISTS:case ye.PERMISSION_DENIED:case ye.FAILED_PRECONDITION:case ye.ABORTED:case ye.OUT_OF_RANGE:case ye.UNIMPLEMENTED:case ye.DATA_LOSS:return!0}}function sG(t){if(t===void 0)return ba("GRPC error has no .code"),ye.UNKNOWN;switch(t){case sr.OK:return ye.OK;case sr.CANCELLED:return ye.CANCELLED;case sr.UNKNOWN:return ye.UNKNOWN;case sr.DEADLINE_EXCEEDED:return ye.DEADLINE_EXCEEDED;case sr.RESOURCE_EXHAUSTED:return ye.RESOURCE_EXHAUSTED;case sr.INTERNAL:return ye.INTERNAL;case sr.UNAVAILABLE:return ye.UNAVAILABLE;case sr.UNAUTHENTICATED:return ye.UNAUTHENTICATED;case sr.INVALID_ARGUMENT:return ye.INVALID_ARGUMENT;case sr.NOT_FOUND:return ye.NOT_FOUND;case sr.ALREADY_EXISTS:return ye.ALREADY_EXISTS;case sr.PERMISSION_DENIED:return ye.PERMISSION_DENIED;case sr.FAILED_PRECONDITION:return ye.FAILED_PRECONDITION;case sr.ABORTED:return ye.ABORTED;case sr.OUT_OF_RANGE:return ye.OUT_OF_RANGE;case sr.UNIMPLEMENTED:return ye.UNIMPLEMENTED;case sr.DATA_LOSS:return ye.DATA_LOSS;default:return lt()}}(Vt=sr||(sr={}))[Vt.OK=0]="OK",Vt[Vt.CANCELLED=1]="CANCELLED",Vt[Vt.UNKNOWN=2]="UNKNOWN",Vt[Vt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vt[Vt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vt[Vt.NOT_FOUND=5]="NOT_FOUND",Vt[Vt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vt[Vt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vt[Vt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vt[Vt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vt[Vt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vt[Vt.ABORTED=10]="ABORTED",Vt[Vt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vt[Vt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vt[Vt.INTERNAL=13]="INTERNAL",Vt[Vt.UNAVAILABLE=14]="UNAVAILABLE",Vt[Vt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rh{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),o=this.inner[n];if(o!==void 0){for(const[c,l]of o)if(this.equalsFn(c,e))return l}}has(e){return this.get(e)!==void 0}set(e,n){const o=this.mapKeyFn(e),c=this.inner[o];if(c===void 0)return this.inner[o]=[[e,n]],void this.innerSize++;for(let l=0;l<c.length;l++)if(this.equalsFn(c[l][0],e))return void(c[l]=[e,n]);c.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),o=this.inner[n];if(o===void 0)return!1;for(let c=0;c<o.length;c++)if(this.equalsFn(o[c][0],e))return o.length===1?delete this.inner[n]:o.splice(c,1),this.innerSize--,!0;return!1}forEach(e){il(this.inner,(n,o)=>{for(const[c,l]of o)e(c,l)})}isEmpty(){return VB(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ufe=new Sr(ze.comparator);function Na(){return Ufe}const oG=new Sr(ze.comparator);function Up(...t){let e=oG;for(const n of t)e=e.insert(n.key,n);return e}function aG(t){let e=oG;return t.forEach((n,o)=>e=e.insert(n,o.overlayedDocument)),e}function Lu(){return ef()}function cG(){return ef()}function ef(){return new Rh(t=>t.toString(),(t,e)=>t.isEqual(e))}const Vfe=new Sr(ze.comparator),Ffe=new vr(ze.comparator);function Lt(...t){let e=Ffe;for(const n of t)e=e.add(n);return e}const jfe=new vr(Yt);function uG(){return jfe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ey{constructor(e,n,o,c,l){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=o,this.documentUpdates=c,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,n,o){const c=new Map;return c.set(e,ym.createSynthesizedTargetChangeForCurrentChange(e,n,o)),new ey(yt.min(),c,uG(),Na(),Lt())}}class ym{constructor(e,n,o,c,l){this.resumeToken=e,this.current=n,this.addedDocuments=o,this.modifiedDocuments=c,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,n,o){return new ym(o,n,Lt(),Lt(),Lt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(e,n,o,c){this.It=e,this.removedTargetIds=n,this.key=o,this.Tt=c}}class lG{constructor(e,n){this.targetId=e,this.Et=n}}class dG{constructor(e,n,o=di.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=n,this.resumeToken=o,this.cause=c}}class p6{constructor(){this.At=0,this.Rt=m6(),this.bt=di.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return this.At!==0}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=Lt(),n=Lt(),o=Lt();return this.Rt.forEach((c,l)=>{switch(l){case 0:e=e.add(c);break;case 2:n=n.add(c);break;case 1:o=o.add(c);break;default:lt()}}),new ym(this.bt,this.Pt,e,n,o)}xt(){this.vt=!1,this.Rt=m6()}Nt(e,n){this.vt=!0,this.Rt=this.Rt.insert(e,n)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class Bfe{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=Na(),this.qt=f6(),this.Ut=new vr(Yt)}Kt(e){for(const n of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(n,e.Tt):this.Qt(n,e.key,e.Tt);for(const n of e.removedTargetIds)this.Qt(n,e.key,e.Tt)}jt(e){this.forEachTarget(e,n=>{const o=this.Wt(n);switch(e.state){case 0:this.zt(n)&&o.Dt(e.resumeToken);break;case 1:o.Mt(),o.Vt||o.xt(),o.Dt(e.resumeToken);break;case 2:o.Mt(),o.Vt||this.removeTarget(n);break;case 3:this.zt(n)&&(o.Ft(),o.Dt(e.resumeToken));break;case 4:this.zt(n)&&(this.Ht(n),o.Dt(e.resumeToken));break;default:lt()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Bt.forEach((o,c)=>{this.zt(c)&&n(c)})}Jt(e){const n=e.targetId,o=e.Et.count,c=this.Yt(n);if(c){const l=c.target;if(xC(l))if(o===0){const f=new ze(l.path);this.Qt(n,f,ii.newNoDocument(f,yt.min()))}else _n(o===1);else this.Xt(n)!==o&&(this.Ht(n),this.Ut=this.Ut.add(n))}}Zt(e){const n=new Map;this.Bt.forEach((l,f)=>{const _=this.Yt(f);if(_){if(l.current&&xC(_.target)){const y=new ze(_.target.path);this.Lt.get(y)!==null||this.te(f,y)||this.Qt(f,y,ii.newNoDocument(y,e))}l.St&&(n.set(f,l.Ct()),l.xt())}});let o=Lt();this.qt.forEach((l,f)=>{let _=!0;f.forEachWhile(y=>{const S=this.Yt(y);return!S||S.purpose===2||(_=!1,!1)}),_&&(o=o.add(l))}),this.Lt.forEach((l,f)=>f.setReadTime(e));const c=new ey(e,n,this.Ut,this.Lt,o);return this.Lt=Na(),this.qt=f6(),this.Ut=new vr(Yt),c}Gt(e,n){if(!this.zt(e))return;const o=this.te(e,n.key)?2:0;this.Wt(e).Nt(n.key,o),this.Lt=this.Lt.insert(n.key,n),this.qt=this.qt.insert(n.key,this.ee(n.key).add(e))}Qt(e,n,o){if(!this.zt(e))return;const c=this.Wt(e);this.te(e,n)?c.Nt(n,1):c.kt(n),this.qt=this.qt.insert(n,this.ee(n).delete(e)),o&&(this.Lt=this.Lt.insert(n,o))}removeTarget(e){this.Bt.delete(e)}Xt(e){const n=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let n=this.Bt.get(e);return n||(n=new p6,this.Bt.set(e,n)),n}ee(e){let n=this.qt.get(e);return n||(n=new vr(Yt),this.qt=this.qt.insert(e,n)),n}zt(e){const n=this.Yt(e)!==null;return n||$e("WatchChangeAggregator","Detected inactive target",e),n}Yt(e){const n=this.Bt.get(e);return n&&n.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new p6),this.$t.getRemoteKeysForTarget(e).forEach(n=>{this.Qt(e,n,null)})}te(e,n){return this.$t.getRemoteKeysForTarget(e).has(n)}}function f6(){return new Sr(ze.comparator)}function m6(){return new Sr(ze.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gfe=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Wfe=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),Hfe=(()=>({and:"AND",or:"OR"}))();class $fe{constructor(e,n){this.databaseId=e,this.wt=n}}function Tv(t,e){return t.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hG(t,e){return t.wt?e.toBase64():e.toUint8Array()}function Kfe(t,e){return Tv(t,e.toTimestamp())}function Lo(t){return _n(!!t),yt.fromTimestamp(function(e){const n=Vc(e);return new _r(n.seconds,n.nanos)}(t))}function hO(t,e){return function(n){return new An(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function pG(t){const e=An.fromString(t);return _n(EG(e)),e}function FC(t,e){return hO(t.databaseId,e.path)}function RI(t,e){const n=pG(e);if(n.get(1)!==t.databaseId.projectId)throw new qe(ye.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new qe(ye.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ze(fG(n))}function jC(t,e){return hO(t.databaseId,e)}function qfe(t){const e=pG(t);return e.length===4?An.emptyPath():fG(e)}function BC(t){return new An(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function fG(t){return _n(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function g6(t,e,n){return{name:FC(t,e),fields:n.value.mapValue.fields}}function zfe(t,e){let n;if("targetChange"in e){e.targetChange;const o=function(y){return y==="NO_CHANGE"?0:y==="ADD"?1:y==="REMOVE"?2:y==="CURRENT"?3:y==="RESET"?4:lt()}(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],l=function(y,S){return y.wt?(_n(S===void 0||typeof S=="string"),di.fromBase64String(S||"")):(_n(S===void 0||S instanceof Uint8Array),di.fromUint8Array(S||new Uint8Array))}(t,e.targetChange.resumeToken),f=e.targetChange.cause,_=f&&function(y){const S=y.code===void 0?ye.UNKNOWN:sG(y.code);return new qe(S,y.message||"")}(f);n=new dG(o,c,l,_||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const c=RI(t,o.document.name),l=Lo(o.document.updateTime),f=o.document.createTime?Lo(o.document.createTime):yt.min(),_=new Pi({mapValue:{fields:o.document.fields}}),y=ii.newFoundDocument(c,l,f,_),S=o.targetIds||[],R=o.removedTargetIds||[];n=new g_(S,R,y.key,y)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const c=RI(t,o.document),l=o.readTime?Lo(o.readTime):yt.min(),f=ii.newNoDocument(c,l),_=o.removedTargetIds||[];n=new g_([],_,f.key,f)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const c=RI(t,o.document),l=o.removedTargetIds||[];n=new g_([],l,c,null)}else{if(!("filter"in e))return lt();{e.filter;const o=e.filter;o.targetId;const c=o.count||0,l=new Mfe(c),f=o.targetId;n=new lG(f,l)}}return n}function Yfe(t,e){let n;if(e instanceof vm)n={update:g6(t,e.key,e.value)};else if(e instanceof dO)n={delete:FC(t,e.key)};else if(e instanceof zc)n={update:g6(t,e.key,e.data),updateMask:ime(e.fieldMask)};else{if(!(e instanceof Lfe))return lt();n={verify:FC(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(o=>function(c,l){const f=l.transform;if(f instanceof yv)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(f instanceof th)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:f.elements}};if(f instanceof nh)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:f.elements}};if(f instanceof Sv)return{fieldPath:l.field.canonicalString(),increment:f.gt};throw lt()}(0,o))),e.precondition.isNone||(n.currentDocument=function(o,c){return c.updateTime!==void 0?{updateTime:Kfe(o,c.updateTime)}:c.exists!==void 0?{exists:c.exists}:lt()}(t,e.precondition)),n}function Xfe(t,e){return t&&t.length>0?(_n(e!==void 0),t.map(n=>function(o,c){let l=o.updateTime?Lo(o.updateTime):Lo(c);return l.isEqual(yt.min())&&(l=Lo(c)),new Pfe(l,o.transformResults||[])}(n,e))):[]}function Jfe(t,e){return{documents:[jC(t,e.path)]}}function Qfe(t,e){const n={structuredQuery:{}},o=e.path;e.collectionGroup!==null?(n.parent=jC(t,o),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=jC(t,o.popLast()),n.structuredQuery.from=[{collectionId:o.lastSegment()}]);const c=function(y){if(y.length!==0)return gG(Uo.create(y,"and"))}(e.filters);c&&(n.structuredQuery.where=c);const l=function(y){if(y.length!==0)return y.map(S=>function(R){return{field:ld(R.field),direction:tme(R.dir)}}(S))}(e.orderBy);l&&(n.structuredQuery.orderBy=l);const f=function(y,S){return y.wt||q1(S)?S:{value:S}}(t,e.limit);var _;return f!==null&&(n.structuredQuery.limit=f),e.startAt&&(n.structuredQuery.startAt={before:(_=e.startAt).inclusive,values:_.position}),e.endAt&&(n.structuredQuery.endAt=function(y){return{before:!y.inclusive,values:y.position}}(e.endAt)),n}function Zfe(t){let e=qfe(t.parent);const n=t.structuredQuery,o=n.from?n.from.length:0;let c=null;if(o>0){_n(o===1);const R=n.from[0];R.allDescendants?c=R.collectionId:e=e.child(R.collectionId)}let l=[];n.where&&(l=function(R){const w=mG(R);return w instanceof Uo&&WB(w)?w.getFilters():[w]}(n.where));let f=[];n.orderBy&&(f=n.orderBy.map(R=>function(w){return new Qp(dd(w.field),function(b){switch(b){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(R)));let _=null;n.limit&&(_=function(R){let w;return w=typeof R=="object"?R.value:R,q1(w)?null:w}(n.limit));let y=null;n.startAt&&(y=function(R){const w=!!R.before,b=R.values||[];return new vv(b,w)}(n.startAt));let S=null;return n.endAt&&(S=function(R){const w=!R.before,b=R.values||[];return new vv(b,w)}(n.endAt)),Sfe(e,c,f,l,_,"F",y,S)}function eme(t,e){const n=function(o,c){switch(c){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return lt()}}(0,e.purpose);return n==null?null:{"goog-listen-tags":n}}function mG(t){return t.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=dd(e.unaryFilter.field);return gr.create(n,"==",{doubleValue:NaN});case"IS_NULL":const o=dd(e.unaryFilter.field);return gr.create(o,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const c=dd(e.unaryFilter.field);return gr.create(c,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=dd(e.unaryFilter.field);return gr.create(l,"!=",{nullValue:"NULL_VALUE"});default:return lt()}}(t):t.fieldFilter!==void 0?function(e){return gr.create(dd(e.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return lt()}}(e.fieldFilter.op),e.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(e){return Uo.create(e.compositeFilter.filters.map(n=>mG(n)),function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return lt()}}(e.compositeFilter.op))}(t):lt()}function tme(t){return Gfe[t]}function nme(t){return Wfe[t]}function rme(t){return Hfe[t]}function ld(t){return{fieldPath:t.canonicalString()}}function dd(t){return si.fromServerFormat(t.fieldPath)}function gG(t){return t instanceof gr?function(e){if(e.op==="=="){if(r6(e.value))return{unaryFilter:{field:ld(e.field),op:"IS_NAN"}};if(n6(e.value))return{unaryFilter:{field:ld(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(r6(e.value))return{unaryFilter:{field:ld(e.field),op:"IS_NOT_NAN"}};if(n6(e.value))return{unaryFilter:{field:ld(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ld(e.field),op:nme(e.op),value:e.value}}}(t):t instanceof Uo?function(e){const n=e.getFilters().map(o=>gG(o));return n.length===1?n[0]:{compositeFilter:{op:rme(e.op),filters:n}}}(t):lt()}function ime(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function EG(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sme{constructor(e,n,o,c){this.batchId=e,this.localWriteTime=n,this.baseMutations=o,this.mutations=c}applyToRemoteDocument(e,n){const o=n.mutationResults;for(let c=0;c<this.mutations.length;c++){const l=this.mutations[c];l.key.isEqual(e.key)&&Dfe(l,e,o[c])}}applyToLocalView(e,n){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(n=Zp(o,e,n,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(n=Zp(o,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const o=cG();return this.mutations.forEach(c=>{const l=e.get(c.key),f=l.overlayedDocument;let _=this.applyToLocalView(f,l.mutatedFields);_=n.has(c.key)?null:_;const y=rG(f,_);y!==null&&o.set(c.key,y),f.isValidDocument()||f.convertToNoDocument(yt.min())}),o}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Lt())}isEqual(e){return this.batchId===e.batchId&&Jd(this.mutations,e.mutations,(n,o)=>l6(n,o))&&Jd(this.baseMutations,e.baseMutations,(n,o)=>l6(n,o))}}class pO{constructor(e,n,o,c){this.batch=e,this.commitVersion=n,this.mutationResults=o,this.docVersions=c}static from(e,n,o){_n(e.mutations.length===o.length);let c=Vfe;const l=e.mutations;for(let f=0;f<l.length;f++)c=c.insert(l[f].key,o[f].version);return new pO(e,n,o,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ome{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,n,o,c,l=yt.min(),f=yt.min(),_=di.EMPTY_BYTE_STRING){this.target=e,this.targetId=n,this.purpose=o,this.sequenceNumber=c,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=_}withSequenceNumber(e){return new ju(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,n){return new ju(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ju(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ame{constructor(e){this.ie=e}}function cme(t){const e=Zfe({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?UC(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ume{constructor(){this.Je=new lme}addToCollectionParentIndex(e,n){return this.Je.add(n),Re.resolve()}getCollectionParents(e,n){return Re.resolve(this.Je.getEntries(n))}addFieldIndex(e,n){return Re.resolve()}deleteFieldIndex(e,n){return Re.resolve()}getDocumentsMatchingTarget(e,n){return Re.resolve(null)}getIndexType(e,n){return Re.resolve(0)}getFieldIndexes(e,n){return Re.resolve([])}getNextCollectionGroupToUpdate(e){return Re.resolve(null)}getMinOffset(e,n){return Re.resolve(Uc.min())}getMinOffsetFromCollectionGroup(e,n){return Re.resolve(Uc.min())}updateCollectionGroup(e,n,o){return Re.resolve()}updateIndexEntries(e,n){return Re.resolve()}}class lme{constructor(){this.index={}}add(e){const n=e.lastSegment(),o=e.popLast(),c=this.index[n]||new vr(An.comparator),l=!c.has(o);return this.index[n]=c.add(o),l}has(e){const n=e.lastSegment(),o=e.popLast(),c=this.index[n];return c&&c.has(o)}getEntries(e){return(this.index[e]||new vr(An.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new rh(0)}static vn(){return new rh(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dme{constructor(){this.changes=new Rh(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,ii.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const o=this.changes.get(n);return o!==void 0?Re.resolve(o):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hme{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pme{constructor(e,n,o,c){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=o,this.indexManager=c}getDocument(e,n){let o=null;return this.documentOverlayCache.getOverlay(e,n).next(c=>(o=c,this.remoteDocumentCache.getEntry(e,n))).next(c=>(o!==null&&Zp(o.mutation,c,os.empty(),_r.now()),c))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(o=>this.getLocalViewOfDocuments(e,o,Lt()).next(()=>o))}getLocalViewOfDocuments(e,n,o=Lt()){const c=Lu();return this.populateOverlays(e,c,n).next(()=>this.computeViews(e,n,c,o).next(l=>{let f=Up();return l.forEach((_,y)=>{f=f.insert(_,y.overlayedDocument)}),f}))}getOverlayedDocuments(e,n){const o=Lu();return this.populateOverlays(e,o,n).next(()=>this.computeViews(e,n,o,Lt()))}populateOverlays(e,n,o){const c=[];return o.forEach(l=>{n.has(l)||c.push(l)}),this.documentOverlayCache.getOverlays(e,c).next(l=>{l.forEach((f,_)=>{n.set(f,_)})})}computeViews(e,n,o,c){let l=Na();const f=ef(),_=ef();return n.forEach((y,S)=>{const R=o.get(S.key);c.has(S.key)&&(R===void 0||R.mutation instanceof zc)?l=l.insert(S.key,S):R!==void 0?(f.set(S.key,R.mutation.getFieldMask()),Zp(R.mutation,S,R.mutation.getFieldMask(),_r.now())):f.set(S.key,os.empty())}),this.recalculateAndSaveOverlays(e,l).next(y=>(y.forEach((S,R)=>f.set(S,R)),n.forEach((S,R)=>{var w;return _.set(S,new hme(R,(w=f.get(S))!==null&&w!==void 0?w:null))}),_))}recalculateAndSaveOverlays(e,n){const o=ef();let c=new Sr((f,_)=>f-_),l=Lt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(f=>{for(const _ of f)_.keys().forEach(y=>{const S=n.get(y);if(S===null)return;let R=o.get(y)||os.empty();R=_.applyToLocalView(S,R),o.set(y,R);const w=(c.get(_.batchId)||Lt()).add(y);c=c.insert(_.batchId,w)})}).next(()=>{const f=[],_=c.getReverseIterator();for(;_.hasNext();){const y=_.getNext(),S=y.key,R=y.value,w=cG();R.forEach(b=>{if(!l.has(b)){const k=rG(n.get(b),o.get(b));k!==null&&w.set(b,k),l=l.add(b)}}),f.push(this.documentOverlayCache.saveOverlays(e,S,w))}return Re.waitFor(f)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,n,o){return function(c){return ze.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Ife(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,o):this.getDocumentsMatchingCollectionQuery(e,n,o)}getNextDocuments(e,n,o,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,o,c).next(l=>{const f=c-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,o.largestBatchId,c-l.size):Re.resolve(Lu());let _=-1,y=l;return f.next(S=>Re.forEach(S,(R,w)=>(_<w.largestBatchId&&(_=w.largestBatchId),l.get(R)?Re.resolve():this.remoteDocumentCache.getEntry(e,R).next(b=>{y=y.insert(R,b)}))).next(()=>this.populateOverlays(e,S,l)).next(()=>this.computeViews(e,y,S,Lt())).next(R=>({batchId:_,changes:aG(R)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ze(n)).next(o=>{let c=Up();return o.isFoundDocument()&&(c=c.insert(o.key,o)),c})}getDocumentsMatchingCollectionGroupQuery(e,n,o){const c=n.collectionGroup;let l=Up();return this.indexManager.getCollectionParents(e,c).next(f=>Re.forEach(f,_=>{const y=function(S,R){return new z1(R,null,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,S.startAt,S.endAt)}(n,_.child(c));return this.getDocumentsMatchingCollectionQuery(e,y,o).next(S=>{S.forEach((R,w)=>{l=l.insert(R,w)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(e,n,o){let c;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,o.largestBatchId).next(l=>(c=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,o,c))).next(l=>{c.forEach((_,y)=>{const S=y.getKey();l.get(S)===null&&(l=l.insert(S,ii.newInvalidDocument(S)))});let f=Up();return l.forEach((_,y)=>{const S=c.get(_);S!==void 0&&Zp(S.mutation,y,os.empty(),_r.now()),J1(n,y)&&(f=f.insert(_,y))}),f})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fme{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,n){return Re.resolve(this.Zn.get(n))}saveBundleMetadata(e,n){var o;return this.Zn.set(n.id,{id:(o=n).id,version:o.version,createTime:Lo(o.createTime)}),Re.resolve()}getNamedQuery(e,n){return Re.resolve(this.ts.get(n))}saveNamedQuery(e,n){return this.ts.set(n.name,function(o){return{name:o.name,query:cme(o.bundledQuery),readTime:Lo(o.readTime)}}(n)),Re.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mme{constructor(){this.overlays=new Sr(ze.comparator),this.es=new Map}getOverlay(e,n){return Re.resolve(this.overlays.get(n))}getOverlays(e,n){const o=Lu();return Re.forEach(n,c=>this.getOverlay(e,c).next(l=>{l!==null&&o.set(c,l)})).next(()=>o)}saveOverlays(e,n,o){return o.forEach((c,l)=>{this.oe(e,n,l)}),Re.resolve()}removeOverlaysForBatchId(e,n,o){const c=this.es.get(o);return c!==void 0&&(c.forEach(l=>this.overlays=this.overlays.remove(l)),this.es.delete(o)),Re.resolve()}getOverlaysForCollection(e,n,o){const c=Lu(),l=n.length+1,f=new ze(n.child("")),_=this.overlays.getIteratorFrom(f);for(;_.hasNext();){const y=_.getNext().value,S=y.getKey();if(!n.isPrefixOf(S.path))break;S.path.length===l&&y.largestBatchId>o&&c.set(y.getKey(),y)}return Re.resolve(c)}getOverlaysForCollectionGroup(e,n,o,c){let l=new Sr((S,R)=>S-R);const f=this.overlays.getIterator();for(;f.hasNext();){const S=f.getNext().value;if(S.getKey().getCollectionGroup()===n&&S.largestBatchId>o){let R=l.get(S.largestBatchId);R===null&&(R=Lu(),l=l.insert(S.largestBatchId,R)),R.set(S.getKey(),S)}}const _=Lu(),y=l.getIterator();for(;y.hasNext()&&(y.getNext().value.forEach((S,R)=>_.set(S,R)),!(_.size()>=c)););return Re.resolve(_)}oe(e,n,o){const c=this.overlays.get(o.key);if(c!==null){const f=this.es.get(c.largestBatchId).delete(o.key);this.es.set(c.largestBatchId,f)}this.overlays=this.overlays.insert(o.key,new ome(n,o));let l=this.es.get(n);l===void 0&&(l=Lt(),this.es.set(n,l)),this.es.set(n,l.add(o.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fO{constructor(){this.ns=new vr(Cr.ss),this.rs=new vr(Cr.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,n){const o=new Cr(e,n);this.ns=this.ns.add(o),this.rs=this.rs.add(o)}us(e,n){e.forEach(o=>this.addReference(o,n))}removeReference(e,n){this.cs(new Cr(e,n))}hs(e,n){e.forEach(o=>this.removeReference(o,n))}ls(e){const n=new ze(new An([])),o=new Cr(n,e),c=new Cr(n,e+1),l=[];return this.rs.forEachInRange([o,c],f=>{this.cs(f),l.push(f.key)}),l}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const n=new ze(new An([])),o=new Cr(n,e),c=new Cr(n,e+1);let l=Lt();return this.rs.forEachInRange([o,c],f=>{l=l.add(f.key)}),l}containsKey(e){const n=new Cr(e,0),o=this.ns.firstAfterOrEqual(n);return o!==null&&e.isEqual(o.key)}}class Cr{constructor(e,n){this.key=e,this._s=n}static ss(e,n){return ze.comparator(e.key,n.key)||Yt(e._s,n._s)}static os(e,n){return Yt(e._s,n._s)||ze.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gme{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.ws=1,this.gs=new vr(Cr.ss)}checkEmpty(e){return Re.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,o,c){const l=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new sme(l,n,o,c);this.mutationQueue.push(f);for(const _ of c)this.gs=this.gs.add(new Cr(_.key,l)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return Re.resolve(f)}lookupMutationBatch(e,n){return Re.resolve(this.ys(n))}getNextMutationBatchAfterBatchId(e,n){const o=n+1,c=this.ps(o),l=c<0?0:c;return Re.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return Re.resolve(this.mutationQueue.length===0?-1:this.ws-1)}getAllMutationBatches(e){return Re.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const o=new Cr(n,0),c=new Cr(n,Number.POSITIVE_INFINITY),l=[];return this.gs.forEachInRange([o,c],f=>{const _=this.ys(f._s);l.push(_)}),Re.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,n){let o=new vr(Yt);return n.forEach(c=>{const l=new Cr(c,0),f=new Cr(c,Number.POSITIVE_INFINITY);this.gs.forEachInRange([l,f],_=>{o=o.add(_._s)})}),Re.resolve(this.Is(o))}getAllMutationBatchesAffectingQuery(e,n){const o=n.path,c=o.length+1;let l=o;ze.isDocumentKey(l)||(l=l.child(""));const f=new Cr(new ze(l),0);let _=new vr(Yt);return this.gs.forEachWhile(y=>{const S=y.key.path;return!!o.isPrefixOf(S)&&(S.length===c&&(_=_.add(y._s)),!0)},f),Re.resolve(this.Is(_))}Is(e){const n=[];return e.forEach(o=>{const c=this.ys(o);c!==null&&n.push(c)}),n}removeMutationBatch(e,n){_n(this.Ts(n.batchId,"removed")===0),this.mutationQueue.shift();let o=this.gs;return Re.forEach(n.mutations,c=>{const l=new Cr(c.key,n.batchId);return o=o.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)}).next(()=>{this.gs=o})}An(e){}containsKey(e,n){const o=new Cr(n,0),c=this.gs.firstAfterOrEqual(o);return Re.resolve(n.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,Re.resolve()}Ts(e,n){return this.ps(e)}ps(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ys(e){const n=this.ps(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eme{constructor(e){this.Es=e,this.docs=new Sr(ze.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const o=n.key,c=this.docs.get(o),l=c?c.size:0,f=this.Es(n);return this.docs=this.docs.insert(o,{document:n.mutableCopy(),size:f}),this.size+=f-l,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const o=this.docs.get(n);return Re.resolve(o?o.document.mutableCopy():ii.newInvalidDocument(n))}getEntries(e,n){let o=Na();return n.forEach(c=>{const l=this.docs.get(c);o=o.insert(c,l?l.document.mutableCopy():ii.newInvalidDocument(c))}),Re.resolve(o)}getDocumentsMatchingQuery(e,n,o,c){let l=Na();const f=n.path,_=new ze(f.child("")),y=this.docs.getIteratorFrom(_);for(;y.hasNext();){const{key:S,value:{document:R}}=y.getNext();if(!f.isPrefixOf(S.path))break;S.path.length>f.length+1||ife(rfe(R),o)<=0||(c.has(R.key)||J1(n,R))&&(l=l.insert(R.key,R.mutableCopy()))}return Re.resolve(l)}getAllFromCollectionGroup(e,n,o,c){lt()}As(e,n){return Re.forEach(this.docs,o=>n(o))}newChangeBuffer(e){return new _me(this)}getSize(e){return Re.resolve(this.size)}}class _me extends dme{constructor(e){super(),this.Yn=e}applyChanges(e){const n=[];return this.changes.forEach((o,c)=>{c.isValidDocument()?n.push(this.Yn.addEntry(e,c)):this.Yn.removeEntry(o)}),Re.waitFor(n)}getFromCache(e,n){return this.Yn.getEntry(e,n)}getAllFromCache(e,n){return this.Yn.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vme{constructor(e){this.persistence=e,this.Rs=new Rh(n=>uO(n),lO),this.lastRemoteSnapshotVersion=yt.min(),this.highestTargetId=0,this.bs=0,this.Ps=new fO,this.targetCount=0,this.vs=rh.Pn()}forEachTarget(e,n){return this.Rs.forEach((o,c)=>n(c)),Re.resolve()}getLastRemoteSnapshotVersion(e){return Re.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Re.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),Re.resolve(this.highestTargetId)}setTargetsMetadata(e,n,o){return o&&(this.lastRemoteSnapshotVersion=o),n>this.bs&&(this.bs=n),Re.resolve()}Dn(e){this.Rs.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.vs=new rh(n),this.highestTargetId=n),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,n){return this.Dn(n),this.targetCount+=1,Re.resolve()}updateTargetData(e,n){return this.Dn(n),Re.resolve()}removeTargetData(e,n){return this.Rs.delete(n.target),this.Ps.ls(n.targetId),this.targetCount-=1,Re.resolve()}removeTargets(e,n,o){let c=0;const l=[];return this.Rs.forEach((f,_)=>{_.sequenceNumber<=n&&o.get(_.targetId)===null&&(this.Rs.delete(f),l.push(this.removeMatchingKeysForTargetId(e,_.targetId)),c++)}),Re.waitFor(l).next(()=>c)}getTargetCount(e){return Re.resolve(this.targetCount)}getTargetData(e,n){const o=this.Rs.get(n)||null;return Re.resolve(o)}addMatchingKeys(e,n,o){return this.Ps.us(n,o),Re.resolve()}removeMatchingKeys(e,n,o){this.Ps.hs(n,o);const c=this.persistence.referenceDelegate,l=[];return c&&n.forEach(f=>{l.push(c.markPotentiallyOrphaned(e,f))}),Re.waitFor(l)}removeMatchingKeysForTargetId(e,n){return this.Ps.ls(n),Re.resolve()}getMatchingKeysForTargetId(e,n){const o=this.Ps.ds(n);return Re.resolve(o)}containsKey(e,n){return Re.resolve(this.Ps.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yme{constructor(e,n){this.Vs={},this.overlays={},this.Ss=new aO(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new vme(this),this.indexManager=new ume,this.remoteDocumentCache=function(o){return new Eme(o)}(o=>this.referenceDelegate.xs(o)),this.yt=new ame(n),this.Ns=new fme(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new mme,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let o=this.Vs[e.toKey()];return o||(o=new gme(n,this.referenceDelegate),this.Vs[e.toKey()]=o),o}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,n,o){$e("MemoryPersistence","Starting transaction:",e);const c=new Sme(this.Ss.next());return this.referenceDelegate.ks(),o(c).next(l=>this.referenceDelegate.Os(c).next(()=>l)).toPromise().then(l=>(c.raiseOnCommittedEvent(),l))}Ms(e,n){return Re.or(Object.values(this.Vs).map(o=>()=>o.containsKey(e,n)))}}class Sme extends ofe{constructor(e){super(),this.currentSequenceNumber=e}}class mO{constructor(e){this.persistence=e,this.Fs=new fO,this.$s=null}static Bs(e){return new mO(e)}get Ls(){if(this.$s)return this.$s;throw lt()}addReference(e,n,o){return this.Fs.addReference(o,n),this.Ls.delete(o.toString()),Re.resolve()}removeReference(e,n,o){return this.Fs.removeReference(o,n),this.Ls.add(o.toString()),Re.resolve()}markPotentiallyOrphaned(e,n){return this.Ls.add(n.toString()),Re.resolve()}removeTarget(e,n){this.Fs.ls(n.targetId).forEach(c=>this.Ls.add(c.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,n.targetId).next(c=>{c.forEach(l=>this.Ls.add(l.toString()))}).next(()=>o.removeTargetData(e,n))}ks(){this.$s=new Set}Os(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Re.forEach(this.Ls,o=>{const c=ze.fromPath(o);return this.qs(e,c).next(l=>{l||n.removeEntry(c,yt.min())})}).next(()=>(this.$s=null,n.apply(e)))}updateLimboDocument(e,n){return this.qs(e,n).next(o=>{o?this.Ls.delete(n.toString()):this.Ls.add(n.toString())})}xs(e){return 0}qs(e,n){return Re.or([()=>Re.resolve(this.Fs.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ms(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(e,n,o,c){this.targetId=e,this.fromCache=n,this.Si=o,this.Di=c}static Ci(e,n){let o=Lt(),c=Lt();for(const l of n.docChanges)switch(l.type){case 0:o=o.add(l.doc.key);break;case 1:c=c.add(l.doc.key)}return new gO(e,n.fromCache,o,c)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tme{constructor(){this.xi=!1}initialize(e,n){this.Ni=e,this.indexManager=n,this.xi=!0}getDocumentsMatchingQuery(e,n,o,c){return this.ki(e,n).next(l=>l||this.Oi(e,n,c,o)).next(l=>l||this.Mi(e,n))}ki(e,n){if(c6(n))return Re.resolve(null);let o=Oa(n);return this.indexManager.getIndexType(e,o).next(c=>c===0?null:(n.limit!==null&&c===1&&(n=UC(n,null,"F"),o=Oa(n)),this.indexManager.getDocumentsMatchingTarget(e,o).next(l=>{const f=Lt(...l);return this.Ni.getDocuments(e,f).next(_=>this.indexManager.getMinOffset(e,o).next(y=>{const S=this.Fi(n,_);return this.$i(n,S,f,y.readTime)?this.ki(e,UC(n,null,"F")):this.Bi(e,S,n,y)}))})))}Oi(e,n,o,c){return c6(n)||c.isEqual(yt.min())?this.Mi(e,n):this.Ni.getDocuments(e,o).next(l=>{const f=this.Fi(n,l);return this.$i(n,f,o,c)?this.Mi(e,n):(ZV()<=Kt.DEBUG&&$e("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),VC(n)),this.Bi(e,f,n,nfe(c,-1)))})}Fi(e,n){let o=new vr(YB(e));return n.forEach((c,l)=>{J1(e,l)&&(o=o.add(l))}),o}$i(e,n,o,c){if(e.limit===null)return!1;if(o.size!==n.size)return!0;const l=e.limitType==="F"?n.last():n.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(c)>0)}Mi(e,n){return ZV()<=Kt.DEBUG&&$e("QueryEngine","Using full collection scan to execute query:",VC(n)),this.Ni.getDocumentsMatchingQuery(e,n,Uc.min())}Bi(e,n,o,c){return this.Ni.getDocumentsMatchingQuery(e,o,c).next(l=>(n.forEach(f=>{l=l.insert(f.key,f)}),l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rme{constructor(e,n,o,c){this.persistence=e,this.Li=n,this.yt=c,this.qi=new Sr(Yt),this.Ui=new Rh(l=>uO(l),lO),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(o)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new pme(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.qi))}}function Ime(t,e,n,o){return new Rme(t,e,n,o)}async function _G(t,e){const n=St(t);return await n.persistence.runTransaction("Handle user change","readonly",o=>{let c;return n.mutationQueue.getAllMutationBatches(o).next(l=>(c=l,n.Qi(e),n.mutationQueue.getAllMutationBatches(o))).next(l=>{const f=[],_=[];let y=Lt();for(const S of c){f.push(S.batchId);for(const R of S.mutations)y=y.add(R.key)}for(const S of l){_.push(S.batchId);for(const R of S.mutations)y=y.add(R.key)}return n.localDocuments.getDocuments(o,y).next(S=>({ji:S,removedBatchIds:f,addedBatchIds:_}))})})}function wme(t,e){const n=St(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const c=e.batch.keys(),l=n.Gi.newChangeBuffer({trackRemovals:!0});return function(f,_,y,S){const R=y.batch,w=R.keys();let b=Re.resolve();return w.forEach(k=>{b=b.next(()=>S.getEntry(_,k)).next(M=>{const F=y.docVersions.get(k);_n(F!==null),M.version.compareTo(F)<0&&(R.applyToRemoteDocument(M,y),M.isValidDocument()&&(M.setReadTime(y.commitVersion),S.addEntry(M)))})}),b.next(()=>f.mutationQueue.removeMutationBatch(_,R))}(n,o,e,l).next(()=>l.apply(o)).next(()=>n.mutationQueue.performConsistencyCheck(o)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(o,c,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(f){let _=Lt();for(let y=0;y<f.mutationResults.length;++y)f.mutationResults[y].transformResults.length>0&&(_=_.add(f.batch.mutations[y].key));return _}(e))).next(()=>n.localDocuments.getDocuments(o,c))})}function vG(t){const e=St(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Cs.getLastRemoteSnapshotVersion(n))}function Cme(t,e){const n=St(t),o=e.snapshotVersion;let c=n.qi;return n.persistence.runTransaction("Apply remote event","readwrite-primary",l=>{const f=n.Gi.newChangeBuffer({trackRemovals:!0});c=n.qi;const _=[];e.targetChanges.forEach((R,w)=>{const b=c.get(w);if(!b)return;_.push(n.Cs.removeMatchingKeys(l,R.removedDocuments,w).next(()=>n.Cs.addMatchingKeys(l,R.addedDocuments,w)));let k=b.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.has(w)?k=k.withResumeToken(di.EMPTY_BYTE_STRING,yt.min()).withLastLimboFreeSnapshotVersion(yt.min()):R.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(R.resumeToken,o)),c=c.insert(w,k),function(M,F,Y){return M.resumeToken.approximateByteSize()===0||F.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=3e8?!0:Y.addedDocuments.size+Y.modifiedDocuments.size+Y.removedDocuments.size>0}(b,k,R)&&_.push(n.Cs.updateTargetData(l,k))});let y=Na(),S=Lt();if(e.documentUpdates.forEach(R=>{e.resolvedLimboDocuments.has(R)&&_.push(n.persistence.referenceDelegate.updateLimboDocument(l,R))}),_.push(Ame(l,f,e.documentUpdates).next(R=>{y=R.Wi,S=R.zi})),!o.isEqual(yt.min())){const R=n.Cs.getLastRemoteSnapshotVersion(l).next(w=>n.Cs.setTargetsMetadata(l,l.currentSequenceNumber,o));_.push(R)}return Re.waitFor(_).next(()=>f.apply(l)).next(()=>n.localDocuments.getLocalViewOfDocuments(l,y,S)).next(()=>y)}).then(l=>(n.qi=c,l))}function Ame(t,e,n){let o=Lt(),c=Lt();return n.forEach(l=>o=o.add(l)),e.getEntries(t,o).next(l=>{let f=Na();return n.forEach((_,y)=>{const S=l.get(_);y.isFoundDocument()!==S.isFoundDocument()&&(c=c.add(_)),y.isNoDocument()&&y.version.isEqual(yt.min())?(e.removeEntry(_,y.readTime),f=f.insert(_,y)):!S.isValidDocument()||y.version.compareTo(S.version)>0||y.version.compareTo(S.version)===0&&S.hasPendingWrites?(e.addEntry(y),f=f.insert(_,y)):$e("LocalStore","Ignoring outdated watch update for ",_,". Current version:",S.version," Watch version:",y.version)}),{Wi:f,zi:c}})}function bme(t,e){const n=St(t);return n.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function Ome(t,e){const n=St(t);return n.persistence.runTransaction("Allocate target","readwrite",o=>{let c;return n.Cs.getTargetData(o,e).next(l=>l?(c=l,Re.resolve(c)):n.Cs.allocateTargetId(o).next(f=>(c=new ju(e,f,0,o.currentSequenceNumber),n.Cs.addTargetData(o,c).next(()=>c))))}).then(o=>{const c=n.qi.get(o.targetId);return(c===null||o.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(n.qi=n.qi.insert(o.targetId,o),n.Ui.set(e,o.targetId)),o})}async function GC(t,e,n){const o=St(t),c=o.qi.get(e),l=n?"readwrite":"readwrite-primary";try{n||await o.persistence.runTransaction("Release target",l,f=>o.persistence.referenceDelegate.removeTarget(f,c))}catch(f){if(!_m(f))throw f;$e("LocalStore",`Failed to update sequence numbers for target ${e}: ${f}`)}o.qi=o.qi.remove(e),o.Ui.delete(c.target)}function E6(t,e,n){const o=St(t);let c=yt.min(),l=Lt();return o.persistence.runTransaction("Execute query","readonly",f=>function(_,y,S){const R=St(_),w=R.Ui.get(S);return w!==void 0?Re.resolve(R.qi.get(w)):R.Cs.getTargetData(y,S)}(o,f,Oa(e)).next(_=>{if(_)return c=_.lastLimboFreeSnapshotVersion,o.Cs.getMatchingKeysForTargetId(f,_.targetId).next(y=>{l=y})}).next(()=>o.Li.getDocumentsMatchingQuery(f,e,n?c:yt.min(),n?l:Lt())).next(_=>(Nme(o,wfe(e),_),{documents:_,Hi:l})))}function Nme(t,e,n){let o=t.Ki.get(e)||yt.min();n.forEach((c,l)=>{l.readTime.compareTo(o)>0&&(o=l.readTime)}),t.Ki.set(e,o)}class _6{constructor(){this.activeTargetIds=uG()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Pme{constructor(){this.Lr=new _6,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,o){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,n,o){this.qr[e]=n}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new _6,Promise.resolve()}handleUserChange(e,n,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dme{Ur(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){$e("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){$e("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kme={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lme{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mme extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http";this.oo=n+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,n,o,c,l){const f=this.ho(e,n);$e("RestConnection","Sending: ",f,o);const _={};return this.lo(_,c,l),this.fo(e,f,_,o).then(y=>($e("RestConnection","Received: ",y),y),y=>{throw DC("RestConnection",`${e} failed with error: `,y,"url: ",f,"request:",o),y})}_o(e,n,o,c,l,f){return this.ao(e,n,o,c,l)}lo(e,n,o){e["X-Goog-Api-Client"]="gl-js/ fire/"+Th,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((c,l)=>e[l]=c),o&&o.headers.forEach((c,l)=>e[l]=c)}ho(e,n){const o=kme[e];return`${this.oo}/v1/${n}:${o}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,n,o,c){return new Promise((l,f)=>{const _=new Kpe;_.setWithCredentials(!0),_.listenOnce(Wpe.COMPLETE,()=>{try{switch(_.getLastErrorCode()){case TI.NO_ERROR:const S=_.getResponseJson();$e("Connection","XHR received:",JSON.stringify(S)),l(S);break;case TI.TIMEOUT:$e("Connection",'RPC "'+e+'" timed out'),f(new qe(ye.DEADLINE_EXCEEDED,"Request time out"));break;case TI.HTTP_ERROR:const R=_.getStatus();if($e("Connection",'RPC "'+e+'" failed with status:',R,"response text:",_.getResponseText()),R>0){let w=_.getResponseJson();Array.isArray(w)&&(w=w[0]);const b=w==null?void 0:w.error;if(b&&b.status&&b.message){const k=function(M){const F=M.toLowerCase().replace(/_/g,"-");return Object.values(ye).indexOf(F)>=0?F:ye.UNKNOWN}(b.status);f(new qe(k,b.message))}else f(new qe(ye.UNKNOWN,"Server responded with status "+_.getStatus()))}else f(new qe(ye.UNAVAILABLE,"Connection failed."));break;default:lt()}}finally{$e("Connection",'RPC "'+e+'" completed.')}});const y=JSON.stringify(c);_.send(n,"POST",y,o,15)})}wo(e,n,o){const c=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=Bpe(),f=Gpe(),_={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(_.xmlHttpFactory=new $pe({})),this.lo(_.initMessageHeaders,n,o),_.encodeInitMessageHeaders=!0;const y=c.join("");$e("Connection","Creating WebChannel: "+y,_);const S=l.createWebChannel(y,_);let R=!1,w=!1;const b=new Lme({Hr:M=>{w?$e("Connection","Not sending because WebChannel is closed:",M):(R||($e("Connection","Opening WebChannel transport."),S.open(),R=!0),$e("Connection","WebChannel sending:",M),S.send(M))},Jr:()=>S.close()}),k=(M,F,Y)=>{M.listen(F,H=>{try{Y(H)}catch(B){setTimeout(()=>{throw B},0)}})};return k(S,HE.EventType.OPEN,()=>{w||$e("Connection","WebChannel transport opened.")}),k(S,HE.EventType.CLOSE,()=>{w||(w=!0,$e("Connection","WebChannel transport closed"),b.io())}),k(S,HE.EventType.ERROR,M=>{w||(w=!0,DC("Connection","WebChannel transport errored:",M),b.io(new qe(ye.UNAVAILABLE,"The operation could not be completed")))}),k(S,HE.EventType.MESSAGE,M=>{var F;if(!w){const Y=M.data[0];_n(!!Y);const H=Y,B=H.error||((F=H[0])===null||F===void 0?void 0:F.error);if(B){$e("Connection","WebChannel received error:",B);const K=B.status;let z=function(de){const Ee=sr[de];if(Ee!==void 0)return sG(Ee)}(K),oe=B.message;z===void 0&&(z=ye.INTERNAL,oe="Unknown error status: "+K+" with message "+B.message),w=!0,b.io(new qe(z,oe)),S.close()}else $e("Connection","WebChannel received:",Y),b.ro(Y)}}),k(f,Hpe.STAT_EVENT,M=>{M.stat===JV.PROXY?$e("Connection","Detected buffering proxy"):M.stat===JV.NOPROXY&&$e("Connection","Detected no buffering proxy")}),setTimeout(()=>{b.so()},0),b}}function II(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ty(t){return new $fe(t,!0)}class yG{constructor(e,n,o=1e3,c=1.5,l=6e4){this.Hs=e,this.timerId=n,this.mo=o,this.yo=c,this.po=l,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const n=Math.floor(this.Io+this.bo()),o=Math.max(0,Date.now()-this.Eo),c=Math.max(0,n-o);c>0&&$e("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Io} ms, delay with jitter: ${n} ms, last attempt: ${o} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,c,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SG{constructor(e,n,o,c,l,f,_,y){this.Hs=e,this.vo=o,this.Vo=c,this.connection=l,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=_,this.listener=y,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new yG(e,n)}No(){return this.state===1||this.state===5||this.ko()}ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&this.Do===null&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,n){this.Lo(),this.qo(),this.xo.cancel(),this.So++,e!==4?this.xo.reset():n&&n.code===ye.RESOURCE_EXHAUSTED?(ba(n.toString()),ba("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):n&&n.code===ye.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(n)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,c])=>{this.So===n&&this.Go(o,c)},o=>{e(()=>{const c=new qe(ye.UNKNOWN,"Fetching auth token failed: "+o.message);return this.Qo(c)})})}Go(e,n){const o=this.Ko(this.So);this.stream=this.jo(e,n),this.stream.Yr(()=>{o(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(c=>{o(()=>this.Qo(c))}),this.stream.onMessage(c=>{o(()=>this.onMessage(c))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return $e("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return n=>{this.Hs.enqueueAndForget(()=>this.So===e?n():($e("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class xme extends SG{constructor(e,n,o,c,l,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,o,c,f),this.yt=l}jo(e,n){return this.connection.wo("Listen",e,n)}onMessage(e){this.xo.reset();const n=zfe(this.yt,e),o=function(c){if(!("targetChange"in c))return yt.min();const l=c.targetChange;return l.targetIds&&l.targetIds.length?yt.min():l.readTime?Lo(l.readTime):yt.min()}(e);return this.listener.Wo(n,o)}zo(e){const n={};n.database=BC(this.yt),n.addTarget=function(c,l){let f;const _=l.target;return f=xC(_)?{documents:Jfe(c,_)}:{query:Qfe(c,_)},f.targetId=l.targetId,l.resumeToken.approximateByteSize()>0?f.resumeToken=hG(c,l.resumeToken):l.snapshotVersion.compareTo(yt.min())>0&&(f.readTime=Tv(c,l.snapshotVersion.toTimestamp())),f}(this.yt,e);const o=eme(this.yt,e);o&&(n.labels=o),this.Bo(n)}Ho(e){const n={};n.database=BC(this.yt),n.removeTarget=e,this.Bo(n)}}class Ume extends SG{constructor(e,n,o,c,l,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,o,c,f),this.yt=l,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,n){return this.connection.wo("Write",e,n)}onMessage(e){if(_n(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const n=Xfe(e.writeResults,e.commitTime),o=Lo(e.commitTime);return this.listener.Zo(o,n)}return _n(!e.writeResults||e.writeResults.length===0),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=BC(this.yt),this.Bo(e)}Xo(e){const n={streamToken:this.lastStreamToken,writes:e.map(o=>Yfe(this.yt,o))};this.Bo(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vme extends class{}{constructor(e,n,o,c){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=o,this.yt=c,this.nu=!1}su(){if(this.nu)throw new qe(ye.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,n,o){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,l])=>this.connection.ao(e,n,o,c,l)).catch(c=>{throw c.name==="FirebaseError"?(c.code===ye.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new qe(ye.UNKNOWN,c.toString())})}_o(e,n,o,c){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,f])=>this.connection._o(e,n,o,l,f,c)).catch(l=>{throw l.name==="FirebaseError"?(l.code===ye.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new qe(ye.UNKNOWN,l.toString())})}terminate(){this.nu=!0}}class Fme{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){this.iu===0&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){this.state==="Online"?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,e==="Online"&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(ba(n),this.ou=!1):$e("OnlineStateTracker",n)}lu(){this.ru!==null&&(this.ru.cancel(),this.ru=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jme{constructor(e,n,o,c,l){this.localStore=e,this.datastore=n,this.asyncQueue=o,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=l,this.mu.Ur(f=>{o.enqueueAndForget(async()=>{sl(this)&&($e("RemoteStore","Restarting streams for network reachability change."),await async function(_){const y=St(_);y._u.add(4),await Sm(y),y.gu.set("Unknown"),y._u.delete(4),await ny(y)}(this))})}),this.gu=new Fme(o,c)}}async function ny(t){if(sl(t))for(const e of t.wu)await e(!0)}async function Sm(t){for(const e of t.wu)await e(!1)}function TG(t,e){const n=St(t);n.du.has(e.targetId)||(n.du.set(e.targetId,e),vO(n)?_O(n):Ih(n).ko()&&EO(n,e))}function RG(t,e){const n=St(t),o=Ih(n);n.du.delete(e),o.ko()&&IG(n,e),n.du.size===0&&(o.ko()?o.Fo():sl(n)&&n.gu.set("Unknown"))}function EO(t,e){t.yu.Ot(e.targetId),Ih(t).zo(e)}function IG(t,e){t.yu.Ot(e),Ih(t).Ho(e)}function _O(t){t.yu=new Bfe({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>t.du.get(e)||null}),Ih(t).start(),t.gu.uu()}function vO(t){return sl(t)&&!Ih(t).No()&&t.du.size>0}function sl(t){return St(t)._u.size===0}function wG(t){t.yu=void 0}async function Bme(t){t.du.forEach((e,n)=>{EO(t,e)})}async function Gme(t,e){wG(t),vO(t)?(t.gu.hu(e),_O(t)):t.gu.set("Unknown")}async function Wme(t,e,n){if(t.gu.set("Online"),e instanceof dG&&e.state===2&&e.cause)try{await async function(o,c){const l=c.cause;for(const f of c.targetIds)o.du.has(f)&&(await o.remoteSyncer.rejectListen(f,l),o.du.delete(f),o.yu.removeTarget(f))}(t,e)}catch(o){$e("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),await Rv(t,o)}else if(e instanceof g_?t.yu.Kt(e):e instanceof lG?t.yu.Jt(e):t.yu.jt(e),!n.isEqual(yt.min()))try{const o=await vG(t.localStore);n.compareTo(o)>=0&&await function(c,l){const f=c.yu.Zt(l);return f.targetChanges.forEach((_,y)=>{if(_.resumeToken.approximateByteSize()>0){const S=c.du.get(y);S&&c.du.set(y,S.withResumeToken(_.resumeToken,l))}}),f.targetMismatches.forEach(_=>{const y=c.du.get(_);if(!y)return;c.du.set(_,y.withResumeToken(di.EMPTY_BYTE_STRING,y.snapshotVersion)),IG(c,_);const S=new ju(y.target,_,1,y.sequenceNumber);EO(c,S)}),c.remoteSyncer.applyRemoteEvent(f)}(t,n)}catch(o){$e("RemoteStore","Failed to raise snapshot:",o),await Rv(t,o)}}async function Rv(t,e,n){if(!_m(e))throw e;t._u.add(1),await Sm(t),t.gu.set("Offline"),n||(n=()=>vG(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{$e("RemoteStore","Retrying IndexedDB access"),await n(),t._u.delete(1),await ny(t)})}function CG(t,e){return e().catch(n=>Rv(t,n,e))}async function ry(t){const e=St(t),n=Fc(e);let o=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;Hme(e);)try{const c=await bme(e.localStore,o);if(c===null){e.fu.length===0&&n.Fo();break}o=c.batchId,$me(e,c)}catch(c){await Rv(e,c)}AG(e)&&bG(e)}function Hme(t){return sl(t)&&t.fu.length<10}function $me(t,e){t.fu.push(e);const n=Fc(t);n.ko()&&n.Yo&&n.Xo(e.mutations)}function AG(t){return sl(t)&&!Fc(t).No()&&t.fu.length>0}function bG(t){Fc(t).start()}async function Kme(t){Fc(t).eu()}async function qme(t){const e=Fc(t);for(const n of t.fu)e.Xo(n.mutations)}async function zme(t,e,n){const o=t.fu.shift(),c=pO.from(o,e,n);await CG(t,()=>t.remoteSyncer.applySuccessfulWrite(c)),await ry(t)}async function Yme(t,e){e&&Fc(t).Yo&&await async function(n,o){if(c=o.code,xfe(c)&&c!==ye.ABORTED){const l=n.fu.shift();Fc(n).Mo(),await CG(n,()=>n.remoteSyncer.rejectFailedWrite(l.batchId,o)),await ry(n)}var c}(t,e),AG(t)&&bG(t)}async function y6(t,e){const n=St(t);n.asyncQueue.verifyOperationInProgress(),$e("RemoteStore","RemoteStore received new credentials");const o=sl(n);n._u.add(3),await Sm(n),o&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n._u.delete(3),await ny(n)}async function Xme(t,e){const n=St(t);e?(n._u.delete(2),await ny(n)):e||(n._u.add(2),await Sm(n),n.gu.set("Unknown"))}function Ih(t){return t.pu||(t.pu=function(e,n,o){const c=St(e);return c.su(),new xme(n,c.connection,c.authCredentials,c.appCheckCredentials,c.yt,o)}(t.datastore,t.asyncQueue,{Yr:Bme.bind(null,t),Zr:Gme.bind(null,t),Wo:Wme.bind(null,t)}),t.wu.push(async e=>{e?(t.pu.Mo(),vO(t)?_O(t):t.gu.set("Unknown")):(await t.pu.stop(),wG(t))})),t.pu}function Fc(t){return t.Iu||(t.Iu=function(e,n,o){const c=St(e);return c.su(),new Ume(n,c.connection,c.authCredentials,c.appCheckCredentials,c.yt,o)}(t.datastore,t.asyncQueue,{Yr:Kme.bind(null,t),Zr:Yme.bind(null,t),tu:qme.bind(null,t),Zo:zme.bind(null,t)}),t.wu.push(async e=>{e?(t.Iu.Mo(),await ry(t)):(await t.Iu.stop(),t.fu.length>0&&($e("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))})),t.Iu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yO{constructor(e,n,o,c,l){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=o,this.op=c,this.removalCallback=l,this.deferred=new Oc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}static createAndSchedule(e,n,o,c,l){const f=Date.now()+o,_=new yO(e,n,f,c,l);return _.start(o),_}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new qe(ye.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function SO(t,e){if(ba("AsyncQueue",`${e}: ${t}`),_m(t))return new qe(ye.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd{constructor(e){this.comparator=e?(n,o)=>e(n,o)||ze.comparator(n.key,o.key):(n,o)=>ze.comparator(n.key,o.key),this.keyedMap=Up(),this.sortedSet=new Sr(this.comparator)}static emptySet(e){return new jd(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,o)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof jd)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;n.hasNext();){const c=n.getNext().key,l=o.getNext().key;if(!c.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const o=new jd;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=n,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S6{constructor(){this.Tu=new Sr(ze.comparator)}track(e){const n=e.doc.key,o=this.Tu.get(n);o?e.type!==0&&o.type===3?this.Tu=this.Tu.insert(n,e):e.type===3&&o.type!==1?this.Tu=this.Tu.insert(n,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.Tu=this.Tu.insert(n,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.Tu=this.Tu.insert(n,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.Tu=this.Tu.remove(n):e.type===1&&o.type===2?this.Tu=this.Tu.insert(n,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.Tu=this.Tu.insert(n,{type:2,doc:e.doc}):lt():this.Tu=this.Tu.insert(n,e)}Eu(){const e=[];return this.Tu.inorderTraversal((n,o)=>{e.push(o)}),e}}class ih{constructor(e,n,o,c,l,f,_,y,S){this.query=e,this.docs=n,this.oldDocs=o,this.docChanges=c,this.mutatedKeys=l,this.fromCache=f,this.syncStateChanged=_,this.excludesMetadataChanges=y,this.hasCachedResults=S}static fromInitialDocuments(e,n,o,c,l){const f=[];return n.forEach(_=>{f.push({type:0,doc:_})}),new ih(e,n,jd.emptySet(n),f,o,c,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&X1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,o=e.docChanges;if(n.length!==o.length)return!1;for(let c=0;c<n.length;c++)if(n[c].type!==o[c].type||!n[c].doc.isEqual(o[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jme{constructor(){this.Au=void 0,this.listeners=[]}}class Qme{constructor(){this.queries=new Rh(e=>zB(e),X1),this.onlineState="Unknown",this.Ru=new Set}}async function OG(t,e){const n=St(t),o=e.query;let c=!1,l=n.queries.get(o);if(l||(c=!0,l=new Jme),c)try{l.Au=await n.onListen(o)}catch(f){const _=SO(f,`Initialization of query '${VC(e.query)}' failed`);return void e.onError(_)}n.queries.set(o,l),l.listeners.push(e),e.bu(n.onlineState),l.Au&&e.Pu(l.Au)&&TO(n)}async function NG(t,e){const n=St(t),o=e.query;let c=!1;const l=n.queries.get(o);if(l){const f=l.listeners.indexOf(e);f>=0&&(l.listeners.splice(f,1),c=l.listeners.length===0)}if(c)return n.queries.delete(o),n.onUnlisten(o)}function Zme(t,e){const n=St(t);let o=!1;for(const c of e){const l=c.query,f=n.queries.get(l);if(f){for(const _ of f.listeners)_.Pu(c)&&(o=!0);f.Au=c}}o&&TO(n)}function ege(t,e,n){const o=St(t),c=o.queries.get(e);if(c)for(const l of c.listeners)l.onError(n);o.queries.delete(e)}function TO(t){t.Ru.forEach(e=>{e.next()})}class PG{constructor(e,n,o){this.query=e,this.vu=n,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=o||{}}Pu(e){if(!this.options.includeMetadataChanges){const o=[];for(const c of e.docChanges)c.type!==3&&o.push(c);e=new ih(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),n=!0):this.Cu(e,this.onlineState)&&(this.xu(e),n=!0),this.Su=e,n}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let n=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),n=!0),n}Cu(e,n){if(!e.fromCache)return!0;const o=n!=="Offline";return(!this.options.Nu||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Du(e){if(e.docChanges.length>0)return!0;const n=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}xu(e){e=ih.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DG{constructor(e){this.key=e}}class kG{constructor(e){this.key=e}}class tge{constructor(e,n){this.query=e,this.qu=n,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=Lt(),this.mutatedKeys=Lt(),this.Gu=YB(e),this.Qu=new jd(this.Gu)}get ju(){return this.qu}Wu(e,n){const o=n?n.zu:new S6,c=n?n.Qu:this.Qu;let l=n?n.mutatedKeys:this.mutatedKeys,f=c,_=!1;const y=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,S=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((R,w)=>{const b=c.get(R),k=J1(this.query,w)?w:null,M=!!b&&this.mutatedKeys.has(b.key),F=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let Y=!1;b&&k?b.data.isEqual(k.data)?M!==F&&(o.track({type:3,doc:k}),Y=!0):this.Hu(b,k)||(o.track({type:2,doc:k}),Y=!0,(y&&this.Gu(k,y)>0||S&&this.Gu(k,S)<0)&&(_=!0)):!b&&k?(o.track({type:0,doc:k}),Y=!0):b&&!k&&(o.track({type:1,doc:b}),Y=!0,(y||S)&&(_=!0)),Y&&(k?(f=f.add(k),l=F?l.add(R):l.delete(R)):(f=f.delete(R),l=l.delete(R)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const R=this.query.limitType==="F"?f.last():f.first();f=f.delete(R.key),l=l.delete(R.key),o.track({type:1,doc:R})}return{Qu:f,zu:o,$i:_,mutatedKeys:l}}Hu(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,o){const c=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const l=e.zu.Eu();l.sort((S,R)=>function(w,b){const k=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return lt()}};return k(w)-k(b)}(S.type,R.type)||this.Gu(S.doc,R.doc)),this.Ju(o);const f=n?this.Yu():[],_=this.Ku.size===0&&this.current?1:0,y=_!==this.Uu;return this.Uu=_,l.length!==0||y?{snapshot:new ih(this.query,e.Qu,c,l,e.mutatedKeys,_===0,y,!1,!!o&&o.resumeToken.approximateByteSize()>0),Xu:f}:{Xu:f}}bu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new S6,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(n=>this.qu=this.qu.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.qu=this.qu.delete(n)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=Lt(),this.Qu.forEach(o=>{this.Zu(o.key)&&(this.Ku=this.Ku.add(o.key))});const n=[];return e.forEach(o=>{this.Ku.has(o)||n.push(new kG(o))}),this.Ku.forEach(o=>{e.has(o)||n.push(new DG(o))}),n}tc(e){this.qu=e.Hi,this.Ku=Lt();const n=this.Wu(e.documents);return this.applyChanges(n,!0)}ec(){return ih.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.Uu===0,this.hasCachedResults)}}class nge{constructor(e,n,o){this.query=e,this.targetId=n,this.view=o}}class rge{constructor(e){this.key=e,this.nc=!1}}class ige{constructor(e,n,o,c,l,f){this.localStore=e,this.remoteStore=n,this.eventManager=o,this.sharedClientState=c,this.currentUser=l,this.maxConcurrentLimboResolutions=f,this.sc={},this.ic=new Rh(_=>zB(_),X1),this.rc=new Map,this.oc=new Set,this.uc=new Sr(ze.comparator),this.cc=new Map,this.ac=new fO,this.hc={},this.lc=new Map,this.fc=rh.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return this.dc===!0}}async function sge(t,e){const n=mge(t);let o,c;const l=n.ic.get(e);if(l)o=l.targetId,n.sharedClientState.addLocalQueryTarget(o),c=l.view.ec();else{const f=await Ome(n.localStore,Oa(e));n.isPrimaryClient&&TG(n.remoteStore,f);const _=n.sharedClientState.addLocalQueryTarget(f.targetId);o=f.targetId,c=await oge(n,e,o,_==="current",f.resumeToken)}return c}async function oge(t,e,n,o,c){t._c=(w,b,k)=>async function(M,F,Y,H){let B=F.view.Wu(Y);B.$i&&(B=await E6(M.localStore,F.query,!1).then(({documents:oe})=>F.view.Wu(oe,B)));const K=H&&H.targetChanges.get(F.targetId),z=F.view.applyChanges(B,M.isPrimaryClient,K);return R6(M,F.targetId,z.Xu),z.snapshot}(t,w,b,k);const l=await E6(t.localStore,e,!0),f=new tge(e,l.Hi),_=f.Wu(l.documents),y=ym.createSynthesizedTargetChangeForCurrentChange(n,o&&t.onlineState!=="Offline",c),S=f.applyChanges(_,t.isPrimaryClient,y);R6(t,n,S.Xu);const R=new nge(e,n,f);return t.ic.set(e,R),t.rc.has(n)?t.rc.get(n).push(e):t.rc.set(n,[e]),S.snapshot}async function age(t,e){const n=St(t),o=n.ic.get(e),c=n.rc.get(o.targetId);if(c.length>1)return n.rc.set(o.targetId,c.filter(l=>!X1(l,e))),void n.ic.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(o.targetId),n.sharedClientState.isActiveQueryTarget(o.targetId)||await GC(n.localStore,o.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(o.targetId),RG(n.remoteStore,o.targetId),WC(n,o.targetId)}).catch(Em)):(WC(n,o.targetId),await GC(n.localStore,o.targetId,!0))}async function cge(t,e,n){const o=gge(t);try{const c=await function(l,f){const _=St(l),y=_r.now(),S=f.reduce((b,k)=>b.add(k.key),Lt());let R,w;return _.persistence.runTransaction("Locally write mutations","readwrite",b=>{let k=Na(),M=Lt();return _.Gi.getEntries(b,S).next(F=>{k=F,k.forEach((Y,H)=>{H.isValidDocument()||(M=M.add(Y))})}).next(()=>_.localDocuments.getOverlayedDocuments(b,k)).next(F=>{R=F;const Y=[];for(const H of f){const B=kfe(H,R.get(H.key).overlayedDocument);B!=null&&Y.push(new zc(H.key,B,qB(B.value.mapValue),so.exists(!0)))}return _.mutationQueue.addMutationBatch(b,y,Y,f)}).next(F=>{w=F;const Y=F.applyToLocalDocumentSet(R,M);return _.documentOverlayCache.saveOverlays(b,F.batchId,Y)})}).then(()=>({batchId:w.batchId,changes:aG(R)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(c.batchId),function(l,f,_){let y=l.hc[l.currentUser.toKey()];y||(y=new Sr(Yt)),y=y.insert(f,_),l.hc[l.currentUser.toKey()]=y}(o,c.batchId,n),await Tm(o,c.changes),await ry(o.remoteStore)}catch(c){const l=SO(c,"Failed to persist write");n.reject(l)}}async function LG(t,e){const n=St(t);try{const o=await Cme(n.localStore,e);e.targetChanges.forEach((c,l)=>{const f=n.cc.get(l);f&&(_n(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?f.nc=!0:c.modifiedDocuments.size>0?_n(f.nc):c.removedDocuments.size>0&&(_n(f.nc),f.nc=!1))}),await Tm(n,o,e)}catch(o){await Em(o)}}function T6(t,e,n){const o=St(t);if(o.isPrimaryClient&&n===0||!o.isPrimaryClient&&n===1){const c=[];o.ic.forEach((l,f)=>{const _=f.view.bu(e);_.snapshot&&c.push(_.snapshot)}),function(l,f){const _=St(l);_.onlineState=f;let y=!1;_.queries.forEach((S,R)=>{for(const w of R.listeners)w.bu(f)&&(y=!0)}),y&&TO(_)}(o.eventManager,e),c.length&&o.sc.Wo(c),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function uge(t,e,n){const o=St(t);o.sharedClientState.updateQueryState(e,"rejected",n);const c=o.cc.get(e),l=c&&c.key;if(l){let f=new Sr(ze.comparator);f=f.insert(l,ii.newNoDocument(l,yt.min()));const _=Lt().add(l),y=new ey(yt.min(),new Map,new vr(Yt),f,_);await LG(o,y),o.uc=o.uc.remove(l),o.cc.delete(e),RO(o)}else await GC(o.localStore,e,!1).then(()=>WC(o,e,n)).catch(Em)}async function lge(t,e){const n=St(t),o=e.batch.batchId;try{const c=await wme(n.localStore,e);xG(n,o,null),MG(n,o),n.sharedClientState.updateMutationState(o,"acknowledged"),await Tm(n,c)}catch(c){await Em(c)}}async function dge(t,e,n){const o=St(t);try{const c=await function(l,f){const _=St(l);return _.persistence.runTransaction("Reject batch","readwrite-primary",y=>{let S;return _.mutationQueue.lookupMutationBatch(y,f).next(R=>(_n(R!==null),S=R.keys(),_.mutationQueue.removeMutationBatch(y,R))).next(()=>_.mutationQueue.performConsistencyCheck(y)).next(()=>_.documentOverlayCache.removeOverlaysForBatchId(y,S,f)).next(()=>_.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(y,S)).next(()=>_.localDocuments.getDocuments(y,S))})}(o.localStore,e);xG(o,e,n),MG(o,e),o.sharedClientState.updateMutationState(e,"rejected",n),await Tm(o,c)}catch(c){await Em(c)}}function MG(t,e){(t.lc.get(e)||[]).forEach(n=>{n.resolve()}),t.lc.delete(e)}function xG(t,e,n){const o=St(t);let c=o.hc[o.currentUser.toKey()];if(c){const l=c.get(e);l&&(n?l.reject(n):l.resolve(),c=c.remove(e)),o.hc[o.currentUser.toKey()]=c}}function WC(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const o of t.rc.get(e))t.ic.delete(o),n&&t.sc.wc(o,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach(o=>{t.ac.containsKey(o)||UG(t,o)})}function UG(t,e){t.oc.delete(e.path.canonicalString());const n=t.uc.get(e);n!==null&&(RG(t.remoteStore,n),t.uc=t.uc.remove(e),t.cc.delete(n),RO(t))}function R6(t,e,n){for(const o of n)o instanceof DG?(t.ac.addReference(o.key,e),hge(t,o)):o instanceof kG?($e("SyncEngine","Document no longer in limbo: "+o.key),t.ac.removeReference(o.key,e),t.ac.containsKey(o.key)||UG(t,o.key)):lt()}function hge(t,e){const n=e.key,o=n.path.canonicalString();t.uc.get(n)||t.oc.has(o)||($e("SyncEngine","New document in limbo: "+n),t.oc.add(o),RO(t))}function RO(t){for(;t.oc.size>0&&t.uc.size<t.maxConcurrentLimboResolutions;){const e=t.oc.values().next().value;t.oc.delete(e);const n=new ze(An.fromString(e)),o=t.fc.next();t.cc.set(o,new rge(n)),t.uc=t.uc.insert(n,o),TG(t.remoteStore,new ju(Oa(Y1(n.path)),o,2,aO.at))}}async function Tm(t,e,n){const o=St(t),c=[],l=[],f=[];o.ic.isEmpty()||(o.ic.forEach((_,y)=>{f.push(o._c(y,e,n).then(S=>{if((S||n)&&o.isPrimaryClient&&o.sharedClientState.updateQueryState(y.targetId,S!=null&&S.fromCache?"not-current":"current"),S){c.push(S);const R=gO.Ci(y.targetId,S);l.push(R)}}))}),await Promise.all(f),o.sc.Wo(c),await async function(_,y){const S=St(_);try{await S.persistence.runTransaction("notifyLocalViewChanges","readwrite",R=>Re.forEach(y,w=>Re.forEach(w.Si,b=>S.persistence.referenceDelegate.addReference(R,w.targetId,b)).next(()=>Re.forEach(w.Di,b=>S.persistence.referenceDelegate.removeReference(R,w.targetId,b)))))}catch(R){if(!_m(R))throw R;$e("LocalStore","Failed to update sequence numbers: "+R)}for(const R of y){const w=R.targetId;if(!R.fromCache){const b=S.qi.get(w),k=b.snapshotVersion,M=b.withLastLimboFreeSnapshotVersion(k);S.qi=S.qi.insert(w,M)}}}(o.localStore,l))}async function pge(t,e){const n=St(t);if(!n.currentUser.isEqual(e)){$e("SyncEngine","User change. New user:",e.toKey());const o=await _G(n.localStore,e);n.currentUser=e,function(c,l){c.lc.forEach(f=>{f.forEach(_=>{_.reject(new qe(ye.CANCELLED,l))})}),c.lc.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await Tm(n,o.ji)}}function fge(t,e){const n=St(t),o=n.cc.get(e);if(o&&o.nc)return Lt().add(o.key);{let c=Lt();const l=n.rc.get(e);if(!l)return c;for(const f of l){const _=n.ic.get(f);c=c.unionWith(_.view.ju)}return c}}function mge(t){const e=St(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=LG.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fge.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uge.bind(null,e),e.sc.Wo=Zme.bind(null,e.eventManager),e.sc.wc=ege.bind(null,e.eventManager),e}function gge(t){const e=St(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=lge.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=dge.bind(null,e),e}class Ege{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=ty(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,n){return null}Ec(e,n){return null}Ic(e){return Ime(this.persistence,new Tme,e.initialUser,this.yt)}yc(e){return new yme(mO.Bs,this.yt)}gc(e){return new Pme}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class _ge{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>T6(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=pge.bind(null,this.syncEngine),await Xme(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Qme}createDatastore(e){const n=ty(e.databaseInfo.databaseId),o=(c=e.databaseInfo,new Mme(c));var c;return function(l,f,_,y){return new Vme(l,f,_,y)}(e.authCredentials,e.appCheckCredentials,o,n)}createRemoteStore(e){return n=this.localStore,o=this.datastore,c=e.asyncQueue,l=_=>T6(this.syncEngine,_,0),f=v6.C()?new v6:new Dme,new jme(n,o,c,l,f);var n,o,c,l,f}createSyncEngine(e,n){return function(o,c,l,f,_,y,S){const R=new ige(o,c,l,f,_,y);return S&&(R.dc=!0),R}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){const n=St(e);$e("RemoteStore","RemoteStore shutting down."),n._u.add(5),await Sm(n),n.mu.shutdown(),n.gu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VG(t,e,n){if(!n)throw new qe(ye.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function vge(t,e,n,o){if(e===!0&&o===!0)throw new qe(ye.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function I6(t){if(!ze.isDocumentKey(t))throw new qe(ye.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function w6(t){if(ze.isDocumentKey(t))throw new qe(ye.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function IO(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":lt()}function oo(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new qe(ye.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=IO(t);throw new qe(ye.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C6=new Map;class A6{constructor(e){var n;if(e.host===void 0){if(e.ssl!==void 0)throw new qe(ye.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new qe(ye.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,vge("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iy{constructor(e,n,o,c){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=o,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new A6({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new qe(ye.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new qe(ye.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new A6(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new qpe;switch(n.type){case"gapi":const o=n.client;return new Jpe(o,n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new qe(ye.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=C6.get(e);n&&($e("ComponentProvider","Removing Datastore"),C6.delete(e),n.terminate())}(this),Promise.resolve()}}function yge(t,e,n,o={}){var c;const l=(t=oo(t,iy))._getSettings();if(l.host!=="firestore.googleapis.com"&&l.host!==e&&DC("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},l),{host:`${e}:${n}`,ssl:!1})),o.mockUserToken){let f,_;if(typeof o.mockUserToken=="string")f=o.mockUserToken,_=ni.MOCK_USER;else{f=Qj(o.mockUserToken,(c=t._app)===null||c===void 0?void 0:c.options.projectId);const y=o.mockUserToken.sub||o.mockUserToken.user_id;if(!y)throw new qe(ye.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new ni(y)}t._authCredentials=new zpe(new xB(f,_))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e,n,o){this.converter=n,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new vi(this.firestore,e,this._key)}}class sy{constructor(e,n,o){this.converter=n,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new sy(this.firestore,e,this._query)}}class Nc extends sy{constructor(e,n,o){super(e,n,Y1(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new vi(this.firestore,null,new ze(e))}withConverter(e){return new Nc(this.firestore,e,this._path)}}function FG(t,e,...n){if(t=yr(t),VG("collection","path",e),t instanceof iy){const o=An.fromString(e,...n);return w6(o),new Nc(t,null,o)}{if(!(t instanceof vi||t instanceof Nc))throw new qe(ye.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=t._path.child(An.fromString(e,...n));return w6(o),new Nc(t.firestore,null,o)}}function Ao(t,e,...n){if(t=yr(t),arguments.length===1&&(e=UB.R()),VG("doc","path",e),t instanceof iy){const o=An.fromString(e,...n);return I6(o),new vi(t,null,new ze(o))}{if(!(t instanceof vi||t instanceof Nc))throw new qe(ye.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=t._path.child(An.fromString(e,...n));return I6(o),new vi(t.firestore,t instanceof Nc?t.converter:null,new ze(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jG{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):ba("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sge{constructor(e,n,o,c){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=o,this.databaseInfo=c,this.user=ni.UNAUTHENTICATED,this.clientId=UB.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(o,async l=>{$e("FirestoreClient","Received user=",l.uid),await this.authCredentialListener(l),this.user=l}),this.appCheckCredentials.start(o,l=>($e("FirestoreClient","Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new qe(ye.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Oc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const o=SO(n,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function Tge(t,e){t.asyncQueue.verifyOperationInProgress(),$e("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let o=n.initialUser;t.setCredentialChangeListener(async c=>{o.isEqual(c)||(await _G(e.localStore,c),o=c)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function Rge(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Ige(t);$e("FirestoreClient","Initializing OnlineComponentProvider");const o=await t.getConfiguration();await e.initialize(n,o),t.setCredentialChangeListener(c=>y6(e.remoteStore,c)),t.setAppCheckTokenChangeListener((c,l)=>y6(e.remoteStore,l)),t.onlineComponents=e}async function Ige(t){return t.offlineComponents||($e("FirestoreClient","Using default OfflineComponentProvider"),await Tge(t,new Ege)),t.offlineComponents}async function BG(t){return t.onlineComponents||($e("FirestoreClient","Using default OnlineComponentProvider"),await Rge(t,new _ge)),t.onlineComponents}function wge(t){return BG(t).then(e=>e.syncEngine)}async function HC(t){const e=await BG(t),n=e.eventManager;return n.onListen=sge.bind(null,e.syncEngine),n.onUnlisten=age.bind(null,e.syncEngine),n}function Cge(t,e,n={}){const o=new Oc;return t.asyncQueue.enqueueAndForget(async()=>function(c,l,f,_,y){const S=new jG({next:w=>{l.enqueueAndForget(()=>NG(c,R));const b=w.docs.has(f);!b&&w.fromCache?y.reject(new qe(ye.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&w.fromCache&&_&&_.source==="server"?y.reject(new qe(ye.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):y.resolve(w)},error:w=>y.reject(w)}),R=new PG(Y1(f.path),S,{includeMetadataChanges:!0,Nu:!0});return OG(c,R)}(await HC(t),t.asyncQueue,e,n,o)),o.promise}class Age{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new yG(this,"async_queue_retry"),this.Wc=()=>{const n=II();n&&$e("AsyncQueue","Visibility state changed to "+n.visibilityState),this.xo.Po()};const e=II();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const n=II();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const n=new Oc;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(this.Lc.length!==0){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!_m(e))throw e;$e("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(e){const n=this.Bc.then(()=>(this.Gc=!0,e().catch(o=>{this.Kc=o,this.Gc=!1;const c=function(l){let f=l.message||"";return l.stack&&(f=l.stack.includes(l.message)?l.stack:l.message+`
`+l.stack),f}(o);throw ba("INTERNAL UNHANDLED ERROR: ",c),o}).then(o=>(this.Gc=!1,o))));return this.Bc=n,n}enqueueAfterDelay(e,n,o){this.zc(),this.jc.indexOf(e)>-1&&(n=0);const c=yO.createAndSchedule(this,e,n,o,l=>this.Yc(l));return this.Uc.push(c),c}zc(){this.Kc&&lt()}verifyOperationInProgress(){}async Xc(){let e;do e=this.Bc,await e;while(e!==this.Bc)}Zc(e){for(const n of this.Uc)if(n.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((n,o)=>n.targetTimeMs-o.targetTimeMs);for(const n of this.Uc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const n=this.Uc.indexOf(e);this.Uc.splice(n,1)}}function b6(t){return function(e,n){if(typeof e!="object"||e===null)return!1;const o=e;for(const c of n)if(c in o&&typeof o[c]=="function")return!0;return!1}(t,["next","error","complete"])}class el extends iy{constructor(e,n,o,c){super(e,n,o,c),this.type="firestore",this._queue=new Age,this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||GG(this),this._firestoreClient.terminate()}}function bge(t,e){const n=typeof t=="object"?t:bb(),o=typeof t=="string"?t:e||"(default)",c=b1(n,"firestore").getImmediate({identifier:o});if(!c._initialized){const l=Xj("firestore");l&&yge(c,...l)}return c}function wO(t){return t._firestoreClient||GG(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function GG(t){var e;const n=t._freezeSettings(),o=function(c,l,f,_){return new afe(c,l,f,_.host,_.ssl,_.experimentalForceLongPolling,_.experimentalAutoDetectLongPolling,_.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Sge(t._authCredentials,t._appCheckCredentials,t._queue,o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new sh(di.fromBase64String(e))}catch(n){throw new qe(ye.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new sh(di.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new qe(ye.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new si(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CO{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new qe(ye.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new qe(ye.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Yt(this._lat,e._lat)||Yt(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oge=/^__.*__$/;class Nge{constructor(e,n,o){this.data=e,this.fieldMask=n,this.fieldTransforms=o}toMutation(e,n){return this.fieldMask!==null?new zc(e,this.data,this.fieldMask,n,this.fieldTransforms):new vm(e,this.data,n,this.fieldTransforms)}}let WG=class{constructor(e,n,o){this.data=e,this.fieldMask=n,this.fieldTransforms=o}toMutation(e,n){return new zc(e,this.data,this.fieldMask,n,this.fieldTransforms)}};function HG(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw lt()}}class ay{constructor(e,n,o,c,l,f){this.settings=e,this.databaseId=n,this.yt=o,this.ignoreUndefinedProperties=c,l===void 0&&this.na(),this.fieldTransforms=l||[],this.fieldMask=f||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new ay(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var n;const o=(n=this.path)===null||n===void 0?void 0:n.child(e),c=this.ia({path:o,oa:!1});return c.ua(e),c}ca(e){var n;const o=(n=this.path)===null||n===void 0?void 0:n.child(e),c=this.ia({path:o,oa:!1});return c.na(),c}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Iv(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(e.length===0)throw this.ha("Document fields must not be empty");if(HG(this.sa)&&Oge.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class Pge{constructor(e,n,o){this.databaseId=e,this.ignoreUndefinedProperties=n,this.yt=o||ty(e)}da(e,n,o,c=!1){return new ay({sa:e,methodName:n,fa:o,path:si.emptyPath(),oa:!1,la:c},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function $G(t){const e=t._freezeSettings(),n=ty(t._databaseId);return new Pge(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Dge(t,e,n,o,c,l={}){const f=t.da(l.merge||l.mergeFields?2:0,e,n,c);AO("Data must be an object, but it was:",f,o);const _=qG(o,f);let y,S;if(l.merge)y=new os(f.fieldMask),S=f.fieldTransforms;else if(l.mergeFields){const R=[];for(const w of l.mergeFields){const b=$C(e,w,n);if(!f.contains(b))throw new qe(ye.INVALID_ARGUMENT,`Field '${b}' is specified in your field mask but missing from your input data.`);YG(R,b)||R.push(b)}y=new os(R),S=f.fieldTransforms.filter(w=>y.covers(w.field))}else y=null,S=f.fieldTransforms;return new Nge(new Pi(_),y,S)}class cy extends Rm{_toFieldTransform(e){if(e.sa!==2)throw e.sa===1?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cy}}function KG(t,e,n){return new ay({sa:3,fa:e.settings.fa,methodName:t._methodName,oa:n},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class kge extends Rm{constructor(e,n){super(e),this._a=n}_toFieldTransform(e){const n=KG(this,e,!0),o=this._a.map(l=>wh(l,n)),c=new th(o);return new nG(e.path,c)}isEqual(e){return this===e}}class Lge extends Rm{constructor(e,n){super(e),this._a=n}_toFieldTransform(e){const n=KG(this,e,!0),o=this._a.map(l=>wh(l,n)),c=new nh(o);return new nG(e.path,c)}isEqual(e){return this===e}}function Mge(t,e,n,o){const c=t.da(1,e,n);AO("Data must be an object, but it was:",c,o);const l=[],f=Pi.empty();il(o,(y,S)=>{const R=bO(e,y,n);S=yr(S);const w=c.ca(R);if(S instanceof cy)l.push(R);else{const b=wh(S,w);b!=null&&(l.push(R),f.set(R,b))}});const _=new os(l);return new WG(f,_,c.fieldTransforms)}function xge(t,e,n,o,c,l){const f=t.da(1,e,n),_=[$C(e,o,n)],y=[c];if(l.length%2!=0)throw new qe(ye.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let b=0;b<l.length;b+=2)_.push($C(e,l[b])),y.push(l[b+1]);const S=[],R=Pi.empty();for(let b=_.length-1;b>=0;--b)if(!YG(S,_[b])){const k=_[b];let M=y[b];M=yr(M);const F=f.ca(k);if(M instanceof cy)S.push(k);else{const Y=wh(M,F);Y!=null&&(S.push(k),R.set(k,Y))}}const w=new os(S);return new WG(R,w,f.fieldTransforms)}function wh(t,e){if(zG(t=yr(t)))return AO("Unsupported field value:",e,t),qG(t,e);if(t instanceof Rm)return function(n,o){if(!HG(o.sa))throw o.ha(`${n._methodName}() can only be used with update() and set()`);if(!o.path)throw o.ha(`${n._methodName}() is not currently supported inside arrays`);const c=n._toFieldTransform(o);c&&o.fieldTransforms.push(c)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.oa&&e.sa!==4)throw e.ha("Nested arrays are not supported");return function(n,o){const c=[];let l=0;for(const f of n){let _=wh(f,o.aa(l));_==null&&(_={nullValue:"NULL_VALUE"}),c.push(_),l++}return{arrayValue:{values:c}}}(t,e)}return function(n,o){if((n=yr(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Afe(o.yt,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const c=_r.fromDate(n);return{timestampValue:Tv(o.yt,c)}}if(n instanceof _r){const c=new _r(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Tv(o.yt,c)}}if(n instanceof CO)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof sh)return{bytesValue:hG(o.yt,n._byteString)};if(n instanceof vi){const c=o.databaseId,l=n.firestore._databaseId;if(!l.isEqual(c))throw o.ha(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:hO(n.firestore._databaseId||o.databaseId,n._key.path)}}throw o.ha(`Unsupported field value: ${IO(n)}`)}(t,e)}function qG(t,e){const n={};return VB(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):il(t,(o,c)=>{const l=wh(c,e.ra(o));l!=null&&(n[o]=l)}),{mapValue:{fields:n}}}function zG(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof _r||t instanceof CO||t instanceof sh||t instanceof vi||t instanceof Rm)}function AO(t,e,n){if(!zG(n)||!function(o){return typeof o=="object"&&o!==null&&(Object.getPrototypeOf(o)===Object.prototype||Object.getPrototypeOf(o)===null)}(n)){const o=IO(n);throw o==="an object"?e.ha(t+" a custom object"):e.ha(t+" "+o)}}function $C(t,e,n){if((e=yr(e))instanceof oy)return e._internalPath;if(typeof e=="string")return bO(t,e);throw Iv("Field path arguments must be of type string or ",t,!1,void 0,n)}const Uge=new RegExp("[~\\*/\\[\\]]");function bO(t,e,n){if(e.search(Uge)>=0)throw Iv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new oy(...e.split("."))._internalPath}catch{throw Iv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Iv(t,e,n,o,c){const l=o&&!o.isEmpty(),f=c!==void 0;let _=`Function ${e}() called with invalid data`;n&&(_+=" (via `toFirestore()`)"),_+=". ";let y="";return(l||f)&&(y+=" (found",l&&(y+=` in field ${o}`),f&&(y+=` in document ${c}`),y+=")"),new qe(ye.INVALID_ARGUMENT,_+t+y)}function YG(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XG{constructor(e,n,o,c,l){this._firestore=e,this._userDataWriter=n,this._key=o,this._document=c,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new vi(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Vge(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(JG("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Vge extends XG{data(){return super.data()}}function JG(t,e){return typeof e=="string"?bO(t,e):e instanceof oy?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fge(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new qe(ye.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class jge{convertValue(e,n="none"){switch(Zu(e)){case 0:return null;case 1:return e.booleanValue;case 2:return or(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Qd(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw lt()}}convertObject(e,n){const o={};return il(e.fields,(c,l)=>{o[c]=this.convertValue(l,n)}),o}convertGeoPoint(e){return new CO(or(e.latitude),or(e.longitude))}convertArray(e,n){return(e.values||[]).map(o=>this.convertValue(o,n))}convertServerTimestamp(e,n){switch(n){case"previous":const o=jB(e);return o==null?null:this.convertValue(o,n);case"estimate":return this.convertTimestamp(Wf(e));default:return null}}convertTimestamp(e){const n=Vc(e);return new _r(n.seconds,n.nanos)}convertDocumentKey(e,n){const o=An.fromString(e);_n(EG(o));const c=new Gf(o.get(1),o.get(3)),l=new ze(o.popFirst(5));return c.isEqual(n)||ba(`Document ${l} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bge(t,e,n){let o;return o=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class QG extends XG{constructor(e,n,o,c,l,f){super(e,n,o,c,f),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new E_(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const o=this._document.data.field(JG("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,n.serverTimestamps)}}}class E_ extends QG{data(e={}){return super.data(e)}}class Gge{constructor(e,n,o,c){this._firestore=e,this._userDataWriter=n,this._snapshot=c,this.metadata=new Vp(c.hasPendingWrites,c.fromCache),this.query=o}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(o=>{e.call(n,new E_(this._firestore,this._userDataWriter,o.key,o,new Vp(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new qe(ye.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(o,c){if(o._snapshot.oldDocs.isEmpty()){let l=0;return o._snapshot.docChanges.map(f=>{const _=new E_(o._firestore,o._userDataWriter,f.doc.key,f.doc,new Vp(o._snapshot.mutatedKeys.has(f.doc.key),o._snapshot.fromCache),o.query.converter);return f.doc,{type:"added",doc:_,oldIndex:-1,newIndex:l++}})}{let l=o._snapshot.oldDocs;return o._snapshot.docChanges.filter(f=>c||f.type!==3).map(f=>{const _=new E_(o._firestore,o._userDataWriter,f.doc.key,f.doc,new Vp(o._snapshot.mutatedKeys.has(f.doc.key),o._snapshot.fromCache),o.query.converter);let y=-1,S=-1;return f.type!==0&&(y=l.indexOf(f.doc.key),l=l.delete(f.doc.key)),f.type!==1&&(l=l.add(f.doc),S=l.indexOf(f.doc.key)),{type:Wge(f.type),doc:_,oldIndex:y,newIndex:S}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function Wge(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return lt()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hge(t){t=oo(t,vi);const e=oo(t.firestore,el);return Cge(wO(e),t._key).then(n=>tW(e,t,n))}class ZG extends jge{constructor(e){super(),this.firestore=e}convertBytes(e){return new sh(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new vi(this.firestore,null,n)}}function $ge(t,e,n){t=oo(t,vi);const o=oo(t.firestore,el),c=Bge(t.converter,e,n);return OO(o,[Dge($G(o),"setDoc",t._key,c,t.converter!==null,n).toMutation(t._key,so.none())])}function _a(t,e,n,...o){t=oo(t,vi);const c=oo(t.firestore,el),l=$G(c);let f;return f=typeof(e=yr(e))=="string"||e instanceof oy?xge(l,"updateDoc",t._key,e,n,o):Mge(l,"updateDoc",t._key,e),OO(c,[f.toMutation(t._key,so.exists(!0))])}function Kge(t){return OO(oo(t.firestore,el),[new dO(t._key,so.none())])}function eW(t,...e){var n,o,c;t=yr(t);let l={includeMetadataChanges:!1},f=0;typeof e[f]!="object"||b6(e[f])||(l=e[f],f++);const _={includeMetadataChanges:l.includeMetadataChanges};if(b6(e[f])){const w=e[f];e[f]=(n=w.next)===null||n===void 0?void 0:n.bind(w),e[f+1]=(o=w.error)===null||o===void 0?void 0:o.bind(w),e[f+2]=(c=w.complete)===null||c===void 0?void 0:c.bind(w)}let y,S,R;if(t instanceof vi)S=oo(t.firestore,el),R=Y1(t._key.path),y={next:w=>{e[f]&&e[f](tW(S,t,w))},error:e[f+1],complete:e[f+2]};else{const w=oo(t,sy);S=oo(w.firestore,el),R=w._query;const b=new ZG(S);y={next:k=>{e[f]&&e[f](new Gge(S,b,w,k))},error:e[f+1],complete:e[f+2]},Fge(t._query)}return function(w,b,k,M){const F=new jG(M),Y=new PG(b,F,k);return w.asyncQueue.enqueueAndForget(async()=>OG(await HC(w),Y)),()=>{F.bc(),w.asyncQueue.enqueueAndForget(async()=>NG(await HC(w),Y))}}(wO(S),R,_,y)}function OO(t,e){return function(n,o){const c=new Oc;return n.asyncQueue.enqueueAndForget(async()=>cge(await wge(n),o,c)),c.promise}(wO(t),e)}function tW(t,e,n){const o=n.docs.get(e._key),c=new ZG(t);return new QG(t,c,e._key,o,new Vp(n.hasPendingWrites,n.fromCache),e.converter)}function fc(...t){return new kge("arrayUnion",t)}function qge(...t){return new Lge("arrayRemove",t)}(function(t,e=!0){(function(n){Th=n})(Eh),Yu(new xc("firestore",(n,{instanceIdentifier:o,options:c})=>{const l=n.getProvider("app").getImmediate(),f=new el(new Ype(n.getProvider("auth-internal")),new Zpe(n.getProvider("app-check-internal")),function(_,y){if(!Object.prototype.hasOwnProperty.apply(_.options,["projectId"]))throw new qe(ye.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gf(_.options.projectId,y)}(l,o),l);return c=Object.assign({useFetchStreams:e},c),f._setSettings(c),f},"PUBLIC").setMultipleInstances(!0)),Po(QV,"3.8.3",t),Po(QV,"3.8.3","esm2017")})();var zge="firebase",Yge="9.17.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Po(zge,Yge,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nW="firebasestorage.googleapis.com",Xge="storageBucket",Jge=2*60*1e3,Qge=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo extends Fo{constructor(e,n,o=0){super(wI(e),`Firebase Storage: ${n} (${wI(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,jo.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return wI(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Vo;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Vo||(Vo={}));function wI(t){return"storage/"+t}function Zge(){const t="An unknown error occurred, please check the error payload for server response.";return new jo(Vo.UNKNOWN,t)}function eEe(){return new jo(Vo.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function tEe(){return new jo(Vo.CANCELED,"User canceled the upload/download.")}function nEe(t){return new jo(Vo.INVALID_URL,"Invalid URL '"+t+"'.")}function rEe(t){return new jo(Vo.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function O6(t){return new jo(Vo.INVALID_ARGUMENT,t)}function rW(){return new jo(Vo.APP_DELETED,"The Firebase app was deleted.")}function iEe(t){return new jo(Vo.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let o;try{o=no.makeFromUrl(e,n)}catch{return new no(e,"")}if(o.path==="")return o;throw rEe(e)}static makeFromUrl(e,n){let o=null;const c="([A-Za-z0-9.\\-_]+)";function l(z){z.path.charAt(z.path.length-1)==="/"&&(z.path_=z.path_.slice(0,-1))}const f="(/(.*))?$",_=new RegExp("^gs://"+c+f,"i"),y={bucket:1,path:3};function S(z){z.path_=decodeURIComponent(z.path)}const R="v[A-Za-z0-9_]+",w=n.replace(/[.]/g,"\\."),b="(/([^?#]*).*)?$",k=new RegExp(`^https?://${w}/${R}/b/${c}/o${b}`,"i"),M={bucket:1,path:3},F=n===nW?"(?:storage.googleapis.com|storage.cloud.google.com)":n,Y="([^?#]*)",H=new RegExp(`^https?://${F}/${c}/${Y}`,"i"),K=[{regex:_,indices:y,postModify:l},{regex:k,indices:M,postModify:S},{regex:H,indices:{bucket:1,path:2},postModify:S}];for(let z=0;z<K.length;z++){const oe=K[z],de=oe.regex.exec(e);if(de){const Ee=de[oe.indices.bucket];let we=de[oe.indices.path];we||(we=""),o=new no(Ee,we),oe.postModify(o);break}}if(o==null)throw nEe(e);return o}}class sEe{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oEe(t,e,n){let o=1,c=null,l=null,f=!1,_=0;function y(){return _===2}let S=!1;function R(...Y){S||(S=!0,e.apply(null,Y))}function w(Y){c=setTimeout(()=>{c=null,t(k,y())},Y)}function b(){l&&clearTimeout(l)}function k(Y,...H){if(S){b();return}if(Y){b(),R.call(null,Y,...H);return}if(y()||f){b(),R.call(null,Y,...H);return}o<64&&(o*=2);let K;_===1?(_=2,K=0):K=(o+Math.random())*1e3,w(K)}let M=!1;function F(Y){M||(M=!0,b(),!S&&(c!==null?(Y||(_=2),clearTimeout(c),w(0)):Y||(_=1)))}return w(0),l=setTimeout(()=>{f=!0,F(!0)},n),F}function aEe(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cEe(t){return t!==void 0}function N6(t,e,n,o){if(o<e)throw O6(`Invalid value for '${t}'. Expected ${e} or greater.`);if(o>n)throw O6(`Invalid value for '${t}'. Expected ${n} or less.`)}function uEe(t){const e=encodeURIComponent;let n="?";for(const o in t)if(t.hasOwnProperty(o)){const c=e(o)+"="+e(t[o]);n=n+c+"&"}return n=n.slice(0,-1),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wv;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(wv||(wv={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lEe(t,e){const n=t>=500&&t<600,c=[408,429].indexOf(t)!==-1,l=e.indexOf(t)!==-1;return n||c||l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dEe{constructor(e,n,o,c,l,f,_,y,S,R,w,b=!0){this.url_=e,this.method_=n,this.headers_=o,this.body_=c,this.successCodes_=l,this.additionalRetryCodes_=f,this.callback_=_,this.errorCallback_=y,this.timeout_=S,this.progressCallback_=R,this.connectionFactory_=w,this.retry=b,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((k,M)=>{this.resolve_=k,this.reject_=M,this.start_()})}start_(){const e=(o,c)=>{if(c){o(!1,new qE(!1,null,!0));return}const l=this.connectionFactory_();this.pendingConnection_=l;const f=_=>{const y=_.loaded,S=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(y,S)};this.progressCallback_!==null&&l.addUploadProgressListener(f),l.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&l.removeUploadProgressListener(f),this.pendingConnection_=null;const _=l.getErrorCode()===wv.NO_ERROR,y=l.getStatus();if(!_||lEe(y,this.additionalRetryCodes_)&&this.retry){const R=l.getErrorCode()===wv.ABORT;o(!1,new qE(!1,null,R));return}const S=this.successCodes_.indexOf(y)!==-1;o(!0,new qE(S,l))})},n=(o,c)=>{const l=this.resolve_,f=this.reject_,_=c.connection;if(c.wasSuccessCode)try{const y=this.callback_(_,_.getResponse());cEe(y)?l(y):l()}catch(y){f(y)}else if(_!==null){const y=Zge();y.serverResponse=_.getErrorText(),this.errorCallback_?f(this.errorCallback_(_,y)):f(y)}else if(c.canceled){const y=this.appDelete_?rW():tEe();f(y)}else{const y=eEe();f(y)}};this.canceled_?n(!1,new qE(!1,null,!0)):this.backoffId_=oEe(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&aEe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class qE{constructor(e,n,o){this.wasSuccessCode=e,this.connection=n,this.canceled=!!o}}function hEe(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function pEe(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function fEe(t,e){e&&(t["X-Firebase-GMPID"]=e)}function mEe(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function gEe(t,e,n,o,c,l,f=!0){const _=uEe(t.urlParams),y=t.url+_,S=Object.assign({},t.headers);return fEe(S,e),hEe(S,n),pEe(S,l),mEe(S,o),new dEe(y,t.method,S,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,c,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EEe(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function _Ee(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cv{constructor(e,n){this._service=e,n instanceof no?this._location=n:this._location=no.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Cv(e,n)}get root(){const e=new no(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return _Ee(this._location.path)}get storage(){return this._service}get parent(){const e=EEe(this._location.path);if(e===null)return null;const n=new no(this._location.bucket,e);return new Cv(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw iEe(e)}}function P6(t,e){const n=e==null?void 0:e[Xge];return n==null?null:no.makeFromBucketSpec(n,t)}function vEe(t,e,n,o={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:c}=o;c&&(t._overrideAuthToken=typeof c=="string"?c:Qj(c,t.app.options.projectId))}class yEe{constructor(e,n,o,c,l){this.app=e,this._authProvider=n,this._appCheckProvider=o,this._url=c,this._firebaseVersion=l,this._bucket=null,this._host=nW,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Jge,this._maxUploadRetryTime=Qge,this._requests=new Set,c!=null?this._bucket=no.makeFromBucketSpec(c,this._host):this._bucket=P6(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=no.makeFromBucketSpec(this._url,e):this._bucket=P6(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){N6("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){N6("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Cv(this,e)}_makeRequest(e,n,o,c,l=!0){if(this._deleted)return new sEe(rW());{const f=gEe(e,this._appId,o,c,n,this._firebaseVersion,l);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(e,n){const[o,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,o,c).getPromise()}}const D6="@firebase/storage",k6="0.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iW="storage";function SEe(t=bb(),e){t=yr(t);const o=b1(t,iW).getImmediate({identifier:e}),c=Xj("storage");return c&&TEe(o,...c),o}function TEe(t,e,n,o={}){vEe(t,e,n,o)}function REe(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),o=t.getProvider("auth-internal"),c=t.getProvider("app-check-internal");return new yEe(n,o,c,e,Eh)}function IEe(){Yu(new xc(iW,REe,"PUBLIC").setMultipleInstances(!0)),Po(D6,k6,""),Po(D6,k6,"esm2017")}IEe();const wEe={apiKey:"AIzaSyAJ8vwk3rDyJUIR4D4Lbq71VanDtxi63Wg",authDomain:"chat-app-fe14a.firebaseapp.com",projectId:"chat-app-fe14a",storageBucket:"chat-app-fe14a.appspot.com",messagingSenderId:"417269468408",appId:"1:417269468408:web:0592a8fcc0c3920dd4bf0d"},NO=t7(wEe),Je=Hhe(NO),CEe=new ha;new da;SEe(NO);const ks=bge(NO),AEe={user:null,isLoggedIn:!1,inviteId:"",errorMessage:""},tf=cue({name:"user",initialState:AEe,reducers:{login(t,e){const{payload:n}=e;if(n.user&&(t.user=n.user,t.isLoggedIn=!0,n.navigateFn("/channels"),t.inviteId.length)){const o=Ao(ks,"channels",t.inviteId);(async()=>await _a(o,{members:fc({id:Je.currentUser.uid,photoURL:Je.currentUser.photoURL,name:Je.currentUser.displayName,email:Je.currentUser.email})}))()}},setInviteId(t,e){t.inviteId=e.payload.inviteId},logout(t){t.user=null,t.isLoggedIn=!1},resetErrorMessage(t,e){window.scrollTo(0,0),t.errorMessage=e.payload}}}),sW=function({type:t,email:e,password:n,navigateFn:o}){return async function(c){try{switch(t){case"GOOGLE":{const f=(await ehe(Je,CEe)).user;if(c(tf.actions.login({user:f,navigateFn:o})),f.metadata.creationTime===f.metadata.lastSignInTime){const _=Ao(ks,"channels","16A4w32PivaHAasvXbflX1676971533389"),y=Ao(ks,"channels","8BVeyNGrX0r5JUrtDm47d1677839254038");(async()=>(await _a(_,{members:fc({id:f.uid,photoURL:f.photoURL,name:f.displayName,email:f.email})}),await _a(y,{members:fc({id:f.uid,photoURL:f.photoURL,name:f.displayName,email:f.email})})))()}break}case"EMAILANDPASSWORDLOGIN":{const f=(await Cde(Je,e,n)).user;c(tf.actions.login({user:f,navigateFn:o}));break}case"EMAILANDPASSWORDSIGNUP":{const f=(await wde(Je,e,n)).user,_=Ao(ks,"channels","16A4w32PivaHAasvXbflX1676971533389"),y=Ao(ks,"channels","8BVeyNGrX0r5JUrtDm47d1677839254038");c(tf.actions.login({user:f,navigateFn:o})),(async()=>(await _a(_,{members:fc({id:f.uid,photoURL:f.photoURL,name:f.displayName,email:f.email})}),await _a(y,{members:fc({id:f.uid,photoURL:f.photoURL,name:f.displayName,email:f.email})})))()}}}catch(l){c(Pc.resetErrorMessage(l.message)),console.log("Error:",l.message)}}},Pc=tf.actions,bEe=iue({reducer:tf.reducer,middleware:[hC]}),PO=te.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),uy=te.createContext({});function OEe(){return te.useContext(uy).visualElement}const Im=te.createContext(null),ly=typeof document<"u",Av=ly?te.useLayoutEffect:te.useEffect,oW=te.createContext({strict:!1});function NEe(t,e,n,o){const c=OEe(),l=te.useContext(oW),f=te.useContext(Im),_=te.useContext(PO).reducedMotion,y=te.useRef();o=o||l.renderer,!y.current&&o&&(y.current=o(t,{visualState:e,parent:c,props:n,presenceId:f?f.id:void 0,blockInitialAnimation:f?f.initial===!1:!1,reducedMotionConfig:_}));const S=y.current;return Av(()=>{S&&S.render()}),(window.HandoffAppearAnimations?Av:te.useEffect)(()=>{S&&S.animationState&&S.animationState.animateChanges()}),S}function Cd(t){return typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function PEe(t,e,n){return te.useCallback(o=>{o&&t.mount&&t.mount(o),e&&(o?e.mount(o):e.unmount()),n&&(typeof n=="function"?n(o):Cd(n)&&(n.current=o))},[e])}function $f(t){return typeof t=="string"||Array.isArray(t)}function dy(t){return typeof t=="object"&&typeof t.start=="function"}const DEe=["initial","animate","exit","whileHover","whileDrag","whileTap","whileFocus","whileInView"];function hy(t){return dy(t.animate)||DEe.some(e=>$f(t[e]))}function aW(t){return Boolean(hy(t)||t.variants)}function kEe(t,e){if(hy(t)){const{initial:n,animate:o}=t;return{initial:n===!1||$f(n)?n:void 0,animate:$f(o)?o:void 0}}return t.inherit!==!1?e:{}}function LEe(t){const{initial:e,animate:n}=kEe(t,te.useContext(uy));return te.useMemo(()=>({initial:e,animate:n}),[L6(e),L6(n)])}function L6(t){return Array.isArray(t)?t.join(" "):t}const aa=t=>({isEnabled:e=>t.some(n=>!!e[n])}),Kf={measureLayout:aa(["layout","layoutId","drag"]),animation:aa(["animate","exit","variants","whileHover","whileTap","whileFocus","whileDrag","whileInView"]),exit:aa(["exit"]),drag:aa(["drag","dragControls"]),focus:aa(["whileFocus"]),hover:aa(["whileHover","onHoverStart","onHoverEnd"]),tap:aa(["whileTap","onTap","onTapStart","onTapCancel"]),pan:aa(["onPan","onPanStart","onPanSessionStart","onPanEnd"]),inView:aa(["whileInView","onViewportEnter","onViewportLeave"])};function MEe(t){for(const e in t)e==="projectionNodeConstructor"?Kf.projectionNodeConstructor=t[e]:Kf[e].Component=t[e]}function py(t){const e=te.useRef(null);return e.current===null&&(e.current=t()),e.current}const nf={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let xEe=1;function UEe(){return py(()=>{if(nf.hasEverUpdated)return xEe++})}const DO=te.createContext({});class VEe extends lh.Component{getSnapshotBeforeUpdate(){const{visualElement:e,props:n}=this.props;return e&&e.setProps(n),null}componentDidUpdate(){}render(){return this.props.children}}const cW=te.createContext({}),FEe=Symbol.for("motionComponentSymbol");function jEe({preloadedFeatures:t,createVisualElement:e,projectionNodeConstructor:n,useRender:o,useVisualState:c,Component:l}){t&&MEe(t);function f(y,S){const R={...te.useContext(PO),...y,layoutId:BEe(y)},{isStatic:w}=R;let b=null;const k=LEe(y),M=w?void 0:UEe(),F=c(y,w);if(!w&&ly){k.visualElement=NEe(l,F,R,e);const Y=te.useContext(cW);k.visualElement&&(b=k.visualElement.loadFeatures(R,te.useContext(oW).strict,t,M,n||Kf.projectionNodeConstructor,Y))}return te.createElement(VEe,{visualElement:k.visualElement,props:R},b,te.createElement(uy.Provider,{value:k},o(l,y,M,PEe(F,k.visualElement,S),F,w,k.visualElement)))}const _=te.forwardRef(f);return _[FEe]=l,_}function BEe({layoutId:t}){const e=te.useContext(DO).id;return e&&t!==void 0?e+"-"+t:t}function GEe(t){function e(o,c={}){return jEe(t(o,c))}if(typeof Proxy>"u")return e;const n=new Map;return new Proxy(e,{get:(o,c)=>(n.has(c)||n.set(c,e(c)),n.get(c))})}const WEe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function kO(t){return typeof t!="string"||t.includes("-")?!1:!!(WEe.indexOf(t)>-1||/[A-Z]/.test(t))}const bv={};function HEe(t){Object.assign(bv,t)}const Ov=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ch=new Set(Ov);function uW(t,{layout:e,layoutId:n}){return Ch.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!bv[t]||t==="opacity")}const xi=t=>!!(t!=null&&t.getVelocity),$Ee={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},KEe=(t,e)=>Ov.indexOf(t)-Ov.indexOf(e);function qEe({transform:t,transformKeys:e},{enableHardwareAcceleration:n=!0,allowTransformNone:o=!0},c,l){let f="";e.sort(KEe);for(const _ of e)f+=`${$Ee[_]||_}(${t[_]}) `;return n&&!t.z&&(f+="translateZ(0)"),f=f.trim(),l?f=l(t,c?"":f):o&&c&&(f="none"),f}function lW(t){return t.startsWith("--")}const zEe=(t,e)=>e&&typeof t=="number"?e.transform(t):t,oh=(t,e,n)=>Math.min(Math.max(n,t),e),ol={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},rf={...ol,transform:t=>oh(0,1,t)},zE={...ol,default:1},sf=t=>Math.round(t*1e5)/1e5,qf=/(-)?([\d]*\.?[\d])+/g,KC=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,YEe=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function wm(t){return typeof t=="string"}const Cm=t=>({test:e=>wm(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),nc=Cm("deg"),Mo=Cm("%"),nt=Cm("px"),XEe=Cm("vh"),JEe=Cm("vw"),M6={...Mo,parse:t=>Mo.parse(t)/100,transform:t=>Mo.transform(t*100)},x6={...ol,transform:Math.round},dW={borderWidth:nt,borderTopWidth:nt,borderRightWidth:nt,borderBottomWidth:nt,borderLeftWidth:nt,borderRadius:nt,radius:nt,borderTopLeftRadius:nt,borderTopRightRadius:nt,borderBottomRightRadius:nt,borderBottomLeftRadius:nt,width:nt,maxWidth:nt,height:nt,maxHeight:nt,size:nt,top:nt,right:nt,bottom:nt,left:nt,padding:nt,paddingTop:nt,paddingRight:nt,paddingBottom:nt,paddingLeft:nt,margin:nt,marginTop:nt,marginRight:nt,marginBottom:nt,marginLeft:nt,rotate:nc,rotateX:nc,rotateY:nc,rotateZ:nc,scale:zE,scaleX:zE,scaleY:zE,scaleZ:zE,skew:nc,skewX:nc,skewY:nc,distance:nt,translateX:nt,translateY:nt,translateZ:nt,x:nt,y:nt,z:nt,perspective:nt,transformPerspective:nt,opacity:rf,originX:M6,originY:M6,originZ:nt,zIndex:x6,fillOpacity:rf,strokeOpacity:rf,numOctaves:x6};function LO(t,e,n,o){const{style:c,vars:l,transform:f,transformKeys:_,transformOrigin:y}=t;_.length=0;let S=!1,R=!1,w=!0;for(const b in e){const k=e[b];if(lW(b)){l[b]=k;continue}const M=dW[b],F=zEe(k,M);if(Ch.has(b)){if(S=!0,f[b]=F,_.push(b),!w)continue;k!==(M.default||0)&&(w=!1)}else b.startsWith("origin")?(R=!0,y[b]=F):c[b]=F}if(e.transform||(S||o?c.transform=qEe(t,n,w,o):c.transform&&(c.transform="none")),R){const{originX:b="50%",originY:k="50%",originZ:M=0}=y;c.transformOrigin=`${b} ${k} ${M}`}}const MO=()=>({style:{},transform:{},transformKeys:[],transformOrigin:{},vars:{}});function hW(t,e,n){for(const o in e)!xi(e[o])&&!uW(o,n)&&(t[o]=e[o])}function QEe({transformTemplate:t},e,n){return te.useMemo(()=>{const o=MO();return LO(o,e,{enableHardwareAcceleration:!n},t),Object.assign({},o.vars,o.style)},[e])}function ZEe(t,e,n){const o=t.style||{},c={};return hW(c,o,t),Object.assign(c,QEe(t,e,n)),t.transformValues?t.transformValues(c):c}function e_e(t,e,n){const o={},c=ZEe(t,e,n);return t.drag&&t.dragListener!==!1&&(o.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(o.tabIndex=0),o.style=c,o}const t_e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onLayoutAnimationStart","onLayoutAnimationComplete","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","ignoreStrict","viewport"]);function Nv(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t_e.has(t)}let pW=t=>!Nv(t);function n_e(t){t&&(pW=e=>e.startsWith("on")?!Nv(e):t(e))}try{n_e(require("@emotion/is-prop-valid").default)}catch{}function r_e(t,e,n){const o={};for(const c in t)c==="values"&&typeof t.values=="object"||(pW(c)||n===!0&&Nv(c)||!e&&!Nv(c)||t.draggable&&c.startsWith("onDrag"))&&(o[c]=t[c]);return o}function U6(t,e,n){return typeof t=="string"?t:nt.transform(e+n*t)}function i_e(t,e,n){const o=U6(e,t.x,t.width),c=U6(n,t.y,t.height);return`${o} ${c}`}const s_e={offset:"stroke-dashoffset",array:"stroke-dasharray"},o_e={offset:"strokeDashoffset",array:"strokeDasharray"};function a_e(t,e,n=1,o=0,c=!0){t.pathLength=1;const l=c?s_e:o_e;t[l.offset]=nt.transform(-o);const f=nt.transform(e),_=nt.transform(n);t[l.array]=`${f} ${_}`}function xO(t,{attrX:e,attrY:n,originX:o,originY:c,pathLength:l,pathSpacing:f=1,pathOffset:_=0,...y},S,R,w){if(LO(t,y,S,w),R){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:b,style:k,dimensions:M}=t;b.transform&&(M&&(k.transform=b.transform),delete b.transform),M&&(o!==void 0||c!==void 0||k.transform)&&(k.transformOrigin=i_e(M,o!==void 0?o:.5,c!==void 0?c:.5)),e!==void 0&&(b.x=e),n!==void 0&&(b.y=n),l!==void 0&&a_e(b,l,f,_,!1)}const fW=()=>({...MO(),attrs:{}}),UO=t=>typeof t=="string"&&t.toLowerCase()==="svg";function c_e(t,e,n,o){const c=te.useMemo(()=>{const l=fW();return xO(l,e,{enableHardwareAcceleration:!1},UO(o),t.transformTemplate),{...l.attrs,style:{...l.style}}},[e]);if(t.style){const l={};hW(l,t.style,t),c.style={...l,...c.style}}return c}function u_e(t=!1){return(n,o,c,l,{latestValues:f},_)=>{const S=(kO(n)?c_e:e_e)(o,f,_,n),w={...r_e(o,typeof n=="string",t),...S,ref:l},{children:b}=o,k=te.useMemo(()=>xi(b)?b.get():b,[b]);return c&&(w["data-projection-id"]=c),te.createElement(n,{...w,children:k})}}const VO=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();function mW(t,{style:e,vars:n},o,c){Object.assign(t.style,e,c&&c.getProjectionStyles(o));for(const l in n)t.style.setProperty(l,n[l])}const gW=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function EW(t,e,n,o){mW(t,e,void 0,o);for(const c in e.attrs)t.setAttribute(gW.has(c)?c:VO(c),e.attrs[c])}function FO(t,e){const{style:n}=t,o={};for(const c in n)(xi(n[c])||e.style&&xi(e.style[c])||uW(c,t))&&(o[c]=n[c]);return o}function _W(t,e){const n=FO(t,e);for(const o in t)if(xi(t[o])||xi(e[o])){const c=o==="x"||o==="y"?"attr"+o.toUpperCase():o;n[c]=t[o]}return n}function jO(t,e,n,o={},c={}){return typeof e=="function"&&(e=e(n!==void 0?n:t.custom,o,c)),typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"&&(e=e(n!==void 0?n:t.custom,o,c)),e}const Pv=t=>Array.isArray(t),l_e=t=>Boolean(t&&typeof t=="object"&&t.mix&&t.toValue),d_e=t=>Pv(t)?t[t.length-1]||0:t;function __(t){const e=xi(t)?t.get():t;return l_e(e)?e.toValue():e}function h_e({scrapeMotionValuesFromProps:t,createRenderState:e,onMount:n},o,c,l){const f={latestValues:p_e(o,c,l,t),renderState:e()};return n&&(f.mount=_=>n(o,_,f)),f}const vW=t=>(e,n)=>{const o=te.useContext(uy),c=te.useContext(Im),l=()=>h_e(t,e,o,c);return n?l():py(l)};function p_e(t,e,n,o){const c={},l=o(t,{});for(const b in l)c[b]=__(l[b]);let{initial:f,animate:_}=t;const y=hy(t),S=aW(t);e&&S&&!y&&t.inherit!==!1&&(f===void 0&&(f=e.initial),_===void 0&&(_=e.animate));let R=n?n.initial===!1:!1;R=R||f===!1;const w=R?_:f;return w&&typeof w!="boolean"&&!dy(w)&&(Array.isArray(w)?w:[w]).forEach(k=>{const M=jO(t,k);if(!M)return;const{transitionEnd:F,transition:Y,...H}=M;for(const B in H){let K=H[B];if(Array.isArray(K)){const z=R?K.length-1:0;K=K[z]}K!==null&&(c[B]=K)}for(const B in F)c[B]=F[B]}),c}const f_e={useVisualState:vW({scrapeMotionValuesFromProps:_W,createRenderState:fW,onMount:(t,e,{renderState:n,latestValues:o})=>{try{n.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}xO(n,o,{enableHardwareAcceleration:!1},UO(e.tagName),t.transformTemplate),EW(e,n)}})},m_e={useVisualState:vW({scrapeMotionValuesFromProps:FO,createRenderState:MO})};function g_e(t,{forwardMotionProps:e=!1},n,o,c){return{...kO(t)?f_e:m_e,preloadedFeatures:n,useRender:u_e(e),createVisualElement:o,projectionNodeConstructor:c,Component:t}}var gn;(function(t){t.Animate="animate",t.Hover="whileHover",t.Tap="whileTap",t.Drag="whileDrag",t.Focus="whileFocus",t.InView="whileInView",t.Exit="exit"})(gn||(gn={}));function Bu(t,e,n,o={passive:!0}){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n)}function Dv(t,e,n,o){te.useEffect(()=>{const c=t.current;if(n&&c)return Bu(c,e,n,o)},[t,e,n,o])}function E_e({whileFocus:t,visualElement:e}){const n=te.useRef(!1),{animationState:o}=e,c=te.useCallback(()=>{let f=!1;try{f=e.current.matches(":focus-visible")}catch{f=!0}!f||!o||(o.setActive(gn.Focus,!0),n.current=!0)},[o]),l=te.useCallback(()=>{!n.current||!o||(o.setActive(gn.Focus,!1),n.current=!1)},[o]);Dv(e,"focus",t?c:void 0),Dv(e,"blur",t?l:void 0)}const yW=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function fy(t,e="page"){return{point:{x:t[e+"X"],y:t[e+"Y"]}}}const SW=t=>e=>yW(e)&&t(e,fy(e));function Bd(t,e,n,o){return Bu(t,e,SW(n),o)}function kv(t,e,n,o){return Dv(t,e,n&&SW(n),o)}function TW(t){let e=null;return()=>{const n=()=>{e=null};return e===null?(e=t,n):!1}}const V6=TW("dragHorizontal"),F6=TW("dragVertical");function RW(t){let e=!1;if(t==="y")e=F6();else if(t==="x")e=V6();else{const n=V6(),o=F6();n&&o?e=()=>{n(),o()}:(n&&n(),o&&o())}return e}function IW(){const t=RW(!0);return t?(t(),!1):!0}function j6(t,e,n,o){return(c,l)=>{c.type==="touch"||IW()||(n&&t.animationState&&t.animationState.setActive(gn.Hover,e),o&&o(c,l))}}function __e({onHoverStart:t,onHoverEnd:e,whileHover:n,visualElement:o}){kv(o,"pointerenter",te.useMemo(()=>t||n?j6(o,!0,Boolean(n),t):void 0,[t,Boolean(n),o]),{passive:!t}),kv(o,"pointerleave",te.useMemo(()=>e||n?j6(o,!1,Boolean(n),e):void 0,[t,Boolean(n),o]),{passive:!e})}const wW=(t,e)=>e?t===e?!0:wW(t,e.parentElement):!1;function BO(t){return te.useEffect(()=>()=>t(),[])}const v_e=(t,e)=>n=>e(t(n)),my=(...t)=>t.reduce(v_e);function CI(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,fy(n))}function y_e({onTap:t,onTapStart:e,onTapCancel:n,whileTap:o,visualElement:c,...l}){const f=t||e||n||o,_=te.useRef(!1),y=te.useRef(null),S={passive:!(e||t||n||l.onPointerDown)};function R(){y.current&&y.current(),y.current=null}function w(){return R(),_.current=!1,c.getProps().whileTap&&c.animationState&&c.animationState.setActive(gn.Tap,!1),!IW()}function b(B,K){var z,oe,de,Ee;w()&&(wW(c.current,B.target)?(Ee=(de=c.getProps()).onTap)===null||Ee===void 0||Ee.call(de,B,K):(oe=(z=c.getProps()).onTapCancel)===null||oe===void 0||oe.call(z,B,K))}function k(B,K){var z,oe;w()&&((oe=(z=c.getProps()).onTapCancel)===null||oe===void 0||oe.call(z,B,K))}function M(B,K){var z;const oe=c.getProps();oe.whileTap&&c.animationState&&c.animationState.setActive(gn.Tap,!0),(z=oe.onTapStart)===null||z===void 0||z.call(oe,B,K)}const F=[Boolean(e),Boolean(t),Boolean(o),c],Y=te.useCallback((B,K)=>{R(),!_.current&&(_.current=!0,y.current=my(Bd(window,"pointerup",b,S),Bd(window,"pointercancel",k,S)),M(B,K))},F);kv(c,"pointerdown",f?Y:void 0,S);const H=te.useCallback(()=>{const B=Bu(c.current,"keydown",z=>{z.key!=="Enter"||_.current||(_.current=!0,y.current=Bu(c.current,"keyup",()=>{z.key!=="Enter"||!w()||CI("up",c.getProps().onTap)},S),CI("down",M))}),K=Bu(c.current,"blur",()=>{B(),K(),_.current&&CI("cancel",k)})},F);Dv(c,"focus",f?H:void 0),BO(R)}const qC=new WeakMap,AI=new WeakMap,S_e=t=>{const e=qC.get(t.target);e&&e(t)},T_e=t=>{t.forEach(S_e)};function R_e({root:t,...e}){const n=t||document;AI.has(n)||AI.set(n,{});const o=AI.get(n),c=JSON.stringify(e);return o[c]||(o[c]=new IntersectionObserver(T_e,{root:t,...e})),o[c]}function I_e(t,e,n){const o=R_e(e);return qC.set(t,n),o.observe(t),()=>{qC.delete(t),o.unobserve(t)}}function w_e({visualElement:t,whileInView:e,onViewportEnter:n,onViewportLeave:o,viewport:c={}}){const l=te.useRef({hasEnteredView:!1,isInView:!1});let f=Boolean(e||n||o);c.once&&l.current.hasEnteredView&&(f=!1),(typeof IntersectionObserver>"u"?b_e:A_e)(f,l.current,t,c)}const C_e={some:0,all:1};function A_e(t,e,n,{root:o,margin:c,amount:l="some",once:f}){te.useEffect(()=>{if(!t||!n.current)return;const _={root:o==null?void 0:o.current,rootMargin:c,threshold:typeof l=="number"?l:C_e[l]},y=S=>{const{isIntersecting:R}=S;if(e.isInView===R||(e.isInView=R,f&&!R&&e.hasEnteredView))return;R&&(e.hasEnteredView=!0),n.animationState&&n.animationState.setActive(gn.InView,R);const w=n.getProps(),b=R?w.onViewportEnter:w.onViewportLeave;b&&b(S)};return I_e(n.current,_,y)},[t,o,c,l])}function b_e(t,e,n,{fallback:o=!0}){te.useEffect(()=>{!t||!o||requestAnimationFrame(()=>{e.hasEnteredView=!0;const{onViewportEnter:c}=n.getProps();c&&c(null),n.animationState&&n.animationState.setActive(gn.InView,!0)})},[t])}const mc=t=>e=>(t(e),null),O_e={inView:mc(w_e),tap:mc(y_e),focus:mc(E_e),hover:mc(__e)};function CW(){const t=te.useContext(Im);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:n,register:o}=t,c=te.useId();return te.useEffect(()=>o(c),[]),!e&&n?[!1,()=>n&&n(c)]:[!0]}function AW(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let o=0;o<n;o++)if(e[o]!==t[o])return!1;return!0}const N_e=t=>/^\-?\d*\.?\d+$/.test(t),P_e=t=>/^0[^.\s]+$/.test(t),ya={delta:0,timestamp:0},bW=1/60*1e3,D_e=typeof performance<"u"?()=>performance.now():()=>Date.now(),OW=typeof window<"u"?t=>window.requestAnimationFrame(t):t=>setTimeout(()=>t(D_e()),bW);function k_e(t){let e=[],n=[],o=0,c=!1,l=!1;const f=new WeakSet,_={schedule:(y,S=!1,R=!1)=>{const w=R&&c,b=w?e:n;return S&&f.add(y),b.indexOf(y)===-1&&(b.push(y),w&&c&&(o=e.length)),y},cancel:y=>{const S=n.indexOf(y);S!==-1&&n.splice(S,1),f.delete(y)},process:y=>{if(c){l=!0;return}if(c=!0,[e,n]=[n,e],n.length=0,o=e.length,o)for(let S=0;S<o;S++){const R=e[S];R(y),f.has(R)&&(_.schedule(R),t())}c=!1,l&&(l=!1,_.process(y))}};return _}const L_e=40;let zC=!0,zf=!1,YC=!1;const Am=["read","update","preRender","render","postRender"],gy=Am.reduce((t,e)=>(t[e]=k_e(()=>zf=!0),t),{}),ci=Am.reduce((t,e)=>{const n=gy[e];return t[e]=(o,c=!1,l=!1)=>(zf||x_e(),n.schedule(o,c,l)),t},{}),jc=Am.reduce((t,e)=>(t[e]=gy[e].cancel,t),{}),bI=Am.reduce((t,e)=>(t[e]=()=>gy[e].process(ya),t),{}),M_e=t=>gy[t].process(ya),NW=t=>{zf=!1,ya.delta=zC?bW:Math.max(Math.min(t-ya.timestamp,L_e),1),ya.timestamp=t,YC=!0,Am.forEach(M_e),YC=!1,zf&&(zC=!1,OW(NW))},x_e=()=>{zf=!0,zC=!0,YC||OW(NW)};function GO(t,e){t.indexOf(e)===-1&&t.push(e)}function WO(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class HO{constructor(){this.subscriptions=[]}add(e){return GO(this.subscriptions,e),()=>WO(this.subscriptions,e)}notify(e,n,o){const c=this.subscriptions.length;if(c)if(c===1)this.subscriptions[0](e,n,o);else for(let l=0;l<c;l++){const f=this.subscriptions[l];f&&f(e,n,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function $O(t,e){return e?t*(1e3/e):0}const U_e=t=>!isNaN(parseFloat(t));class V_e{constructor(e,n={}){this.version="9.0.2",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(o,c=!0)=>{this.prev=this.current,this.current=o;const{delta:l,timestamp:f}=ya;this.lastUpdated!==f&&(this.timeDelta=l,this.lastUpdated=f,ci.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),c&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>ci.postRender(this.velocityCheck),this.velocityCheck=({timestamp:o})=>{o!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=U_e(this.current),this.owner=n.owner}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new HO);const o=this.events[e].add(n);return e==="change"?()=>{o(),ci.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,o){this.set(n),this.prev=e,this.timeDelta=o}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?$O(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n)||null,this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){this.animation=null}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ah(t,e){return new V_e(t,e)}const KO=(t,e)=>n=>Boolean(wm(n)&&YEe.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),PW=(t,e,n)=>o=>{if(!wm(o))return o;const[c,l,f,_]=o.match(qf);return{[t]:parseFloat(c),[e]:parseFloat(l),[n]:parseFloat(f),alpha:_!==void 0?parseFloat(_):1}},F_e=t=>oh(0,255,t),OI={...ol,transform:t=>Math.round(F_e(t))},Mu={test:KO("rgb","red"),parse:PW("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:o=1})=>"rgba("+OI.transform(t)+", "+OI.transform(e)+", "+OI.transform(n)+", "+sf(rf.transform(o))+")"};function j_e(t){let e="",n="",o="",c="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),o=t.substring(5,7),c=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),o=t.substring(3,4),c=t.substring(4,5),e+=e,n+=n,o+=o,c+=c),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(o,16),alpha:c?parseInt(c,16)/255:1}}const XC={test:KO("#"),parse:j_e,transform:Mu.transform},Ad={test:KO("hsl","hue"),parse:PW("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:o=1})=>"hsla("+Math.round(t)+", "+Mo.transform(sf(e))+", "+Mo.transform(sf(n))+", "+sf(rf.transform(o))+")"},mi={test:t=>Mu.test(t)||XC.test(t)||Ad.test(t),parse:t=>Mu.test(t)?Mu.parse(t):Ad.test(t)?Ad.parse(t):XC.parse(t),transform:t=>wm(t)?t:t.hasOwnProperty("red")?Mu.transform(t):Ad.transform(t)},DW="${c}",kW="${n}";function B_e(t){var e,n;return isNaN(t)&&wm(t)&&(((e=t.match(qf))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(KC))===null||n===void 0?void 0:n.length)||0)>0}function Lv(t){typeof t=="number"&&(t=`${t}`);const e=[];let n=0,o=0;const c=t.match(KC);c&&(n=c.length,t=t.replace(KC,DW),e.push(...c.map(mi.parse)));const l=t.match(qf);return l&&(o=l.length,t=t.replace(qf,kW),e.push(...l.map(ol.parse))),{values:e,numColors:n,numNumbers:o,tokenised:t}}function LW(t){return Lv(t).values}function MW(t){const{values:e,numColors:n,tokenised:o}=Lv(t),c=e.length;return l=>{let f=o;for(let _=0;_<c;_++)f=f.replace(_<n?DW:kW,_<n?mi.transform(l[_]):sf(l[_]));return f}}const G_e=t=>typeof t=="number"?0:t;function W_e(t){const e=LW(t);return MW(t)(e.map(G_e))}const Bc={test:B_e,parse:LW,createTransformer:MW,getAnimatableNone:W_e},H_e=new Set(["brightness","contrast","saturate","opacity"]);function $_e(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[o]=n.match(qf)||[];if(!o)return t;const c=n.replace(o,"");let l=H_e.has(e)?1:0;return o!==n&&(l*=100),e+"("+l+c+")"}const K_e=/([a-z-]*)\(.*?\)/g,JC={...Bc,getAnimatableNone:t=>{const e=t.match(K_e);return e?e.map($_e).join(" "):t}},q_e={...dW,color:mi,backgroundColor:mi,outlineColor:mi,fill:mi,stroke:mi,borderColor:mi,borderTopColor:mi,borderRightColor:mi,borderBottomColor:mi,borderLeftColor:mi,filter:JC,WebkitFilter:JC},qO=t=>q_e[t];function zO(t,e){var n;let o=qO(t);return o!==JC&&(o=Bc),(n=o.getAnimatableNone)===null||n===void 0?void 0:n.call(o,e)}const xW=t=>e=>e.test(t),z_e={test:t=>t==="auto",parse:t=>t},UW=[ol,nt,Mo,nc,JEe,XEe,z_e],Cp=t=>UW.find(xW(t)),Y_e=[...UW,mi,Bc],X_e=t=>Y_e.find(xW(t));function J_e(t){const e={};return t.values.forEach((n,o)=>e[o]=n.get()),e}function Q_e(t){const e={};return t.values.forEach((n,o)=>e[o]=n.getVelocity()),e}function Ey(t,e,n){const o=t.getProps();return jO(o,e,n!==void 0?n:o.custom,J_e(t),Q_e(t))}function Z_e(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,ah(n))}function eve(t,e){const n=Ey(t,e);let{transitionEnd:o={},transition:c={},...l}=n?t.makeTargetAnimatable(n,!1):{};l={...l,...o};for(const f in l){const _=d_e(l[f]);Z_e(t,f,_)}}function tve(t,e,n){var o,c;const l=Object.keys(e).filter(_=>!t.hasValue(_)),f=l.length;if(f)for(let _=0;_<f;_++){const y=l[_],S=e[y];let R=null;Array.isArray(S)&&(R=S[0]),R===null&&(R=(c=(o=n[y])!==null&&o!==void 0?o:t.readValue(y))!==null&&c!==void 0?c:e[y]),R!=null&&(typeof R=="string"&&(N_e(R)||P_e(R))?R=parseFloat(R):!X_e(R)&&Bc.test(S)&&(R=zO(y,S)),t.addValue(y,ah(R,{owner:t})),n[y]===void 0&&(n[y]=R),R!==null&&t.setBaseTarget(y,R))}}function nve(t,e){return e?(e[t]||e.default||e).from:void 0}function rve(t,e,n){var o;const c={};for(const l in t){const f=nve(l,e);c[l]=f!==void 0?f:(o=n.getValue(l))===null||o===void 0?void 0:o.get()}return c}function Mv(t){return Boolean(xi(t)&&t.add)}const ive="framerAppearId",sve="data-"+VO(ive);var ove=function(){},xv=function(){};const v_=t=>t*1e3,ave={current:!1},YO=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,XO=t=>e=>1-t(1-e),JO=t=>t*t,cve=XO(JO),QO=YO(JO),Vn=(t,e,n)=>-n*t+n*e+t;function NI(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function uve({hue:t,saturation:e,lightness:n,alpha:o}){t/=360,e/=100,n/=100;let c=0,l=0,f=0;if(!e)c=l=f=n;else{const _=n<.5?n*(1+e):n+e-n*e,y=2*n-_;c=NI(y,_,t+1/3),l=NI(y,_,t),f=NI(y,_,t-1/3)}return{red:Math.round(c*255),green:Math.round(l*255),blue:Math.round(f*255),alpha:o}}const PI=(t,e,n)=>{const o=t*t;return Math.sqrt(Math.max(0,n*(e*e-o)+o))},lve=[XC,Mu,Ad],dve=t=>lve.find(e=>e.test(t));function B6(t){const e=dve(t);let n=e.parse(t);return e===Ad&&(n=uve(n)),n}const VW=(t,e)=>{const n=B6(t),o=B6(e),c={...n};return l=>(c.red=PI(n.red,o.red,l),c.green=PI(n.green,o.green,l),c.blue=PI(n.blue,o.blue,l),c.alpha=Vn(n.alpha,o.alpha,l),Mu.transform(c))};function FW(t,e){return typeof t=="number"?n=>Vn(t,e,n):mi.test(t)?VW(t,e):BW(t,e)}const jW=(t,e)=>{const n=[...t],o=n.length,c=t.map((l,f)=>FW(l,e[f]));return l=>{for(let f=0;f<o;f++)n[f]=c[f](l);return n}},hve=(t,e)=>{const n={...t,...e},o={};for(const c in n)t[c]!==void 0&&e[c]!==void 0&&(o[c]=FW(t[c],e[c]));return c=>{for(const l in o)n[l]=o[l](c);return n}},BW=(t,e)=>{const n=Bc.createTransformer(e),o=Lv(t),c=Lv(e);return o.numColors===c.numColors&&o.numNumbers>=c.numNumbers?my(jW(o.values,c.values),n):f=>`${f>0?e:t}`},Uv=(t,e,n)=>{const o=e-t;return o===0?1:(n-t)/o},G6=(t,e)=>n=>Vn(t,e,n);function pve(t){return typeof t=="number"?G6:typeof t=="string"?mi.test(t)?VW:BW:Array.isArray(t)?jW:typeof t=="object"?hve:G6}function fve(t,e,n){const o=[],c=n||pve(t[0]),l=t.length-1;for(let f=0;f<l;f++){let _=c(t[f],t[f+1]);if(e){const y=Array.isArray(e)?e[f]:e;_=my(y,_)}o.push(_)}return o}function GW(t,e,{clamp:n=!0,ease:o,mixer:c}={}){const l=t.length;xv(l===e.length),xv(!o||!Array.isArray(o)||o.length===l-1),t[0]>t[l-1]&&(t=[...t].reverse(),e=[...e].reverse());const f=fve(e,o,c),_=f.length,y=S=>{let R=0;if(_>1)for(;R<t.length-2&&!(S<t[R+1]);R++);const w=Uv(t[R],t[R+1],S);return f[R](w)};return n?S=>y(oh(t[0],t[l-1],S)):y}const ZO=t=>t,WW=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,mve=1e-7,gve=12;function Eve(t,e,n,o,c){let l,f,_=0;do f=e+(n-e)/2,l=WW(f,o,c)-t,l>0?n=f:e=f;while(Math.abs(l)>mve&&++_<gve);return f}function HW(t,e,n,o){if(t===e&&n===o)return ZO;const c=l=>Eve(l,0,1,t,n);return l=>l===0||l===1?l:WW(c(l),e,o)}const $W=t=>1-Math.sin(Math.acos(t)),e2=XO($W),_ve=YO(e2),KW=HW(.33,1.53,.69,.99),t2=XO(KW),vve=YO(t2),yve=t=>(t*=2)<1?.5*t2(t):.5*(2-Math.pow(2,-10*(t-1))),Sve={linear:ZO,easeIn:JO,easeInOut:QO,easeOut:cve,circIn:$W,circInOut:_ve,circOut:e2,backIn:t2,backInOut:vve,backOut:KW,anticipate:yve},W6=t=>{if(Array.isArray(t)){xv(t.length===4);const[e,n,o,c]=t;return HW(e,n,o,c)}else if(typeof t=="string")return Sve[t];return t},Tve=t=>Array.isArray(t)&&typeof t[0]!="number";function Rve(t,e){return t.map(()=>e||QO).splice(0,t.length-1)}function Ive(t){const e=t.length;return t.map((n,o)=>o!==0?o/(e-1):0)}function wve(t,e){return t.map(n=>n*e)}function QC({keyframes:t,ease:e=QO,times:n,duration:o=300}){t=[...t];const c=Tve(e)?e.map(W6):W6(e),l={done:!1,value:t[0]},f=wve(n&&n.length===t.length?n:Ive(t),o);function _(){return GW(f,t,{ease:Array.isArray(c)?c:Rve(t,c)})}let y=_();return{next:S=>(l.value=y(S),l.done=S>=o,l),flipTarget:()=>{t.reverse(),y=_()}}}const DI=.001,Cve=.01,H6=10,Ave=.05,bve=1;function Ove({duration:t=800,bounce:e=.25,velocity:n=0,mass:o=1}){let c,l;ove(t<=H6*1e3);let f=1-e;f=oh(Ave,bve,f),t=oh(Cve,H6,t/1e3),f<1?(c=S=>{const R=S*f,w=R*t,b=R-n,k=ZC(S,f),M=Math.exp(-w);return DI-b/k*M},l=S=>{const w=S*f*t,b=w*n+n,k=Math.pow(f,2)*Math.pow(S,2)*t,M=Math.exp(-w),F=ZC(Math.pow(S,2),f);return(-c(S)+DI>0?-1:1)*((b-k)*M)/F}):(c=S=>{const R=Math.exp(-S*t),w=(S-n)*t+1;return-DI+R*w},l=S=>{const R=Math.exp(-S*t),w=(n-S)*(t*t);return R*w});const _=5/t,y=Pve(c,l,_);if(t=t*1e3,isNaN(y))return{stiffness:100,damping:10,duration:t};{const S=Math.pow(y,2)*o;return{stiffness:S,damping:f*2*Math.sqrt(o*S),duration:t}}}const Nve=12;function Pve(t,e,n){let o=n;for(let c=1;c<Nve;c++)o=o-t(o)/e(o);return o}function ZC(t,e){return t*Math.sqrt(1-e*e)}const Dve=["duration","bounce"],kve=["stiffness","damping","mass"];function $6(t,e){return e.some(n=>t[n]!==void 0)}function Lve(t){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!$6(t,kve)&&$6(t,Dve)){const n=Ove(t);e={...e,...n,velocity:0,mass:1},e.isResolvedFromDuration=!0}return e}const Mve=5;function qW({keyframes:t,restDelta:e,restSpeed:n,...o}){let c=t[0],l=t[t.length-1];const f={done:!1,value:c},{stiffness:_,damping:y,mass:S,velocity:R,duration:w,isResolvedFromDuration:b}=Lve(o);let k=xve,M=R?-(R/1e3):0;const F=y/(2*Math.sqrt(_*S));function Y(){const H=l-c,B=Math.sqrt(_/S)/1e3,K=Math.abs(H)<5;if(n||(n=K?.01:2),e||(e=K?.005:.5),F<1){const z=ZC(B,F);k=oe=>{const de=Math.exp(-F*B*oe);return l-de*((M+F*B*H)/z*Math.sin(z*oe)+H*Math.cos(z*oe))}}else if(F===1)k=z=>l-Math.exp(-B*z)*(H+(M+B*H)*z);else{const z=B*Math.sqrt(F*F-1);k=oe=>{const de=Math.exp(-F*B*oe),Ee=Math.min(z*oe,300);return l-de*((M+F*B*H)*Math.sinh(Ee)+z*H*Math.cosh(Ee))/z}}}return Y(),{next:H=>{const B=k(H);if(b)f.done=H>=w;else{let K=M;if(H!==0)if(F<1){const de=Math.max(0,H-Mve);K=$O(B-k(de),H-de)}else K=0;const z=Math.abs(K)<=n,oe=Math.abs(l-B)<=e;f.done=z&&oe}return f.value=f.done?l:B,f},flipTarget:()=>{M=-M,[c,l]=[l,c],Y()}}}qW.needsInterpolation=(t,e)=>typeof t=="string"||typeof e=="string";const xve=t=>0;function Uve({keyframes:t=[0],velocity:e=0,power:n=.8,timeConstant:o=350,restDelta:c=.5,modifyTarget:l}){const f=t[0],_={done:!1,value:f};let y=n*e;const S=f+y,R=l===void 0?S:l(S);return R!==S&&(y=R-f),{next:w=>{const b=-y*Math.exp(-w/o);return _.done=!(b>c||b<-c),_.value=_.done?R:R+b,_},flipTarget:()=>{}}}const Vve={decay:Uve,keyframes:QC,tween:QC,spring:qW};function zW(t,e,n=0){return t-e-n}function Fve(t,e=0,n=0,o=!0){return o?zW(e+-t,e,n):e-(t-e)+n}function jve(t,e,n,o){return o?t>=e+n:t<=-n}const Bve=t=>{const e=({delta:n})=>t(n);return{start:()=>ci.update(e,!0),stop:()=>jc.update(e)}};function Vv({duration:t,driver:e=Bve,elapsed:n=0,repeat:o=0,repeatType:c="loop",repeatDelay:l=0,keyframes:f,autoplay:_=!0,onPlay:y,onStop:S,onComplete:R,onRepeat:w,onUpdate:b,type:k="keyframes",...M}){var F,Y;const H=n;let B,K=0,z=t,oe=!1,de=!0,Ee;const we=Vve[f.length>2?"keyframes":k]||QC,Fe=f[0],be=f[f.length-1];let dt={done:!1,value:Fe};!((Y=(F=we).needsInterpolation)===null||Y===void 0)&&Y.call(F,Fe,be)&&(Ee=GW([0,100],[Fe,be],{clamp:!1}),f=[0,100]);const kn=we({...M,duration:t,keyframes:f});function Vi(){K++,c==="reverse"?(de=K%2===0,n=Fve(n,z,l,de)):(n=zW(n,z,l),c==="mirror"&&kn.flipTarget()),oe=!1,w&&w()}function jn(){B&&B.stop(),R&&R()}function sn(ur){de||(ur=-ur),n+=ur,oe||(dt=kn.next(Math.max(0,n)),Ee&&(dt.value=Ee(dt.value)),oe=de?dt.done:n<=0),b&&b(dt.value),oe&&(K===0&&(z=z!==void 0?z:n),K<o?jve(n,z,l,de)&&Vi():jn())}function Hn(){y&&y(),B=e(sn),B.start()}return _&&Hn(),{stop:()=>{S&&S(),B&&B.stop()},set currentTime(ur){n=H,sn(ur)},sample:ur=>{n=H;const Ue=t&&typeof t=="number"?Math.max(t*.5,50):50;let rt=0;for(sn(0);rt<=ur;){const st=ur-rt;sn(Math.min(st,Ue)),rt+=Ue}return dt}}}function Gve(t){return!t||Array.isArray(t)||typeof t=="string"&&YW[t]}const Fp=([t,e,n,o])=>`cubic-bezier(${t}, ${e}, ${n}, ${o})`,YW={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Fp([0,.65,.55,1]),circOut:Fp([.55,0,1,.45]),backIn:Fp([.31,.01,.66,-.59]),backOut:Fp([.33,1.53,.69,.99])};function Wve(t){if(t)return Array.isArray(t)?Fp(t):YW[t]}function Hve(t,e,n,{delay:o=0,duration:c,repeat:l=0,repeatType:f="loop",ease:_,times:y}={}){return t.animate({[e]:n,offset:y},{delay:o,duration:c,easing:Wve(_),fill:"both",iterations:l+1,direction:f==="reverse"?"alternate":"normal"})}const K6={waapi:()=>Object.hasOwnProperty.call(Element.prototype,"animate")},kI={},XW={};for(const t in K6)XW[t]=()=>(kI[t]===void 0&&(kI[t]=K6[t]()),kI[t]);function $ve(t,{repeat:e,repeatType:n="loop"}){const o=e&&n!=="loop"&&e%2===1?0:t.length-1;return t[o]}const Kve=new Set(["opacity"]),YE=10;function qve(t,e,{onUpdate:n,onComplete:o,...c}){if(!(XW.waapi()&&Kve.has(e)&&!c.repeatDelay&&c.repeatType!=="mirror"&&c.damping!==0))return!1;let{keyframes:f,duration:_=300,elapsed:y=0,ease:S}=c;if(c.type==="spring"||!Gve(c.ease)){if(c.repeat===1/0)return;const w=Vv({...c,elapsed:0});let b={done:!1,value:f[0]};const k=[];let M=0;for(;!b.done&&M<2e4;)b=w.sample(M),k.push(b.value),M+=YE;f=k,_=M-YE,S="linear"}const R=Hve(t.owner.current,e,f,{...c,delay:-y,duration:_,ease:S});return R.onfinish=()=>{t.set($ve(f,c)),ci.update(()=>R.cancel()),o&&o()},{get currentTime(){return R.currentTime||0},set currentTime(w){R.currentTime=w},stop:()=>{const{currentTime:w}=R;if(w){const b=Vv({...c,autoplay:!1});t.setWithVelocity(b.sample(w-YE).value,b.sample(w).value,YE)}ci.update(()=>R.cancel())}}}function JW(t,e){const n=performance.now(),o=({timestamp:c})=>{const l=c-n;l>=e&&(jc.read(o),t(l-e))};return ci.read(o,!0),()=>jc.read(o)}function zve({keyframes:t,elapsed:e,onUpdate:n,onComplete:o}){const c=()=>{n&&n(t[t.length-1]),o&&o()};return e?{stop:JW(c,-e)}:c()}function Yve({keyframes:t,velocity:e=0,min:n,max:o,power:c=.8,timeConstant:l=750,bounceStiffness:f=500,bounceDamping:_=10,restDelta:y=1,modifyTarget:S,driver:R,onUpdate:w,onComplete:b,onStop:k}){const M=t[0];let F;function Y(z){return n!==void 0&&z<n||o!==void 0&&z>o}function H(z){return n===void 0?o:o===void 0||Math.abs(n-z)<Math.abs(o-z)?n:o}function B(z){F==null||F.stop(),F=Vv({keyframes:[0,1],velocity:0,...z,driver:R,onUpdate:oe=>{var de;w==null||w(oe),(de=z.onUpdate)===null||de===void 0||de.call(z,oe)},onComplete:b,onStop:k})}function K(z){B({type:"spring",stiffness:f,damping:_,restDelta:y,...z})}if(Y(M))K({velocity:e,keyframes:[M,H(M)]});else{let z=c*e+M;typeof S<"u"&&(z=S(z));const oe=H(z),de=oe===n?-1:1;let Ee,we;const Fe=be=>{Ee=we,we=be,e=$O(be-Ee,ya.delta),(de===1&&be>oe||de===-1&&be<oe)&&K({keyframes:[be,oe],velocity:e})};B({type:"decay",keyframes:[M,0],velocity:e,timeConstant:l,power:c,restDelta:y,modifyTarget:S,onUpdate:Y(z)?Fe:void 0})}return{stop:()=>F==null?void 0:F.stop()}}const Su=()=>({type:"spring",stiffness:500,damping:25,restSpeed:10}),XE=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),LI=()=>({type:"keyframes",ease:"linear",duration:.3}),Xve={type:"keyframes",duration:.8},q6={x:Su,y:Su,z:Su,rotate:Su,rotateX:Su,rotateY:Su,rotateZ:Su,scaleX:XE,scaleY:XE,scale:XE,opacity:LI,backgroundColor:LI,color:LI,default:XE},Jve=(t,{keyframes:e})=>e.length>2?Xve:(q6[t]||q6.default)(e[1]),eA=(t,e)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&Bc.test(e)&&!e.startsWith("url("));function Qve({when:t,delay:e,delayChildren:n,staggerChildren:o,staggerDirection:c,repeat:l,repeatType:f,repeatDelay:_,from:y,elapsed:S,...R}){return!!Object.keys(R).length}function z6(t){return t===0||typeof t=="string"&&parseFloat(t)===0&&t.indexOf(" ")===-1}function Y6(t){return typeof t=="number"?0:zO("",t)}function QW(t,e){return t[e]||t.default||t}function Zve(t,e,n,o){const c=eA(e,n);let l=o.from!==void 0?o.from:t.get();return l==="none"&&c&&typeof n=="string"?l=zO(e,n):z6(l)&&typeof n=="string"?l=Y6(n):!Array.isArray(n)&&z6(n)&&typeof l=="string"&&(n=Y6(l)),Array.isArray(n)?(n[0]===null&&(n[0]=l),n):[l,n]}const n2=(t,e,n,o={})=>c=>{const l=QW(o,t)||{},f=l.delay||o.delay||0;let{elapsed:_=0}=o;_=_-v_(f);const y=Zve(e,t,n,l),S=y[0],R=y[y.length-1],w=eA(t,S),b=eA(t,R);let k={keyframes:y,velocity:e.getVelocity(),...l,elapsed:_,onUpdate:Y=>{e.set(Y),l.onUpdate&&l.onUpdate(Y)},onComplete:()=>{c(),l.onComplete&&l.onComplete()}};if(!w||!b||ave.current||l.type===!1)return zve(k);if(l.type==="inertia")return Yve(k);Qve(l)||(k={...k,...Jve(t,k)}),k.duration&&(k.duration=v_(k.duration)),k.repeatDelay&&(k.repeatDelay=v_(k.repeatDelay));const M=e.owner,F=M&&M.current;if(M&&F instanceof HTMLElement&&!(M!=null&&M.getProps().onUpdate)){const Y=qve(e,t,k);if(Y)return Y}return Vv(k)};function e1e(t,e,n={}){t.notify("AnimationStart",e);let o;if(Array.isArray(e)){const c=e.map(l=>tA(t,l,n));o=Promise.all(c)}else if(typeof e=="string")o=tA(t,e,n);else{const c=typeof e=="function"?Ey(t,e,n.custom):e;o=ZW(t,c,n)}return o.then(()=>t.notify("AnimationComplete",e))}function tA(t,e,n={}){var o;const c=Ey(t,e,n.custom);let{transition:l=t.getDefaultTransition()||{}}=c||{};n.transitionOverride&&(l=n.transitionOverride);const f=c?()=>ZW(t,c,n):()=>Promise.resolve(),_=!((o=t.variantChildren)===null||o===void 0)&&o.size?(S=0)=>{const{delayChildren:R=0,staggerChildren:w,staggerDirection:b}=l;return t1e(t,e,R+S,w,b,n)}:()=>Promise.resolve(),{when:y}=l;if(y){const[S,R]=y==="beforeChildren"?[f,_]:[_,f];return S().then(R)}else return Promise.all([f(),_(n.delay)])}function ZW(t,e,{delay:n=0,transitionOverride:o,type:c}={}){var l;let{transition:f=t.getDefaultTransition(),transitionEnd:_,...y}=t.makeTargetAnimatable(e);const S=t.getValue("willChange");o&&(f=o);const R=[],w=c&&((l=t.animationState)===null||l===void 0?void 0:l.getState()[c]);for(const b in y){const k=t.getValue(b),M=y[b];if(!k||M===void 0||w&&r1e(w,b))continue;const F={delay:n,elapsed:0,...f};if(window.HandoffAppearAnimations&&!k.hasAnimated){const H=t.getProps()[sve];H&&(F.elapsed=window.HandoffAppearAnimations(H,b,k,ci))}let Y=k.start(n2(b,k,M,t.shouldReduceMotion&&Ch.has(b)?{type:!1}:F));Mv(S)&&(S.add(b),Y=Y.then(()=>S.remove(b))),R.push(Y)}return Promise.all(R).then(()=>{_&&eve(t,_)})}function t1e(t,e,n=0,o=0,c=1,l){const f=[],_=(t.variantChildren.size-1)*o,y=c===1?(S=0)=>S*o:(S=0)=>_-S*o;return Array.from(t.variantChildren).sort(n1e).forEach((S,R)=>{S.notify("AnimationStart",e),f.push(tA(S,e,{...l,delay:n+y(R)}).then(()=>S.notify("AnimationComplete",e)))}),Promise.all(f)}function n1e(t,e){return t.sortNodePosition(e)}function r1e({protectedKeys:t,needsAnimating:e},n){const o=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,o}const r2=[gn.Animate,gn.InView,gn.Focus,gn.Hover,gn.Tap,gn.Drag,gn.Exit],i1e=[...r2].reverse(),s1e=r2.length;function o1e(t){return e=>Promise.all(e.map(({animation:n,options:o})=>e1e(t,n,o)))}function a1e(t){let e=o1e(t);const n=u1e();let o=!0;const c=(y,S)=>{const R=Ey(t,S);if(R){const{transition:w,transitionEnd:b,...k}=R;y={...y,...k,...b}}return y};function l(y){e=y(t)}function f(y,S){const R=t.getProps(),w=t.getVariantContext(!0)||{},b=[],k=new Set;let M={},F=1/0;for(let H=0;H<s1e;H++){const B=i1e[H],K=n[B],z=R[B]!==void 0?R[B]:w[B],oe=$f(z),de=B===S?K.isActive:null;de===!1&&(F=H);let Ee=z===w[B]&&z!==R[B]&&oe;if(Ee&&o&&t.manuallyAnimateOnMount&&(Ee=!1),K.protectedKeys={...M},!K.isActive&&de===null||!z&&!K.prevProp||dy(z)||typeof z=="boolean")continue;const we=c1e(K.prevProp,z);let Fe=we||B===S&&K.isActive&&!Ee&&oe||H>F&&oe;const be=Array.isArray(z)?z:[z];let dt=be.reduce(c,{});de===!1&&(dt={});const{prevResolvedValues:kn={}}=K,Vi={...kn,...dt},jn=sn=>{Fe=!0,k.delete(sn),K.needsAnimating[sn]=!0};for(const sn in Vi){const Hn=dt[sn],ur=kn[sn];M.hasOwnProperty(sn)||(Hn!==ur?Pv(Hn)&&Pv(ur)?!AW(Hn,ur)||we?jn(sn):K.protectedKeys[sn]=!0:Hn!==void 0?jn(sn):k.add(sn):Hn!==void 0&&k.has(sn)?jn(sn):K.protectedKeys[sn]=!0)}K.prevProp=z,K.prevResolvedValues=dt,K.isActive&&(M={...M,...dt}),o&&t.blockInitialAnimation&&(Fe=!1),Fe&&!Ee&&b.push(...be.map(sn=>({animation:sn,options:{type:B,...y}})))}if(k.size){const H={};k.forEach(B=>{const K=t.getBaseTarget(B);K!==void 0&&(H[B]=K)}),b.push({animation:H})}let Y=Boolean(b.length);return o&&R.initial===!1&&!t.manuallyAnimateOnMount&&(Y=!1),o=!1,Y?e(b):Promise.resolve()}function _(y,S,R){var w;if(n[y].isActive===S)return Promise.resolve();(w=t.variantChildren)===null||w===void 0||w.forEach(k=>{var M;return(M=k.animationState)===null||M===void 0?void 0:M.setActive(y,S)}),n[y].isActive=S;const b=f(R,y);for(const k in n)n[k].protectedKeys={};return b}return{animateChanges:f,setActive:_,setAnimateFunction:l,getState:()=>n}}function c1e(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!AW(e,t):!1}function Tu(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function u1e(){return{[gn.Animate]:Tu(!0),[gn.InView]:Tu(),[gn.Hover]:Tu(),[gn.Tap]:Tu(),[gn.Drag]:Tu(),[gn.Focus]:Tu(),[gn.Exit]:Tu()}}const l1e={animation:mc(({visualElement:t,animate:e})=>{t.animationState||(t.animationState=a1e(t)),dy(e)&&te.useEffect(()=>e.subscribe(t),[e])}),exit:mc(t=>{const{custom:e,visualElement:n}=t,[o,c]=CW(),l=te.useContext(Im);te.useEffect(()=>{n.isPresent=o;const f=n.animationState&&n.animationState.setActive(gn.Exit,!o,{custom:l&&l.custom||e});f&&!o&&f.then(c)},[o])})},X6=(t,e)=>Math.abs(t-e);function d1e(t,e){const n=X6(t.x,e.x),o=X6(t.y,e.y);return Math.sqrt(n**2+o**2)}class eH{constructor(e,n,{transformPagePoint:o}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const S=xI(this.lastMoveEventInfo,this.history),R=this.startEvent!==null,w=d1e(S.offset,{x:0,y:0})>=3;if(!R&&!w)return;const{point:b}=S,{timestamp:k}=ya;this.history.push({...b,timestamp:k});const{onStart:M,onMove:F}=this.handlers;R||(M&&M(this.lastMoveEvent,S),this.startEvent=this.lastMoveEvent),F&&F(this.lastMoveEvent,S)},this.handlePointerMove=(S,R)=>{this.lastMoveEvent=S,this.lastMoveEventInfo=MI(R,this.transformPagePoint),ci.update(this.updatePoint,!0)},this.handlePointerUp=(S,R)=>{if(this.end(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const{onEnd:w,onSessionEnd:b}=this.handlers,k=xI(S.type==="pointercancel"?this.lastMoveEventInfo:MI(R,this.transformPagePoint),this.history);this.startEvent&&w&&w(S,k),b&&b(S,k)},!yW(e))return;this.handlers=n,this.transformPagePoint=o;const c=fy(e),l=MI(c,this.transformPagePoint),{point:f}=l,{timestamp:_}=ya;this.history=[{...f,timestamp:_}];const{onSessionStart:y}=n;y&&y(e,xI(l,this.history)),this.removeListeners=my(Bd(window,"pointermove",this.handlePointerMove),Bd(window,"pointerup",this.handlePointerUp),Bd(window,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),jc.update(this.updatePoint)}}function MI(t,e){return e?{point:e(t.point)}:t}function J6(t,e){return{x:t.x-e.x,y:t.y-e.y}}function xI({point:t},e){return{point:t,delta:J6(t,tH(e)),offset:J6(t,h1e(e)),velocity:p1e(e,.1)}}function h1e(t){return t[0]}function tH(t){return t[t.length-1]}function p1e(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,o=null;const c=tH(t);for(;n>=0&&(o=t[n],!(c.timestamp-o.timestamp>v_(e)));)n--;if(!o)return{x:0,y:0};const l=(c.timestamp-o.timestamp)/1e3;if(l===0)return{x:0,y:0};const f={x:(c.x-o.x)/l,y:(c.y-o.y)/l};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function ds(t){return t.max-t.min}function nA(t,e=0,n=.01){return Math.abs(t-e)<=n}function Q6(t,e,n,o=.5){t.origin=o,t.originPoint=Vn(e.min,e.max,t.origin),t.scale=ds(n)/ds(e),(nA(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=Vn(n.min,n.max,t.origin)-t.originPoint,(nA(t.translate)||isNaN(t.translate))&&(t.translate=0)}function of(t,e,n,o){Q6(t.x,e.x,n.x,o==null?void 0:o.originX),Q6(t.y,e.y,n.y,o==null?void 0:o.originY)}function Z6(t,e,n){t.min=n.min+e.min,t.max=t.min+ds(e)}function f1e(t,e,n){Z6(t.x,e.x,n.x),Z6(t.y,e.y,n.y)}function e8(t,e,n){t.min=e.min-n.min,t.max=t.min+ds(e)}function af(t,e,n){e8(t.x,e.x,n.x),e8(t.y,e.y,n.y)}function m1e(t,{min:e,max:n},o){return e!==void 0&&t<e?t=o?Vn(e,t,o.min):Math.max(t,e):n!==void 0&&t>n&&(t=o?Vn(n,t,o.max):Math.min(t,n)),t}function t8(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function g1e(t,{top:e,left:n,bottom:o,right:c}){return{x:t8(t.x,n,c),y:t8(t.y,e,o)}}function n8(t,e){let n=e.min-t.min,o=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,o]=[o,n]),{min:n,max:o}}function E1e(t,e){return{x:n8(t.x,e.x),y:n8(t.y,e.y)}}function _1e(t,e){let n=.5;const o=ds(t),c=ds(e);return c>o?n=Uv(e.min,e.max-o,t.min):o>c&&(n=Uv(t.min,t.max-c,e.min)),oh(0,1,n)}function v1e(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const rA=.35;function y1e(t=rA){return t===!1?t=0:t===!0&&(t=rA),{x:r8(t,"left","right"),y:r8(t,"top","bottom")}}function r8(t,e,n){return{min:i8(t,e),max:i8(t,n)}}function i8(t,e){return typeof t=="number"?t:t[e]||0}const s8=()=>({translate:0,scale:1,origin:0,originPoint:0}),cf=()=>({x:s8(),y:s8()}),o8=()=>({min:0,max:0}),fr=()=>({x:o8(),y:o8()});function Io(t){return[t("x"),t("y")]}function nH({top:t,left:e,right:n,bottom:o}){return{x:{min:e,max:n},y:{min:t,max:o}}}function S1e({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function T1e(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),o=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:o.y,right:o.x}}function UI(t){return t===void 0||t===1}function iA({scale:t,scaleX:e,scaleY:n}){return!UI(t)||!UI(e)||!UI(n)}function Au(t){return iA(t)||rH(t)||t.z||t.rotate||t.rotateX||t.rotateY}function rH(t){return a8(t.x)||a8(t.y)}function a8(t){return t&&t!=="0%"}function Fv(t,e,n){const o=t-n,c=e*o;return n+c}function c8(t,e,n,o,c){return c!==void 0&&(t=Fv(t,c,o)),Fv(t,n,o)+e}function sA(t,e=0,n=1,o,c){t.min=c8(t.min,e,n,o,c),t.max=c8(t.max,e,n,o,c)}function iH(t,{x:e,y:n}){sA(t.x,e.translate,e.scale,e.originPoint),sA(t.y,n.translate,n.scale,n.originPoint)}function R1e(t,e,n,o=!1){var c,l;const f=n.length;if(!f)return;e.x=e.y=1;let _,y;for(let S=0;S<f;S++)_=n[S],y=_.projectionDelta,((l=(c=_.instance)===null||c===void 0?void 0:c.style)===null||l===void 0?void 0:l.display)!=="contents"&&(o&&_.options.layoutScroll&&_.scroll&&_!==_.root&&bd(t,{x:-_.scroll.offset.x,y:-_.scroll.offset.y}),y&&(e.x*=y.x.scale,e.y*=y.y.scale,iH(t,y)),o&&Au(_.latestValues)&&bd(t,_.latestValues));e.x=u8(e.x),e.y=u8(e.y)}function u8(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function sc(t,e){t.min=t.min+e,t.max=t.max+e}function l8(t,e,[n,o,c]){const l=e[c]!==void 0?e[c]:.5,f=Vn(t.min,t.max,l);sA(t,e[n],e[o],f,e.scale)}const I1e=["x","scaleX","originX"],w1e=["y","scaleY","originY"];function bd(t,e){l8(t.x,e,I1e),l8(t.y,e,w1e)}function sH(t,e){return nH(T1e(t.getBoundingClientRect(),e))}function C1e(t,e,n){const o=sH(t,n),{scroll:c}=e;return c&&(sc(o.x,c.offset.x),sc(o.y,c.offset.y)),o}const A1e=new WeakMap;class b1e{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=fr(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){if(this.visualElement.isPresent===!1)return;const o=_=>{this.stopAnimation(),n&&this.snapToCursor(fy(_,"page").point)},c=(_,y)=>{var S;const{drag:R,dragPropagation:w,onDragStart:b}=this.getProps();R&&!w&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=RW(R),!this.openGlobalLock)||(this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Io(k=>{var M,F;let Y=this.getAxisMotionValue(k).get()||0;if(Mo.test(Y)){const H=(F=(M=this.visualElement.projection)===null||M===void 0?void 0:M.layout)===null||F===void 0?void 0:F.layoutBox[k];H&&(Y=ds(H)*(parseFloat(Y)/100))}this.originPoint[k]=Y}),b==null||b(_,y),(S=this.visualElement.animationState)===null||S===void 0||S.setActive(gn.Drag,!0))},l=(_,y)=>{const{dragPropagation:S,dragDirectionLock:R,onDirectionLock:w,onDrag:b}=this.getProps();if(!S&&!this.openGlobalLock)return;const{offset:k}=y;if(R&&this.currentDirection===null){this.currentDirection=O1e(k),this.currentDirection!==null&&(w==null||w(this.currentDirection));return}this.updateAxis("x",y.point,k),this.updateAxis("y",y.point,k),this.visualElement.render(),b==null||b(_,y)},f=(_,y)=>this.stop(_,y);this.panSession=new eH(e,{onSessionStart:o,onStart:c,onMove:l,onSessionEnd:f},{transformPagePoint:this.visualElement.getTransformPagePoint()})}stop(e,n){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:c}=n;this.startAnimation(c);const{onDragEnd:l}=this.getProps();l==null||l(e,n)}cancel(){var e,n;this.isDragging=!1,this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!1),(e=this.panSession)===null||e===void 0||e.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),(n=this.visualElement.animationState)===null||n===void 0||n.setActive(gn.Drag,!1)}updateAxis(e,n,o){const{drag:c}=this.getProps();if(!o||!JE(e,c,this.currentDirection))return;const l=this.getAxisMotionValue(e);let f=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(f=m1e(f,this.constraints[e],this.elastic[e])),l.set(f)}resolveConstraints(){const{dragConstraints:e,dragElastic:n}=this.getProps(),{layout:o}=this.visualElement.projection||{},c=this.constraints;e&&Cd(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&o?this.constraints=g1e(o.layoutBox,e):this.constraints=!1,this.elastic=y1e(n),c!==this.constraints&&o&&this.constraints&&!this.hasMutatedConstraints&&Io(l=>{this.getAxisMotionValue(l)&&(this.constraints[l]=v1e(o.layoutBox[l],this.constraints[l]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Cd(e))return!1;const o=e.current,{projection:c}=this.visualElement;if(!c||!c.layout)return!1;const l=C1e(o,c.root,this.visualElement.getTransformPagePoint());let f=E1e(c.layout.layoutBox,l);if(n){const _=n(S1e(f));this.hasMutatedConstraints=!!_,_&&(f=nH(_))}return f}startAnimation(e){const{drag:n,dragMomentum:o,dragElastic:c,dragTransition:l,dragSnapToOrigin:f,onDragTransitionEnd:_}=this.getProps(),y=this.constraints||{},S=Io(R=>{if(!JE(R,n,this.currentDirection))return;let w=(y==null?void 0:y[R])||{};f&&(w={min:0,max:0});const b=c?200:1e6,k=c?40:1e7,M={type:"inertia",velocity:o?e[R]:0,bounceStiffness:b,bounceDamping:k,timeConstant:750,restDelta:1,restSpeed:10,...l,...w};return this.startAxisValueAnimation(R,M)});return Promise.all(S).then(_)}startAxisValueAnimation(e,n){const o=this.getAxisMotionValue(e);return o.start(n2(e,o,0,n))}stopAnimation(){Io(e=>this.getAxisMotionValue(e).stop())}getAxisMotionValue(e){var n;const o="_drag"+e.toUpperCase(),c=this.visualElement.getProps()[o];return c||this.visualElement.getValue(e,((n=this.visualElement.getProps().initial)===null||n===void 0?void 0:n[e])||0)}snapToCursor(e){Io(n=>{const{drag:o}=this.getProps();if(!JE(n,o,this.currentDirection))return;const{projection:c}=this.visualElement,l=this.getAxisMotionValue(n);if(c&&c.layout){const{min:f,max:_}=c.layout.layoutBox[n];l.set(e[n]-Vn(f,_,.5))}})}scalePositionWithinConstraints(){var e;if(!this.visualElement.current)return;const{drag:n,dragConstraints:o}=this.getProps(),{projection:c}=this.visualElement;if(!Cd(o)||!c||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Io(_=>{const y=this.getAxisMotionValue(_);if(y){const S=y.get();l[_]=_1e({min:S,max:S},this.constraints[_])}});const{transformTemplate:f}=this.visualElement.getProps();this.visualElement.current.style.transform=f?f({},""):"none",(e=c.root)===null||e===void 0||e.updateScroll(),c.updateLayout(),this.resolveConstraints(),Io(_=>{if(!JE(_,n,null))return;const y=this.getAxisMotionValue(_),{min:S,max:R}=this.constraints[_];y.set(Vn(S,R,l[_]))})}addListeners(){var e;if(!this.visualElement.current)return;A1e.set(this.visualElement,this);const n=this.visualElement.current,o=Bd(n,"pointerdown",S=>{const{drag:R,dragListener:w=!0}=this.getProps();R&&w&&this.start(S)}),c=()=>{const{dragConstraints:S}=this.getProps();Cd(S)&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,f=l.addEventListener("measure",c);l&&!l.layout&&((e=l.root)===null||e===void 0||e.updateScroll(),l.updateLayout()),c();const _=Bu(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",({delta:S,hasLayoutChanged:R})=>{this.isDragging&&R&&(Io(w=>{const b=this.getAxisMotionValue(w);b&&(this.originPoint[w]+=S[w].translate,b.set(b.get()+S[w].translate))}),this.visualElement.render())});return()=>{_(),o(),f(),y==null||y()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:o=!1,dragPropagation:c=!1,dragConstraints:l=!1,dragElastic:f=rA,dragMomentum:_=!0}=e;return{...e,drag:n,dragDirectionLock:o,dragPropagation:c,dragConstraints:l,dragElastic:f,dragMomentum:_}}}function JE(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function O1e(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}function N1e(t){const{dragControls:e,visualElement:n}=t,o=py(()=>new b1e(n));te.useEffect(()=>e&&e.subscribe(o),[o,e]),te.useEffect(()=>o.addListeners(),[o])}function P1e({onPan:t,onPanStart:e,onPanEnd:n,onPanSessionStart:o,visualElement:c}){const l=t||e||n||o,f=te.useRef(null),{transformPagePoint:_}=te.useContext(PO),y={onSessionStart:o,onStart:e,onMove:t,onEnd:(R,w)=>{f.current=null,n&&n(R,w)}};te.useEffect(()=>{f.current!==null&&f.current.updateHandlers(y)});function S(R){f.current=new eH(R,y,{transformPagePoint:_})}kv(c,"pointerdown",l&&S),BO(()=>f.current&&f.current.end())}const D1e={pan:mc(P1e),drag:mc(N1e)};function oA(t){return typeof t=="string"&&t.startsWith("var(--")}const oH=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function k1e(t){const e=oH.exec(t);if(!e)return[,];const[,n,o]=e;return[n,o]}function aA(t,e,n=1){const[o,c]=k1e(t);if(!o)return;const l=window.getComputedStyle(e).getPropertyValue(o);return l?l.trim():oA(c)?aA(c,e,n+1):c}function L1e(t,{...e},n){const o=t.current;if(!(o instanceof Element))return{target:e,transitionEnd:n};n&&(n={...n}),t.values.forEach(c=>{const l=c.get();if(!oA(l))return;const f=aA(l,o);f&&c.set(f)});for(const c in e){const l=e[c];if(!oA(l))continue;const f=aA(l,o);f&&(e[c]=f,n&&n[c]===void 0&&(n[c]=l))}return{target:e,transitionEnd:n}}const M1e=new Set(["width","height","top","left","right","bottom","x","y"]),aH=t=>M1e.has(t),x1e=t=>Object.keys(t).some(aH),d8=t=>t===ol||t===nt;var h8;(function(t){t.width="width",t.height="height",t.left="left",t.right="right",t.top="top",t.bottom="bottom"})(h8||(h8={}));const p8=(t,e)=>parseFloat(t.split(", ")[e]),f8=(t,e)=>(n,{transform:o})=>{if(o==="none"||!o)return 0;const c=o.match(/^matrix3d\((.+)\)$/);if(c)return p8(c[1],e);{const l=o.match(/^matrix\((.+)\)$/);return l?p8(l[1],t):0}},U1e=new Set(["x","y","z"]),V1e=Ov.filter(t=>!U1e.has(t));function F1e(t){const e=[];return V1e.forEach(n=>{const o=t.getValue(n);o!==void 0&&(e.push([n,o.get()]),o.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}const m8={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:f8(4,13),y:f8(5,14)},j1e=(t,e,n)=>{const o=e.measureViewportBox(),c=e.current,l=getComputedStyle(c),{display:f}=l,_={};f==="none"&&e.setStaticValue("display",t.display||"block"),n.forEach(S=>{_[S]=m8[S](o,l)}),e.render();const y=e.measureViewportBox();return n.forEach(S=>{const R=e.getValue(S);R&&R.jump(_[S]),t[S]=m8[S](y,l)}),t},B1e=(t,e,n={},o={})=>{e={...e},o={...o};const c=Object.keys(e).filter(aH);let l=[],f=!1;const _=[];if(c.forEach(y=>{const S=t.getValue(y);if(!t.hasValue(y))return;let R=n[y],w=Cp(R);const b=e[y];let k;if(Pv(b)){const M=b.length,F=b[0]===null?1:0;R=b[F],w=Cp(R);for(let Y=F;Y<M;Y++)k?xv(Cp(b[Y])===k):k=Cp(b[Y])}else k=Cp(b);if(w!==k)if(d8(w)&&d8(k)){const M=S.get();typeof M=="string"&&S.set(parseFloat(M)),typeof b=="string"?e[y]=parseFloat(b):Array.isArray(b)&&k===nt&&(e[y]=b.map(parseFloat))}else w!=null&&w.transform&&(k!=null&&k.transform)&&(R===0||b===0)?R===0?S.set(k.transform(R)):e[y]=w.transform(b):(f||(l=F1e(t),f=!0),_.push(y),o[y]=o[y]!==void 0?o[y]:e[y],S.jump(b))}),_.length){const y=_.indexOf("height")>=0?window.pageYOffset:null,S=j1e(e,t,_);return l.length&&l.forEach(([R,w])=>{t.getValue(R).set(w)}),t.render(),ly&&y!==null&&window.scrollTo({top:y}),{target:S,transitionEnd:o}}else return{target:e,transitionEnd:o}};function G1e(t,e,n,o){return x1e(e)?B1e(t,e,n,o):{target:e,transitionEnd:o}}const W1e=(t,e,n,o)=>{const c=L1e(t,e,o);return e=c.target,o=c.transitionEnd,G1e(t,e,n,o)},cA={current:null},cH={current:!1};function H1e(){if(cH.current=!0,!!ly)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>cA.current=t.matches;t.addListener(e),e()}else cA.current=!1}function $1e(t,e,n){const{willChange:o}=e;for(const c in e){const l=e[c],f=n[c];if(xi(l))t.addValue(c,l),Mv(o)&&o.add(c);else if(xi(f))t.addValue(c,ah(l,{owner:t})),Mv(o)&&o.remove(c);else if(f!==l)if(t.hasValue(c)){const _=t.getValue(c);!_.hasAnimated&&_.set(l)}else{const _=t.getStaticValue(c);t.addValue(c,ah(_!==void 0?_:l,{owner:t}))}}for(const c in n)e[c]===void 0&&t.removeValue(c);return e}const uH=Object.keys(Kf),K1e=uH.length,g8=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class q1e{constructor({parent:e,props:n,reducedMotionConfig:o,visualState:c},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.isPresent=!0,this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>ci.render(this.render,!1,!0);const{latestValues:f,renderState:_}=c;this.latestValues=f,this.baseTarget={...f},this.initialValues=n.initial?{...f}:{},this.renderState=_,this.parent=e,this.props=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=o,this.options=l,this.isControllingVariants=hy(n),this.isVariantNode=aW(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const{willChange:y,...S}=this.scrapeMotionValuesFromProps(n,{});for(const R in S){const w=S[R];f[R]!==void 0&&xi(w)&&(w.set(f[R],!1),Mv(y)&&y.add(R))}}scrapeMotionValuesFromProps(e,n){return{}}mount(e){var n;this.current=e,this.projection&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=(n=this.parent)===null||n===void 0?void 0:n.addVariantChild(this)),this.values.forEach((o,c)=>this.bindToMotionValue(c,o)),cH.current||H1e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:cA.current,this.parent&&this.parent.children.add(this),this.setProps(this.props)}unmount(){var e,n,o;(e=this.projection)===null||e===void 0||e.unmount(),jc.update(this.notifyUpdate),jc.render(this.render),this.valueSubscriptions.forEach(c=>c()),(n=this.removeFromVariantTree)===null||n===void 0||n.call(this),(o=this.parent)===null||o===void 0||o.children.delete(this);for(const c in this.events)this.events[c].clear();this.current=null}bindToMotionValue(e,n){const o=Ch.has(e),c=n.on("change",f=>{this.latestValues[e]=f,this.props.onUpdate&&ci.update(this.notifyUpdate,!1,!0),o&&this.projection&&(this.projection.isTransformDirty=!0)}),l=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{c(),l()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...n},o,c,l,f,_){const y=[];for(let S=0;S<K1e;S++){const R=uH[S],{isEnabled:w,Component:b}=Kf[R];w(n)&&b&&y.push(te.createElement(b,{key:R,...n,visualElement:this}))}if(!this.projection&&f){this.projection=new f(l,this.latestValues,this.parent&&this.parent.projection);const{layoutId:S,layout:R,drag:w,dragConstraints:b,layoutScroll:k,layoutRoot:M}=n;this.projection.setOptions({layoutId:S,layout:R,alwaysMeasureLayout:Boolean(w)||b&&Cd(b),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof R=="string"?R:"both",initialPromotionConfig:_,layoutScroll:k,layoutRoot:M})}return y}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):fr()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}makeTargetAnimatable(e,n=!0){return this.makeTargetAnimatableFromInstance(e,this.props,n)}setProps(e){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender();const n=this.props;this.props=e;for(let o=0;o<g8.length;o++){const c=g8[o];this.propEventSubscriptions[c]&&(this.propEventSubscriptions[c](),delete this.propEventSubscriptions[c]);const l=e["on"+c];l&&(this.propEventSubscriptions[c]=this.on(c,l))}this.prevMotionValues=$1e(this,this.scrapeMotionValuesFromProps(e,n),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){var n;return(n=this.props.variants)===null||n===void 0?void 0:n[e]}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){var e;return this.isVariantNode?this:(e=this.parent)===null||e===void 0?void 0:e.getClosestVariantNode()}getVariantContext(e=!1){var n,o;if(e)return(n=this.parent)===null||n===void 0?void 0:n.getVariantContext();if(!this.isControllingVariants){const l=((o=this.parent)===null||o===void 0?void 0:o.getVariantContext())||{};return this.props.initial!==void 0&&(l.initial=this.props.initial),l}const c={};for(let l=0;l<z1e;l++){const f=lH[l],_=this.props[f];($f(_)||_===!1)&&(c[f]=_)}return c}addVariantChild(e){var n;const o=this.getClosestVariantNode();if(o)return(n=o.variantChildren)===null||n===void 0||n.add(e),()=>o.variantChildren.delete(e)}addValue(e,n){n!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,n)),this.values.set(e,n),this.latestValues[e]=n.get()}removeValue(e){var n;this.values.delete(e),(n=this.valueSubscriptions.get(e))===null||n===void 0||n(),this.valueSubscriptions.delete(e),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&n!==void 0&&(o=ah(n,{owner:this}),this.addValue(e,o)),o}readValue(e){return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:o}=this.props,c=typeof o=="string"||typeof o=="object"?(n=jO(this.props,o))===null||n===void 0?void 0:n[e]:void 0;if(o&&c!==void 0)return c;const l=this.getBaseTargetFromProps(this.props,e);return l!==void 0&&!xi(l)?l:this.initialValues[e]!==void 0&&c===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new HO),this.events[e].add(n)}notify(e,...n){var o;(o=this.events[e])===null||o===void 0||o.notify(...n)}}const lH=["initial",...r2],z1e=lH.length;class dH extends q1e{sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){var o;return(o=e.style)===null||o===void 0?void 0:o[n]}removeValueFromRenderState(e,{vars:n,style:o}){delete n[e],delete o[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:n,...o},{transformValues:c},l){let f=rve(o,e||{},this);if(c&&(n&&(n=c(n)),o&&(o=c(o)),f&&(f=c(f))),l){tve(this,o,f);const _=W1e(this,o,f,n);n=_.transitionEnd,o=_.target}return{transition:e,transitionEnd:n,...o}}}function Y1e(t){return window.getComputedStyle(t)}class X1e extends dH{readValueFromInstance(e,n){if(Ch.has(n)){const o=qO(n);return o&&o.default||0}else{const o=Y1e(e),c=(lW(n)?o.getPropertyValue(n):o[n])||0;return typeof c=="string"?c.trim():c}}measureInstanceViewportBox(e,{transformPagePoint:n}){return sH(e,n)}build(e,n,o,c){LO(e,n,o,c.transformTemplate)}scrapeMotionValuesFromProps(e,n){return FO(e,n)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;xi(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(e,n,o,c){mW(e,n,o,c)}}class J1e extends dH{constructor(){super(...arguments),this.isSVGTag=!1}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){var o;return Ch.has(n)?((o=qO(n))===null||o===void 0?void 0:o.default)||0:(n=gW.has(n)?n:VO(n),e.getAttribute(n))}measureInstanceViewportBox(){return fr()}scrapeMotionValuesFromProps(e,n){return _W(e,n)}build(e,n,o,c){xO(e,n,o,this.isSVGTag,c.transformTemplate)}renderInstance(e,n,o,c){EW(e,n,o,c)}mount(e){this.isSVGTag=UO(e.tagName),super.mount(e)}}const Q1e=(t,e)=>kO(t)?new J1e(e,{enableHardwareAcceleration:!1}):new X1e(e,{enableHardwareAcceleration:!0});function E8(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Ap={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(nt.test(t))t=parseFloat(t);else return t;const n=E8(t,e.target.x),o=E8(t,e.target.y);return`${n}% ${o}%`}},_8="_$css",Z1e={correct:(t,{treeScale:e,projectionDelta:n})=>{const o=t,c=t.includes("var("),l=[];c&&(t=t.replace(oH,k=>(l.push(k),_8)));const f=Bc.parse(t);if(f.length>5)return o;const _=Bc.createTransformer(t),y=typeof f[0]!="number"?1:0,S=n.x.scale*e.x,R=n.y.scale*e.y;f[0+y]/=S,f[1+y]/=R;const w=Vn(S,R,.5);typeof f[2+y]=="number"&&(f[2+y]/=w),typeof f[3+y]=="number"&&(f[3+y]/=w);let b=_(f);if(c){let k=0;b=b.replace(_8,()=>{const M=l[k];return k++,M})}return b}};class eye extends lh.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:o,layoutId:c}=this.props,{projection:l}=e;HEe(nye),l&&(n.group&&n.group.add(l),o&&o.register&&c&&o.register(l),l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,onExitComplete:()=>this.safeToRemove()})),nf.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:o,drag:c,isPresent:l}=this.props,f=o.projection;return f&&(f.isPresent=l,c||e.layoutDependency!==n||n===void 0?f.willUpdate():this.safeToRemove(),e.isPresent!==l&&(l?f.promote():f.relegate()||ci.postRender(()=>{var _;!((_=f.getStack())===null||_===void 0)&&_.members.length||this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),!e.currentAnimation&&e.isLead()&&this.safeToRemove())}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:o}=this.props,{projection:c}=e;c&&(c.scheduleCheckAfterUnmount(),n!=null&&n.group&&n.group.remove(c),o!=null&&o.deregister&&o.deregister(c))}safeToRemove(){const{safeToRemove:e}=this.props;e==null||e()}render(){return null}}function tye(t){const[e,n]=CW(),o=te.useContext(DO);return lh.createElement(eye,{...t,layoutGroup:o,switchLayoutGroup:te.useContext(cW),isPresent:e,safeToRemove:n})}const nye={borderRadius:{...Ap,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ap,borderTopRightRadius:Ap,borderBottomLeftRadius:Ap,borderBottomRightRadius:Ap,boxShadow:Z1e},rye={measureLayout:tye};function iye(t,e,n={}){const o=xi(t)?t:ah(t);return o.start(n2("",o,e,n)),{stop:()=>o.stop(),isAnimating:()=>o.isAnimating()}}const hH=["TopLeft","TopRight","BottomLeft","BottomRight"],sye=hH.length,v8=t=>typeof t=="string"?parseFloat(t):t,y8=t=>typeof t=="number"||nt.test(t);function oye(t,e,n,o,c,l){c?(t.opacity=Vn(0,n.opacity!==void 0?n.opacity:1,aye(o)),t.opacityExit=Vn(e.opacity!==void 0?e.opacity:1,0,cye(o))):l&&(t.opacity=Vn(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,o));for(let f=0;f<sye;f++){const _=`border${hH[f]}Radius`;let y=S8(e,_),S=S8(n,_);if(y===void 0&&S===void 0)continue;y||(y=0),S||(S=0),y===0||S===0||y8(y)===y8(S)?(t[_]=Math.max(Vn(v8(y),v8(S),o),0),(Mo.test(S)||Mo.test(y))&&(t[_]+="%")):t[_]=S}(e.rotate||n.rotate)&&(t.rotate=Vn(e.rotate||0,n.rotate||0,o))}function S8(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const aye=pH(0,.5,e2),cye=pH(.5,.95,ZO);function pH(t,e,n){return o=>o<t?0:o>e?1:n(Uv(t,e,o))}function T8(t,e){t.min=e.min,t.max=e.max}function Xs(t,e){T8(t.x,e.x),T8(t.y,e.y)}function R8(t,e,n,o,c){return t-=e,t=Fv(t,1/n,o),c!==void 0&&(t=Fv(t,1/c,o)),t}function uye(t,e=0,n=1,o=.5,c,l=t,f=t){if(Mo.test(e)&&(e=parseFloat(e),e=Vn(f.min,f.max,e/100)-f.min),typeof e!="number")return;let _=Vn(l.min,l.max,o);t===l&&(_-=e),t.min=R8(t.min,e,n,_,c),t.max=R8(t.max,e,n,_,c)}function I8(t,e,[n,o,c],l,f){uye(t,e[n],e[o],e[c],e.scale,l,f)}const lye=["x","scaleX","originX"],dye=["y","scaleY","originY"];function w8(t,e,n,o){I8(t.x,e,lye,n==null?void 0:n.x,o==null?void 0:o.x),I8(t.y,e,dye,n==null?void 0:n.y,o==null?void 0:o.y)}function C8(t){return t.translate===0&&t.scale===1}function fH(t){return C8(t.x)&&C8(t.y)}function mH(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}function A8(t){return ds(t.x)/ds(t.y)}class hye{constructor(){this.members=[]}add(e){GO(this.members,e),e.scheduleRender()}remove(e){if(WO(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(c=>e===c);if(n===0)return!1;let o;for(let c=n;c>=0;c--){const l=this.members[c];if(l.isPresent!==!1){o=l;break}}return o?(this.promote(o),!0):!1}promote(e,n){var o;const c=this.lead;if(e!==c&&(this.prevLead=c,this.lead=e,e.show(),c)){c.instance&&c.scheduleRender(),e.scheduleRender(),e.resumeFrom=c,n&&(e.resumeFrom.preserveOpacity=!0),c.snapshot&&(e.snapshot=c.snapshot,e.snapshot.latestValues=c.animationValues||c.latestValues),!((o=e.root)===null||o===void 0)&&o.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&c.hide()}}exitAnimationComplete(){this.members.forEach(e=>{var n,o,c,l,f;(o=(n=e.options).onExitComplete)===null||o===void 0||o.call(n),(f=(c=e.resumingFrom)===null||c===void 0?void 0:(l=c.options).onExitComplete)===null||f===void 0||f.call(l)})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function b8(t,e,n){let o="";const c=t.x.translate/e.x,l=t.y.translate/e.y;if((c||l)&&(o=`translate3d(${c}px, ${l}px, 0) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),n){const{rotate:y,rotateX:S,rotateY:R}=n;y&&(o+=`rotate(${y}deg) `),S&&(o+=`rotateX(${S}deg) `),R&&(o+=`rotateY(${R}deg) `)}const f=t.x.scale*e.x,_=t.y.scale*e.y;return(f!==1||_!==1)&&(o+=`scale(${f}, ${_})`),o||"none"}const pye=(t,e)=>t.depth-e.depth;class fye{constructor(){this.children=[],this.isDirty=!1}add(e){GO(this.children,e),this.isDirty=!0}remove(e){WO(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(pye),this.isDirty=!1,this.children.forEach(e)}}const O8=["","X","Y","Z"],N8=1e3;let mye=0;function gH({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:o,resetTransform:c}){return class{constructor(f,_={},y=e==null?void 0:e()){this.id=mye++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isTransformDirty=!1,this.isProjectionDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.potentialNodes=new Map,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.nodes.forEach(_ye),this.nodes.forEach(Sye),this.nodes.forEach(Tye)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.elementId=f,this.latestValues=_,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0,f&&this.root.registerPotentialNode(f,this);for(let S=0;S<this.path.length;S++)this.path[S].shouldResetTransform=!0;this.root===this&&(this.nodes=new fye)}addEventListener(f,_){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new HO),this.eventHandlers.get(f).add(_)}notifyListeners(f,..._){const y=this.eventHandlers.get(f);y==null||y.notify(..._)}hasListeners(f){return this.eventHandlers.has(f)}registerPotentialNode(f,_){this.potentialNodes.set(f,_)}mount(f,_=!1){var y;if(this.instance)return;this.isSVG=f instanceof SVGElement&&f.tagName!=="svg",this.instance=f;const{layoutId:S,layout:R,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),(y=this.parent)===null||y===void 0||y.children.add(this),this.elementId&&this.root.potentialNodes.delete(this.elementId),_&&(R||S)&&(this.isLayoutDirty=!0),t){let b;const k=()=>this.root.updateBlockedByResize=!1;t(f,()=>{this.root.updateBlockedByResize=!0,b&&b(),b=JW(k,250),nf.hasAnimatedSinceResize&&(nf.hasAnimatedSinceResize=!1,this.nodes.forEach(D8))})}S&&this.root.registerSharedNode(S,this),this.options.animate!==!1&&w&&(S||R)&&this.addEventListener("didUpdate",({delta:b,hasLayoutChanged:k,hasRelativeTargetChanged:M,layout:F})=>{var Y,H,B,K,z;if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const oe=(H=(Y=this.options.transition)!==null&&Y!==void 0?Y:w.getDefaultTransition())!==null&&H!==void 0?H:Aye,{onLayoutAnimationStart:de,onLayoutAnimationComplete:Ee}=w.getProps(),we=!this.targetLayout||!mH(this.targetLayout,F)||M,Fe=!k&&M;if(this.options.layoutRoot||!((B=this.resumeFrom)===null||B===void 0)&&B.instance||Fe||k&&(we||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(b,Fe);const be={...QW(oe,"layout"),onPlay:de,onComplete:Ee};(w.shouldReduceMotion||this.options.layoutRoot)&&(be.delay=0,be.type=!1),this.startAnimation(be)}else!k&&this.animationProgress===0&&D8(this),this.isLead()&&((z=(K=this.options).onExitComplete)===null||z===void 0||z.call(K));this.targetLayout=F})}unmount(){var f,_;this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this),(f=this.getStack())===null||f===void 0||f.remove(this),(_=this.parent)===null||_===void 0||_.children.delete(this),this.instance=void 0,jc.preRender(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){var f;return this.isAnimationBlocked||((f=this.parent)===null||f===void 0?void 0:f.isTreeAnimationBlocked())||!1}startUpdate(){var f;this.isUpdateBlocked()||(this.isUpdating=!0,(f=this.nodes)===null||f===void 0||f.forEach(Rye),this.animationId++)}getTransformTemplate(){var f;return(f=this.options.visualElement)===null||f===void 0?void 0:f.getProps().transformTemplate}willUpdate(f=!0){var _,y,S;if(this.root.isUpdateBlocked()){(y=(_=this.options).onExitComplete)===null||y===void 0||y.call(_);return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let b=0;b<this.path.length;b++){const k=this.path[b];k.shouldResetTransform=!0,k.updateScroll("snapshot"),k.options.layoutRoot&&k.willUpdate(!1)}const{layoutId:R,layout:w}=this.options;R===void 0&&!w||(this.prevTransformTemplateValue=(S=this.getTransformTemplate())===null||S===void 0?void 0:S(this.latestValues,""),this.updateSnapshot(),f&&this.notifyListeners("willUpdate"))}didUpdate(){if(this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(P8);return}this.isUpdating&&(this.isUpdating=!1,this.potentialNodes.size&&(this.potentialNodes.forEach(bye),this.potentialNodes.clear()),this.nodes.forEach(yye),this.nodes.forEach(gye),this.nodes.forEach(Eye),this.clearAllSnapshots(),bI.update(),bI.preRender(),bI.render())}clearAllSnapshots(){this.nodes.forEach(vye),this.sharedNodes.forEach(Iye)}scheduleUpdateProjection(){ci.preRender(this.updateProjection,!1,!0)}scheduleCheckAfterUnmount(){ci.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){var f;if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let y=0;y<this.path.length;y++)this.path[y].updateScroll();const _=this.layout;this.layout=this.measure(!1),this.layoutCorrected=fr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox),(f=this.options.visualElement)===null||f===void 0||f.notify("LayoutMeasure",this.layout.layoutBox,_==null?void 0:_.layoutBox)}updateScroll(f="measure"){let _=Boolean(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(_=!1),_&&(this.scroll={animationId:this.root.animationId,phase:f,isRoot:o(this.instance),offset:n(this.instance)})}resetTransform(){var f;if(!c)return;const _=this.isLayoutDirty||this.shouldResetTransform,y=this.projectionDelta&&!fH(this.projectionDelta),S=(f=this.getTransformTemplate())===null||f===void 0?void 0:f(this.latestValues,""),R=S!==this.prevTransformTemplateValue;_&&(y||Au(this.latestValues)||R)&&(c(this.instance,S),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const _=this.measurePageBox();let y=this.removeElementScroll(_);return f&&(y=this.removeTransform(y)),Oye(y),{animationId:this.root.animationId,measuredBox:_,layoutBox:y,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:f}=this.options;if(!f)return fr();const _=f.measureViewportBox(),{scroll:y}=this.root;return y&&(sc(_.x,y.offset.x),sc(_.y,y.offset.y)),_}removeElementScroll(f){const _=fr();Xs(_,f);for(let y=0;y<this.path.length;y++){const S=this.path[y],{scroll:R,options:w}=S;if(S!==this.root&&R&&w.layoutScroll){if(R.isRoot){Xs(_,f);const{scroll:b}=this.root;b&&(sc(_.x,-b.offset.x),sc(_.y,-b.offset.y))}sc(_.x,R.offset.x),sc(_.y,R.offset.y)}}return _}applyTransform(f,_=!1){const y=fr();Xs(y,f);for(let S=0;S<this.path.length;S++){const R=this.path[S];!_&&R.options.layoutScroll&&R.scroll&&R!==R.root&&bd(y,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),Au(R.latestValues)&&bd(y,R.latestValues)}return Au(this.latestValues)&&bd(y,this.latestValues),y}removeTransform(f){var _;const y=fr();Xs(y,f);for(let S=0;S<this.path.length;S++){const R=this.path[S];if(!R.instance||!Au(R.latestValues))continue;iA(R.latestValues)&&R.updateSnapshot();const w=fr(),b=R.measurePageBox();Xs(w,b),w8(y,R.latestValues,(_=R.snapshot)===null||_===void 0?void 0:_.layoutBox,w)}return Au(this.latestValues)&&w8(y,this.latestValues),y}setTargetDelta(f){this.targetDelta=f,this.isProjectionDirty=!0,this.root.scheduleUpdateProjection()}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}resolveTargetDelta(){var f;const _=this.getLead();if(this.isProjectionDirty||(this.isProjectionDirty=_.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=_.isTransformDirty),!this.isProjectionDirty&&!this.attemptToResolveRelativeTarget)return;const{layout:y,layoutId:S}=this.options;if(!(!this.layout||!(y||S))){if(!this.targetDelta&&!this.relativeTarget){const R=this.getClosestProjectingParent();R&&R.layout?(this.relativeParent=R,this.relativeTarget=fr(),this.relativeTargetOrigin=fr(),af(this.relativeTargetOrigin,this.layout.layoutBox,R.layout.layoutBox),Xs(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=fr(),this.targetWithTransforms=fr()),this.relativeTarget&&this.relativeTargetOrigin&&(!((f=this.relativeParent)===null||f===void 0)&&f.target)?f1e(this.target,this.relativeTarget,this.relativeParent.target):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Xs(this.target,this.layout.layoutBox),iH(this.target,this.targetDelta)):Xs(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const R=this.getClosestProjectingParent();R&&Boolean(R.resumingFrom)===Boolean(this.resumingFrom)&&!R.options.layoutScroll&&R.target?(this.relativeParent=R,this.relativeTarget=fr(),this.relativeTargetOrigin=fr(),af(this.relativeTargetOrigin,this.target,R.target),Xs(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||iA(this.parent.latestValues)||rH(this.parent.latestValues)))return(this.parent.relativeTarget||this.parent.targetDelta||this.parent.options.layoutRoot)&&this.parent.layout?this.parent:this.parent.getClosestProjectingParent()}calcProjection(){var f;const{isProjectionDirty:_,isTransformDirty:y}=this;this.isProjectionDirty=this.isTransformDirty=!1;const S=this.getLead(),R=Boolean(this.resumingFrom)||this!==S;let w=!0;if(_&&(w=!1),R&&y&&(w=!1),w)return;const{layout:b,layoutId:k}=this.options;if(this.isTreeAnimating=Boolean(((f=this.parent)===null||f===void 0?void 0:f.isTreeAnimating)||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(b||k))return;Xs(this.layoutCorrected,this.layout.layoutBox),R1e(this.layoutCorrected,this.treeScale,this.path,R);const{target:M}=S;if(!M)return;this.projectionDelta||(this.projectionDelta=cf(),this.projectionDeltaWithTransform=cf());const F=this.treeScale.x,Y=this.treeScale.y,H=this.projectionTransform;of(this.projectionDelta,this.layoutCorrected,M,this.latestValues),this.projectionTransform=b8(this.projectionDelta,this.treeScale),(this.projectionTransform!==H||this.treeScale.x!==F||this.treeScale.y!==Y)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",M))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var _,y,S;(y=(_=this.options).scheduleRender)===null||y===void 0||y.call(_),f&&((S=this.getStack())===null||S===void 0||S.scheduleRender()),this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(f,_=!1){var y,S;const R=this.snapshot,w=(R==null?void 0:R.latestValues)||{},b={...this.latestValues},k=cf();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const M=fr(),F=(R==null?void 0:R.source)!==((y=this.layout)===null||y===void 0?void 0:y.source),Y=(((S=this.getStack())===null||S===void 0?void 0:S.members.length)||0)<=1,H=Boolean(F&&!Y&&this.options.crossfade===!0&&!this.path.some(Cye));this.animationProgress=0,this.mixTargetDelta=B=>{var K;const z=B/1e3;k8(k.x,f.x,z),k8(k.y,f.y,z),this.setTargetDelta(k),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&(!((K=this.relativeParent)===null||K===void 0)&&K.layout)&&(af(M,this.layout.layoutBox,this.relativeParent.layout.layoutBox),wye(this.relativeTarget,this.relativeTargetOrigin,M,z)),F&&(this.animationValues=b,oye(b,w,this.latestValues,z,H,Y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=z},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){var _,y;this.notifyListeners("animationStart"),(_=this.currentAnimation)===null||_===void 0||_.stop(),this.resumingFrom&&((y=this.resumingFrom.currentAnimation)===null||y===void 0||y.stop()),this.pendingAnimation&&(jc.update(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ci.update(()=>{nf.hasAnimatedSinceResize=!0,this.currentAnimation=iye(0,N8,{...f,onUpdate:S=>{var R;this.mixTargetDelta(S),(R=f.onUpdate)===null||R===void 0||R.call(f,S)},onComplete:()=>{var S;(S=f.onComplete)===null||S===void 0||S.call(f),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){var f;this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0),(f=this.getStack())===null||f===void 0||f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){var f;this.currentAnimation&&((f=this.mixTargetDelta)===null||f===void 0||f.call(this,N8),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:_,target:y,layout:S,latestValues:R}=f;if(!(!_||!y||!S)){if(this!==f&&this.layout&&S&&EH(this.options.animationType,this.layout.layoutBox,S.layoutBox)){y=this.target||fr();const w=ds(this.layout.layoutBox.x);y.x.min=f.target.x.min,y.x.max=y.x.min+w;const b=ds(this.layout.layoutBox.y);y.y.min=f.target.y.min,y.y.max=y.y.min+b}Xs(_,y),bd(_,R),of(this.projectionDeltaWithTransform,this.layoutCorrected,_,R)}}registerSharedNode(f,_){var y,S,R;this.sharedNodes.has(f)||this.sharedNodes.set(f,new hye),this.sharedNodes.get(f).add(_),_.promote({transition:(y=_.options.initialPromotionConfig)===null||y===void 0?void 0:y.transition,preserveFollowOpacity:(R=(S=_.options.initialPromotionConfig)===null||S===void 0?void 0:S.shouldPreserveFollowOpacity)===null||R===void 0?void 0:R.call(S,_)})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:_}=this.options;return _?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:_}=this.options;return _?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:_,preserveFollowOpacity:y}={}){const S=this.getStack();S&&S.promote(this,y),f&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetRotation(){const{visualElement:f}=this.options;if(!f)return;let _=!1;const{latestValues:y}=f;if((y.rotate||y.rotateX||y.rotateY||y.rotateZ)&&(_=!0),!_)return;const S={};for(let R=0;R<O8.length;R++){const w="rotate"+O8[R];y[w]&&(S[w]=y[w],f.setStaticValue(w,0))}f==null||f.render();for(const R in S)f.setStaticValue(R,S[R]);f.scheduleRender()}getProjectionStyles(f={}){var _,y;const S={};if(!this.instance||this.isSVG)return S;if(this.isVisible)S.visibility="";else return{visibility:"hidden"};const R=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,S.opacity="",S.pointerEvents=__(f.pointerEvents)||"",S.transform=R?R(this.latestValues,""):"none",S;const w=this.getLead();if(!this.projectionDelta||!this.layout||!w.target){const F={};return this.options.layoutId&&(F.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,F.pointerEvents=__(f.pointerEvents)||""),this.hasProjected&&!Au(this.latestValues)&&(F.transform=R?R({},""):"none",this.hasProjected=!1),F}const b=w.animationValues||w.latestValues;this.applyTransformsToTarget(),S.transform=b8(this.projectionDeltaWithTransform,this.treeScale,b),R&&(S.transform=R(b,S.transform));const{x:k,y:M}=this.projectionDelta;S.transformOrigin=`${k.origin*100}% ${M.origin*100}% 0`,w.animationValues?S.opacity=w===this?(y=(_=b.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&y!==void 0?y:1:this.preserveOpacity?this.latestValues.opacity:b.opacityExit:S.opacity=w===this?b.opacity!==void 0?b.opacity:"":b.opacityExit!==void 0?b.opacityExit:0;for(const F in bv){if(b[F]===void 0)continue;const{correct:Y,applyTo:H}=bv[F],B=S.transform==="none"?b[F]:Y(b[F],w);if(H){const K=H.length;for(let z=0;z<K;z++)S[H[z]]=B}else S[F]=B}return this.options.layoutId&&(S.pointerEvents=w===this?__(f.pointerEvents)||"":"none"),S}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var _;return(_=f.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(P8),this.root.sharedNodes.clear()}}}function gye(t){t.updateLayout()}function Eye(t){var e,n,o;const c=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&c&&t.hasListeners("didUpdate")){const{layoutBox:l,measuredBox:f}=t.layout,{animationType:_}=t.options,y=c.source!==t.layout.source;_==="size"?Io(k=>{const M=y?c.measuredBox[k]:c.layoutBox[k],F=ds(M);M.min=l[k].min,M.max=M.min+F}):EH(_,c.layoutBox,l)&&Io(k=>{const M=y?c.measuredBox[k]:c.layoutBox[k],F=ds(l[k]);M.max=M.min+F});const S=cf();of(S,l,c.layoutBox);const R=cf();y?of(R,t.applyTransform(f,!0),c.measuredBox):of(R,l,c.layoutBox);const w=!fH(S);let b=!1;if(!t.resumeFrom){const k=t.getClosestProjectingParent();if(k&&!k.resumeFrom){const{snapshot:M,layout:F}=k;if(M&&F){const Y=fr();af(Y,c.layoutBox,M.layoutBox);const H=fr();af(H,l,F.layoutBox),mH(Y,H)||(b=!0),k.options.layoutRoot&&(t.relativeTarget=H,t.relativeTargetOrigin=Y,t.relativeParent=k)}}}t.notifyListeners("didUpdate",{layout:l,snapshot:c,delta:R,layoutDelta:S,hasLayoutChanged:w,hasRelativeTargetChanged:b})}else t.isLead()&&((o=(n=t.options).onExitComplete)===null||o===void 0||o.call(n));t.options.transition=void 0}function _ye(t){t.isProjectionDirty||(t.isProjectionDirty=Boolean(t.parent&&t.parent.isProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=Boolean(t.parent&&t.parent.isTransformDirty))}function vye(t){t.clearSnapshot()}function P8(t){t.clearMeasurements()}function yye(t){const{visualElement:e}=t.options;e!=null&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function D8(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0}function Sye(t){t.resolveTargetDelta()}function Tye(t){t.calcProjection()}function Rye(t){t.resetRotation()}function Iye(t){t.removeLeadSnapshot()}function k8(t,e,n){t.translate=Vn(e.translate,0,n),t.scale=Vn(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function L8(t,e,n,o){t.min=Vn(e.min,n.min,o),t.max=Vn(e.max,n.max,o)}function wye(t,e,n,o){L8(t.x,e.x,n.x,o),L8(t.y,e.y,n.y,o)}function Cye(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const Aye={duration:.45,ease:[.4,0,.1,1]};function bye(t,e){let n=t.root;for(let l=t.path.length-1;l>=0;l--)if(Boolean(t.path[l].instance)){n=t.path[l];break}const c=(n&&n!==t.root?n.instance:document).querySelector(`[data-projection-id="${e}"]`);c&&t.mount(c,!0)}function M8(t){t.min=Math.round(t.min),t.max=Math.round(t.max)}function Oye(t){M8(t.x),M8(t.y)}function EH(t,e,n){return t==="position"||t==="preserve-aspect"&&!nA(A8(e),A8(n),.2)}const Nye=gH({attachResizeListener:(t,e)=>Bu(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),VI={current:void 0},Pye=gH({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!VI.current){const t=new Nye(0,{});t.mount(window),t.setOptions({layoutScroll:!0}),VI.current=t}return VI.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>Boolean(window.getComputedStyle(t).position==="fixed")}),Dye={...l1e,...O_e,...D1e,...rye},Pa=GEe((t,e)=>g_e(t,e,Dye,Q1e,Pye));function _H(){const t=te.useRef(!1);return Av(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function kye(){const t=_H(),[e,n]=te.useState(0),o=te.useCallback(()=>{t.current&&n(e+1)},[e]);return[te.useCallback(()=>ci.postRender(o),[o]),e]}class Lye extends te.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Mye({children:t,isPresent:e}){const n=te.useId(),o=te.useRef(null),c=te.useRef({width:0,height:0,top:0,left:0});return te.useInsertionEffect(()=>{const{width:l,height:f,top:_,left:y}=c.current;if(e||!o.current||!l||!f)return;o.current.dataset.motionPopId=n;const S=document.createElement("style");return document.head.appendChild(S),S.sheet&&S.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${f}px !important;
            top: ${_}px !important;
            left: ${y}px !important;
          }
        `),()=>{document.head.removeChild(S)}},[e]),te.createElement(Lye,{isPresent:e,childRef:o,sizeRef:c},te.cloneElement(t,{ref:o}))}const FI=({children:t,initial:e,isPresent:n,onExitComplete:o,custom:c,presenceAffectsLayout:l,mode:f})=>{const _=py(xye),y=te.useId(),S=te.useMemo(()=>({id:y,initial:e,isPresent:n,custom:c,onExitComplete:R=>{_.set(R,!0);for(const w of _.values())if(!w)return;o&&o()},register:R=>(_.set(R,!1),()=>_.delete(R))}),l?void 0:[n]);return te.useMemo(()=>{_.forEach((R,w)=>_.set(w,!1))},[n]),te.useEffect(()=>{!n&&!_.size&&o&&o()},[n]),f==="popLayout"&&(t=te.createElement(Mye,{isPresent:n},t)),te.createElement(Im.Provider,{value:S},t)};function xye(){return new Map}const hd=t=>t.key||"";function Uye(t,e){t.forEach(n=>{const o=hd(n);e.set(o,n)})}function Vye(t){const e=[];return te.Children.forEach(t,n=>{te.isValidElement(n)&&e.push(n)}),e}const i2=({children:t,custom:e,initial:n=!0,onExitComplete:o,exitBeforeEnter:c,presenceAffectsLayout:l=!0,mode:f="sync"})=>{c&&(f="wait");let[_]=kye();const y=te.useContext(DO).forceRender;y&&(_=y);const S=_H(),R=Vye(t);let w=R;const b=new Set,k=te.useRef(w),M=te.useRef(new Map).current,F=te.useRef(!0);if(Av(()=>{F.current=!1,Uye(R,M),k.current=w}),BO(()=>{F.current=!0,M.clear(),b.clear()}),F.current)return te.createElement(te.Fragment,null,w.map(K=>te.createElement(FI,{key:hd(K),isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:l,mode:f},K)));w=[...w];const Y=k.current.map(hd),H=R.map(hd),B=Y.length;for(let K=0;K<B;K++){const z=Y[K];H.indexOf(z)===-1&&b.add(z)}return f==="wait"&&b.size&&(w=[]),b.forEach(K=>{if(H.indexOf(K)!==-1)return;const z=M.get(K);if(!z)return;const oe=Y.indexOf(K),de=()=>{M.delete(K),b.delete(K);const Ee=k.current.findIndex(we=>we.key===K);if(k.current.splice(Ee,1),!b.size){if(k.current=R,S.current===!1)return;_(),o&&o()}};w.splice(oe,0,te.createElement(FI,{key:hd(z),isPresent:!1,onExitComplete:de,custom:e,presenceAffectsLayout:l,mode:f},z))}),w=w.map(K=>{const z=K.key;return b.has(z)?K:te.createElement(FI,{key:hd(K),isPresent:!0,presenceAffectsLayout:l,mode:f},K)}),te.createElement(te.Fragment,null,b.size?w:w.map(K=>te.cloneElement(K)))},Fye="/assets/envelope-solid-0e3cdbb8.svg",jye="/assets/lock-solid-c08829bb.svg",Bye="/assets/devchallenges-light-6441f27c.svg";const x8=te.forwardRef(function({type:t,img:e},n){const o=te.useId();return Pt("label",{htmlFor:o,className:"auth-input",children:[ge("img",{src:e,alt:"input"}),ge("input",{type:t,minLength:t==="password"?6:1/0,name:t,id:o,placeholder:t,ref:n,required:!0})]})});const vH=function({children:t,...e}){return ge("button",{...e,className:"button",onMouseDown:function(o){let c=o.nativeEvent.offsetX,l=o.nativeEvent.offsetY;o.target.style.setProperty("--x",c+"px"),o.target.style.setProperty("--y",l+"px"),o.target.classList.add("pulse")},onAnimationEnd:o=>o.target.classList.remove("pulse"),children:t})};let _y=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");const Gye="/assets/google-b9f2dce9.png",Wye=function(){const t=mh(),e=co(),n=function(){t(sW({type:"GOOGLE",navigateFn:e}))};return Pt(Pa.div,{className:"social-profiles",whileHover:{scale:1.05},whileTap:{scale:.95},onClick:n,children:[[Gye].map((o,c)=>ge("img",{src:o,alt:"social"},_y())),ge("p",{children:"Sign in with Google"})]})},yH=function({children:t,button:e,footer:n,type:o}){const c=te.useRef(null),l=te.useRef(null),f=mh(),_=co(),y=function(S){return R=>{R.preventDefault(),f(sW({type:S,email:c.current.value,password:l.current.value,navigateFn:_}))}};return ge("div",{className:"form-template-container",children:Pt(Pa.form,{className:"form-template",onSubmit:y(o),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[ge("img",{src:Bye,alt:"logo"}),t,ge(x8,{type:"email",img:Fye,ref:c}),ge(x8,{type:"password",img:jye,ref:l}),ge(vH,{type:"submit",children:e}),ge("p",{children:"or continue with google"}),ge(Wye,{}),n]})})};function Hye(){return ge(yH,{button:"Login",footer:Pt("div",{className:"footer",children:[ge("p",{children:"Don't have an account yet? "}),ge(Cj,{to:"/signup",children:"Register"})]}),type:"EMAILANDPASSWORDLOGIN",children:ge("h1",{children:"Login"})})}const $ye="/assets/MyProfile-34ec1a04.jpg",Kye="/assets/chevron-left-solid-f1e89964.svg",SH="/assets/chatgpt-logo-02AFA704B5-seeklogo.com-d7cb522f.png",ch="/assets/account_circle_FILL0_wght400_GRAD0_opsz48-d3ab6d9e.svg";const qye=function({img:t,name:e,id:n,isPrivate:o,channelDispatch:c,email:l=""}){const f=e||l.slice(0,l.indexOf("@"));return Pt("div",{className:"member",onClick:function(){if(n==="openai"||Je.currentUser.uid===n||o)return;const y=[Je.currentUser.uid,n].sort().join("");c({type:"channelDispatch",payload:{channelName:f,channelDesc:"Private Chat",channelId:y,isPrivate:!0,channelMembers:[{id:n,photoURL:t,name:f,email:l},{id:Je.currentUser.uid,photoURL:Je.currentUser.photoURL,name:Je.currentUser.displayName||Je.currentUser.email.slice(0,Je.currentUser.email.indexOf("@")),email:Je.currentUser.email}],channelMessages:[]}})},children:[ge("img",{src:t==="openai"?SH:t||ch,alt:f,onError:y=>{y.target.src=ch}}),ge("p",{className:f,children:f})]})};const TH="/assets/xmark-solid-4098d5ca.svg",zye="/assets/angle-down-solid-ae14287f.svg";const Yye="/assets/copy-solid-73e4120d.svg",Xye="/assets/arrow-right-from-bracket-solid-892d46c8.svg",Jye="/assets/door-open-solid-1d3763da.svg";const Qye=function({channelInfo:t,channelDispatch:e}){const n=co(),o=mh(),c=Ao(ks,"channels",t.channelId),l=function(){e({type:"exit",payload:{channelName:"DEFAULT CHANNEL",channelDesc:"Test channel for all users",channelId:"16A4w32PivaHAasvXbflX1676971533389",channelMembers:[{id:"",photoURL:"",name:"",email:""}],channelMessages:[]}}),Nde(Je),n("/login"),o(Pc.logout())},f=async function(){var _,y,S,R;if(t.channelId==="16A4w32PivaHAasvXbflX1676971533389"){o(Pc.resetErrorMessage("Cannot exit default channel"));return}t.channelMembers.length===2?await Kge(Ao(ks,"channels",t.channelId)):await _a(c,{members:qge({email:(_=Je.currentUser)==null?void 0:_.email,id:(y=Je.currentUser)==null?void 0:y.uid,name:(S=Je.currentUser)==null?void 0:S.displayName,photoURL:(R=Je.currentUser)==null?void 0:R.photoURL})}),e({type:"exit",payload:{channelName:"DEFAULT CHANNEL",channelDesc:"Test channel for all users",channelId:"16A4w32PivaHAasvXbflX1676971533389",channelMembers:[{id:"",photoURL:"",name:"",email:""}],channelMessages:[]}}),n("/channels")};return Pt(Pa.div,{className:"drop-down",initial:{y:"calc(-100% + 30px)",opacity:0},animate:{y:"-100%",opacity:1,transition:{type:"spring",damping:20,stiffness:500}},exit:{y:"calc(-100% + 30px)",opacity:0,transition:{type:"tween",duration:.3}},children:[!t.isPrivate&&Pt(EF,{children:[Pt("div",{className:"child copy-link",onClick:()=>{navigator.clipboard.writeText(`https://astounding-choux-c5148e.netlify.app/join/:${t.channelId}`),o(Pc.resetErrorMessage("Invite link copied to clipboard!"))},children:[ge("p",{children:"Invite Link"}),ge("img",{src:Yye,alt:"copy"})]}),Pt("div",{className:"child exit-channel",onClick:f,children:[ge("p",{children:"Exit channel"}),ge("img",{src:Jye,alt:"exit channel"})]}),ge("div",{className:"line"})]}),Pt("div",{className:"child logout",onClick:l,children:[ge("p",{children:"Logout"}),ge("img",{src:Xye,alt:"logout"})]})]})},RH=function({channelInfo:t,channelDispatch:e}){const n=oC(_=>_.user),[o,c]=te.useState(!1),l=n.displayName||n.email.slice(0,n.email.indexOf("@")),f=n.photoURL||ch;return document.body.addEventListener("click",_=>{_.target.closest(".down")||_.target.closest(".drop-down")||c(!1)}),Pt("div",{className:"user",title:l,children:[ge("img",{src:f,alt:"profile",onError:_=>{_.target.src=ch}}),ge("p",{className:"name",children:l}),ge(Pa.img,{className:"down",onClick:()=>{c(_=>!_)},src:zye,alt:"open",animate:{rotate:o?"180deg":"0"}}),ge(i2,{children:o&&ge(Qye,{channelInfo:t,channelDispatch:e},t.channelId)})]})},Zye=function({channelInfo:t,isNavOpen:e,channelDispatch:n,setIsNavOpen:o}){const c=co();return Pt("div",{className:`channel-info-nav nav ${e?"active":""}`,children:[Pt("div",{className:"header",children:[ge("img",{src:Kye,alt:"back",onClick:()=>c("/channels")}),ge("p",{children:"All Channels"}),ge("div",{className:"close-btn",onClick:()=>o(!1),children:ge("img",{src:TH,alt:"close"})})]}),Pt("div",{className:"container",children:[ge("p",{className:"name",children:t.channelName}),ge("p",{className:"desc",children:t.channelDesc}),Pt("div",{className:"members",children:[ge("p",{children:"Members"}),t.channelMembers.map(l=>ge(qye,{img:l.photoURL,name:l.name,email:l.email,id:l.id,isPrivate:t.isPrivate,channelDispatch:n},_y()))]})]}),ge(RH,{channelInfo:t,channelDispatch:n})]})};var s2={},IH={},jv={},e0e={get exports(){return jv},set exports(t){jv=t}},Bv={},t0e={get exports(){return Bv},set exports(t){Bv=t}},wH=function(e,n){return function(){for(var c=new Array(arguments.length),l=0;l<c.length;l++)c[l]=arguments[l];return e.apply(n,c)}},n0e=wH,Yc=Object.prototype.toString;function o2(t){return Array.isArray(t)}function uA(t){return typeof t>"u"}function r0e(t){return t!==null&&!uA(t)&&t.constructor!==null&&!uA(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function CH(t){return Yc.call(t)==="[object ArrayBuffer]"}function i0e(t){return Yc.call(t)==="[object FormData]"}function s0e(t){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&CH(t.buffer),e}function o0e(t){return typeof t=="string"}function a0e(t){return typeof t=="number"}function AH(t){return t!==null&&typeof t=="object"}function y_(t){if(Yc.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function c0e(t){return Yc.call(t)==="[object Date]"}function u0e(t){return Yc.call(t)==="[object File]"}function l0e(t){return Yc.call(t)==="[object Blob]"}function bH(t){return Yc.call(t)==="[object Function]"}function d0e(t){return AH(t)&&bH(t.pipe)}function h0e(t){return Yc.call(t)==="[object URLSearchParams]"}function p0e(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function f0e(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function a2(t,e){if(!(t===null||typeof t>"u"))if(typeof t!="object"&&(t=[t]),o2(t))for(var n=0,o=t.length;n<o;n++)e.call(null,t[n],n,t);else for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&e.call(null,t[c],c,t)}function lA(){var t={};function e(c,l){y_(t[l])&&y_(c)?t[l]=lA(t[l],c):y_(c)?t[l]=lA({},c):o2(c)?t[l]=c.slice():t[l]=c}for(var n=0,o=arguments.length;n<o;n++)a2(arguments[n],e);return t}function m0e(t,e,n){return a2(e,function(c,l){n&&typeof c=="function"?t[l]=n0e(c,n):t[l]=c}),t}function g0e(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}var Ui={isArray:o2,isArrayBuffer:CH,isBuffer:r0e,isFormData:i0e,isArrayBufferView:s0e,isString:o0e,isNumber:a0e,isObject:AH,isPlainObject:y_,isUndefined:uA,isDate:c0e,isFile:u0e,isBlob:l0e,isFunction:bH,isStream:d0e,isURLSearchParams:h0e,isStandardBrowserEnv:f0e,forEach:a2,merge:lA,extend:m0e,trim:p0e,stripBOM:g0e},cd=Ui;function U8(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var OH=function(e,n,o){if(!n)return e;var c;if(o)c=o(n);else if(cd.isURLSearchParams(n))c=n.toString();else{var l=[];cd.forEach(n,function(y,S){y===null||typeof y>"u"||(cd.isArray(y)?S=S+"[]":y=[y],cd.forEach(y,function(w){cd.isDate(w)?w=w.toISOString():cd.isObject(w)&&(w=JSON.stringify(w)),l.push(U8(S)+"="+U8(w))}))}),c=l.join("&")}if(c){var f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+c}return e},E0e=Ui;function vy(){this.handlers=[]}vy.prototype.use=function(e,n,o){return this.handlers.push({fulfilled:e,rejected:n,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1};vy.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};vy.prototype.forEach=function(e){E0e.forEach(this.handlers,function(o){o!==null&&e(o)})};var _0e=vy,v0e=Ui,y0e=function(e,n){v0e.forEach(e,function(c,l){l!==n&&l.toUpperCase()===n.toUpperCase()&&(e[n]=c,delete e[l])})},NH=function(e,n,o,c,l){return e.config=n,o&&(e.code=o),e.request=c,e.response=l,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},PH={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},jI,V8;function DH(){if(V8)return jI;V8=1;var t=NH;return jI=function(n,o,c,l,f){var _=new Error(n);return t(_,o,c,l,f)},jI}var BI,F8;function S0e(){if(F8)return BI;F8=1;var t=DH();return BI=function(n,o,c){var l=c.config.validateStatus;!c.status||!l||l(c.status)?n(c):o(t("Request failed with status code "+c.status,c.config,null,c.request,c))},BI}var GI,j8;function T0e(){if(j8)return GI;j8=1;var t=Ui;return GI=t.isStandardBrowserEnv()?function(){return{write:function(o,c,l,f,_,y){var S=[];S.push(o+"="+encodeURIComponent(c)),t.isNumber(l)&&S.push("expires="+new Date(l).toGMTString()),t.isString(f)&&S.push("path="+f),t.isString(_)&&S.push("domain="+_),y===!0&&S.push("secure"),document.cookie=S.join("; ")},read:function(o){var c=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return c?decodeURIComponent(c[3]):null},remove:function(o){this.write(o,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),GI}var WI,B8;function R0e(){return B8||(B8=1,WI=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}),WI}var HI,G8;function I0e(){return G8||(G8=1,HI=function(e,n){return n?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e}),HI}var $I,W8;function w0e(){if(W8)return $I;W8=1;var t=R0e(),e=I0e();return $I=function(o,c){return o&&!t(c)?e(o,c):c},$I}var KI,H8;function C0e(){if(H8)return KI;H8=1;var t=Ui,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return KI=function(o){var c={},l,f,_;return o&&t.forEach(o.split(`
`),function(S){if(_=S.indexOf(":"),l=t.trim(S.substr(0,_)).toLowerCase(),f=t.trim(S.substr(_+1)),l){if(c[l]&&e.indexOf(l)>=0)return;l==="set-cookie"?c[l]=(c[l]?c[l]:[]).concat([f]):c[l]=c[l]?c[l]+", "+f:f}}),c},KI}var qI,$8;function A0e(){if($8)return qI;$8=1;var t=Ui;return qI=t.isStandardBrowserEnv()?function(){var n=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a"),c;function l(f){var _=f;return n&&(o.setAttribute("href",_),_=o.href),o.setAttribute("href",_),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:o.pathname.charAt(0)==="/"?o.pathname:"/"+o.pathname}}return c=l(window.location.href),function(_){var y=t.isString(_)?l(_):_;return y.protocol===c.protocol&&y.host===c.host}}():function(){return function(){return!0}}(),qI}var zI,K8;function yy(){if(K8)return zI;K8=1;function t(e){this.message=e}return t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,zI=t,zI}var YI,q8;function z8(){if(q8)return YI;q8=1;var t=Ui,e=S0e(),n=T0e(),o=OH,c=w0e(),l=C0e(),f=A0e(),_=DH(),y=PH,S=yy();return YI=function(w){return new Promise(function(k,M){var F=w.data,Y=w.headers,H=w.responseType,B;function K(){w.cancelToken&&w.cancelToken.unsubscribe(B),w.signal&&w.signal.removeEventListener("abort",B)}t.isFormData(F)&&delete Y["Content-Type"];var z=new XMLHttpRequest;if(w.auth){var oe=w.auth.username||"",de=w.auth.password?unescape(encodeURIComponent(w.auth.password)):"";Y.Authorization="Basic "+btoa(oe+":"+de)}var Ee=c(w.baseURL,w.url);z.open(w.method.toUpperCase(),o(Ee,w.params,w.paramsSerializer),!0),z.timeout=w.timeout;function we(){if(z){var be="getAllResponseHeaders"in z?l(z.getAllResponseHeaders()):null,dt=!H||H==="text"||H==="json"?z.responseText:z.response,kn={data:dt,status:z.status,statusText:z.statusText,headers:be,config:w,request:z};e(function(jn){k(jn),K()},function(jn){M(jn),K()},kn),z=null}}if("onloadend"in z?z.onloadend=we:z.onreadystatechange=function(){!z||z.readyState!==4||z.status===0&&!(z.responseURL&&z.responseURL.indexOf("file:")===0)||setTimeout(we)},z.onabort=function(){z&&(M(_("Request aborted",w,"ECONNABORTED",z)),z=null)},z.onerror=function(){M(_("Network Error",w,null,z)),z=null},z.ontimeout=function(){var dt=w.timeout?"timeout of "+w.timeout+"ms exceeded":"timeout exceeded",kn=w.transitional||y;w.timeoutErrorMessage&&(dt=w.timeoutErrorMessage),M(_(dt,w,kn.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",z)),z=null},t.isStandardBrowserEnv()){var Fe=(w.withCredentials||f(Ee))&&w.xsrfCookieName?n.read(w.xsrfCookieName):void 0;Fe&&(Y[w.xsrfHeaderName]=Fe)}"setRequestHeader"in z&&t.forEach(Y,function(dt,kn){typeof F>"u"&&kn.toLowerCase()==="content-type"?delete Y[kn]:z.setRequestHeader(kn,dt)}),t.isUndefined(w.withCredentials)||(z.withCredentials=!!w.withCredentials),H&&H!=="json"&&(z.responseType=w.responseType),typeof w.onDownloadProgress=="function"&&z.addEventListener("progress",w.onDownloadProgress),typeof w.onUploadProgress=="function"&&z.upload&&z.upload.addEventListener("progress",w.onUploadProgress),(w.cancelToken||w.signal)&&(B=function(be){z&&(M(!be||be&&be.type?new S("canceled"):be),z.abort(),z=null)},w.cancelToken&&w.cancelToken.subscribe(B),w.signal&&(w.signal.aborted?B():w.signal.addEventListener("abort",B))),F||(F=null),z.send(F)})},YI}var jr=Ui,Y8=y0e,b0e=NH,O0e=PH,N0e={"Content-Type":"application/x-www-form-urlencoded"};function X8(t,e){!jr.isUndefined(t)&&jr.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function P0e(){var t;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(t=z8()),t}function D0e(t,e,n){if(jr.isString(t))try{return(e||JSON.parse)(t),jr.trim(t)}catch(o){if(o.name!=="SyntaxError")throw o}return(n||JSON.stringify)(t)}var Sy={transitional:O0e,adapter:P0e(),transformRequest:[function(e,n){return Y8(n,"Accept"),Y8(n,"Content-Type"),jr.isFormData(e)||jr.isArrayBuffer(e)||jr.isBuffer(e)||jr.isStream(e)||jr.isFile(e)||jr.isBlob(e)?e:jr.isArrayBufferView(e)?e.buffer:jr.isURLSearchParams(e)?(X8(n,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):jr.isObject(e)||n&&n["Content-Type"]==="application/json"?(X8(n,"application/json"),D0e(e)):e}],transformResponse:[function(e){var n=this.transitional||Sy.transitional,o=n&&n.silentJSONParsing,c=n&&n.forcedJSONParsing,l=!o&&this.responseType==="json";if(l||c&&jr.isString(e)&&e.length)try{return JSON.parse(e)}catch(f){if(l)throw f.name==="SyntaxError"?b0e(f,this,"E_JSON_PARSE"):f}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};jr.forEach(["delete","get","head"],function(e){Sy.headers[e]={}});jr.forEach(["post","put","patch"],function(e){Sy.headers[e]=jr.merge(N0e)});var c2=Sy,k0e=Ui,L0e=c2,M0e=function(e,n,o){var c=this||L0e;return k0e.forEach(o,function(f){e=f.call(c,e,n)}),e},XI,J8;function kH(){return J8||(J8=1,XI=function(e){return!!(e&&e.__CANCEL__)}),XI}var Q8=Ui,JI=M0e,x0e=kH(),U0e=c2,V0e=yy();function QI(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new V0e("canceled")}var F0e=function(e){QI(e),e.headers=e.headers||{},e.data=JI.call(e,e.data,e.headers,e.transformRequest),e.headers=Q8.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),Q8.forEach(["delete","get","head","post","put","patch","common"],function(c){delete e.headers[c]});var n=e.adapter||U0e.adapter;return n(e).then(function(c){return QI(e),c.data=JI.call(e,c.data,c.headers,e.transformResponse),c},function(c){return x0e(c)||(QI(e),c&&c.response&&(c.response.data=JI.call(e,c.response.data,c.response.headers,e.transformResponse))),Promise.reject(c)})},rs=Ui,LH=function(e,n){n=n||{};var o={};function c(R,w){return rs.isPlainObject(R)&&rs.isPlainObject(w)?rs.merge(R,w):rs.isPlainObject(w)?rs.merge({},w):rs.isArray(w)?w.slice():w}function l(R){if(rs.isUndefined(n[R])){if(!rs.isUndefined(e[R]))return c(void 0,e[R])}else return c(e[R],n[R])}function f(R){if(!rs.isUndefined(n[R]))return c(void 0,n[R])}function _(R){if(rs.isUndefined(n[R])){if(!rs.isUndefined(e[R]))return c(void 0,e[R])}else return c(void 0,n[R])}function y(R){if(R in n)return c(e[R],n[R]);if(R in e)return c(void 0,e[R])}var S={url:f,method:f,data:f,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:y};return rs.forEach(Object.keys(e).concat(Object.keys(n)),function(w){var b=S[w]||l,k=b(w);rs.isUndefined(k)&&b!==y||(o[w]=k)}),o},ZI,Z8;function MH(){return Z8||(Z8=1,ZI={version:"0.26.1"}),ZI}var j0e=MH().version,u2={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){u2[t]=function(o){return typeof o===t||"a"+(e<1?"n ":" ")+t}});var eF={};u2.transitional=function(e,n,o){function c(l,f){return"[Axios v"+j0e+"] Transitional option '"+l+"'"+f+(o?". "+o:"")}return function(l,f,_){if(e===!1)throw new Error(c(f," has been removed"+(n?" in "+n:"")));return n&&!eF[f]&&(eF[f]=!0,console.warn(c(f," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(l,f,_):!0}};function B0e(t,e,n){if(typeof t!="object")throw new TypeError("options must be an object");for(var o=Object.keys(t),c=o.length;c-- >0;){var l=o[c],f=e[l];if(f){var _=t[l],y=_===void 0||f(_,l,t);if(y!==!0)throw new TypeError("option "+l+" must be "+y);continue}if(n!==!0)throw Error("Unknown option "+l)}}var G0e={assertOptions:B0e,validators:u2},xH=Ui,W0e=OH,tF=_0e,nF=F0e,Ty=LH,UH=G0e,ud=UH.validators;function bm(t){this.defaults=t,this.interceptors={request:new tF,response:new tF}}bm.prototype.request=function(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Ty(this.defaults,n),n.method?n.method=n.method.toLowerCase():this.defaults.method?n.method=this.defaults.method.toLowerCase():n.method="get";var o=n.transitional;o!==void 0&&UH.assertOptions(o,{silentJSONParsing:ud.transitional(ud.boolean),forcedJSONParsing:ud.transitional(ud.boolean),clarifyTimeoutError:ud.transitional(ud.boolean)},!1);var c=[],l=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(n)===!1||(l=l&&k.synchronous,c.unshift(k.fulfilled,k.rejected))});var f=[];this.interceptors.response.forEach(function(k){f.push(k.fulfilled,k.rejected)});var _;if(!l){var y=[nF,void 0];for(Array.prototype.unshift.apply(y,c),y=y.concat(f),_=Promise.resolve(n);y.length;)_=_.then(y.shift(),y.shift());return _}for(var S=n;c.length;){var R=c.shift(),w=c.shift();try{S=R(S)}catch(b){w(b);break}}try{_=nF(S)}catch(b){return Promise.reject(b)}for(;f.length;)_=_.then(f.shift(),f.shift());return _};bm.prototype.getUri=function(e){return e=Ty(this.defaults,e),W0e(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};xH.forEach(["delete","get","head","options"],function(e){bm.prototype[e]=function(n,o){return this.request(Ty(o||{},{method:e,url:n,data:(o||{}).data}))}});xH.forEach(["post","put","patch"],function(e){bm.prototype[e]=function(n,o,c){return this.request(Ty(c||{},{method:e,url:n,data:o}))}});var H0e=bm,ew,rF;function $0e(){if(rF)return ew;rF=1;var t=yy();function e(n){if(typeof n!="function")throw new TypeError("executor must be a function.");var o;this.promise=new Promise(function(f){o=f});var c=this;this.promise.then(function(l){if(c._listeners){var f,_=c._listeners.length;for(f=0;f<_;f++)c._listeners[f](l);c._listeners=null}}),this.promise.then=function(l){var f,_=new Promise(function(y){c.subscribe(y),f=y}).then(l);return _.cancel=function(){c.unsubscribe(f)},_},n(function(f){c.reason||(c.reason=new t(f),o(c.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]},e.prototype.unsubscribe=function(o){if(this._listeners){var c=this._listeners.indexOf(o);c!==-1&&this._listeners.splice(c,1)}},e.source=function(){var o,c=new e(function(f){o=f});return{token:c,cancel:o}},ew=e,ew}var tw,iF;function K0e(){return iF||(iF=1,tw=function(e){return function(o){return e.apply(null,o)}}),tw}var nw,sF;function q0e(){if(sF)return nw;sF=1;var t=Ui;return nw=function(n){return t.isObject(n)&&n.isAxiosError===!0},nw}var oF=Ui,z0e=wH,S_=H0e,Y0e=LH,X0e=c2;function VH(t){var e=new S_(t),n=z0e(S_.prototype.request,e);return oF.extend(n,S_.prototype,e),oF.extend(n,e),n.create=function(c){return VH(Y0e(t,c))},n}var Bo=VH(X0e);Bo.Axios=S_;Bo.Cancel=yy();Bo.CancelToken=$0e();Bo.isCancel=kH();Bo.VERSION=MH().version;Bo.all=function(e){return Promise.all(e)};Bo.spread=K0e();Bo.isAxiosError=q0e();t0e.exports=Bo;Bv.default=Bo;(function(t){t.exports=Bv})(e0e);var xn={},l2={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RequiredError=t.BaseAPI=t.COLLECTION_FORMATS=t.BASE_PATH=void 0;const e=jv;t.BASE_PATH="https://api.openai.com/v1".replace(/\/+$/,""),t.COLLECTION_FORMATS={csv:",",ssv:" ",tsv:"	",pipes:"|"};class n{constructor(l,f=t.BASE_PATH,_=e.default){this.basePath=f,this.axios=_,l&&(this.configuration=l,this.basePath=l.basePath||this.basePath)}}t.BaseAPI=n;class o extends Error{constructor(l,f){super(f),this.field=l,this.name="RequiredError"}}t.RequiredError=o})(l2);var d2=to&&to.__awaiter||function(t,e,n,o){function c(l){return l instanceof n?l:new n(function(f){f(l)})}return new(n||(n=Promise))(function(l,f){function _(R){try{S(o.next(R))}catch(w){f(w)}}function y(R){try{S(o.throw(R))}catch(w){f(w)}}function S(R){R.done?l(R.value):c(R.value).then(_,y)}S((o=o.apply(t,e||[])).next())})};Object.defineProperty(xn,"__esModule",{value:!0});xn.createRequestFunction=xn.toPathString=xn.serializeDataIfNeeded=xn.setSearchParams=xn.setOAuthToObject=xn.setBearerAuthToObject=xn.setBasicAuthToObject=xn.setApiKeyToObject=xn.assertParamExists=xn.DUMMY_BASE_URL=void 0;const J0e=l2;xn.DUMMY_BASE_URL="https://example.com";xn.assertParamExists=function(t,e,n){if(n==null)throw new J0e.RequiredError(e,`Required parameter ${e} was null or undefined when calling ${t}.`)};xn.setApiKeyToObject=function(t,e,n){return d2(this,void 0,void 0,function*(){if(n&&n.apiKey){const o=typeof n.apiKey=="function"?yield n.apiKey(e):yield n.apiKey;t[e]=o}})};xn.setBasicAuthToObject=function(t,e){e&&(e.username||e.password)&&(t.auth={username:e.username,password:e.password})};xn.setBearerAuthToObject=function(t,e){return d2(this,void 0,void 0,function*(){if(e&&e.accessToken){const n=typeof e.accessToken=="function"?yield e.accessToken():yield e.accessToken;t.Authorization="Bearer "+n}})};xn.setOAuthToObject=function(t,e,n,o){return d2(this,void 0,void 0,function*(){if(o&&o.accessToken){const c=typeof o.accessToken=="function"?yield o.accessToken(e,n):yield o.accessToken;t.Authorization="Bearer "+c}})};function dA(t,e,n=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(o=>dA(t,o,n)):Object.keys(e).forEach(o=>dA(t,e[o],`${n}${n!==""?".":""}${o}`)):t.has(n)?t.append(n,e):t.set(n,e))}xn.setSearchParams=function(t,...e){const n=new URLSearchParams(t.search);dA(n,e),t.search=n.toString()};xn.serializeDataIfNeeded=function(t,e,n){const o=typeof t!="string";return(o&&n&&n.isJsonMime?n.isJsonMime(e.headers["Content-Type"]):o)?JSON.stringify(t!==void 0?t:{}):t||""};xn.toPathString=function(t){return t.pathname+t.search+t.hash};xn.createRequestFunction=function(t,e,n,o){return(c=e,l=n)=>{const f=Object.assign(Object.assign({},t.options),{url:((o==null?void 0:o.basePath)||l)+t.url});return c.request(f)}};(function(t){var e=to&&to.__awaiter||function(f,_,y,S){function R(w){return w instanceof y?w:new y(function(b){b(w)})}return new(y||(y=Promise))(function(w,b){function k(Y){try{F(S.next(Y))}catch(H){b(H)}}function M(Y){try{F(S.throw(Y))}catch(H){b(H)}}function F(Y){Y.done?w(Y.value):R(Y.value).then(k,M)}F((S=S.apply(f,_||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIApi=t.OpenAIApiFactory=t.OpenAIApiFp=t.OpenAIApiAxiosParamCreator=t.CreateImageRequestResponseFormatEnum=t.CreateImageRequestSizeEnum=t.ChatCompletionResponseMessageRoleEnum=t.ChatCompletionRequestMessageRoleEnum=void 0;const n=jv,o=xn,c=l2;t.ChatCompletionRequestMessageRoleEnum={System:"system",User:"user",Assistant:"assistant"},t.ChatCompletionResponseMessageRoleEnum={System:"system",User:"user",Assistant:"assistant"},t.CreateImageRequestSizeEnum={_256x256:"256x256",_512x512:"512x512",_1024x1024:"1024x1024"},t.CreateImageRequestResponseFormatEnum={Url:"url",B64Json:"b64_json"},t.OpenAIApiAxiosParamCreator=function(f){return{cancelFineTune:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("cancelFineTune","fineTuneId",_);const S="/fine-tunes/{fine_tune_id}/cancel".replace("{fine_tune_id}",encodeURIComponent(String(_))),R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),{url:o.toPathString(R),options:b}}),createAnswer:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createAnswer","createAnswerRequest",_);const S="/answers",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createChatCompletion:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createChatCompletion","createChatCompletionRequest",_);const S="/chat/completions",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createClassification:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createClassification","createClassificationRequest",_);const S="/classifications",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createCompletion:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createCompletion","createCompletionRequest",_);const S="/completions",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createEdit:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createEdit","createEditRequest",_);const S="/edits",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createEmbedding:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createEmbedding","createEmbeddingRequest",_);const S="/embeddings",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createFile:(_,y,S={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createFile","file",_),o.assertParamExists("createFile","purpose",y);const R="/files",w=new URL(R,o.DUMMY_BASE_URL);let b;f&&(b=f.baseOptions);const k=Object.assign(Object.assign({method:"POST"},b),S),M={},F={},Y=new(f&&f.formDataCtor||FormData);_!==void 0&&Y.append("file",_),y!==void 0&&Y.append("purpose",y),M["Content-Type"]="multipart/form-data",o.setSearchParams(w,F);let H=b&&b.headers?b.headers:{};return k.headers=Object.assign(Object.assign(Object.assign(Object.assign({},M),Y.getHeaders()),H),S.headers),k.data=Y,{url:o.toPathString(w),options:k}}),createFineTune:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createFineTune","createFineTuneRequest",_);const S="/fine-tunes",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createImage:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createImage","createImageRequest",_);const S="/images/generations",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createImageEdit:(_,y,S,R,w,b,k,M={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createImageEdit","image",_),o.assertParamExists("createImageEdit","prompt",y);const F="/images/edits",Y=new URL(F,o.DUMMY_BASE_URL);let H;f&&(H=f.baseOptions);const B=Object.assign(Object.assign({method:"POST"},H),M),K={},z={},oe=new(f&&f.formDataCtor||FormData);_!==void 0&&oe.append("image",_),S!==void 0&&oe.append("mask",S),y!==void 0&&oe.append("prompt",y),R!==void 0&&oe.append("n",R),w!==void 0&&oe.append("size",w),b!==void 0&&oe.append("response_format",b),k!==void 0&&oe.append("user",k),K["Content-Type"]="multipart/form-data",o.setSearchParams(Y,z);let de=H&&H.headers?H.headers:{};return B.headers=Object.assign(Object.assign(Object.assign(Object.assign({},K),oe.getHeaders()),de),M.headers),B.data=oe,{url:o.toPathString(Y),options:B}}),createImageVariation:(_,y,S,R,w,b={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createImageVariation","image",_);const k="/images/variations",M=new URL(k,o.DUMMY_BASE_URL);let F;f&&(F=f.baseOptions);const Y=Object.assign(Object.assign({method:"POST"},F),b),H={},B={},K=new(f&&f.formDataCtor||FormData);_!==void 0&&K.append("image",_),y!==void 0&&K.append("n",y),S!==void 0&&K.append("size",S),R!==void 0&&K.append("response_format",R),w!==void 0&&K.append("user",w),H["Content-Type"]="multipart/form-data",o.setSearchParams(M,B);let z=F&&F.headers?F.headers:{};return Y.headers=Object.assign(Object.assign(Object.assign(Object.assign({},H),K.getHeaders()),z),b.headers),Y.data=K,{url:o.toPathString(M),options:Y}}),createModeration:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createModeration","createModerationRequest",_);const S="/moderations",R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"POST"},w),y),k={},M={};k["Content-Type"]="application/json",o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),b.data=o.serializeDataIfNeeded(_,b,f),{url:o.toPathString(R),options:b}}),createSearch:(_,y,S={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createSearch","engineId",_),o.assertParamExists("createSearch","createSearchRequest",y);const R="/engines/{engine_id}/search".replace("{engine_id}",encodeURIComponent(String(_))),w=new URL(R,o.DUMMY_BASE_URL);let b;f&&(b=f.baseOptions);const k=Object.assign(Object.assign({method:"POST"},b),S),M={},F={};M["Content-Type"]="application/json",o.setSearchParams(w,F);let Y=b&&b.headers?b.headers:{};return k.headers=Object.assign(Object.assign(Object.assign({},M),Y),S.headers),k.data=o.serializeDataIfNeeded(y,k,f),{url:o.toPathString(w),options:k}}),createTranscription:(_,y,S,R,w,b,k={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createTranscription","file",_),o.assertParamExists("createTranscription","model",y);const M="/audio/transcriptions",F=new URL(M,o.DUMMY_BASE_URL);let Y;f&&(Y=f.baseOptions);const H=Object.assign(Object.assign({method:"POST"},Y),k),B={},K={},z=new(f&&f.formDataCtor||FormData);_!==void 0&&z.append("file",_),y!==void 0&&z.append("model",y),S!==void 0&&z.append("prompt",S),R!==void 0&&z.append("response_format",R),w!==void 0&&z.append("temperature",w),b!==void 0&&z.append("language",b),B["Content-Type"]="multipart/form-data",o.setSearchParams(F,K);let oe=Y&&Y.headers?Y.headers:{};return H.headers=Object.assign(Object.assign(Object.assign(Object.assign({},B),z.getHeaders()),oe),k.headers),H.data=z,{url:o.toPathString(F),options:H}}),createTranslation:(_,y,S,R,w,b={})=>e(this,void 0,void 0,function*(){o.assertParamExists("createTranslation","file",_),o.assertParamExists("createTranslation","model",y);const k="/audio/translations",M=new URL(k,o.DUMMY_BASE_URL);let F;f&&(F=f.baseOptions);const Y=Object.assign(Object.assign({method:"POST"},F),b),H={},B={},K=new(f&&f.formDataCtor||FormData);_!==void 0&&K.append("file",_),y!==void 0&&K.append("model",y),S!==void 0&&K.append("prompt",S),R!==void 0&&K.append("response_format",R),w!==void 0&&K.append("temperature",w),H["Content-Type"]="multipart/form-data",o.setSearchParams(M,B);let z=F&&F.headers?F.headers:{};return Y.headers=Object.assign(Object.assign(Object.assign(Object.assign({},H),K.getHeaders()),z),b.headers),Y.data=K,{url:o.toPathString(M),options:Y}}),deleteFile:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("deleteFile","fileId",_);const S="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(_))),R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"DELETE"},w),y),k={},M={};o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),{url:o.toPathString(R),options:b}}),deleteModel:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("deleteModel","model",_);const S="/models/{model}".replace("{model}",encodeURIComponent(String(_))),R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"DELETE"},w),y),k={},M={};o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),{url:o.toPathString(R),options:b}}),downloadFile:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("downloadFile","fileId",_);const S="/files/{file_id}/content".replace("{file_id}",encodeURIComponent(String(_))),R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"GET"},w),y),k={},M={};o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),{url:o.toPathString(R),options:b}}),listEngines:(_={})=>e(this,void 0,void 0,function*(){const y="/engines",S=new URL(y,o.DUMMY_BASE_URL);let R;f&&(R=f.baseOptions);const w=Object.assign(Object.assign({method:"GET"},R),_),b={},k={};o.setSearchParams(S,k);let M=R&&R.headers?R.headers:{};return w.headers=Object.assign(Object.assign(Object.assign({},b),M),_.headers),{url:o.toPathString(S),options:w}}),listFiles:(_={})=>e(this,void 0,void 0,function*(){const y="/files",S=new URL(y,o.DUMMY_BASE_URL);let R;f&&(R=f.baseOptions);const w=Object.assign(Object.assign({method:"GET"},R),_),b={},k={};o.setSearchParams(S,k);let M=R&&R.headers?R.headers:{};return w.headers=Object.assign(Object.assign(Object.assign({},b),M),_.headers),{url:o.toPathString(S),options:w}}),listFineTuneEvents:(_,y,S={})=>e(this,void 0,void 0,function*(){o.assertParamExists("listFineTuneEvents","fineTuneId",_);const R="/fine-tunes/{fine_tune_id}/events".replace("{fine_tune_id}",encodeURIComponent(String(_))),w=new URL(R,o.DUMMY_BASE_URL);let b;f&&(b=f.baseOptions);const k=Object.assign(Object.assign({method:"GET"},b),S),M={},F={};y!==void 0&&(F.stream=y),o.setSearchParams(w,F);let Y=b&&b.headers?b.headers:{};return k.headers=Object.assign(Object.assign(Object.assign({},M),Y),S.headers),{url:o.toPathString(w),options:k}}),listFineTunes:(_={})=>e(this,void 0,void 0,function*(){const y="/fine-tunes",S=new URL(y,o.DUMMY_BASE_URL);let R;f&&(R=f.baseOptions);const w=Object.assign(Object.assign({method:"GET"},R),_),b={},k={};o.setSearchParams(S,k);let M=R&&R.headers?R.headers:{};return w.headers=Object.assign(Object.assign(Object.assign({},b),M),_.headers),{url:o.toPathString(S),options:w}}),listModels:(_={})=>e(this,void 0,void 0,function*(){const y="/models",S=new URL(y,o.DUMMY_BASE_URL);let R;f&&(R=f.baseOptions);const w=Object.assign(Object.assign({method:"GET"},R),_),b={},k={};o.setSearchParams(S,k);let M=R&&R.headers?R.headers:{};return w.headers=Object.assign(Object.assign(Object.assign({},b),M),_.headers),{url:o.toPathString(S),options:w}}),retrieveEngine:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("retrieveEngine","engineId",_);const S="/engines/{engine_id}".replace("{engine_id}",encodeURIComponent(String(_))),R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"GET"},w),y),k={},M={};o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),{url:o.toPathString(R),options:b}}),retrieveFile:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("retrieveFile","fileId",_);const S="/files/{file_id}".replace("{file_id}",encodeURIComponent(String(_))),R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"GET"},w),y),k={},M={};o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),{url:o.toPathString(R),options:b}}),retrieveFineTune:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("retrieveFineTune","fineTuneId",_);const S="/fine-tunes/{fine_tune_id}".replace("{fine_tune_id}",encodeURIComponent(String(_))),R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"GET"},w),y),k={},M={};o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),{url:o.toPathString(R),options:b}}),retrieveModel:(_,y={})=>e(this,void 0,void 0,function*(){o.assertParamExists("retrieveModel","model",_);const S="/models/{model}".replace("{model}",encodeURIComponent(String(_))),R=new URL(S,o.DUMMY_BASE_URL);let w;f&&(w=f.baseOptions);const b=Object.assign(Object.assign({method:"GET"},w),y),k={},M={};o.setSearchParams(R,M);let F=w&&w.headers?w.headers:{};return b.headers=Object.assign(Object.assign(Object.assign({},k),F),y.headers),{url:o.toPathString(R),options:b}})}},t.OpenAIApiFp=function(f){const _=t.OpenAIApiAxiosParamCreator(f);return{cancelFineTune(y,S){return e(this,void 0,void 0,function*(){const R=yield _.cancelFineTune(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createAnswer(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createAnswer(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createChatCompletion(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createChatCompletion(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createClassification(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createClassification(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createCompletion(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createCompletion(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createEdit(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createEdit(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createEmbedding(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createEmbedding(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createFile(y,S,R){return e(this,void 0,void 0,function*(){const w=yield _.createFile(y,S,R);return o.createRequestFunction(w,n.default,c.BASE_PATH,f)})},createFineTune(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createFineTune(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createImage(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createImage(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createImageEdit(y,S,R,w,b,k,M,F){return e(this,void 0,void 0,function*(){const Y=yield _.createImageEdit(y,S,R,w,b,k,M,F);return o.createRequestFunction(Y,n.default,c.BASE_PATH,f)})},createImageVariation(y,S,R,w,b,k){return e(this,void 0,void 0,function*(){const M=yield _.createImageVariation(y,S,R,w,b,k);return o.createRequestFunction(M,n.default,c.BASE_PATH,f)})},createModeration(y,S){return e(this,void 0,void 0,function*(){const R=yield _.createModeration(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},createSearch(y,S,R){return e(this,void 0,void 0,function*(){const w=yield _.createSearch(y,S,R);return o.createRequestFunction(w,n.default,c.BASE_PATH,f)})},createTranscription(y,S,R,w,b,k,M){return e(this,void 0,void 0,function*(){const F=yield _.createTranscription(y,S,R,w,b,k,M);return o.createRequestFunction(F,n.default,c.BASE_PATH,f)})},createTranslation(y,S,R,w,b,k){return e(this,void 0,void 0,function*(){const M=yield _.createTranslation(y,S,R,w,b,k);return o.createRequestFunction(M,n.default,c.BASE_PATH,f)})},deleteFile(y,S){return e(this,void 0,void 0,function*(){const R=yield _.deleteFile(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},deleteModel(y,S){return e(this,void 0,void 0,function*(){const R=yield _.deleteModel(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},downloadFile(y,S){return e(this,void 0,void 0,function*(){const R=yield _.downloadFile(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},listEngines(y){return e(this,void 0,void 0,function*(){const S=yield _.listEngines(y);return o.createRequestFunction(S,n.default,c.BASE_PATH,f)})},listFiles(y){return e(this,void 0,void 0,function*(){const S=yield _.listFiles(y);return o.createRequestFunction(S,n.default,c.BASE_PATH,f)})},listFineTuneEvents(y,S,R){return e(this,void 0,void 0,function*(){const w=yield _.listFineTuneEvents(y,S,R);return o.createRequestFunction(w,n.default,c.BASE_PATH,f)})},listFineTunes(y){return e(this,void 0,void 0,function*(){const S=yield _.listFineTunes(y);return o.createRequestFunction(S,n.default,c.BASE_PATH,f)})},listModels(y){return e(this,void 0,void 0,function*(){const S=yield _.listModels(y);return o.createRequestFunction(S,n.default,c.BASE_PATH,f)})},retrieveEngine(y,S){return e(this,void 0,void 0,function*(){const R=yield _.retrieveEngine(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},retrieveFile(y,S){return e(this,void 0,void 0,function*(){const R=yield _.retrieveFile(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},retrieveFineTune(y,S){return e(this,void 0,void 0,function*(){const R=yield _.retrieveFineTune(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})},retrieveModel(y,S){return e(this,void 0,void 0,function*(){const R=yield _.retrieveModel(y,S);return o.createRequestFunction(R,n.default,c.BASE_PATH,f)})}}},t.OpenAIApiFactory=function(f,_,y){const S=t.OpenAIApiFp(f);return{cancelFineTune(R,w){return S.cancelFineTune(R,w).then(b=>b(y,_))},createAnswer(R,w){return S.createAnswer(R,w).then(b=>b(y,_))},createChatCompletion(R,w){return S.createChatCompletion(R,w).then(b=>b(y,_))},createClassification(R,w){return S.createClassification(R,w).then(b=>b(y,_))},createCompletion(R,w){return S.createCompletion(R,w).then(b=>b(y,_))},createEdit(R,w){return S.createEdit(R,w).then(b=>b(y,_))},createEmbedding(R,w){return S.createEmbedding(R,w).then(b=>b(y,_))},createFile(R,w,b){return S.createFile(R,w,b).then(k=>k(y,_))},createFineTune(R,w){return S.createFineTune(R,w).then(b=>b(y,_))},createImage(R,w){return S.createImage(R,w).then(b=>b(y,_))},createImageEdit(R,w,b,k,M,F,Y,H){return S.createImageEdit(R,w,b,k,M,F,Y,H).then(B=>B(y,_))},createImageVariation(R,w,b,k,M,F){return S.createImageVariation(R,w,b,k,M,F).then(Y=>Y(y,_))},createModeration(R,w){return S.createModeration(R,w).then(b=>b(y,_))},createSearch(R,w,b){return S.createSearch(R,w,b).then(k=>k(y,_))},createTranscription(R,w,b,k,M,F,Y){return S.createTranscription(R,w,b,k,M,F,Y).then(H=>H(y,_))},createTranslation(R,w,b,k,M,F){return S.createTranslation(R,w,b,k,M,F).then(Y=>Y(y,_))},deleteFile(R,w){return S.deleteFile(R,w).then(b=>b(y,_))},deleteModel(R,w){return S.deleteModel(R,w).then(b=>b(y,_))},downloadFile(R,w){return S.downloadFile(R,w).then(b=>b(y,_))},listEngines(R){return S.listEngines(R).then(w=>w(y,_))},listFiles(R){return S.listFiles(R).then(w=>w(y,_))},listFineTuneEvents(R,w,b){return S.listFineTuneEvents(R,w,b).then(k=>k(y,_))},listFineTunes(R){return S.listFineTunes(R).then(w=>w(y,_))},listModels(R){return S.listModels(R).then(w=>w(y,_))},retrieveEngine(R,w){return S.retrieveEngine(R,w).then(b=>b(y,_))},retrieveFile(R,w){return S.retrieveFile(R,w).then(b=>b(y,_))},retrieveFineTune(R,w){return S.retrieveFineTune(R,w).then(b=>b(y,_))},retrieveModel(R,w){return S.retrieveModel(R,w).then(b=>b(y,_))}}};class l extends c.BaseAPI{cancelFineTune(_,y){return t.OpenAIApiFp(this.configuration).cancelFineTune(_,y).then(S=>S(this.axios,this.basePath))}createAnswer(_,y){return t.OpenAIApiFp(this.configuration).createAnswer(_,y).then(S=>S(this.axios,this.basePath))}createChatCompletion(_,y){return t.OpenAIApiFp(this.configuration).createChatCompletion(_,y).then(S=>S(this.axios,this.basePath))}createClassification(_,y){return t.OpenAIApiFp(this.configuration).createClassification(_,y).then(S=>S(this.axios,this.basePath))}createCompletion(_,y){return t.OpenAIApiFp(this.configuration).createCompletion(_,y).then(S=>S(this.axios,this.basePath))}createEdit(_,y){return t.OpenAIApiFp(this.configuration).createEdit(_,y).then(S=>S(this.axios,this.basePath))}createEmbedding(_,y){return t.OpenAIApiFp(this.configuration).createEmbedding(_,y).then(S=>S(this.axios,this.basePath))}createFile(_,y,S){return t.OpenAIApiFp(this.configuration).createFile(_,y,S).then(R=>R(this.axios,this.basePath))}createFineTune(_,y){return t.OpenAIApiFp(this.configuration).createFineTune(_,y).then(S=>S(this.axios,this.basePath))}createImage(_,y){return t.OpenAIApiFp(this.configuration).createImage(_,y).then(S=>S(this.axios,this.basePath))}createImageEdit(_,y,S,R,w,b,k,M){return t.OpenAIApiFp(this.configuration).createImageEdit(_,y,S,R,w,b,k,M).then(F=>F(this.axios,this.basePath))}createImageVariation(_,y,S,R,w,b){return t.OpenAIApiFp(this.configuration).createImageVariation(_,y,S,R,w,b).then(k=>k(this.axios,this.basePath))}createModeration(_,y){return t.OpenAIApiFp(this.configuration).createModeration(_,y).then(S=>S(this.axios,this.basePath))}createSearch(_,y,S){return t.OpenAIApiFp(this.configuration).createSearch(_,y,S).then(R=>R(this.axios,this.basePath))}createTranscription(_,y,S,R,w,b,k){return t.OpenAIApiFp(this.configuration).createTranscription(_,y,S,R,w,b,k).then(M=>M(this.axios,this.basePath))}createTranslation(_,y,S,R,w,b){return t.OpenAIApiFp(this.configuration).createTranslation(_,y,S,R,w,b).then(k=>k(this.axios,this.basePath))}deleteFile(_,y){return t.OpenAIApiFp(this.configuration).deleteFile(_,y).then(S=>S(this.axios,this.basePath))}deleteModel(_,y){return t.OpenAIApiFp(this.configuration).deleteModel(_,y).then(S=>S(this.axios,this.basePath))}downloadFile(_,y){return t.OpenAIApiFp(this.configuration).downloadFile(_,y).then(S=>S(this.axios,this.basePath))}listEngines(_){return t.OpenAIApiFp(this.configuration).listEngines(_).then(y=>y(this.axios,this.basePath))}listFiles(_){return t.OpenAIApiFp(this.configuration).listFiles(_).then(y=>y(this.axios,this.basePath))}listFineTuneEvents(_,y,S){return t.OpenAIApiFp(this.configuration).listFineTuneEvents(_,y,S).then(R=>R(this.axios,this.basePath))}listFineTunes(_){return t.OpenAIApiFp(this.configuration).listFineTunes(_).then(y=>y(this.axios,this.basePath))}listModels(_){return t.OpenAIApiFp(this.configuration).listModels(_).then(y=>y(this.axios,this.basePath))}retrieveEngine(_,y){return t.OpenAIApiFp(this.configuration).retrieveEngine(_,y).then(S=>S(this.axios,this.basePath))}retrieveFile(_,y){return t.OpenAIApiFp(this.configuration).retrieveFile(_,y).then(S=>S(this.axios,this.basePath))}retrieveFineTune(_,y){return t.OpenAIApiFp(this.configuration).retrieveFineTune(_,y).then(S=>S(this.axios,this.basePath))}retrieveModel(_,y){return t.OpenAIApiFp(this.configuration).retrieveModel(_,y).then(S=>S(this.axios,this.basePath))}}t.OpenAIApi=l})(IH);var Ry={};const Q0e="openai",Z0e="3.2.1",eSe="Node.js library for the OpenAI API",tSe={type:"git",url:"git@github.com:openai/openai-node.git"},nSe=["openai","open","ai","gpt-3","gpt3"],rSe="OpenAI",iSe="MIT",sSe="./dist/index.js",oSe="./dist/index.d.ts",aSe={build:"tsc --outDir dist/"},cSe={axios:"^0.26.0","form-data":"^4.0.0"},uSe={"@types/node":"^12.11.5",typescript:"^3.6.4"},lSe={name:Q0e,version:Z0e,description:eSe,repository:tSe,keywords:nSe,author:rSe,license:iSe,main:sSe,types:oSe,scripts:aSe,dependencies:cSe,devDependencies:uSe};var rw,aF;function dSe(){return aF||(aF=1,rw=typeof self=="object"?self.FormData:window.FormData),rw}Object.defineProperty(Ry,"__esModule",{value:!0});Ry.Configuration=void 0;const hSe=lSe;class pSe{constructor(e={}){this.apiKey=e.apiKey,this.organization=e.organization,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor,this.baseOptions||(this.baseOptions={}),this.baseOptions.headers=Object.assign({"User-Agent":`OpenAI/NodeJS/${hSe.version}`,Authorization:`Bearer ${this.apiKey}`},this.baseOptions.headers),this.organization&&(this.baseOptions.headers["OpenAI-Organization"]=this.organization),this.formDataCtor||(this.formDataCtor=dSe())}isJsonMime(e){const n=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(n.test(e)||e.toLowerCase()==="application/json-patch+json")}}Ry.Configuration=pSe;(function(t){var e=to&&to.__createBinding||(Object.create?function(o,c,l,f){f===void 0&&(f=l),Object.defineProperty(o,f,{enumerable:!0,get:function(){return c[l]}})}:function(o,c,l,f){f===void 0&&(f=l),o[f]=c[l]}),n=to&&to.__exportStar||function(o,c){for(var l in o)l!=="default"&&!c.hasOwnProperty(l)&&e(c,o,l)};Object.defineProperty(t,"__esModule",{value:!0}),n(IH,t),n(Ry,t)})(s2);const fSe=new s2.Configuration({apiKey:gSe("fx-sHliwidJB2bR88i4rARtG3OyoxSWFj1YjTAAqkvj0sZ5ouQZ")}),mSe=new s2.OpenAIApi(fSe),FH=async function(t,e,n=`${_y()}${Date.now()}`,o,c){try{const l=await $ge(Ao(ks,"channels",n),{channelName:t,channelDescription:e,id:n,isPrivate:!!o,members:o?c:[{id:Je.currentUser.uid,photoURL:Je.currentUser.photoURL,name:Je.currentUser.displayName,email:Je.currentUser.email},{id:"openai",photoURL:"openai",name:"OpenAI",email:null}],messages:[]});console.log("channel created!")}catch(l){console.log(l.message)}},hA=async function(t,e,n){var c,l,f,_,y,S,R,w,b,k,M,F,Y,H,B,K,z,oe,de,Ee;if(t.trim().length===0)return;const o=Ao(ks,"channels",n.channelId);try{if(t.trim().toLowerCase().startsWith("@openai")){const we=((c=Je.currentUser)==null?void 0:c.displayName)||((y=(l=Je.currentUser)==null?void 0:l.email)==null?void 0:y.slice(0,(_=(f=Je.currentUser)==null?void 0:f.email)==null?void 0:_.indexOf("@"))),Fe=[{role:"system",content:"You are a chatbot in a chat application. Always tag every user you respond to."},...n.channelMessages.slice(-25).map(dt=>({role:dt.id?dt.id==="openai"?"assistant":"user":dt.userName==="openai"?"assistant":"user",content:`

${dt.message}`})),{role:"user",content:`

${we}: ${t}`}];await _a(o,{messages:fc({message:t,userName:we,userImg:(S=Je.currentUser)==null?void 0:S.photoURL,email:(R=Je.currentUser)==null?void 0:R.email,date:Date.now(),user:e})});const be=await mSe.createChatCompletion({model:"gpt-3.5-turbo",messages:Fe,max_tokens:100,temperature:.8});await _a(o,{messages:fc({message:`${(w=be.data.choices[0].message)==null?void 0:w.content}`,userName:"openai",userImg:"openai",email:null,date:Date.now(),user:"openai"})});return}await _a(o,{messages:fc({message:t,user:e,userName:((b=Je.currentUser)==null?void 0:b.displayName)||((Y=(k=Je.currentUser)==null?void 0:k.email)==null?void 0:Y.slice(0,(F=(M=Je.currentUser)==null?void 0:M.email)==null?void 0:F.indexOf("@"))),userImg:(H=Je.currentUser)==null?void 0:H.photoURL,email:(B=Je.currentUser)==null?void 0:B.email,date:Date.now()})})}catch(we){if(we.code!=="not-found"||!n.isPrivate)return;FH([n.channelName,((K=Je.currentUser)==null?void 0:K.displayName)||((Ee=(z=Je.currentUser)==null?void 0:z.email)==null?void 0:Ee.slice(0,(de=(oe=Je.currentUser)==null?void 0:oe.email)==null?void 0:de.indexOf("@")))],"Private channel",n.channelId,!0,n.channelMembers),hA(t,Je.currentUser.uid,n),console.dir(we)}};function gSe(t){let e="";for(let n=0;n<t.length;n++){const o=t.charCodeAt(n);o>=65&&o<=90?e+=String.fromCharCode((o-65+13)%26+65):o>=97&&o<=122?e+=String.fromCharCode((o-97+13)%26+97):e+=t.charAt(n)}return e}const ESe=function({userImg:t,userName:e,date:n,message:o,email:c}){const l=t==="openai"?SH:t||ch,f=e||c.slice(0,c.indexOf("@"));let _=new Date(n);const y=`${_.getHours()}:${(""+_.getMinutes()).padStart(2,"0")}`;let S;const R=new Date(n);return R.setDate(R.getDate()+1),new Intl.DateTimeFormat("en-GB").format(new Date)===new Intl.DateTimeFormat("en-GB").format(R)?S="yesterday":new Intl.DateTimeFormat("en-GB").format(new Date)===new Intl.DateTimeFormat("en-GB").format(_)?S="today":S=new Intl.DateTimeFormat("en-GB").format(_),Pt(Pa.div,{initial:{y:100},animate:{y:0},className:"member-message",children:[ge("img",{src:l,alt:f,onError:w=>{w.target.src=ch}}),Pt("div",{className:"header",children:[ge("p",{className:"name",children:f}),ge("p",{className:"date",children:`${S}, ${y}`})]}),ge("p",{className:"message",children:o})]})},_Se="/assets/paper-plane-solid-1be22845.svg",vSe="/assets/bars-solid-4c429154.svg";const ySe=function({setIsModalOpen:t}){const e=function(f){f.target.closest(".container")||t(!1)},n=te.useRef(null),o=te.useRef(null),c=mh();return document.getElementById("modal-root").addEventListener("click",e),ge(Pa.div,{className:"modal",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25},children:Pt(Pa.div,{className:"container",initial:{scale:0},animate:{scale:1,transition:{type:"spring",damping:25,stiffness:500,duration:.4}},children:[ge("h2",{children:"New Channel"}),ge("input",{type:"text",placeholder:"Channel name",maxLength:24,ref:n}),ge("textarea",{placeholder:"Channel Description",ref:o}),ge(vH,{onClick:()=>{try{if(n.current.value.trim()==="")throw new Error("Please enter a name");if(o.current.value.trim()==="")throw new Error("Please enter a description");FH(n.current.value,o.current.value)}catch(f){c(Pc.resetErrorMessage(f.message))}},children:"Save"})]})})},SSe="/assets/video_call_FILL0_wght400_GRAD0_opsz48-ee8eac10.svg";const TSe=function({channelInfo:t,isModalOpen:e,setIsNavOpen:n,setIsModalOpen:o}){const c=co(),[l,f]=te.useState(""),_=te.useRef(null),y=te.useRef(null),[S,R]=te.useState([{date:0,message:"",userImg:"",userName:"",email:""}]),w=function(){n(F=>!F)},b=function(F){F.key==="Enter"&&(F.preventDefault(),hA(_.current.value,Je.currentUser.uid,t),_.current.value="",y.current.innerHTML="",_.current.style.height=y.current.clientHeight+"px")},k=function(){const F=/\n/g,Y=_.current.value.split(F).map(H=>(H.trim()===""&&(H="a"),`<p>${H}</p>`));y.current.style.width=_.current.clientWidth+"px",y.current.innerHTML=Y.join(""),_.current.style.height=y.current.clientHeight+"px"};return te.useEffect(()=>eW(FG(ks,"channels"),Y=>{let H=[];Y.docs.forEach(B=>{B.data().id===t.channelId&&(H=B.data().messages)}),R(H),_.current&&f(_.current.value)}),[t.channelId]),te.useEffect(()=>{window.scrollTo(0,document.body.scrollHeight+52),_.current&&(_.current.value=l)},[S.length]),Pt("main",{className:"chat-interface",onClick:function(F){var Y;!F.target.closest(".nav")&&!F.target.matches(".menu")&&((Y=document.querySelector(".nav"))!=null&&Y.classList.contains("active"))&&w()},children:[ge(Cae,{}),Pt("section",{children:[Pt("header",{className:"header",children:[ge("img",{src:vSe,alt:"menu",onClick:w,className:"menu"}),ge("p",{children:t.channelName}),(t.channelMembers.length===3||t.isPrivate)&&ge("img",{className:"video-call",src:SSe,alt:"video call",onClick:()=>c("/call")})]}),Pt("div",{className:"main-container container",children:[ge("div",{className:"messages-container",children:S.map((F,Y)=>ge(ESe,{...F},Y))}),!(t.channelId==="16A4w32PivaHAasvXbflX1676971533389"&&Je.currentUser.uid!=="88yL1VnbdcgSLUwKisB4L3soou22")&&Pt("label",{htmlFor:"message",className:"message-input",children:[ge("textarea",{id:"message",placeholder:"Type a message here",autoComplete:"off",ref:_,onKeyDown:b,onInput:k}),ge("div",{className:"textarea-width",ref:y}),ge("button",{onClick:()=>{hA(_.current.value,Je.currentUser.uid,t),_.current.value=""},children:ge("img",{src:_Se,alt:"send"})})]})]}),Ooe.createPortal(ge(i2,{children:e&&ge(ySe,{setIsModalOpen:o})}),document.getElementById("modal-root"))]})]})},RSe="/assets/plus-solid-5511053f.svg",ISe="/assets/magnifying-glass-solid-5311bf51.svg";const wSe=function({name:t,onClick:e}){const n=co(),o=t.split(" ").map(c=>{var l;return(l=c[0])==null?void 0:l.toUpperCase()}).join("").slice(0,2);return Pt("div",{className:"channel",onClick:()=>{e(),n(`/:${t}`)},children:[ge("p",{className:"logo",children:o}),ge("p",{className:"name",children:t})]})};const CSe=function({isNavOpen:t,channelInfo:e,setIsModalOpen:n,channelDispatch:o,setIsNavOpen:c}){const[l,f]=te.useState([]),[_,y]=te.useState(l),S=te.useRef(null),R=function(w){y(l.filter(b=>{if(Array.isArray(b.channelName)){const k=b.channelName.find(M=>M!==Je.currentUser.displayName&&M!==Je.currentUser.email.slice(0,Je.currentUser.email.indexOf("@")));b.channelName=k}return b.channelName.toLowerCase().includes(w.target.value.toLowerCase().trim())}))};return te.useEffect(()=>{(async()=>{try{eW(FG(ks,"channels"),w=>{let b=[];w.docs.forEach(k=>{b=[...b,k.data()]}),b=b.filter(k=>k.members.findIndex(M=>{var F;return M.id===((F=Je.currentUser)==null?void 0:F.uid)})+1),f(b),y(b.filter(k=>{var M;if(Array.isArray(k.channelName)){const F=k.channelName.find(Y=>Y!==Je.currentUser.displayName&&Y!==Je.currentUser.email.slice(0,Je.currentUser.email.indexOf("@")));k.channelName=F}return k.channelName.toLowerCase().includes(((M=S.current)==null?void 0:M.value.toLowerCase().trim())??"")})),n(!1)})}catch(w){console.log(w)}})()},[]),Pt("div",{className:`all-channels nav ${t?"active":""}`,children:[Pt("div",{className:"header",children:[ge("p",{children:"Channels"}),ge("div",{className:"img-container",onClick:()=>n(!0),children:ge("img",{src:RSe,alt:"add channel"})}),ge("div",{className:"close-btn",onClick:()=>c(!1),children:ge("img",{src:TH,alt:"close"})})]}),Pt("div",{className:"container",children:[Pt("label",{htmlFor:"search",children:[ge("img",{src:ISe,alt:"search"}),ge("input",{type:"text",id:"search",name:"search",ref:S,onInput:R,placeholder:"search",autoComplete:"off"})]}),ge("div",{className:"channels-container",children:_.map(w=>{const b=function(){o({type:"dispatchChannelInfo",payload:{channelName:w.channelName,channelDesc:w.channelDescription,channelMembers:w.members,channelMessages:w.messages,channelId:w.id,isPrivate:w.isPrivate}})};return ge(wSe,{name:w.channelName,onClick:b},_y())})})]}),ge(RH,{channelInfo:e,channelDispatch:o})]})};function ASe(){return Pt(yH,{button:"Start coding now",footer:Pt("div",{className:"footer",children:[ge("p",{children:"Already a member? "}),ge(Cj,{to:"/login",children:"Login"})]}),type:"EMAILANDPASSWORDSIGNUP",children:[ge("h1",{children:"Chat with thousands of people from around the world "}),ge("p",{children:"Sign up today to engage in stimulating conversations with anyone, anywhere."})]})}const bSe=function(){const t=mae(),e=co(),n=mh(),o=t.channelId.slice(1);return n(Pc.setInviteId({inviteId:o})),e("/channels"),ge("p",{children:"Loading..."})};var pA={},OSe={get exports(){return pA},set exports(t){pA=t}};(function(t,e){(function(n,o){t.exports=o()})(to,function(){function n(r,i){return i.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in r)){var u=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(r,a,u.get?u:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(r)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof to<"u"?to:typeof self<"u"?self:{},c=function(r){try{return!!r()}catch{return!0}},l=!c(function(){var r=function(){}.bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),f=l,_=Function.prototype,y=_.bind,S=_.call,R=f&&y.bind(S,S),w=f?function(r){return r&&R(r)}:function(r){return r&&function(){return S.apply(r,arguments)}},b=w({}.isPrototypeOf),k=function(r){return r&&r.Math==Math&&r},M=k(typeof globalThis=="object"&&globalThis)||k(typeof window=="object"&&window)||k(typeof self=="object"&&self)||k(typeof o=="object"&&o)||function(){return this}()||Function("return this")(),F=l,Y=Function.prototype,H=Y.apply,B=Y.call,K=typeof Reflect=="object"&&Reflect.apply||(F?B.bind(H):function(){return B.apply(H,arguments)}),z=function(r){return typeof r=="function"},oe={},de=!c(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ee=l,we=Function.prototype.call,Fe=Ee?we.bind(we):function(){return we.apply(we,arguments)},be={},dt={}.propertyIsEnumerable,kn=Object.getOwnPropertyDescriptor,Vi=kn&&!dt.call({1:2},1);be.f=Vi?function(r){var i=kn(this,r);return!!i&&i.enumerable}:dt;var jn,sn,Hn=function(r,i){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:i}},ur=w,Ue=ur({}.toString),rt=ur("".slice),st=function(r){return rt(Ue(r),8,-1)},bn=w,$n=c,al=st,Fs=M.Object,Ah=bn("".split),ms=$n(function(){return!Fs("z").propertyIsEnumerable(0)})?function(r){return al(r)=="String"?Ah(r,""):Fs(r)}:Fs,cl=M.TypeError,Om=function(r){if(r==null)throw cl("Can't call method on "+r);return r},BH=ms,GH=Om,ka=function(r){return BH(GH(r))},WH=z,Fi=function(r){return typeof r=="object"?r!==null:WH(r)},Go={},Iy=Go,wy=M,HH=z,h2=function(r){return HH(r)?r:void 0},js=function(r,i){return arguments.length<2?h2(Iy[r])||h2(wy[r]):Iy[r]&&Iy[r][i]||wy[r]&&wy[r][i]},Xc=js("navigator","userAgent")||"",p2=M,Cy=Xc,f2=p2.process,m2=p2.Deno,g2=f2&&f2.versions||m2&&m2.version,E2=g2&&g2.v8;E2&&(sn=(jn=E2.split("."))[0]>0&&jn[0]<4?1:+(jn[0]+jn[1])),!sn&&Cy&&(!(jn=Cy.match(/Edge\/(\d+)/))||jn[1]>=74)&&(jn=Cy.match(/Chrome\/(\d+)/))&&(sn=+jn[1]);var ul=sn,_2=ul,$H=c,Ay=!!Object.getOwnPropertySymbols&&!$H(function(){var r=Symbol();return!String(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&_2&&_2<41}),v2=Ay&&!Symbol.sham&&typeof Symbol.iterator=="symbol",KH=js,qH=z,zH=b,YH=v2,XH=M.Object,by=YH?function(r){return typeof r=="symbol"}:function(r){var i=KH("Symbol");return qH(i)&&zH(i.prototype,XH(r))},JH=M.String,Nm=function(r){try{return JH(r)}catch{return"Object"}},QH=z,ZH=Nm,e$=M.TypeError,Wo=function(r){if(QH(r))return r;throw e$(ZH(r)+" is not a function")},t$=Wo,Oy=function(r,i){var s=r[i];return s==null?void 0:t$(s)},Ny=Fe,Py=z,Dy=Fi,n$=M.TypeError,Pm={exports:{}},y2=M,r$=Object.defineProperty,i$=function(r,i){try{r$(y2,r,{value:i,configurable:!0,writable:!0})}catch{y2[r]=i}return i},S2="__core-js_shared__",ky=M[S2]||i$(S2,{}),T2=ky;(Pm.exports=function(r,i){return T2[r]||(T2[r]=i!==void 0?i:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var s$=Om,o$=M.Object,uo=function(r){return o$(s$(r))},a$=uo,c$=w({}.hasOwnProperty),Pr=Object.hasOwn||function(r,i){return c$(a$(r),i)},u$=w,l$=0,d$=Math.random(),h$=u$(1 .toString),Ly=function(r){return"Symbol("+(r===void 0?"":r)+")_"+h$(++l$+d$,36)},p$=M,f$=Pm.exports,R2=Pr,m$=Ly,I2=Ay,w2=v2,bh=f$("wks"),Jc=p$.Symbol,C2=Jc&&Jc.for,g$=w2?Jc:Jc&&Jc.withoutSetter||m$,Ln=function(r){if(!R2(bh,r)||!I2&&typeof bh[r]!="string"){var i="Symbol."+r;I2&&R2(Jc,r)?bh[r]=Jc[r]:bh[r]=w2&&C2?C2(i):g$(i)}return bh[r]},E$=Fe,A2=Fi,b2=by,_$=Oy,v$=function(r,i){var s,a;if(i==="string"&&Py(s=r.toString)&&!Dy(a=Ny(s,r))||Py(s=r.valueOf)&&!Dy(a=Ny(s,r))||i!=="string"&&Py(s=r.toString)&&!Dy(a=Ny(s,r)))return a;throw n$("Can't convert object to primitive value")},y$=Ln,S$=M.TypeError,T$=y$("toPrimitive"),R$=function(r,i){if(!A2(r)||b2(r))return r;var s,a=_$(r,T$);if(a){if(i===void 0&&(i="default"),s=E$(a,r,i),!A2(s)||b2(s))return s;throw S$("Can't convert object to primitive value")}return i===void 0&&(i="number"),v$(r,i)},I$=by,Dm=function(r){var i=R$(r,"string");return I$(i)?i:i+""},O2=Fi,My=M.document,w$=O2(My)&&O2(My.createElement),xy=function(r){return w$?My.createElement(r):{}},C$=xy,N2=!de&&!c(function(){return Object.defineProperty(C$("div"),"a",{get:function(){return 7}}).a!=7}),A$=de,b$=Fe,O$=be,N$=Hn,P$=ka,D$=Dm,k$=Pr,L$=N2,P2=Object.getOwnPropertyDescriptor;oe.f=A$?P2:function(r,i){if(r=P$(r),i=D$(i),L$)try{return P2(r,i)}catch{}if(k$(r,i))return N$(!b$(O$.f,r,i),r[i])};var M$=c,x$=z,U$=/#|\.prototype\./,Oh=function(r,i){var s=F$[V$(r)];return s==B$||s!=j$&&(x$(i)?M$(i):!!i)},V$=Oh.normalize=function(r){return String(r).replace(U$,".").toLowerCase()},F$=Oh.data={},j$=Oh.NATIVE="N",B$=Oh.POLYFILL="P",D2=Oh,G$=Wo,W$=l,H$=w(w.bind),La=function(r,i){return G$(r),i===void 0?r:W$?H$(r,i):function(){return r.apply(i,arguments)}},Bs={},k2=de&&c(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),L2=M,$$=Fi,K$=L2.String,q$=L2.TypeError,ji=function(r){if($$(r))return r;throw q$(K$(r)+" is not an object")},z$=de,Y$=N2,X$=k2,km=ji,M2=Dm,J$=M.TypeError,Uy=Object.defineProperty,Q$=Object.getOwnPropertyDescriptor,Z$="enumerable",eK="configurable",tK="writable";Bs.f=z$?X$?function(r,i,s){if(km(r),i=M2(i),km(s),typeof r=="function"&&i==="prototype"&&"value"in s&&tK in s&&!s.writable){var a=Q$(r,i);a&&a.writable&&(r[i]=s.value,s={configurable:eK in s?s.configurable:a.configurable,enumerable:Z$ in s?s.enumerable:a.enumerable,writable:!1})}return Uy(r,i,s)}:Uy:function(r,i,s){if(km(r),i=M2(i),km(s),Y$)try{return Uy(r,i,s)}catch{}if("get"in s||"set"in s)throw J$("Accessors not supported");return"value"in s&&(r[i]=s.value),r};var nK=Bs,rK=Hn,Qc=de?function(r,i,s){return nK.f(r,i,rK(1,s))}:function(r,i,s){return r[i]=s,r},Lm=M,iK=K,sK=w,oK=z,aK=oe.f,cK=D2,ll=Go,uK=La,dl=Qc,x2=Pr,lK=function(r){var i=function(s,a,u){if(this instanceof i){switch(arguments.length){case 0:return new r;case 1:return new r(s);case 2:return new r(s,a)}return new r(s,a,u)}return iK(r,this,arguments)};return i.prototype=r.prototype,i},lr=function(r,i){var s,a,u,d,h,m,g,p,E=r.target,v=r.global,T=r.stat,I=r.proto,O=v?Lm:T?Lm[E]:(Lm[E]||{}).prototype,N=v?ll:ll[E]||dl(ll,E,{})[E],P=N.prototype;for(u in i)s=!cK(v?u:E+(T?".":"#")+u,r.forced)&&O&&x2(O,u),h=N[u],s&&(m=r.noTargetGet?(p=aK(O,u))&&p.value:O[u]),d=s&&m?m:i[u],s&&typeof h==typeof d||(g=r.bind&&s?uK(d,Lm):r.wrap&&s?lK(d):I&&oK(d)?sK(d):d,(r.sham||d&&d.sham||h&&h.sham)&&dl(g,"sham",!0),dl(N,u,g),I&&(x2(ll,a=E+"Prototype")||dl(ll,a,{}),dl(ll[a],u,d),r.real&&P&&!P[u]&&dl(P,u,d)))},dK=Math.ceil,hK=Math.floor,Vy=function(r){var i=+r;return i!=i||i===0?0:(i>0?hK:dK)(i)},pK=Vy,fK=Math.min,mK=function(r){return r>0?fK(pK(r),9007199254740991):0},Ho=function(r){return mK(r.length)},gK=Wo,EK=uo,_K=ms,vK=Ho,yK=M.TypeError,U2=function(r){return function(i,s,a,u){gK(s);var d=EK(i),h=_K(d),m=vK(d),g=r?m-1:0,p=r?-1:1;if(a<2)for(;;){if(g in h){u=h[g],g+=p;break}if(g+=p,r?g<0:m<=g)throw yK("Reduce of empty array with no initial value")}for(;r?g>=0:m>g;g+=p)g in h&&(u=s(u,h[g],g,d));return u}},SK={left:U2(!1),right:U2(!0)},TK=c,Fy=function(r,i){var s=[][r];return!!s&&TK(function(){s.call(null,i||function(){throw 1},1)})},Mm=st(M.process)=="process",RK=SK.left,V2=ul,IK=Mm;lr({target:"Array",proto:!0,forced:!Fy("reduce")||!IK&&V2>79&&V2<83},{reduce:function(r){var i=arguments.length;return RK(this,r,i,i>1?arguments[1]:void 0)}});var wK=Go,Ma=function(r){return wK[r+"Prototype"]},CK=Ma("Array").reduce,AK=b,bK=CK,jy=Array.prototype,F2=function(r){var i=r.reduce;return r===jy||AK(jy,r)&&i===jy.reduce?bK:i},xa=F2;let j2=!0,B2=!0;function xm(r,i,s){const a=r.match(i);return a&&a.length>=s&&parseInt(a[s],10)}function Zc(r,i,s){if(!r.RTCPeerConnection)return;const a=r.RTCPeerConnection.prototype,u=a.addEventListener;a.addEventListener=function(h,m){if(h!==i)return u.apply(this,arguments);const g=p=>{const E=s(p);E&&(m.handleEvent?m.handleEvent(E):m(E))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(m,g),u.apply(this,[h,g])};const d=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==i||!this._eventMap||!this._eventMap[i])return d.apply(this,arguments);if(!this._eventMap[i].has(m))return d.apply(this,arguments);const g=this._eventMap[i].get(m);return this._eventMap[i].delete(m),this._eventMap[i].size===0&&delete this._eventMap[i],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,g])},Object.defineProperty(a,"on"+i,{get(){return this["_on"+i]},set(h){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),h&&this.addEventListener(i,this["_on"+i]=h)},enumerable:!0,configurable:!0})}function OK(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(j2=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function NK(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(B2=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function G2(){if(typeof window=="object"){if(j2)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function By(r,i){B2&&console.warn(r+" is deprecated, please use "+i+" instead.")}function PK(r){const i={browser:null,version:null};if(r===void 0||!r.navigator)return i.browser="Not a browser.",i;const{navigator:s}=r;if(s.mozGetUserMedia)i.browser="firefox",i.version=xm(s.userAgent,/Firefox\/(\d+)\./,1);else if(s.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)i.browser="chrome",i.version=xm(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!r.RTCPeerConnection||!s.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=xm(s.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype}return i}function W2(r){return Object.prototype.toString.call(r)==="[object Object]"}function H2(r){var i;return W2(r)?xa(i=Object.keys(r)).call(i,function(s,a){const u=W2(r[a]),d=u?H2(r[a]):r[a],h=u&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})},{}):r}function $2(r,i,s){const a=s?"outbound-rtp":"inbound-rtp",u=new Map;if(i===null)return u;const d=[];return r.forEach(h=>{h.type==="track"&&h.trackIdentifier===i.id&&d.push(h)}),d.forEach(h=>{r.forEach(m=>{m.type===a&&m.trackId===h.id&&function g(p,E,v){E&&!v.has(E.id)&&(v.set(E.id,E),Object.keys(E).forEach(T=>{T.endsWith("Id")?g(p,p.get(E[T]),v):T.endsWith("Ids")&&E[T].forEach(I=>{g(p,p.get(I),v)})}))}(r,m,u)})}),u}var DK=Pm.exports,kK=Ly,K2=DK("keys"),Um=function(r){return K2[r]||(K2[r]=kK(r))},LK=!c(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),MK=M,xK=Pr,UK=z,VK=uo,FK=LK,q2=Um("IE_PROTO"),Gy=MK.Object,jK=Gy.prototype,Wy=FK?Gy.getPrototypeOf:function(r){var i=VK(r);if(xK(i,q2))return i[q2];var s=i.constructor;return UK(s)&&i instanceof s?s.prototype:i instanceof Gy?jK:null},z2=M,BK=z,GK=z2.String,WK=z2.TypeError,HK=w,$K=ji,KK=function(r){if(typeof r=="object"||BK(r))return r;throw WK("Can't set "+GK(r)+" as a prototype")},qK=Object.setPrototypeOf||("__proto__"in{}?function(){var r,i=!1,s={};try{(r=HK(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(s,[]),i=s instanceof Array}catch{}return function(a,u){return $K(a),KK(u),i?r(a,u):a.__proto__=u,a}}():void 0),Vm={},zK=Vy,YK=Math.max,XK=Math.min,Hy=function(r,i){var s=zK(r);return s<0?YK(s+i,0):XK(s,i)},JK=ka,QK=Hy,ZK=Ho,Y2=function(r){return function(i,s,a){var u,d=JK(i),h=ZK(d),m=QK(a,h);if(r&&s!=s){for(;h>m;)if((u=d[m++])!=u)return!0}else for(;h>m;m++)if((r||m in d)&&d[m]===s)return r||m||0;return!r&&-1}},eq={includes:Y2(!0),indexOf:Y2(!1)},Fm={},$y=Pr,tq=ka,nq=eq.indexOf,rq=Fm,X2=w([].push),J2=function(r,i){var s,a=tq(r),u=0,d=[];for(s in a)!$y(rq,s)&&$y(a,s)&&X2(d,s);for(;i.length>u;)$y(a,s=i[u++])&&(~nq(d,s)||X2(d,s));return d},Ky=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],iq=J2,sq=Ky.concat("length","prototype");Vm.f=Object.getOwnPropertyNames||function(r){return iq(r,sq)};var jm={};jm.f=Object.getOwnPropertySymbols;var oq=js,aq=Vm,cq=jm,uq=ji,lq=w([].concat),dq=oq("Reflect","ownKeys")||function(r){var i=aq.f(uq(r)),s=cq.f;return s?lq(i,s(r)):i},Q2=Pr,hq=dq,pq=oe,fq=Bs,Bm={},mq=J2,gq=Ky,Gm=Object.keys||function(r){return mq(r,gq)},Eq=de,_q=k2,vq=Bs,yq=ji,Sq=ka,Tq=Gm;Bm.f=Eq&&!_q?Object.defineProperties:function(r,i){yq(r);for(var s,a=Sq(i),u=Tq(i),d=u.length,h=0;d>h;)vq.f(r,s=u[h++],a[s]);return r};var Wm,Z2=js("document","documentElement"),Rq=ji,Iq=Bm,eN=Ky,wq=Fm,Cq=Z2,Aq=xy,tN=Um("IE_PROTO"),qy=function(){},nN=function(r){return"<script>"+r+"<\/script>"},rN=function(r){r.write(nN("")),r.close();var i=r.parentWindow.Object;return r=null,i},Hm=function(){try{Wm=new ActiveXObject("htmlfile")}catch{}var r,i;Hm=typeof document<"u"?document.domain&&Wm?rN(Wm):((i=Aq("iframe")).style.display="none",Cq.appendChild(i),i.src=String("javascript:"),(r=i.contentWindow.document).open(),r.write(nN("document.F=Object")),r.close(),r.F):rN(Wm);for(var s=eN.length;s--;)delete Hm.prototype[eN[s]];return Hm()};wq[tN]=!0;var Nh=Object.create||function(r,i){var s;return r!==null?(qy.prototype=Rq(r),s=new qy,qy.prototype=null,s[tN]=r):s=Hm(),i===void 0?s:Iq.f(s,i)},bq=w("".replace),Oq=String(Error("zxcasd").stack),iN=/\n\s*at [^:]*:[^\n]*/,Nq=iN.test(Oq),Pq=Fi,Dq=Qc,hl={},kq=hl,Lq=Ln("iterator"),Mq=Array.prototype,sN=function(r){return r!==void 0&&(kq.Array===r||Mq[Lq]===r)},oN={};oN[Ln("toStringTag")]="z";var zy=String(oN)==="[object z]",xq=M,Uq=zy,Vq=z,$m=st,Fq=Ln("toStringTag"),jq=xq.Object,Bq=$m(function(){return arguments}())=="Arguments",$o=Uq?$m:function(r){var i,s,a;return r===void 0?"Undefined":r===null?"Null":typeof(s=function(u,d){try{return u[d]}catch{}}(i=jq(r),Fq))=="string"?s:Bq?$m(i):(a=$m(i))=="Object"&&Vq(i.callee)?"Arguments":a},Gq=$o,aN=Oy,Wq=hl,Hq=Ln("iterator"),Km=function(r){if(r!=null)return aN(r,Hq)||aN(r,"@@iterator")||Wq[Gq(r)]},$q=Fe,Kq=Wo,qq=ji,zq=Nm,Yq=Km,Xq=M.TypeError,Yy=function(r,i){var s=arguments.length<2?Yq(r):i;if(Kq(s))return qq($q(s,r));throw Xq(zq(r)+" is not iterable")},Jq=Fe,cN=ji,Qq=Oy,uN=function(r,i,s){var a,u;cN(r);try{if(!(a=Qq(r,"return"))){if(i==="throw")throw s;return s}a=Jq(a,r)}catch(d){u=!0,a=d}if(i==="throw")throw s;if(u)throw a;return cN(a),s},Zq=La,ez=Fe,tz=ji,nz=Nm,rz=sN,iz=Ho,lN=b,sz=Yy,oz=Km,dN=uN,az=M.TypeError,qm=function(r,i){this.stopped=r,this.result=i},hN=qm.prototype,zm=function(r,i,s){var a,u,d,h,m,g,p,E=s&&s.that,v=!(!s||!s.AS_ENTRIES),T=!(!s||!s.IS_ITERATOR),I=!(!s||!s.INTERRUPTED),O=Zq(i,E),N=function(L){return a&&dN(a,"normal",L),new qm(!0,L)},P=function(L){return v?(tz(L),I?O(L[0],L[1],N):O(L[0],L[1])):I?O(L,N):O(L)};if(T)a=r;else{if(!(u=oz(r)))throw az(nz(r)+" is not iterable");if(rz(u)){for(d=0,h=iz(r);h>d;d++)if((m=P(r[d]))&&lN(hN,m))return m;return new qm(!1)}a=sz(r,u)}for(g=a.next;!(p=ez(g,a)).done;){try{m=P(p.value)}catch(L){dN(a,"throw",L)}if(typeof m=="object"&&m&&lN(hN,m))return m}return new qm(!1)},cz=$o,uz=M.String,Ua=function(r){if(cz(r)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return uz(r)},lz=Ua,dz=Hn,hz=!c(function(){var r=Error("a");return!("stack"in r)||(Object.defineProperty(r,"stack",dz(1,7)),r.stack!==7)}),pz=lr,fz=M,mz=b,gz=Wy,Ym=qK,Ez=function(r,i,s){for(var a=hq(i),u=fq.f,d=pq.f,h=0;h<a.length;h++){var m=a[h];Q2(r,m)||s&&Q2(s,m)||u(r,m,d(i,m))}},pN=Nh,Xm=Qc,Xy=Hn,_z=function(r,i){if(Nq&&typeof r=="string")for(;i--;)r=bq(r,iN,"");return r},vz=function(r,i){Pq(i)&&"cause"in i&&Dq(r,"cause",i.cause)},yz=zm,Sz=function(r,i){return r===void 0?arguments.length<2?"":i:lz(r)},Tz=hz,Rz=Ln("toStringTag"),Jm=fz.Error,Iz=[].push,Ph=function(r,i){var s,a=arguments.length>2?arguments[2]:void 0,u=mz(Jy,this);Ym?s=Ym(new Jm,u?gz(this):Jy):(s=u?this:pN(Jy),Xm(s,Rz,"Error")),i!==void 0&&Xm(s,"message",Sz(i)),Tz&&Xm(s,"stack",_z(s.stack,1)),vz(s,a);var d=[];return yz(r,Iz,{that:d}),Xm(s,"errors",d),s};Ym?Ym(Ph,Jm):Ez(Ph,Jm,{name:!0});var Jy=Ph.prototype=pN(Jm.prototype,{constructor:Xy(1,Ph),message:Xy(1,""),name:Xy(1,"AggregateError")});pz({global:!0},{AggregateError:Ph});var wz=z,Qy=ky,Cz=w(Function.toString);wz(Qy.inspectSource)||(Qy.inspectSource=function(r){return Cz(r)});var Qm,Dh,Zm,Zy=Qy.inspectSource,Az=z,bz=Zy,fN=M.WeakMap,Oz=Az(fN)&&/native code/.test(bz(fN)),mN=M,e0=w,Nz=Fi,Pz=Qc,t0=Pr,n0=ky,Dz=Um,kz=Fm,gN="Object already initialized",r0=mN.TypeError,Lz=mN.WeakMap;if(Oz||n0.state){var eu=n0.state||(n0.state=new Lz),Mz=e0(eu.get),EN=e0(eu.has),xz=e0(eu.set);Qm=function(r,i){if(EN(eu,r))throw new r0(gN);return i.facade=r,xz(eu,r,i),i},Dh=function(r){return Mz(eu,r)||{}},Zm=function(r){return EN(eu,r)}}else{var pl=Dz("state");kz[pl]=!0,Qm=function(r,i){if(t0(r,pl))throw new r0(gN);return i.facade=r,Pz(r,pl,i),i},Dh=function(r){return t0(r,pl)?r[pl]:{}},Zm=function(r){return t0(r,pl)}}var tu,_N,vN,fl={set:Qm,get:Dh,has:Zm,enforce:function(r){return Zm(r)?Dh(r):Qm(r,{})},getterFor:function(r){return function(i){var s;if(!Nz(i)||(s=Dh(i)).type!==r)throw r0("Incompatible receiver, "+r+" required");return s}}},i0=de,Uz=Pr,yN=Function.prototype,Vz=i0&&Object.getOwnPropertyDescriptor,s0=Uz(yN,"name"),SN={EXISTS:s0,PROPER:s0&&function(){}.name==="something",CONFIGURABLE:s0&&(!i0||i0&&Vz(yN,"name").configurable)},Fz=Qc,ml=function(r,i,s,a){a&&a.enumerable?r[i]=s:Fz(r,i,s)},jz=c,Bz=z,Gz=Nh,TN=Wy,Wz=ml,o0=Ln("iterator"),RN=!1;[].keys&&("next"in(vN=[].keys())?(_N=TN(TN(vN)))!==Object.prototype&&(tu=_N):RN=!0);var Hz=tu==null||jz(function(){var r={};return tu[o0].call(r)!==r});Bz((tu=Hz?{}:Gz(tu))[o0])||Wz(tu,o0,function(){return this});var IN={IteratorPrototype:tu,BUGGY_SAFARI_ITERATORS:RN},$z=$o,Kz=zy?{}.toString:function(){return"[object "+$z(this)+"]"},qz=zy,zz=Bs.f,Yz=Qc,Xz=Pr,Jz=Kz,wN=Ln("toStringTag"),nu=function(r,i,s,a){if(r){var u=s?r:r.prototype;Xz(u,wN)||zz(u,wN,{configurable:!0,value:i}),a&&!qz&&Yz(u,"toString",Jz)}},Qz=IN.IteratorPrototype,Zz=Nh,eY=Hn,tY=nu,nY=hl,rY=function(){return this},CN=function(r,i,s,a){var u=i+" Iterator";return r.prototype=Zz(Qz,{next:eY(+!a,s)}),tY(r,u,!1,!0),nY[u]=rY,r},iY=lr,sY=Fe,oY=CN,aY=Wy,cY=nu,AN=ml,bN=hl,uY=SN.PROPER,eg=IN.BUGGY_SAFARI_ITERATORS,a0=Ln("iterator"),ON="keys",tg="values",NN="entries",lY=function(){return this},PN=function(r,i,s,a,u,d,h){oY(s,i,a);var m,g,p,E=function(L){if(L===u&&N)return N;if(!eg&&L in I)return I[L];switch(L){case ON:case tg:case NN:return function(){return new s(this,L)}}return function(){return new s(this)}},v=i+" Iterator",T=!1,I=r.prototype,O=I[a0]||I["@@iterator"]||u&&I[u],N=!eg&&O||E(u),P=i=="Array"&&I.entries||O;if(P&&(m=aY(P.call(new r)))!==Object.prototype&&m.next&&(cY(m,v,!0,!0),bN[v]=lY),uY&&u==tg&&O&&O.name!==tg&&(T=!0,N=function(){return sY(O,this)}),u)if(g={values:E(tg),keys:d?N:E(ON),entries:E(NN)},h)for(p in g)(eg||T||!(p in I))&&AN(I,p,g[p]);else iY({target:i,proto:!0,forced:eg||T},g);return h&&I[a0]!==N&&AN(I,a0,N,{name:u}),bN[i]=N,g},dY=ka,DN=hl,kN=fl;Bs.f;var hY=PN,LN="Array Iterator",pY=kN.set,fY=kN.getterFor(LN);hY(Array,"Array",function(r,i){pY(this,{type:LN,target:dY(r),index:0,kind:i})},function(){var r=fY(this),i=r.target,s=r.kind,a=r.index++;return!i||a>=i.length?(r.target=void 0,{value:void 0,done:!0}):s=="keys"?{value:a,done:!1}:s=="values"?{value:i[a],done:!1}:{value:[a,i[a]],done:!1}},"values"),DN.Arguments=DN.Array;var MN=M.Promise,mY=ml,xN=function(r,i,s){for(var a in i)s&&s.unsafe&&r[a]?r[a]=i[a]:mY(r,a,i[a],s);return r},gY=js,EY=Bs,_Y=de,UN=Ln("species"),vY=b,yY=M.TypeError,c0=function(r,i){if(vY(i,r))return r;throw yY("Incorrect invocation")},VN=Ln("iterator"),FN=!1;try{var SY=0,jN={next:function(){return{done:!!SY++}},return:function(){FN=!0}};jN[VN]=function(){return this},Array.from(jN,function(){throw 2})}catch{}var TY=w,RY=c,BN=z,IY=$o,wY=Zy,GN=function(){},CY=[],WN=js("Reflect","construct"),u0=/^\s*(?:class|function)\b/,AY=TY(u0.exec),bY=!u0.exec(GN),kh=function(r){if(!BN(r))return!1;try{return WN(GN,CY,r),!0}catch{return!1}},HN=function(r){if(!BN(r))return!1;switch(IY(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return bY||!!AY(u0,wY(r))}catch{return!0}};HN.sham=!0;var Lh,gl,$N,l0,ng=!WN||RY(function(){var r;return kh(kh.call)||!kh(Object)||!kh(function(){r=!0})||r})?HN:kh,OY=ng,NY=Nm,PY=M.TypeError,KN=ji,DY=function(r){if(OY(r))return r;throw PY(NY(r)+" is not a constructor")},kY=Ln("species"),qN=function(r,i){var s,a=KN(r).constructor;return a===void 0||(s=KN(a)[kY])==null?i:DY(s)},d0=w([].slice),zN=/(?:ipad|iphone|ipod).*applewebkit/i.test(Xc),Bi=M,LY=K,MY=La,YN=z,xY=Pr,UY=c,XN=Z2,VY=d0,JN=xy,FY=zN,jY=Mm,h0=Bi.setImmediate,p0=Bi.clearImmediate,BY=Bi.process,f0=Bi.Dispatch,GY=Bi.Function,QN=Bi.MessageChannel,WY=Bi.String,m0=0,Mh={},HY="onreadystatechange";try{Lh=Bi.location}catch{}var g0=function(r){if(xY(Mh,r)){var i=Mh[r];delete Mh[r],i()}},E0=function(r){return function(){g0(r)}},ZN=function(r){g0(r.data)},eP=function(r){Bi.postMessage(WY(r),Lh.protocol+"//"+Lh.host)};h0&&p0||(h0=function(r){var i=VY(arguments,1);return Mh[++m0]=function(){LY(YN(r)?r:GY(r),void 0,i)},gl(m0),m0},p0=function(r){delete Mh[r]},jY?gl=function(r){BY.nextTick(E0(r))}:f0&&f0.now?gl=function(r){f0.now(E0(r))}:QN&&!FY?(l0=($N=new QN).port2,$N.port1.onmessage=ZN,gl=MY(l0.postMessage,l0)):Bi.addEventListener&&YN(Bi.postMessage)&&!Bi.importScripts&&Lh&&Lh.protocol!=="file:"&&!UY(eP)?(gl=eP,Bi.addEventListener("message",ZN,!1)):gl=HY in JN("script")?function(r){XN.appendChild(JN("script")).onreadystatechange=function(){XN.removeChild(this),g0(r)}}:function(r){setTimeout(E0(r),0)});var xh,ru,Uh,El,_0,v0,y0,tP,nP={set:h0,clear:p0},$Y=M,KY=/ipad|iphone|ipod/i.test(Xc)&&$Y.Pebble!==void 0,qY=/web0s(?!.*chrome)/i.test(Xc),iu=M,rP=La,zY=oe.f,S0=nP.set,YY=zN,XY=KY,JY=qY,T0=Mm,iP=iu.MutationObserver||iu.WebKitMutationObserver,sP=iu.document,oP=iu.process,rg=iu.Promise,aP=zY(iu,"queueMicrotask"),cP=aP&&aP.value;cP||(xh=function(){var r,i;for(T0&&(r=oP.domain)&&r.exit();ru;){i=ru.fn,ru=ru.next;try{i()}catch(s){throw ru?El():Uh=void 0,s}}Uh=void 0,r&&r.enter()},YY||T0||JY||!iP||!sP?!XY&&rg&&rg.resolve?((y0=rg.resolve(void 0)).constructor=rg,tP=rP(y0.then,y0),El=function(){tP(xh)}):T0?El=function(){oP.nextTick(xh)}:(S0=rP(S0,iu),El=function(){S0(xh)}):(_0=!0,v0=sP.createTextNode(""),new iP(xh).observe(v0,{characterData:!0}),El=function(){v0.data=_0=!_0}));var QY=cP||function(r){var i={fn:r,next:void 0};Uh&&(Uh.next=i),ru||(ru=i,El()),Uh=i},_l={},uP=Wo,ZY=function(r){var i,s;this.promise=new r(function(a,u){if(i!==void 0||s!==void 0)throw TypeError("Bad Promise constructor");i=a,s=u}),this.resolve=uP(i),this.reject=uP(s)};_l.f=function(r){return new ZY(r)};var eX=ji,tX=Fi,nX=_l,lP=function(r,i){if(eX(r),tX(i)&&i.constructor===r)return i;var s=nX.f(r);return(0,s.resolve)(i),s.promise},rX=M,ig=function(r){try{return{error:!1,value:r()}}catch(i){return{error:!0,value:i}}},dP=function(){this.head=null,this.tail=null};dP.prototype={add:function(r){var i={item:r,next:null};this.head?this.tail.next=i:this.head=i,this.tail=i},get:function(){var r=this.head;if(r)return this.head=r.next,this.tail===r&&(this.tail=null),r.item}};var R0,hP,I0,iX=typeof window=="object",sg=lr,Ko=M,sX=js,Va=Fe,w0=MN,oX=xN,aX=nu,cX=function(r){var i=gY(r),s=EY.f;_Y&&i&&!i[UN]&&s(i,UN,{configurable:!0,get:function(){return this}})},C0=Wo,og=z,uX=Fi,lX=c0,dX=Zy,pP=zm,hX=function(r,i){if(!i&&!FN)return!1;var s=!1;try{var a={};a[VN]=function(){return{next:function(){return{done:s=!0}}}},r(a)}catch{}return s},pX=qN,fP=nP.set,A0=QY,fX=lP,mX=function(r,i){var s=rX.console;s&&s.error&&(arguments.length==1?s.error(r):s.error(r,i))},mP=_l,b0=ig,gX=dP,O0=fl,EX=D2,_X=iX,ag=Mm,gP=ul,vX=Ln("species"),lo="Promise",EP=O0.getterFor(lo),yX=O0.set,SX=O0.getterFor(lo),TX=w0&&w0.prototype,ho=w0,cg=TX,_P=Ko.TypeError,N0=Ko.document,P0=Ko.process,vl=mP.f,RX=vl,IX=!!(N0&&N0.createEvent&&Ko.dispatchEvent),vP=og(Ko.PromiseRejectionEvent),yP="unhandledrejection",ug=EX(lo,function(){var r=dX(ho),i=r!==String(ho);if(!i&&gP===66||!cg.finally)return!0;if(gP>=51&&/native code/.test(r))return!1;var s=new ho(function(u){u(1)}),a=function(u){u(function(){},function(){})};return(s.constructor={})[vX]=a,!(s.then(function(){})instanceof a)||!i&&_X&&!vP}),wX=ug||!hX(function(r){ho.all(r).catch(function(){})}),SP=function(r){var i;return!(!uX(r)||!og(i=r.then))&&i},TP=function(r,i){var s,a,u,d=i.value,h=i.state==1,m=h?r.ok:r.fail,g=r.resolve,p=r.reject,E=r.domain;try{m?(h||(i.rejection===2&&AX(i),i.rejection=1),m===!0?s=d:(E&&E.enter(),s=m(d),E&&(E.exit(),u=!0)),s===r.promise?p(_P("Promise-chain cycle")):(a=SP(s))?Va(a,s,g,p):g(s)):p(d)}catch(v){E&&!u&&E.exit(),p(v)}},RP=function(r,i){r.notified||(r.notified=!0,A0(function(){for(var s,a=r.reactions;s=a.get();)TP(s,r);r.notified=!1,i&&!r.rejection&&CX(r)}))},IP=function(r,i,s){var a,u;IX?((a=N0.createEvent("Event")).promise=i,a.reason=s,a.initEvent(r,!1,!0),Ko.dispatchEvent(a)):a={promise:i,reason:s},!vP&&(u=Ko["on"+r])?u(a):r===yP&&mX("Unhandled promise rejection",s)},CX=function(r){Va(fP,Ko,function(){var i,s=r.facade,a=r.value;if(wP(r)&&(i=b0(function(){ag?P0.emit("unhandledRejection",a,s):IP(yP,s,a)}),r.rejection=ag||wP(r)?2:1,i.error))throw i.value})},wP=function(r){return r.rejection!==1&&!r.parent},AX=function(r){Va(fP,Ko,function(){var i=r.facade;ag?P0.emit("rejectionHandled",i):IP("rejectionhandled",i,r.value)})},yl=function(r,i,s){return function(a){r(i,a,s)}},Sl=function(r,i,s){r.done||(r.done=!0,s&&(r=s),r.value=i,r.state=2,RP(r,!0))},D0=function(r,i,s){if(!r.done){r.done=!0,s&&(r=s);try{if(r.facade===i)throw _P("Promise can't be resolved itself");var a=SP(i);a?A0(function(){var u={done:!1};try{Va(a,i,yl(D0,u,r),yl(Sl,u,r))}catch(d){Sl(u,d,r)}}):(r.value=i,r.state=1,RP(r,!1))}catch(u){Sl({done:!1},u,r)}}};ug&&(cg=(ho=function(r){lX(this,cg),C0(r),Va(R0,this);var i=EP(this);try{r(yl(D0,i),yl(Sl,i))}catch(s){Sl(i,s)}}).prototype,(R0=function(r){yX(this,{type:lo,done:!1,notified:!1,parent:!1,reactions:new gX,rejection:!1,state:0,value:void 0})}).prototype=oX(cg,{then:function(r,i){var s=SX(this),a=vl(pX(this,ho));return s.parent=!0,a.ok=!og(r)||r,a.fail=og(i)&&i,a.domain=ag?P0.domain:void 0,s.state==0?s.reactions.add(a):A0(function(){TP(a,s)}),a.promise},catch:function(r){return this.then(void 0,r)}}),hP=function(){var r=new R0,i=EP(r);this.promise=r,this.resolve=yl(D0,i),this.reject=yl(Sl,i)},mP.f=vl=function(r){return r===ho||r===I0?new hP(r):RX(r)}),sg({global:!0,wrap:!0,forced:ug},{Promise:ho}),aX(ho,lo,!1,!0),cX(lo),I0=sX(lo),sg({target:lo,stat:!0,forced:ug},{reject:function(r){var i=vl(this);return Va(i.reject,void 0,r),i.promise}}),sg({target:lo,stat:!0,forced:!0},{resolve:function(r){return fX(this===I0?ho:this,r)}}),sg({target:lo,stat:!0,forced:wX},{all:function(r){var i=this,s=vl(i),a=s.resolve,u=s.reject,d=b0(function(){var h=C0(i.resolve),m=[],g=0,p=1;pP(r,function(E){var v=g++,T=!1;p++,Va(h,i,E).then(function(I){T||(T=!0,m[v]=I,--p||a(m))},u)}),--p||a(m)});return d.error&&u(d.value),s.promise},race:function(r){var i=this,s=vl(i),a=s.reject,u=b0(function(){var d=C0(i.resolve);pP(r,function(h){Va(d,i,h).then(s.resolve,a)})});return u.error&&a(u.value),s.promise}});var bX=Fe,OX=Wo,NX=_l,PX=ig,DX=zm;lr({target:"Promise",stat:!0},{allSettled:function(r){var i=this,s=NX.f(i),a=s.resolve,u=s.reject,d=PX(function(){var h=OX(i.resolve),m=[],g=0,p=1;DX(r,function(E){var v=g++,T=!1;p++,bX(h,i,E).then(function(I){T||(T=!0,m[v]={status:"fulfilled",value:I},--p||a(m))},function(I){T||(T=!0,m[v]={status:"rejected",reason:I},--p||a(m))})}),--p||a(m)});return d.error&&u(d.value),s.promise}});var kX=Wo,LX=js,MX=Fe,xX=_l,UX=ig,VX=zm,CP="No one promise resolved";lr({target:"Promise",stat:!0},{any:function(r){var i=this,s=LX("AggregateError"),a=xX.f(i),u=a.resolve,d=a.reject,h=UX(function(){var m=kX(i.resolve),g=[],p=0,E=1,v=!1;VX(r,function(T){var I=p++,O=!1;E++,MX(m,i,T).then(function(N){O||v||(v=!0,u(N))},function(N){O||v||(O=!0,g[I]=N,--E||d(new s(g,CP)))})}),--E||d(new s(g,CP))});return h.error&&d(h.value),a.promise}});var AP=MN,FX=js,jX=z,BX=qN,bP=lP;lr({target:"Promise",proto:!0,real:!0,forced:!!AP&&c(function(){AP.prototype.finally.call({then:function(){}},function(){})})},{finally:function(r){var i=BX(this,FX("Promise")),s=jX(r);return this.then(s?function(a){return bP(i,r()).then(function(){return a})}:r,s?function(a){return bP(i,r()).then(function(){throw a})}:r)}});var k0=w,GX=Vy,WX=Ua,HX=Om,$X=k0("".charAt),OP=k0("".charCodeAt),KX=k0("".slice),NP=function(r){return function(i,s){var a,u,d=WX(HX(i)),h=GX(s),m=d.length;return h<0||h>=m?r?"":void 0:(a=OP(d,h))<55296||a>56319||h+1===m||(u=OP(d,h+1))<56320||u>57343?r?$X(d,h):a:r?KX(d,h,h+2):u-56320+(a-55296<<10)+65536}},PP={codeAt:NP(!1),charAt:NP(!0)},qX=PP.charAt,zX=Ua,DP=fl,YX=PN,kP="String Iterator",XX=DP.set,JX=DP.getterFor(kP);YX(String,"String",function(r){XX(this,{type:kP,string:zX(r),index:0})},function(){var r,i=JX(this),s=i.string,a=i.index;return a>=s.length?{value:void 0,done:!0}:(r=qX(s,a),i.index+=r.length,{value:r,done:!1})});var QX=Go.Promise,ZX={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},eJ=M,tJ=$o,nJ=Qc,LP=hl,MP=Ln("toStringTag");for(var L0 in ZX){var xP=eJ[L0],M0=xP&&xP.prototype;M0&&tJ(M0)!==MP&&nJ(M0,MP,L0),LP[L0]=LP.Array}var UP=QX,_e=UP;const VP=G2;function FP(r,i){const s=r&&r.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const p=typeof h[g]=="object"?h[g]:{ideal:h[g]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const E=function(v,T){return v?v+T.charAt(0).toUpperCase()+T.slice(1):T==="deviceId"?"sourceId":T};if(p.ideal!==void 0){m.optional=m.optional||[];let v={};typeof p.ideal=="number"?(v[E("min",g)]=p.ideal,m.optional.push(v),v={},v[E("max",g)]=p.ideal,m.optional.push(v)):(v[E("",g)]=p.ideal,m.optional.push(v))}p.exact!==void 0&&typeof p.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[E("",g)]=p.exact):["min","max"].forEach(v=>{p[v]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[E(v,g)]=p[v])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},u=function(h,m){if(i.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(p,E,v){E in p&&!(v in p)&&(p[v]=p[E],delete p[E])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const p=i.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||p)){let E;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?E=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(E=["front"]),E)return s.mediaDevices.enumerateDevices().then(v=>{let T=(v=v.filter(I=>I.kind==="videoinput")).find(I=>E.some(O=>I.label.toLowerCase().includes(O)));return!T&&v.length&&E.includes("back")&&(T=v[v.length-1]),T&&(h.video.deviceId=g.exact?{exact:T.deviceId}:{ideal:T.deviceId}),h.video=a(h.video),VP("chrome: "+JSON.stringify(h)),m(h)})}h.video=a(h.video)}return VP("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return i.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=function(h,m,g){u(h,p=>{s.webkitGetUserMedia(p,m,E=>{g&&g(d(E))})})}.bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return u(m,g=>h(g).then(p=>{if(g.audio&&!p.getAudioTracks().length||g.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return p},p=>_e.reject(d(p))))}}}function jP(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function BP(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let u;u=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=u,d.transceiver={receiver:u},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(a=>{let u;u=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=u,d.transceiver={receiver:u},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Zc(r,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function GP(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const i=function(u,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=u.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:u}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const u=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(h,m){let g=u.apply(this,arguments);return g||(g=i(this,h),this._senders.push(g)),g};const d=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(u){this._senders=this._senders||[],s.apply(this,[u]),u.getTracks().forEach(d=>{this._senders.push(i(this,d))})};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(u){this._senders=this._senders||[],a.apply(this,[u]),u.getTracks().forEach(d=>{const h=this._senders.find(m=>m.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const i=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function WP(r){if(!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[s,a,u]=arguments;if(arguments.length>0&&typeof s=="function")return i.apply(this,arguments);if(i.length===0&&(arguments.length===0||typeof s!="function"))return i.apply(this,[]);const d=function(m){const g={};return m.result().forEach(p=>{const E={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(v=>{E[v]=p.stat(v)}),g[E.id]=E}),g},h=function(m){return new Map(Object.keys(m).map(g=>[g,m[g]]))};if(arguments.length>=2){const m=function(g){a(h(d(g)))};return i.apply(this,[m,s])}return new _e((m,g)=>{i.apply(this,[function(p){m(h(d(p)))},g])}).then(a,u)}}function HP(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const s=r.RTCPeerConnection.prototype.getSenders;s&&(r.RTCPeerConnection.prototype.getSenders=function(){const u=s.apply(this,[]);return u.forEach(d=>d._pc=this),u});const a=r.RTCPeerConnection.prototype.addTrack;a&&(r.RTCPeerConnection.prototype.addTrack=function(){const u=a.apply(this,arguments);return u._pc=this,u}),r.RTCRtpSender.prototype.getStats=function(){const u=this;return this._pc.getStats().then(d=>$2(d,u.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const s=r.RTCPeerConnection.prototype.getReceivers;s&&(r.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach(u=>u._pc=this),a}),Zc(r,"track",a=>(a.receiver._pc=a.srcElement,a)),r.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(u=>$2(u,a.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype)||!("getStats"in r.RTCRtpReceiver.prototype))return;const i=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const s=arguments[0];let a,u,d;return this.getSenders().forEach(h=>{h.track===s&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(u?d=!0:u=h),h.track===s)),d||a&&u?_e.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():u?u.getStats():_e.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function $P(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=i.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(g=>{if(this.getSenders().find(p=>p.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(g=>h.indexOf(g)===-1);this._shimmedLocalStreams[d.id]=[d].concat(m)};const a=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const u=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),u.apply(this,arguments)}}function KP(r,i){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&i.version>=65)return $P(r);const s=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const p=s.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(E=>this._reverseStreams[E.id])};const a=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(E=>{if(this.getSenders().find(v=>v.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const E=new r.MediaStream(p.getTracks());this._streams[p.id]=E,this._reverseStreams[E.id]=p,p=E}a.apply(this,[p])};const u=r.RTCPeerConnection.prototype.removeStream;function d(p,E){let v=E.sdp;return Object.keys(p._reverseStreams||[]).forEach(T=>{const I=p._reverseStreams[T],O=p._streams[I.id];v=v.replace(new RegExp(O.id,"g"),I.id)}),new RTCSessionDescription({type:E.type,sdp:v})}function h(p,E){let v=E.sdp;return Object.keys(p._reverseStreams||[]).forEach(T=>{const I=p._reverseStreams[T],O=p._streams[I.id];v=v.replace(new RegExp(I.id,"g"),O.id)}),new RTCSessionDescription({type:E.type,sdp:v})}r.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},r.RTCPeerConnection.prototype.addTrack=function(p,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(O=>O===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(O=>O.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[E.id];if(I)I.addTrack(p),_e.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const O=new r.MediaStream([p]);this._streams[E.id]=O,this._reverseStreams[O.id]=E,this.addStream(O)}return this.getSenders().find(O=>O.track===p)},["createOffer","createAnswer"].forEach(function(p){const E=r.RTCPeerConnection.prototype[p],v={[p](){const T=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[I=>{const O=d(this,I);T[0].apply(null,[O])},I=>{T[1]&&T[1].apply(null,I)},arguments[2]]):E.apply(this,arguments).then(I=>d(this,I))}};r.RTCPeerConnection.prototype[p]=v[p]});const m=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=h(this,arguments[0]),m.apply(this,arguments)):m.apply(this,arguments)};const g=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const p=g.get.apply(this);return p.type===""?p:d(this,p)}}),r.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(T=>p.track===T)&&(E=this._streams[v])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function x0(r,i){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=r.RTCPeerConnection.prototype[s],u={[s](){return arguments[0]=new(s==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};r.RTCPeerConnection.prototype[s]=u[s]})}function qP(r,i){Zc(r,"negotiationneeded",s=>{const a=s.target;if(!(i.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var zP=Object.freeze({__proto__:null,shimMediaStream:jP,shimOnTrack:BP,shimGetSendersWithDtmf:GP,shimGetStats:WP,shimSenderReceiverGetStats:HP,shimAddTrackRemoveTrackWithNative:$P,shimAddTrackRemoveTrack:KP,shimPeerConnection:x0,fixNegotiationNeeded:qP,shimGetUserMedia:FP,shimGetDisplayMedia:function(r,i){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(typeof i=="function"?r.navigator.mediaDevices.getDisplayMedia=function(s){return i(s).then(a=>{const u=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},u&&(s.video.mandatory.maxWidth=u),d&&(s.video.mandatory.maxHeight=d),r.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function YP(r,i){const s=r&&r.navigator,a=r&&r.MediaStreamTrack;if(s.getUserMedia=function(u,d,h){By("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(u).then(d,h)},!(i.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const u=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),u(h.audio,"autoGainControl","mozAutoGainControl"),u(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return u(m,"mozAutoGainControl","autoGainControl"),u(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),u(m,"autoGainControl","mozAutoGainControl"),u(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function XP(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function U0(r,i){if(typeof r!="object"||!r.RTCPeerConnection&&!r.mozRTCPeerConnection)return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(u){const d=r.RTCPeerConnection.prototype[u],h={[u](){return arguments[0]=new(u==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};r.RTCPeerConnection.prototype[u]=h[u]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[u,d,h]=arguments;return a.apply(this,[u||null]).then(m=>{if(i.version<53&&!d)try{m.forEach(g=>{g.type=s[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;m.forEach((p,E)=>{m.set(E,Object.assign({},p,{type:s[p.type]||p.type}))})}return m}).then(d,h)}}function JP(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const i=r.RTCPeerConnection.prototype.getSenders;i&&(r.RTCPeerConnection.prototype.getSenders=function(){const a=i.apply(this,[]);return a.forEach(u=>u._pc=this),a});const s=r.RTCPeerConnection.prototype.addTrack;s&&(r.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):_e.resolve(new Map)}}function QP(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const i=r.RTCPeerConnection.prototype.getReceivers;i&&(r.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(a=>a._pc=this),s}),Zc(r,"track",s=>(s.receiver._pc=s.srcElement,s)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ZP(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(i){By("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&i.getTracks().includes(s.track)&&this.removeTrack(s)})})}function eD(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function tD(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.addTransceiver;i&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const u=i.apply(this,arguments);if(a){const{sender:d}=u,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return u})}function nD(r){if(typeof r!="object"||!r.RTCRtpSender)return;const i=r.RTCRtpSender.prototype.getParameters;i&&(r.RTCRtpSender.prototype.getParameters=function(){const s=i.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function rD(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?_e.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function iD(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?_e.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var sD=Object.freeze({__proto__:null,shimOnTrack:XP,shimPeerConnection:U0,shimSenderGetStats:JP,shimReceiverGetStats:QP,shimRemoveStream:ZP,shimRTCDataChannel:eD,shimAddTransceiver:tD,shimGetParameters:nD,shimCreateOffer:rD,shimCreateAnswer:iD,shimGetUserMedia:YP,shimGetDisplayMedia:function(r,i){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,_e.reject(a)}return s.video===!0?s.video={mediaSource:i}:s.video.mediaSource=i,r.navigator.mediaDevices.getUserMedia(s)})}});function oD(r){if(typeof r=="object"&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(a=>i.call(this,a,s)),s.getVideoTracks().forEach(a=>i.call(this,a,s))},r.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,u=new Array(a>1?a-1:0),d=1;d<a;d++)u[d-1]=arguments[d];return u&&u.forEach(h=>{this._localStreams?this._localStreams.includes(h)||this._localStreams.push(h):this._localStreams=[h]}),i.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(i);if(s===-1)return;this._localStreams.splice(s,1);const a=i.getTracks();this.getSenders().forEach(u=>{a.includes(u.track)&&this.removeTrack(u)})})}}function aD(r){if(typeof r=="object"&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(u=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(u))return;this._remoteStreams.push(u);const d=new Event("addstream");d.stream=u,this.dispatchEvent(d)})})}});const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(u=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(u)>=0)return;s._remoteStreams.push(u);const d=new Event("addstream");d.stream=u,s.dispatchEvent(d)})}),i.apply(s,arguments)}}}function cD(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype,s=i.createOffer,a=i.createAnswer,u=i.setLocalDescription,d=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(g,p){const E=arguments.length>=2?arguments[2]:arguments[0],v=s.apply(this,[E]);return p?(v.then(g,p),_e.resolve()):v},i.createAnswer=function(g,p){const E=arguments.length>=2?arguments[2]:arguments[0],v=a.apply(this,[E]);return p?(v.then(g,p),_e.resolve()):v};let m=function(g,p,E){const v=u.apply(this,[g]);return E?(v.then(p,E),_e.resolve()):v};i.setLocalDescription=m,m=function(g,p,E){const v=d.apply(this,[g]);return E?(v.then(p,E),_e.resolve()):v},i.setRemoteDescription=m,m=function(g,p,E){const v=h.apply(this,[g]);return E?(v.then(p,E),_e.resolve()):v},i.addIceCandidate=m}function uD(r){const i=r&&r.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const s=i.mediaDevices,a=s.getUserMedia.bind(s);i.mediaDevices.getUserMedia=u=>a(lD(u))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(s,a,u){i.mediaDevices.getUserMedia(s).then(a,u)}.bind(i))}function lD(r){return r&&r.video!==void 0?Object.assign({},r,{video:H2(r.video)}):r}function dD(r){if(!r.RTCPeerConnection)return;const i=r.RTCPeerConnection;r.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const u=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(By("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,u.push(h)):u.push(s.iceServers[d])}s.iceServers=u}return new i(s,a)},r.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function hD(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function pD(r){const i=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const u=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&u?u.direction==="sendrecv"?u.setDirection?u.setDirection("sendonly"):u.direction="sendonly":u.direction==="recvonly"&&(u.setDirection?u.setDirection("inactive"):u.direction="inactive"):s.offerToReceiveVideo!==!0||u||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function fD(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var mD=Object.freeze({__proto__:null,shimLocalStreamsAPI:oD,shimRemoteStreamsAPI:aD,shimCallbacksAPI:cD,shimGetUserMedia:uD,shimConstraints:lD,shimRTCIceServerUrls:dD,shimTrackEventTransceiver:hD,shimCreateOfferLegacy:pD,shimAudioContext:fD}),rJ=`	
\v\f\r                　\u2028\u2029\uFEFF`,iJ=Om,sJ=Ua,gD=w("".replace),lg=`[	
\v\f\r                　\u2028\u2029\uFEFF]`,oJ=RegExp("^"+lg+lg+"*"),aJ=RegExp(lg+lg+"*$"),V0=function(r){return function(i){var s=sJ(iJ(i));return 1&r&&(s=gD(s,oJ,"")),2&r&&(s=gD(s,aJ,"")),s}},cJ={start:V0(1),end:V0(2),trim:V0(3)},uJ=SN.PROPER,lJ=c,ED=rJ,dJ=cJ.trim;lr({target:"String",proto:!0,forced:function(r){return lJ(function(){return!!ED[r]()||"​᠎"[r]()!=="​᠎"||uJ&&ED[r].name!==r})}("trim")},{trim:function(){return dJ(this)}});var hJ=Ma("String").trim,pJ=b,fJ=hJ,F0=String.prototype,qo=function(r){var i=r.trim;return typeof r=="string"||r===F0||pJ(F0,r)&&i===F0.trim?fJ:i},j0={exports:{}};(function(r){const i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(s){return qo(s).call(s).split(`
`).map(a=>qo(a).call(a))},i.splitSections=function(s){return s.split(`
m=`).map((a,u)=>{var d;return qo(d=u>0?"m="+a:a).call(d)+`\r
`})},i.getDescription=function(s){const a=i.splitSections(s);return a&&a[0]},i.getMediaSections=function(s){const a=i.splitSections(s);return a.shift(),a},i.matchPrefix=function(s,a){return i.splitLines(s).filter(u=>u.indexOf(a)===0)},i.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const u={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":u.relatedAddress=a[d+1];break;case"rport":u.relatedPort=parseInt(a[d+1],10);break;case"tcptype":u.tcpType=a[d+1];break;case"ufrag":u.ufrag=a[d+1],u.usernameFragment=a[d+1];break;default:u[a[d]]===void 0&&(u[a[d]]=a[d+1])}return u},i.writeCandidate=function(s){const a=[];a.push(s.foundation);const u=s.component;u==="rtp"?a.push(1):u==="rtcp"?a.push(2):a.push(u),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},i.parseIceOptions=function(s){return s.substr(14).split(" ")},i.parseRtpMap=function(s){let a=s.substr(9).split(" ");const u={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),u.name=a[0],u.clockRate=parseInt(a[1],10),u.channels=a.length===3?parseInt(a[2],10):1,u.numChannels=u.channels,u},i.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const u=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(u!==1?"/"+u:"")+`\r
`},i.parseExtmap=function(s){const a=s.substr(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1]}},i.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+`\r
`},i.parseFmtp=function(s){const a={};let u;const d=s.substr(s.indexOf(" ")+1).split(";");for(let g=0;g<d.length;g++){var h,m;u=qo(h=d[g]).call(h).split("="),a[qo(m=u[0]).call(m)]=u[1]}return a},i.writeFmtp=function(s){let a="",u=s.payloadType;if(s.preferredPayloadType!==void 0&&(u=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),a+="a=fmtp:"+u+" "+d.join(";")+`\r
`}return a},i.parseRtcpFb=function(s){const a=s.substr(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},i.writeRtcpFb=function(s){let a="",u=s.payloadType;return s.preferredPayloadType!==void 0&&(u=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+u+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},i.parseSsrcMedia=function(s){const a=s.indexOf(" "),u={ssrc:parseInt(s.substr(7,a-7),10)},d=s.indexOf(":",a);return d>-1?(u.attribute=s.substr(a+1,d-a-1),u.value=s.substr(d+1)):u.attribute=s.substr(a+1),u},i.parseSsrcGroup=function(s){const a=s.substr(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(u=>parseInt(u,10))}},i.getMid=function(s){const a=i.matchPrefix(s,"a=mid:")[0];if(a)return a.substr(6)},i.parseFingerprint=function(s){const a=s.substr(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},i.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:i.matchPrefix(s+a,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(s,a){let u="a=setup:"+a+`\r
`;return s.fingerprints.forEach(d=>{u+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),u},i.parseCryptoLine=function(s){const a=s.substr(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},i.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?i.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},i.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substr(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},i.getCryptoParameters=function(s,a){return i.matchPrefix(s+a,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(s,a){const u=i.matchPrefix(s+a,"a=ice-ufrag:")[0],d=i.matchPrefix(s+a,"a=ice-pwd:")[0];return u&&d?{usernameFragment:u.substr(12),password:d.substr(10)}:null},i.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},i.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=i.splitLines(s)[0].split(" ");for(let d=3;d<u.length;d++){const h=u[d],m=i.matchPrefix(s,"a=rtpmap:"+h+" ")[0];if(m){const g=i.parseRtpMap(m),p=i.matchPrefix(s,"a=fmtp:"+h+" ");switch(g.parameters=p.length?i.parseFmtp(p[0]):{},g.rtcpFeedback=i.matchPrefix(s,"a=rtcp-fb:"+h+" ").map(i.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase())}}}return i.matchPrefix(s,"a=extmap:").forEach(d=>{a.headerExtensions.push(i.parseExtmap(d))}),a},i.writeRtpDescription=function(s,a){let u="";u+="m="+s+" ",u+=a.codecs.length>0?"9":"0",u+=" UDP/TLS/RTP/SAVPF ",u+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{u+=i.writeRtpMap(h),u+=i.writeFmtp(h),u+=i.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(u+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{u+=i.writeExtmap(h)}),u},i.parseRtpEncodingParameters=function(s){const a=[],u=i.parseRtpParameters(s),d=u.fecMechanisms.indexOf("RED")!==-1,h=u.fecMechanisms.indexOf("ULPFEC")!==-1,m=i.matchPrefix(s,"a=ssrc:").map(T=>i.parseSsrcMedia(T)).filter(T=>T.attribute==="cname"),g=m.length>0&&m[0].ssrc;let p;const E=i.matchPrefix(s,"a=ssrc-group:FID").map(T=>T.substr(17).split(" ").map(I=>parseInt(I,10)));E.length>0&&E[0].length>1&&E[0][0]===g&&(p=E[0][1]),u.codecs.forEach(T=>{if(T.name.toUpperCase()==="RTX"&&T.parameters.apt){let I={ssrc:g,codecPayloadType:parseInt(T.parameters.apt,10)};g&&p&&(I.rtx={ssrc:p}),a.push(I),d&&(I=JSON.parse(JSON.stringify(I)),I.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},a.push(I))}}),a.length===0&&g&&a.push({ssrc:g});let v=i.matchPrefix(s,"b=");return v.length&&(v=v[0].indexOf("b=TIAS:")===0?parseInt(v[0].substr(7),10):v[0].indexOf("b=AS:")===0?1e3*parseInt(v[0].substr(5),10)*.95-16e3:void 0,a.forEach(T=>{T.maxBitrate=v})),a},i.parseRtcpParameters=function(s){const a={},u=i.matchPrefix(s,"a=ssrc:").map(m=>i.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];u&&(a.cname=u.value,a.ssrc=u.ssrc);const d=i.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const h=i.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},i.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},i.parseMsid=function(s){let a;const u=i.matchPrefix(s,"a=msid:");if(u.length===1)return a=u[0].substr(7).split(" "),{stream:a[0],track:a[1]};const d=i.matchPrefix(s,"a=ssrc:").map(h=>i.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},i.parseSctpDescription=function(s){const a=i.parseMLine(s),u=i.matchPrefix(s,"a=max-message-size:");let d;u.length>0&&(d=parseInt(u[0].substr(19),10)),isNaN(d)&&(d=65536);const h=i.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substr(12),10),protocol:a.fmt,maxMessageSize:d};const m=i.matchPrefix(s,"a=sctpmap:");if(m.length>0){const g=m[0].substr(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:d}}},i.writeSctpDescription=function(s,a){let u=[];return u=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&u.push("a=max-message-size:"+a.maxMessageSize+`\r
`),u.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(s,a,u){let d;const h=a!==void 0?a:2;return d=s||i.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},i.getDirection=function(s,a){const u=i.splitLines(s);for(let d=0;d<u.length;d++)switch(u[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[d].substr(2)}return a?i.getDirection(a):"sendrecv"},i.getKind=function(s){return i.splitLines(s)[0].split(" ")[0].substr(2)},i.isRejected=function(s){return s.split(" ",2)[1]==="0"},i.parseMLine=function(s){const a=i.splitLines(s)[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},i.parseOLine=function(s){const a=i.matchPrefix(s,"o=")[0].substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},i.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=i.splitLines(s);for(let u=0;u<a.length;u++)if(a[u].length<2||a[u].charAt(1)!=="=")return!1;return!0},r.exports=i})(j0);var Tl=j0.exports,mJ=Object.freeze(n({__proto__:null,default:Tl},[j0.exports]));function dg(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const i=r.RTCIceCandidate;r.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new i(s),u=Tl.parseCandidate(s.candidate),d=Object.assign(a,u);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new i(s)},r.RTCIceCandidate.prototype=i.prototype,Zc(r,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new r.RTCIceCandidate(s.candidate),writable:"false"}),s))}function B0(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||Zc(r,"icecandidate",i=>{if(i.candidate){const s=Tl.parseCandidate(i.candidate.candidate);s.type==="relay"&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return i})}function hg(r,i){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const g=Tl.splitSections(m.sdp);return g.shift(),g.some(p=>{const E=Tl.parseMLine(p);return E&&E.kind==="application"&&E.protocol.indexOf("SCTP")!==-1})},a=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const p=parseInt(g[1],10);return p!=p?-1:p},u=function(m){let g=65536;return i.browser==="firefox"&&(g=i.version<57?m===-1?16384:2147483637:i.version<60?i.version===57?65535:65536:2147483637),g},d=function(m,g){let p=65536;i.browser==="firefox"&&i.version===57&&(p=65535);const E=Tl.matchPrefix(m.sdp,"a=max-message-size:");return E.length>0?p=parseInt(E[0].substr(19),10):i.browser==="firefox"&&g!==-1&&(p=2147483637),p},h=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,i.browser==="chrome"&&i.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),g=u(m),p=d(arguments[0],m);let E;E=g===0&&p===0?Number.POSITIVE_INFINITY:g===0||p===0?Math.max(g,p):Math.min(g,p);const v={};Object.defineProperty(v,"maxMessageSize",{get:()=>E}),this._sctp=v}return h.apply(this,arguments)}}function pg(r){if(!r.RTCPeerConnection||!("createDataChannel"in r.RTCPeerConnection.prototype))return;function i(a,u){const d=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&u.sctp&&m>u.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+u.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const s=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return i(a,this),a},Zc(r,"datachannel",a=>(i(a.channel,a.target),a))}function G0(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const i=r.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const a=i[s];i[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=u=>{const d=u.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",u);d.dispatchEvent(h)}return u},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function W0(r,i){if(!r.RTCPeerConnection||i.browser==="chrome"&&i.version>=71||i.browser==="safari"&&i.version>=605)return;const s=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const u=a.sdp.split(`
`).filter(d=>qo(d).call(d)!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&a instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:a.type,sdp:u}):a.sdp=u}return s.apply(this,arguments)}}function fg(r,i){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const s=r.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(i.browser==="chrome"&&i.version<78||i.browser==="firefox"&&i.version<68||i.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?_e.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),_e.resolve())})}function mg(r,i){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const s=r.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(r.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(d=>s.apply(this,[d]))})}var gJ=Object.freeze({__proto__:null,shimRTCIceCandidate:dg,shimRTCIceCandidateRelayProtocol:B0,shimMaxMessageSize:hg,shimSendThrowTypeError:pg,shimConnectionState:G0,removeExtmapAllowMixed:W0,shimAddIceCandidateNullOrEmpty:fg,shimParameterlessSetLocalDescription:mg});let Kn,It;(function(){let{window:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=G2,a=PK(r),u={browserDetails:a,commonShim:gJ,extractVersion:xm,disableLog:OK,disableWarnings:NK,sdp:mJ};switch(a.browser){case"chrome":if(!zP||!x0||!i.shimChrome)return s("Chrome shim is not included in this adapter release."),u;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),u;s("adapter.js shimming chrome."),u.browserShim=zP,fg(r,a),mg(r),FP(r,a),jP(r),x0(r,a),BP(r),KP(r,a),GP(r),WP(r),HP(r),qP(r,a),dg(r),B0(r),G0(r),hg(r,a),pg(r),W0(r,a);break;case"firefox":if(!sD||!U0||!i.shimFirefox)return s("Firefox shim is not included in this adapter release."),u;s("adapter.js shimming firefox."),u.browserShim=sD,fg(r,a),mg(r),YP(r,a),U0(r,a),XP(r),ZP(r),JP(r),QP(r),eD(r),tD(r),nD(r),rD(r),iD(r),dg(r),G0(r),hg(r,a),pg(r);break;case"safari":if(!mD||!i.shimSafari)return s("Safari shim is not included in this adapter release."),u;s("adapter.js shimming safari."),u.browserShim=mD,fg(r,a),mg(r),dD(r),pD(r),cD(r),oD(r),aD(r),hD(r),uD(r),fD(r),dg(r),B0(r),hg(r,a),pg(r),W0(r,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(r){r.WIN_10="Windows 10",r.WIN_81="Windows 8.1",r.WIN_8="Windows 8",r.WIN_7="Windows 7",r.WIN_VISTA="Windows Vista",r.WIN_SERVER_2003="Windows Server 2003",r.WIN_XP="Windows XP",r.WIN_2000="Windows 2000",r.ANDROID="Android",r.OPEN_BSD="Open BSD",r.SUN_OS="Sun OS",r.LINUX="Linux",r.IOS="iOS",r.MAC_OS="Mac OS",r.QNX="QNX",r.UNIX="UNIX",r.BEOS="BeOS",r.OS_2="OS/2",r.SEARCH_BOT="Search Bot"}(Kn||(Kn={})),function(r){r.CHROME="Chrome",r.SAFARI="Safari",r.EDGE="Edge",r.FIREFOX="Firefox",r.OPERA="OPR",r.QQ="QQBrowser",r.WECHAT="MicroMessenger"}(It||(It={}));var H0={exports:{}};(function(r,i){(function(s,a){var u="function",d="undefined",h="object",m="string",g="model",p="name",E="type",v="vendor",T="version",I="architecture",O="console",N="mobile",P="tablet",L="smarttv",x="wearable",W="embedded",q="Amazon",X="Apple",ie="ASUS",ee="BlackBerry",le="Firefox",he="Google",ue="Huawei",Ce="LG",De="Microsoft",je="Motorola",fe="Opera",J="Samsung",ne="Sharp",$="Sony",Z="Xiaomi",se="Zebra",pe="Facebook",Oe=function(et){for(var xt={},ut=0;ut<et.length;ut++)xt[et[ut].toUpperCase()]=et[ut];return xt},ce=function(et,xt){return typeof et===m&&A(xt).indexOf(A(et))!==-1},A=function(et){return et.toLowerCase()},U=function(et,xt){if(typeof et===m)return et=et.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof xt===d?et:et.substring(0,350)},G=function(et,xt){for(var ut,Vr,pt,kt,ts,ir,rd=0;rd<xt.length&&!ts;){var mp=xt[rd],SE=xt[rd+1];for(ut=Vr=0;ut<mp.length&&!ts;)if(ts=mp[ut++].exec(et))for(pt=0;pt<SE.length;pt++)ir=ts[++Vr],typeof(kt=SE[pt])===h&&kt.length>0?kt.length===2?typeof kt[1]==u?this[kt[0]]=kt[1].call(this,ir):this[kt[0]]=kt[1]:kt.length===3?typeof kt[1]!==u||kt[1].exec&&kt[1].test?this[kt[0]]=ir?ir.replace(kt[1],kt[2]):a:this[kt[0]]=ir?kt[1].call(this,ir,kt[2]):a:kt.length===4&&(this[kt[0]]=ir?kt[3].call(this,ir.replace(kt[1],kt[2])):a):this[kt]=ir||a;rd+=2}},re=function(et,xt){for(var ut in xt)if(typeof xt[ut]===h&&xt[ut].length>0){for(var Vr=0;Vr<xt[ut].length;Vr++)if(ce(xt[ut][Vr],et))return ut==="?"?a:ut}else if(ce(xt[ut],et))return ut==="?"?a:ut;return et},Ne={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},ht={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,T],[/opios[\/ ]+([\w\.]+)/i],[T,[p,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[T,[p,fe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[p,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[T,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure Browser"],T],[/\bfocus\/([\w\.]+)/i],[T,[p,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[T,[p,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[p,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[p,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[T,[p,le]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 Browser"],T],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,pe],T],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[p,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,"Chrome WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[p,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[T,re,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[p,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,T]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,A]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",A]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,A]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[v,J],[E,P]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[g,[v,J],[E,N]],[/\((ip(?:hone|od)[\w ]*);/i],[g,[v,X],[E,N]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[v,X],[E,P]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[v,ue],[E,P]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[v,ue],[E,N]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[g,/_/g," "],[v,Z],[E,N]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[v,Z],[E,P]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[v,"OPPO"],[E,N]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[v,"Vivo"],[E,N]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[g,[v,"Realme"],[E,N]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[v,je],[E,N]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[v,je],[E,P]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[v,Ce],[E,P]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[v,Ce],[E,N]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[v,"Lenovo"],[E,P]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[v,"Nokia"],[E,N]],[/(pixel c)\b/i],[g,[v,he],[E,P]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[v,he],[E,N]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[v,$],[E,N]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[v,$],[E,P]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[v,"OnePlus"],[E,N]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[v,q],[E,P]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[v,q],[E,N]],[/(playbook);[-\w\),; ]+(rim)/i],[g,v,[E,P]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[v,ee],[E,N]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[v,ie],[E,P]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[v,ie],[E,N]],[/(nexus 9)/i],[g,[v,"HTC"],[E,P]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[g,/_/g," "],[E,N]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[v,"Acer"],[E,P]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[v,"Meizu"],[E,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[v,ne],[E,N]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,g,[E,N]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,g,[E,P]],[/(surface duo)/i],[g,[v,De],[E,P]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[v,"Fairphone"],[E,N]],[/(u304aa)/i],[g,[v,"AT&T"],[E,N]],[/\bsie-(\w*)/i],[g,[v,"Siemens"],[E,N]],[/\b(rct\w+) b/i],[g,[v,"RCA"],[E,P]],[/\b(venue[\d ]{2,7}) b/i],[g,[v,"Dell"],[E,P]],[/\b(q(?:mv|ta)\w+) b/i],[g,[v,"Verizon"],[E,P]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[v,"Barnes & Noble"],[E,P]],[/\b(tm\d{3}\w+) b/i],[g,[v,"NuVision"],[E,P]],[/\b(k88) b/i],[g,[v,"ZTE"],[E,P]],[/\b(nx\d{3}j) b/i],[g,[v,"ZTE"],[E,N]],[/\b(gen\d{3}) b.+49h/i],[g,[v,"Swiss"],[E,N]],[/\b(zur\d{3}) b/i],[g,[v,"Swiss"],[E,P]],[/\b((zeki)?tb.*\b) b/i],[g,[v,"Zeki"],[E,P]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],g,[E,P]],[/\b(ns-?\w{0,9}) b/i],[g,[v,"Insignia"],[E,P]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[v,"NextBook"],[E,P]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],g,[E,N]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],g,[E,N]],[/\b(ph-1) /i],[g,[v,"Essential"],[E,N]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[v,"Envizen"],[E,P]],[/\b(trio[-\w\. ]+) b/i],[g,[v,"MachSpeed"],[E,P]],[/\btu_(1491) b/i],[g,[v,"Rotor"],[E,P]],[/(shield[\w ]+) b/i],[g,[v,"Nvidia"],[E,P]],[/(sprint) (\w+)/i],[v,g,[E,N]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[v,De],[E,N]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[v,se],[E,P]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[v,se],[E,N]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,g,[E,O]],[/droid.+; (shield) bui/i],[g,[v,"Nvidia"],[E,O]],[/(playstation [345portablevi]+)/i],[g,[v,$],[E,O]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[v,De],[E,O]],[/smart-tv.+(samsung)/i],[v,[E,L]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[v,J],[E,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,Ce],[E,L]],[/(apple) ?tv/i],[v,[g,"Apple TV"],[E,L]],[/crkey/i],[[g,"Chromecast"],[v,he],[E,L]],[/droid.+aft(\w)( bui|\))/i],[g,[v,q],[E,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[v,ne],[E,L]],[/(bravia[\w ]+)( bui|\))/i],[g,[v,$],[E,L]],[/(mitv-\w{5}) bui/i],[g,[v,Z],[E,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[v,U],[g,U],[E,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,L]],[/((pebble))app/i],[v,g,[E,x]],[/droid.+; (glass) \d/i],[g,[v,he],[E,x]],[/droid.+; (wt63?0{2,3})\)/i],[g,[v,se],[E,x]],[/(quest( 2)?)/i],[g,[v,pe],[E,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[E,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[g,[E,N]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[E,P]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,P]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,N]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[T,re,Ne]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[T,re,Ne]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,"Mac OS"],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,T],[/\(bb(10);/i],[T,[p,ee]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[p,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[p,"webOS"]],[/crkey\/([\d\.]+)/i],[T,[p,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[p,"Chromium OS"],T],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,T],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,T]]},At=function(et,xt){if(typeof et===h&&(xt=et,et=a),!(this instanceof At))return new At(et,xt).getResult();var ut=et||(typeof s!==d&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),Vr=xt?function(pt,kt){var ts={};for(var ir in pt)kt[ir]&&kt[ir].length%2==0?ts[ir]=kt[ir].concat(pt[ir]):ts[ir]=pt[ir];return ts}(ht,xt):ht;return this.getBrowser=function(){var pt={};return pt.name=a,pt.version=a,G.call(pt,ut,Vr.browser),pt.major=function(kt){return typeof kt===m?kt.replace(/[^\d\.]/g,"").split(".")[0]:a}(pt.version),pt},this.getCPU=function(){var pt={};return pt.architecture=a,G.call(pt,ut,Vr.cpu),pt},this.getDevice=function(){var pt={};return pt.vendor=a,pt.model=a,pt.type=a,G.call(pt,ut,Vr.device),pt},this.getEngine=function(){var pt={};return pt.name=a,pt.version=a,G.call(pt,ut,Vr.engine),pt},this.getOS=function(){var pt={};return pt.name=a,pt.version=a,G.call(pt,ut,Vr.os),pt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ut},this.setUA=function(pt){return ut=typeof pt===m&&pt.length>350?U(pt,350):pt,this},this.setUA(ut),this};At.VERSION="0.7.32",At.BROWSER=Oe([p,T,"major"]),At.CPU=Oe([I]),At.DEVICE=Oe([g,v,E,O,N,L,P,x,W]),At.ENGINE=At.OS=Oe([p,T]),r.exports&&(i=r.exports=At),i.UAParser=At;var Et=typeof s!==d&&(s.jQuery||s.Zepto);if(Et&&!Et.ua){var mn=new At;Et.ua=mn.getResult(),Et.ua.get=function(){return mn.getUA()},Et.ua.set=function(et){mn.setUA(et);var xt=mn.getResult();for(var ut in xt)Et.ua[ut]=xt[ut]}}})(typeof window=="object"?window:o)})(H0,H0.exports);const $0=new H0.exports;let zo=$0.getResult();function bt(r){return r&&$0.setUA(r),zo=$0.getResult(),{name:EJ(zo),version:_J(zo),os:vJ(zo),osVersion:zo.os.version}}function EJ(r){if(r.engine.name==="Blink"&&r.browser.name!=="WeChat")return It.CHROME;switch(r.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return It.CHROME;case"Safari":case"Mobile Safari":return It.SAFARI;case"Edge":return It.EDGE;case"Firefox":return It.FIREFOX;case"QQBrowser":return It.QQ;case"Opera":return It.OPERA;case"WeChat":return It.WECHAT;default:return r.browser.name||""}}function _J(r){let i;return i=r.engine.name==="Blink"?r.engine.version||"":r.browser.version||"",i.split(".")[0]}function vJ(r){switch(r.os.name){case"Windows":return r.os.version?r.os.name+" "+r.os.version:r.os.name;default:return r.os.name||""}}function _D(){return bt().os}function gg(){const r=bt();return!!(zo.engine.name==="WebKit"&&r.os===Kn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&r.name!==It.SAFARI||dr()&&r.name!==It.SAFARI)}function yJ(){const r=bt();if(gg()){if(r.os===Kn.MAC_OS)return!0;if(r.os===Kn.IOS){const i=zo.os.version&&zo.os.version.split(".");if(i&&Number(i[0])===14&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}function SJ(){return zo.engine.name==="WebKit"}function K0(){return bt().name===It.CHROME}function Kr(){return bt().name===It.SAFARI}function tn(){return bt().name===It.FIREFOX}function dr(){return bt().os===Kn.IOS}function vD(){const r=bt();return!(r.name!==It.CHROME||!r.osVersion)&&Number(r.version)<=90}function Rl(){const r=bt();if(r.os!==Kn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])===15}function yD(){const r=bt();if(r.os!==Kn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])===15&&Number(i[1])===0}function SD(){const r=bt();if(r.os!==Kn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])===15&&Number(i[1])>=1}function q0(){const r=bt();if(r.os!==Kn.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])===15&&Number(i[1])>=2}function Yo(){return Kr()&&navigator.maxTouchPoints>0}function TD(){return bt().name===It.WECHAT}function RD(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function su(){const r=bt();return r.name===It.EDGE||r.name===It.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function z0(){return bt().os===Kn.ANDROID}function Vh(){const r=bt();return r.os==="Android"&&(r.name==="Chrome"||r.name===It.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var ID={exports:{}},TJ=lr,RJ=de,wD=Bs.f;TJ({target:"Object",stat:!0,forced:Object.defineProperty!==wD,sham:!RJ},{defineProperty:wD});var CD=Go.Object,IJ=ID.exports=function(r,i,s){return CD.defineProperty(r,i,s)};CD.defineProperty.sham&&(IJ.sham=!0);var AD=ID.exports;function C(r,i,s){return i in r?AD(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s,r}var Y0,X0={exports:{}},bD=function(r,i){return function(){for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];return r.apply(i,s)}},wJ=bD,J0=Object.prototype.toString,Q0=(Y0=Object.create(null),function(r){var i=J0.call(r);return Y0[i]||(Y0[i]=i.slice(8,-1).toLowerCase())});function ou(r){return r=r.toLowerCase(),function(i){return Q0(i)===r}}function Z0(r){return Array.isArray(r)}function Eg(r){return r===void 0}var OD=ou("ArrayBuffer");function ND(r){return r!==null&&typeof r=="object"}function _g(r){if(Q0(r)!=="object")return!1;var i=Object.getPrototypeOf(r);return i===null||i===Object.prototype}var CJ=ou("Date"),AJ=ou("File"),bJ=ou("Blob"),OJ=ou("FileList");function eS(r){return J0.call(r)==="[object Function]"}var NJ=ou("URLSearchParams");function tS(r,i){if(r!=null)if(typeof r!="object"&&(r=[r]),Z0(r))for(var s=0,a=r.length;s<a;s++)i.call(null,r[s],s,r);else for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&i.call(null,r[u],u,r)}var nS,PJ=(nS=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(r){return nS&&r instanceof nS}),Dr={isArray:Z0,isArrayBuffer:OD,isBuffer:function(r){return r!==null&&!Eg(r)&&r.constructor!==null&&!Eg(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)},isFormData:function(r){var i="[object FormData]";return r&&(typeof FormData=="function"&&r instanceof FormData||J0.call(r)===i||eS(r.toString)&&r.toString()===i)},isArrayBufferView:function(r){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer&&OD(r.buffer)},isString:function(r){return typeof r=="string"},isNumber:function(r){return typeof r=="number"},isObject:ND,isPlainObject:_g,isUndefined:Eg,isDate:CJ,isFile:AJ,isBlob:bJ,isFunction:eS,isStream:function(r){return ND(r)&&eS(r.pipe)},isURLSearchParams:NJ,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:tS,merge:function r(){var i={};function s(d,h){_g(i[h])&&_g(d)?i[h]=r(i[h],d):_g(d)?i[h]=r({},d):Z0(d)?i[h]=d.slice():i[h]=d}for(var a=0,u=arguments.length;a<u;a++)tS(arguments[a],s);return i},extend:function(r,i,s){return tS(i,function(a,u){r[u]=s&&typeof a=="function"?wJ(a,s):a}),r},trim:function(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")},stripBOM:function(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r},inherits:function(r,i,s,a){r.prototype=Object.create(i.prototype,a),r.prototype.constructor=r,s&&Object.assign(r.prototype,s)},toFlatObject:function(r,i,s){var a,u,d,h={};i=i||{};do{for(u=(a=Object.getOwnPropertyNames(r)).length;u-- >0;)h[d=a[u]]||(i[d]=r[d],h[d]=!0);r=Object.getPrototypeOf(r)}while(r&&(!s||s(r,i))&&r!==Object.prototype);return i},kindOf:Q0,kindOfTest:ou,endsWith:function(r,i,s){r=String(r),(s===void 0||s>r.length)&&(s=r.length),s-=i.length;var a=r.indexOf(i,s);return a!==-1&&a===s},toArray:function(r){if(!r)return null;var i=r.length;if(Eg(i))return null;for(var s=new Array(i);i-- >0;)s[i]=r[i];return s},isTypedArray:PJ,isFileList:OJ},Il=Dr;function PD(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var DD=function(r,i,s){if(!i)return r;var a;if(s)a=s(i);else if(Il.isURLSearchParams(i))a=i.toString();else{var u=[];Il.forEach(i,function(h,m){h!=null&&(Il.isArray(h)?m+="[]":h=[h],Il.forEach(h,function(g){Il.isDate(g)?g=g.toISOString():Il.isObject(g)&&(g=JSON.stringify(g)),u.push(PD(m)+"="+PD(g))}))}),a=u.join("&")}if(a){var d=r.indexOf("#");d!==-1&&(r=r.slice(0,d)),r+=(r.indexOf("?")===-1?"?":"&")+a}return r},DJ=Dr;function vg(){this.handlers=[]}vg.prototype.use=function(r,i,s){return this.handlers.push({fulfilled:r,rejected:i,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1},vg.prototype.eject=function(r){this.handlers[r]&&(this.handlers[r]=null)},vg.prototype.forEach=function(r){DJ.forEach(this.handlers,function(i){i!==null&&r(i)})};var kJ=vg,LJ=Dr,kD=Dr;function wl(r,i,s,a,u){Error.call(this),this.message=r,this.name="AxiosError",i&&(this.code=i),s&&(this.config=s),a&&(this.request=a),u&&(this.response=u)}kD.inherits(wl,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var LD=wl.prototype,MD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(r){MD[r]={value:r}}),Object.defineProperties(wl,MD),Object.defineProperty(LD,"isAxiosError",{value:!0}),wl.from=function(r,i,s,a,u,d){var h=Object.create(LD);return kD.toFlatObject(r,h,function(m){return m!==Error.prototype}),wl.call(h,r.message,i,s,a,u),h.name=r.name,d&&Object.assign(h,d),h};var Cl=wl,xD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Gs=Dr,UD=function(r,i){i=i||new FormData;var s=[];function a(u){return u===null?"":Gs.isDate(u)?u.toISOString():Gs.isArrayBuffer(u)||Gs.isTypedArray(u)?typeof Blob=="function"?new Blob([u]):Buffer.from(u):u}return function u(d,h){if(Gs.isPlainObject(d)||Gs.isArray(d)){if(s.indexOf(d)!==-1)throw Error("Circular reference detected in "+h);s.push(d),Gs.forEach(d,function(m,g){if(!Gs.isUndefined(m)){var p,E=h?h+"."+g:g;if(m&&!h&&typeof m=="object"){if(Gs.endsWith(g,"{}"))m=JSON.stringify(m);else if(Gs.endsWith(g,"[]")&&(p=Gs.toArray(m)))return void p.forEach(function(v){!Gs.isUndefined(v)&&i.append(E,a(v))})}u(m,E)}}),s.pop()}else i.append(h,a(d))}(r),i},rS=Cl,yg=Dr,MJ=yg.isStandardBrowserEnv()?{write:function(r,i,s,a,u,d){var h=[];h.push(r+"="+encodeURIComponent(i)),yg.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),yg.isString(a)&&h.push("path="+a),yg.isString(u)&&h.push("domain="+u),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read:function(r){var i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},xJ=function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)},UJ=function(r,i){return i?r.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):r},VD=function(r,i){return r&&!xJ(i)?UJ(r,i):i},iS=Dr,VJ=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],FD=Dr,FJ=FD.isStandardBrowserEnv()?function(){var r,i=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");function a(u){var d=u;return i&&(s.setAttribute("href",d),d=s.href),s.setAttribute("href",d),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return r=a(window.location.href),function(u){var d=FD.isString(u)?a(u):u;return d.protocol===r.protocol&&d.host===r.host}}():function(){return!0},sS=Cl;function jD(r){sS.call(this,r??"canceled",sS.ERR_CANCELED),this.name="CanceledError"}Dr.inherits(jD,sS,{__CANCEL__:!0});var Sg=jD,Fh=Dr,jJ=function(r,i,s){var a=s.config.validateStatus;s.status&&a&&!a(s.status)?i(new rS("Request failed with status code "+s.status,[rS.ERR_BAD_REQUEST,rS.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):r(s)},BJ=MJ,GJ=DD,WJ=VD,HJ=function(r){var i,s,a,u={};return r&&iS.forEach(r.split(`
`),function(d){if(a=d.indexOf(":"),i=iS.trim(d.substr(0,a)).toLowerCase(),s=iS.trim(d.substr(a+1)),i){if(u[i]&&VJ.indexOf(i)>=0)return;u[i]=i==="set-cookie"?(u[i]?u[i]:[]).concat([s]):u[i]?u[i]+", "+s:s}}),u},$J=FJ,KJ=xD,Xo=Cl,qJ=Sg,zJ=function(r){var i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return i&&i[1]||""},YJ=function(r){return new Promise(function(i,s){var a,u=r.data,d=r.headers,h=r.responseType;function m(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}Fh.isFormData(u)&&Fh.isStandardBrowserEnv()&&delete d["Content-Type"];var g=new XMLHttpRequest;if(r.auth){var p=r.auth.username||"",E=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";d.Authorization="Basic "+btoa(p+":"+E)}var v=WJ(r.baseURL,r.url);function T(){if(g){var N="getAllResponseHeaders"in g?HJ(g.getAllResponseHeaders()):null,P={data:h&&h!=="text"&&h!=="json"?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:N,config:r,request:g};jJ(function(L){i(L),m()},function(L){s(L),m()},P),g=null}}if(g.open(r.method.toUpperCase(),GJ(v,r.params,r.paramsSerializer),!0),g.timeout=r.timeout,"onloadend"in g?g.onloadend=T:g.onreadystatechange=function(){g&&g.readyState===4&&(g.status!==0||g.responseURL&&g.responseURL.indexOf("file:")===0)&&setTimeout(T)},g.onabort=function(){g&&(s(new Xo("Request aborted",Xo.ECONNABORTED,r,g)),g=null)},g.onerror=function(){s(new Xo("Network Error",Xo.ERR_NETWORK,r,g,g)),g=null},g.ontimeout=function(){var N=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",P=r.transitional||KJ;r.timeoutErrorMessage&&(N=r.timeoutErrorMessage),s(new Xo(N,P.clarifyTimeoutError?Xo.ETIMEDOUT:Xo.ECONNABORTED,r,g)),g=null},Fh.isStandardBrowserEnv()){var I=(r.withCredentials||$J(v))&&r.xsrfCookieName?BJ.read(r.xsrfCookieName):void 0;I&&(d[r.xsrfHeaderName]=I)}"setRequestHeader"in g&&Fh.forEach(d,function(N,P){u===void 0&&P.toLowerCase()==="content-type"?delete d[P]:g.setRequestHeader(P,N)}),Fh.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),h&&h!=="json"&&(g.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&g.addEventListener("progress",r.onDownloadProgress),typeof r.onUploadProgress=="function"&&g.upload&&g.upload.addEventListener("progress",r.onUploadProgress),(r.cancelToken||r.signal)&&(a=function(N){g&&(s(!N||N&&N.type?new qJ:N),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a))),u||(u=null);var O=zJ(v);O&&["http","https","file"].indexOf(O)===-1?s(new Xo("Unsupported protocol "+O+":",Xo.ERR_BAD_REQUEST,r)):g.send(u)})},Tr=Dr,BD=function(r,i){LJ.forEach(r,function(s,a){a!==i&&a.toUpperCase()===i.toUpperCase()&&(r[i]=s,delete r[a])})},GD=Cl,XJ=UD,JJ={"Content-Type":"application/x-www-form-urlencoded"};function WD(r,i){!Tr.isUndefined(r)&&Tr.isUndefined(r["Content-Type"])&&(r["Content-Type"]=i)}var HD,Tg={transitional:xD,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(HD=YJ),HD),transformRequest:[function(r,i){if(BD(i,"Accept"),BD(i,"Content-Type"),Tr.isFormData(r)||Tr.isArrayBuffer(r)||Tr.isBuffer(r)||Tr.isStream(r)||Tr.isFile(r)||Tr.isBlob(r))return r;if(Tr.isArrayBufferView(r))return r.buffer;if(Tr.isURLSearchParams(r))return WD(i,"application/x-www-form-urlencoded;charset=utf-8"),r.toString();var s,a=Tr.isObject(r),u=i&&i["Content-Type"];if((s=Tr.isFileList(r))||a&&u==="multipart/form-data"){var d=this.env&&this.env.FormData;return XJ(s?{"files[]":r}:r,d&&new d)}return a||u==="application/json"?(WD(i,"application/json"),function(h,m,g){if(Tr.isString(h))try{return(m||JSON.parse)(h),Tr.trim(h)}catch(p){if(p.name!=="SyntaxError")throw p}return(g||JSON.stringify)(h)}(r)):r}],transformResponse:[function(r){var i=this.transitional||Tg.transitional,s=i&&i.silentJSONParsing,a=i&&i.forcedJSONParsing,u=!s&&this.responseType==="json";if(u||a&&Tr.isString(r)&&r.length)try{return JSON.parse(r)}catch(d){if(u)throw d.name==="SyntaxError"?GD.from(d,GD.ERR_BAD_RESPONSE,this,null,this.response):d}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Tr.forEach(["delete","get","head"],function(r){Tg.headers[r]={}}),Tr.forEach(["post","put","patch"],function(r){Tg.headers[r]=Tr.merge(JJ)});var oS=Tg,QJ=Dr,ZJ=oS,$D=function(r){return!(!r||!r.__CANCEL__)},KD=Dr,aS=function(r,i,s){var a=this||ZJ;return QJ.forEach(s,function(u){r=u.call(a,r,i)}),r},eQ=$D,tQ=oS,nQ=Sg;function cS(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new nQ}var Gi=Dr,qD=function(r,i){i=i||{};var s={};function a(p,E){return Gi.isPlainObject(p)&&Gi.isPlainObject(E)?Gi.merge(p,E):Gi.isPlainObject(E)?Gi.merge({},E):Gi.isArray(E)?E.slice():E}function u(p){return Gi.isUndefined(i[p])?Gi.isUndefined(r[p])?void 0:a(void 0,r[p]):a(r[p],i[p])}function d(p){if(!Gi.isUndefined(i[p]))return a(void 0,i[p])}function h(p){return Gi.isUndefined(i[p])?Gi.isUndefined(r[p])?void 0:a(void 0,r[p]):a(void 0,i[p])}function m(p){return p in i?a(r[p],i[p]):p in r?a(void 0,r[p]):void 0}var g={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m};return Gi.forEach(Object.keys(r).concat(Object.keys(i)),function(p){var E=g[p]||u,v=E(p);Gi.isUndefined(v)&&E!==m||(s[p]=v)}),s},zD="0.27.2",rQ=zD,Fa=Cl,uS={};["object","boolean","number","function","string","symbol"].forEach(function(r,i){uS[r]=function(s){return typeof s===r||"a"+(i<1?"n ":" ")+r}});var YD={};uS.transitional=function(r,i,s){function a(u,d){return"[Axios v"+rQ+"] Transitional option '"+u+"'"+d+(s?". "+s:"")}return function(u,d,h){if(r===!1)throw new Fa(a(d," has been removed"+(i?" in "+i:"")),Fa.ERR_DEPRECATED);return i&&!YD[d]&&(YD[d]=!0,console.warn(a(d," has been deprecated since v"+i+" and will be removed in the near future"))),!r||r(u,d,h)}};var XD=Dr,iQ=DD,JD=kJ,QD=function(r){return cS(r),r.headers=r.headers||{},r.data=aS.call(r,r.data,r.headers,r.transformRequest),r.headers=KD.merge(r.headers.common||{},r.headers[r.method]||{},r.headers),KD.forEach(["delete","get","head","post","put","patch","common"],function(i){delete r.headers[i]}),(r.adapter||tQ.adapter)(r).then(function(i){return cS(r),i.data=aS.call(r,i.data,i.headers,r.transformResponse),i},function(i){return eQ(i)||(cS(r),i&&i.response&&(i.response.data=aS.call(r,i.response.data,i.response.headers,r.transformResponse))),Promise.reject(i)})},Rg=qD,sQ=VD,ZD={assertOptions:function(r,i,s){if(typeof r!="object")throw new Fa("options must be an object",Fa.ERR_BAD_OPTION_VALUE);for(var a=Object.keys(r),u=a.length;u-- >0;){var d=a[u],h=i[d];if(h){var m=r[d],g=m===void 0||h(m,d,r);if(g!==!0)throw new Fa("option "+d+" must be "+g,Fa.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new Fa("Unknown option "+d,Fa.ERR_BAD_OPTION)}},validators:uS},Al=ZD.validators;function bl(r){this.defaults=r,this.interceptors={request:new JD,response:new JD}}bl.prototype.request=function(r,i){typeof r=="string"?(i=i||{}).url=r:i=r||{},(i=Rg(this.defaults,i)).method?i.method=i.method.toLowerCase():this.defaults.method?i.method=this.defaults.method.toLowerCase():i.method="get";var s=i.transitional;s!==void 0&&ZD.assertOptions(s,{silentJSONParsing:Al.transitional(Al.boolean),forcedJSONParsing:Al.transitional(Al.boolean),clarifyTimeoutError:Al.transitional(Al.boolean)},!1);var a=[],u=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(i)===!1||(u=u&&v.synchronous,a.unshift(v.fulfilled,v.rejected))});var d,h=[];if(this.interceptors.response.forEach(function(v){h.push(v.fulfilled,v.rejected)}),!u){var m=[QD,void 0];for(Array.prototype.unshift.apply(m,a),m=m.concat(h),d=Promise.resolve(i);m.length;)d=d.then(m.shift(),m.shift());return d}for(var g=i;a.length;){var p=a.shift(),E=a.shift();try{g=p(g)}catch(v){E(v);break}}try{d=QD(g)}catch(v){return Promise.reject(v)}for(;h.length;)d=d.then(h.shift(),h.shift());return d},bl.prototype.getUri=function(r){r=Rg(this.defaults,r);var i=sQ(r.baseURL,r.url);return iQ(i,r.params,r.paramsSerializer)},XD.forEach(["delete","get","head","options"],function(r){bl.prototype[r]=function(i,s){return this.request(Rg(s||{},{method:r,url:i,data:(s||{}).data}))}}),XD.forEach(["post","put","patch"],function(r){function i(s){return function(a,u,d){return this.request(Rg(d||{},{method:r,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:u}))}}bl.prototype[r]=i(),bl.prototype[r+"Form"]=i(!0)});var oQ=bl,aQ=Sg;function Ol(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var i;this.promise=new Promise(function(a){i=a});var s=this;this.promise.then(function(a){if(s._listeners){var u,d=s._listeners.length;for(u=0;u<d;u++)s._listeners[u](a);s._listeners=null}}),this.promise.then=function(a){var u,d=new Promise(function(h){s.subscribe(h),u=h}).then(a);return d.cancel=function(){s.unsubscribe(u)},d},r(function(a){s.reason||(s.reason=new aQ(a),i(s.reason))})}Ol.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Ol.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},Ol.prototype.unsubscribe=function(r){if(this._listeners){var i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}},Ol.source=function(){var r;return{token:new Ol(function(i){r=i}),cancel:r}};var cQ=Ol,uQ=Dr,ek=Dr,lQ=bD,Ig=oQ,dQ=qD,Ti=function r(i){var s=new Ig(i),a=lQ(Ig.prototype.request,s);return ek.extend(a,Ig.prototype,s),ek.extend(a,s),a.create=function(u){return r(dQ(i,u))},a}(oS);Ti.Axios=Ig,Ti.CanceledError=Sg,Ti.CancelToken=cQ,Ti.isCancel=$D,Ti.VERSION=zD,Ti.toFormData=UD,Ti.AxiosError=Cl,Ti.Cancel=Ti.CanceledError,Ti.all=function(r){return Promise.all(r)},Ti.spread=function(r){return function(i){return r.apply(null,i)}},Ti.isAxiosError=function(r){return uQ.isObject(r)&&r.isAxiosError===!0},X0.exports=Ti,X0.exports.default=Ti;var gs=X0.exports;class hQ{constructor(i){C(this,"logger",void 0),C(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}class Wt{constructor(){C(this,"_events",{}),C(this,"addListener",this.on)}getListeners(i){return this._events[i]?this._events[i].map(s=>s.listener):[]}on(i,s){this._events[i]||(this._events[i]=[]);const a=this._events[i];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!1})}once(i,s){this._events[i]||(this._events[i]=[]);const a=this._events[i];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!0})}off(i,s){if(!this._events[i])return;const a=this._events[i],u=this._indexOfListener(a,s);u!==-1&&a.splice(u,1),this._events[i].length===0&&delete this._events[i]}removeAllListeners(i){i?delete this._events[i]:this._events={}}emit(i){this._events[i]||(this._events[i]=[]);const s=this._events[i].map(h=>h);for(var a=arguments.length,u=new Array(a>1?a-1:0),d=1;d<a;d++)u[d-1]=arguments[d];for(let h=0;h<s.length;h+=1){const m=s[h];m.once&&this.off(i,m.listener),m.listener.apply(this,u||[])}}_indexOfListener(i,s){let a=i.length;for(;a--;)if(i[a].listener===s)return a;return-1}}const wg=new class extends Wt{reportLogUploadError(r){this.emit("REPORT_LOG_UPLOAD",r)}};let V;(function(r){r.UNEXPECTED_ERROR="UNEXPECTED_ERROR",r.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",r.TIMEOUT="TIMEOUT",r.INVALID_PARAMS="INVALID_PARAMS",r.NOT_READABLE="NOT_READABLE",r.NOT_SUPPORTED="NOT_SUPPORTED",r.INVALID_OPERATION="INVALID_OPERATION",r.OPERATION_ABORTED="OPERATION_ABORTED",r.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",r.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",r.NETWORK_ERROR="NETWORK_ERROR",r.NETWORK_TIMEOUT="NETWORK_TIMEOUT",r.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",r.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",r.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",r.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",r.ELECTRON_IS_NULL="ELECTRON_IS_NULL",r.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",r.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",r.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",r.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",r.TRACK_IS_DISABLED="TRACK_IS_DISABLED",r.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",r.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",r.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",r.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",r.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",r.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",r.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",r.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",r.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",r.UID_CONFLICT="UID_CONFLICT",r.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",r.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",r.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",r.INVALID_TRACK="INVALID_TRACK",r.SENDER_NOT_FOUND="SENDER_NOT_FOUND",r.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",r.SET_ANSWER_FAILED="SET_ANSWER_FAILED",r.ICE_FAILED="ICE_FAILED",r.PC_CLOSED="PC_CLOSED",r.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",r.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",r.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",r.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",r.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",r.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",r.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",r.INVALID_REMOTE_USER="INVALID_REMOTE_USER",r.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",r.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",r.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",r.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",r.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",r.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",r.WS_ABORT="WS_ABORT",r.WS_DISCONNECT="WS_DISCONNECT",r.WS_ERR="WS_ERR",r.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",r.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",r.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",r.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",r.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",r.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",r.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",r.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",r.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",r.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",r.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",r.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",r.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",r.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",r.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",r.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",r.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",r.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",r.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",r.INVALID_PLUGIN="INVALID_PLUGIN",r.DISCONNECT_P2P="DISCONNECT_P2P",r.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",r.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",r.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",r.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",r.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT"})(V||(V={}));class j extends Error{constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;super(s),C(this,"code",void 0),C(this,"message",void 0),C(this,"data",void 0),C(this,"name","AgoraRTCException"),this.code=i,this.message="AgoraRTCError ".concat(this.code,": ").concat(s),this.data=a}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return i==="error"&&D.error(this.toString()),i==="warning"&&D.warning(this.toString()),this}throw(){throw this.print(),this}}const vn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function lS(r,i){const s=Math.floor(i.timeout*Math.pow(i.timeoutFactor,r));return Math.min(i.maxRetryTimeout,s)}function po(r,i,s,a){const u=Object.assign({},vn,a);let d=u.timeout;const h=async()=>{await function(p){return new _e(E=>{window.setTimeout(E,p)})}(d),d*=u.timeoutFactor,d=Math.min(u.maxRetryTimeout,d)};let m=!1;const g=new _e(async(p,E)=>{i=i||(()=>!1),s=s||(()=>!0);for(let v=0;v<u.maxRetryCount;v+=1){if(m)return E(new j(V.OPERATION_ABORTED));try{const T=await r();if(!i(T,v)||v+1===u.maxRetryCount)return p(T);await h()}catch(T){if(!s(T,v)||v+1===u.maxRetryCount)return E(T);await h()}}});return g.cancel=()=>m=!0,g}function dS(){const r=new Date;return r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}function tk(){const r=new Date,i=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return i?(i==null?void 0:i[0])+":"+r.getUTCMilliseconds():r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}const Wi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Cg=Date.now(),jh=r=>{for(const i in Wi)if(Object.prototype.hasOwnProperty.call(Wi,i)&&Wi[i]===r)return i;return"DEFAULT"},D=new class{constructor(){C(this,"proxyServerURL",void 0),C(this,"logLevel",Wi.DEBUG),C(this,"uploadState","collecting"),C(this,"uploadLogWaitingList",[]),C(this,"uploadLogUploadingList",[]),C(this,"uploadErrorCount",0),C(this,"currentLogID",0),C(this,"url",void 0),C(this,"extLog",(r,i)=>{this.appendLogToWaitingList(r,...i)})}debug(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const a=[Wi.DEBUG].concat(i);this.log.apply(this,a)}info(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const a=[Wi.INFO].concat(i);this.log.apply(this,a)}warning(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const a=[Wi.WARNING].concat(i);this.log.apply(this,a)}error(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const a=[Wi.ERROR].concat(i);this.log.apply(this,a)}upload(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const a=[Wi.DEBUG].concat(i);this.uploadLog.apply(this,a)}setLogLevel(r){r=Math.min(Math.max(0,r),4),this.logLevel=r}enableLogUpload(){Dt("UPLOAD_LOG",!0)}disableLogUpload(){Dt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(r){this.proxyServerURL=r}prefix(r){return new hQ(this).prefix(r)}log(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];if(Date.now()-Cg<100)return void setTimeout(()=>{this.log(...i)},Date.now()-Cg);const a=Math.max(0,Math.min(4,i[0]));if(i[0]=dS()+" Agora-SDK [".concat(jh(a),"]:"),this.appendLogToWaitingList(a,...i),a<this.logLevel)return;const u=dS()+" %cAgora-SDK [".concat(jh(a),"]:");let d=[];if(!Q("USE_NEW_LOG"))switch(a){case Wi.DEBUG:d=[u,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,d);break;case Wi.INFO:d=[u,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,d);break;case Wi.WARNING:d=[u,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,d);break;case Wi.ERROR:d=[u,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];if(Date.now()-Cg<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-Cg);const a=Math.max(0,Math.min(4,i[0]));i[0]=dS()+" Agora-SDK [".concat(jh(a),"]:"),this.appendLogToWaitingList(a,...i)}appendLogToWaitingList(r){if(!Q("UPLOAD_LOG"))return;for(var i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=tk()+" Agora-SDK [".concat(jh(r),"]:"):s[0]=tk()+" Agora-SDK [".concat(jh(r),"]:");let u="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),u+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:u,log_level:r,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const r=this.uploadLogUploadingList,i={sdk_version:Hi,process_id:Q("PROCESS_ID"),payload:JSON.stringify(r)};return po(async()=>{const s=await gs.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Q("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Q("LOG_UPLOAD_SERVER"),"/upload/v1")),i,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>(s.response?wg.reportLogUploadError({status:s.response.status,data:s.response.data,headers:s.response.headers,message:s.message}):s.request?wg.reportLogUploadError({status:s.request.status,message:s.message}):wg.reportLogUploadError({status:-1,message:s.message}),!0),{timeout:Q("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Q("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Q("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_INTERVAL"))}).catch(r=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Q("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},hS="v4.16.1-0-gb268655f-dirty(2/8/2023, 2:53:13 PM)",Hi=function(r){if(r.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return r;const i=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(i&&i[1]&&i[2]){const a=i[1],u=i[2];return"".concat(a,".").concat(u)}const s=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(s&&s[1]&&s[2]){const a=s[1],u=s[2];return"".concat(a,".").concat(100*(Number(u)+1))}return"4.0.0.999"}("4.16.1"),pS=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),Ri=function(){const r="us".concat("erna","me"),i="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),u=[];for(let m=0;m<6;m++)u.push("1");const d=u.join(""),h={};return h[r]=a,h[i]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ri;const pQ={"90p":Qe(160,90),"90p_1":Qe(160,90),"120p":Qe(160,120,15,30,65),"120p_1":Qe(160,120,15,30,65),"120p_3":Qe(120,120,15,30,50),"120p_4":Qe(212,120),"180p":Qe(320,180,15,30,140),"180p_1":Qe(320,180,15,30,140),"180p_3":Qe(180,180,15,30,100),"180p_4":Qe(240,180,15,30,120),"240p":Qe(320,240,15,40,200),"240p_1":Qe(320,240,15,40,200),"240p_3":Qe(240,240,15,40,140),"240p_4":Qe(424,240,15,40,220),"360p":Qe(640,360,15,80,400),"360p_1":Qe(640,360,15,80,400),"360p_3":Qe(360,360,15,80,260),"360p_4":Qe(640,360,30,80,600),"360p_6":Qe(360,360,30,80,400),"360p_7":Qe(480,360,15,80,320),"360p_8":Qe(480,360,30,80,490),"360p_9":Qe(640,360,15,80,800),"360p_10":Qe(640,360,24,80,800),"360p_11":Qe(640,360,24,80,1e3),"480p":Qe(640,480,15,100,500),"480p_1":Qe(640,480,15,100,500),"480p_2":Qe(640,480,30,100,1e3),"480p_3":Qe(480,480,15,100,400),"480p_4":Qe(640,480,30,100,750),"480p_6":Qe(480,480,30,100,600),"480p_8":Qe(848,480,15,100,610),"480p_9":Qe(848,480,30,100,930),"480p_10":Qe(640,480,10,100,400),"720p":Qe(1280,720,15,120,1130),"720p_1":Qe(1280,720,15,120,1130),"720p_2":Qe(1280,720,30,120,2e3),"720p_3":Qe(1280,720,30,120,1710),"720p_5":Qe(960,720,15,120,910),"720p_6":Qe(960,720,30,120,1380),"1080p":Qe(1920,1080,15,120,2080),"1080p_1":Qe(1920,1080,15,120,2080),"1080p_2":Qe(1920,1080,30,120,3e3),"1080p_3":Qe(1920,1080,30,120,3150),"1080p_5":Qe(1920,1080,60,120,4780),"1440p":Qe(2560,1440,30,120,4850),"1440p_1":Qe(2560,1440,30,120,4850),"1440p_2":Qe(2560,1440,60,120,7350),"4k":Qe(3840,2160,30,120,8910),"4k_1":Qe(3840,2160,30,120,8910),"4k_3":Qe(3840,2160,60,120,13500)},fQ={"480p":Es(640,480,5),"480p_1":Es(640,480,5),"480p_2":Es(640,480,30),"480p_3":Es(640,480,15),"720p":Es(1280,720,5),"720p_1":Es(1280,720,5),"720p_2":Es(1280,720,30),"720p_3":Es(1280,720,15),"1080p":Es(1920,1080,5),"1080p_1":Es(1920,1080,5),"1080p_2":Es(1920,1080,30),"1080p_3":Es(1920,1080,15)},mQ={"1SL1TL":gS(1,1),"3SL3TL":gS(3,3),"2SL3TL":gS(2,3)};function Nl(r){return typeof r=="string"?Object.assign({},pQ[r]):r}function fS(r){return typeof r=="string"?Object.assign({},fQ[r]):r}function Ag(r){return typeof r=="string"?Object.assign({},mQ[r]):r}const gQ={speech_low_quality:Pl(16e3,!1),speech_standard:Pl(32e3,!1,18),music_standard:Pl(48e3,!1),standard_stereo:Pl(48e3,!0,56),high_quality:Pl(48e3,!1,128),high_quality_stereo:Pl(48e3,!0,192)};function bg(r){return typeof r=="string"?Object.assign({},gQ[r]):r}function Dt(r,i,s){Object.keys(qr).includes(r)&&(!s&&Object.keys(mS).includes(r)||(qr[r]=i))}function Q(r){return qr[r]}const qr={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TCC:!0,PUBLISH_TCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},mS={};function Pl(r,i,s){return{sampleRate:r,stereo:i,bitrate:s}}function Qe(r,i,s,a,u){return{width:r,height:i,frameRate:s,bitrateMin:a,bitrateMax:u}}function Es(r,i,s,a,u){return{width:{max:r},height:{max:i},frameRate:s,bitrateMin:a,bitrateMax:u}}function gS(r,i){return{numSpatialLayers:r,numTemporalLayers:i}}pS||(qr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],qr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],qr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],qr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],qr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],qr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],qr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",qr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",qr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",qr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",qr.AREAS=["NORTH_AMERICA","OVERSEA"]);const EQ=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Dl=[],Bh=[];var _Q=Dm,vQ=Bs,yQ=Hn,Og=function(r,i,s){var a=_Q(i);a in r?vQ.f(r,a,yQ(0,s)):r[a]=s},nk=Hy,SQ=Ho,TQ=Og,RQ=M.Array,IQ=Math.max,ES=function(r,i,s){for(var a=SQ(r),u=nk(i,a),d=nk(s===void 0?a:s,a),h=RQ(IQ(d-u,0)),m=0;u<d;u++,m++)TQ(h,m,r[u]);return h.length=m,h},rk=ES,wQ=Math.floor,_S=function(r,i){var s=r.length,a=wQ(s/2);return s<8?CQ(r,i):AQ(r,_S(rk(r,0,a),i),_S(rk(r,a),i),i)},CQ=function(r,i){for(var s,a,u=r.length,d=1;d<u;){for(a=d,s=r[d];a&&i(r[a-1],s)>0;)r[a]=r[--a];a!==d++&&(r[a]=s)}return r},AQ=function(r,i,s,a){for(var u=i.length,d=s.length,h=0,m=0;h<u||m<d;)r[h+m]=h<u&&m<d?a(i[h],s[m])<=0?i[h++]:s[m++]:h<u?i[h++]:s[m++];return r},ik=_S,sk=Xc.match(/firefox\/(\d+)/i),bQ=!!sk&&+sk[1],OQ=/MSIE|Trident/.test(Xc),ok=Xc.match(/AppleWebKit\/(\d+)\./),NQ=!!ok&&+ok[1],PQ=lr,ak=w,DQ=Wo,kQ=uo,LQ=Ho,ck=Ua,vS=c,MQ=ik,xQ=Fy,uk=bQ,UQ=OQ,lk=ul,dk=NQ,ja=[],hk=ak(ja.sort),VQ=ak(ja.push),FQ=vS(function(){ja.sort(void 0)}),jQ=vS(function(){ja.sort(null)}),BQ=xQ("sort"),pk=!vS(function(){if(lk)return lk<70;if(!(uk&&uk>3)){if(UQ)return!0;if(dk)return dk<603;var r,i,s,a,u="";for(r=65;r<76;r++){switch(i=String.fromCharCode(r),r){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)ja.push({k:i+a,v:s})}for(ja.sort(function(d,h){return h.v-d.v}),a=0;a<ja.length;a++)i=ja[a].k.charAt(0),u.charAt(u.length-1)!==i&&(u+=i);return u!=="DGBEFHACIJK"}});PQ({target:"Array",proto:!0,forced:FQ||!jQ||!BQ||!pk},{sort:function(r){r!==void 0&&DQ(r);var i=kQ(this);if(pk)return r===void 0?hk(i):hk(i,r);var s,a,u=[],d=LQ(i);for(a=0;a<d;a++)a in i&&VQ(u,i[a]);for(MQ(u,function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:ck(m)>ck(g)?1:-1}}(r)),s=u.length,a=0;a<s;)i[a]=u[a++];for(;a<d;)delete i[a++];return i}});var GQ=Ma("Array").sort,WQ=b,HQ=GQ,yS=Array.prototype,SS=function(r){var i=r.sort;return r===yS||WQ(yS,r)&&i===yS.sort?HQ:i};function Gh(r,i){if(typeof r!="boolean")throw new j(V.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function qn(r,i,s){if(!s.includes(r))throw new j(V.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(s)))}function Ot(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,u=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(r<s||r>a||u&&!$Q(r))throw new j(V.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function TS(r,i){if(typeof r!="number"){if(!(r.min||r.max||r.ideal||r.exact))throw new j(V.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));r.min!==void 0&&Ot(r.min,"".concat(i,".min"),0,1/0),r.max!==void 0&&Ot(r.max,"".concat(i,".max"),1,1/0),r.exact!==void 0&&Ot(r.exact,"".concat(i,".exact"),1,1/0),r.ideal!==void 0&&Ot(r.ideal,"".concat(i,".ideal"),1,1/0)}else Ot(r,i,1,1/0)}function zn(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,u=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(r==null)throw new j(V.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!fk(r,s,a,u))throw new j(V.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(u?" ASCII characters only.":""))}function Jo(r,i){if(!Array.isArray(r))throw new j(V.INVALID_PARAMS,"".concat(i," should be an array"))}function RS(r){if(typeof r!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(r))throw D.error("Invalid Channel Name ".concat(r)),new j(V.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function IS(r){if(i=r,!(typeof i=="number"&&Math.floor(i)===i&&0<=i&&i<=4294967295||fk(r,1,255)))throw D.error("Invalid UID ".concat(r," ").concat(typeof r)),new j(V.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;typeof r=="string"&&D.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function Ft(r){return r==null}function fk(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof r=="string"&&r.length<=s&&r.length>=i&&(!a||KQ(r))}function $Q(r){return typeof r=="number"&&r%1==0}function KQ(r){if(typeof r!="string")return!1;for(let i=0;i<r.length;i+=1){const s=r.charCodeAt(i);if(s<0||s>255)return!1}return!0}let mk,gk,Yn;(function(r){r.FREE="free",r.UPLOADING="uploading"})(mk||(mk={})),function(r){r[r.MISC=0]="MISC",r[r.INTERNAL_EVENT=1]="INTERNAL_EVENT",r[r.PUBLIC_EVENT=2]="PUBLIC_EVENT",r[r.WEB_EVENT=3]="WEB_EVENT",r[r.INTERNAL_API=4]="INTERNAL_API",r[r.WEB_API=5]="WEB_API",r[r.PUBLIC_API=6]="PUBLIC_API"}(gk||(gk={})),function(r){r.NONE="none",r.INIT="init",r.CANPLAY="canplay",r.PLAYING="playing",r.PAUSED="paused",r.SUSPEND="suspend",r.STALLED="stalled",r.WAITING="waiting",r.ERROR="error",r.DESTROYED="destroyed",r.ABORT="abort",r.ENDED="ended",r.EMPTIED="emptied",r.LOADEDDATA="loadeddata"}(Yn||(Yn={}));const wS={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function qQ(r){return zn(r.reportId,"params.reportId",0,100,!1),zn(r.category,"params.category",0,100,!1),zn(r.event,"params.event",0,100,!1),zn(r.label,"params.label",0,100,!1),Ot(r.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const zQ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Xn,qt,Ek,CS,dn,Ht,au,Qo,kl,Wh,Ii,Jn,Pe,AS,_t,Ye,kr,Tt,Te,Le,zr,Ke,_k,Yr;function vk(r){return Ot(r.timeout,"config.timeout",0,1e5),Ot(r.timeoutFactor,"config.timeoutFactor",0,100,!1),Ot(r.maxRetryCount,"config.maxRetryConfig",0,1/0),Ot(r.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function YQ(r){return qn(r.codec,"config.codec",["vp8","vp9","av1","h264"]),qn(r.mode,"config.mode",["rtc","live"]),r.audioCodec!==void 0&&qn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&zn(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&yk(r.turnServer),r.httpRetryConfig!==void 0&&vk(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&vk(r.websocketRetryConfig),!0}function Hh(r){if(!Array.isArray(r)||r.length<1)return!1;try{r.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function yk(r){return zn(r.turnServerURL,"turnServerURL"),zn(r.username,"username"),zn(r.password,"password"),r.udpport&&Ot(r.udpport,"udpport",1,99999,!0),r.forceturn&&Gh(r.forceturn,"forceturn"),r.security&&Gh(r.security,"security"),r.tcpport&&Ot(r.tcpport,"tcpport",1,99999,!0),!0}function Sk(r){return r.level!==void 0&&qn(r.level,"level",[1,2,3]),!0}(function(r){r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.WS_COMPRESSOR_INIT="ws_compressor_init",r.SESSION_INIT="session_init",r.JOIN_CHOOSE_SERVER="join_choose_server",r.REQ_USER_ACCOUNT="req_user_account",r.JOIN_GATEWAY="join_gateway",r.REJOIN_GATEWAY="rejoin_gateway",r.STREAM_SWITCH="stream_switch",r.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",r.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",r.FIRST_VIDEO_RECEIVED="first_video_received",r.FIRST_AUDIO_RECEIVED="first_audio_received",r.FIRST_VIDEO_DECODE="first_video_decode",r.FIRST_AUDIO_DECODE="first_audio_decode",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_UPDATE_STREAM="on_update_stream",r.ON_REMOVE_STREAM="on_remove_stream",r.USER_ANALYTICS="req_user_analytics"})(Xn||(Xn={})),function(r){r.SESSION="io.agora.pb.Wrtc.Session",r.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",r.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",r.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",r.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",r.PUBLISH="io.agora.pb.Wrtc.Publish",r.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",r.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",r.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",r.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",r.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",r.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",r.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",r.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",r.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",r.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",r.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",r.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",r.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",r.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",r.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",r.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",r.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",r.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",r.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",r.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",r.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",r.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",r.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",r.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed"}(qt||(qt={})),function(r){r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Ek||(Ek={})),function(r){r[r.SESSION=26]="SESSION",r[r.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",r[r.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",r[r.JOIN_GATEWAY=28]="JOIN_GATEWAY",r[r.PUBLISH=30]="PUBLISH",r[r.SUBSCRIBE=29]="SUBSCRIBE",r[r.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",r[r.STREAM_SWITCH=32]="STREAM_SWITCH",r[r.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",r[r.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",r[r.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",r[r.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",r[r.API_INVOKE=41]="API_INVOKE",r[r.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",r[r.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",r[r.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",r[r.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",r[r.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",r[r.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",r[r.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",r[r.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",r[r.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",r[r.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",r[r.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",r[r.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",r[r.USER_ANALYTICS=1e4]="USER_ANALYTICS",r[r.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(CS||(CS={})),function(r){r.CREATE_CLIENT="createClient",r.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",r.SET_AREA="setArea",r.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",r.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",r.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",r.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",r.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",r.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",r.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",r.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",r.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",r.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",r.START_PROXY_SERVER="Client.startProxyServer",r.STOP_PROXY_SERVER="Client.stopProxyServer",r.SET_PROXY_SERVER="Client.setProxyServer",r.SET_TURN_SERVER="Client.setTurnServer",r.SET_CLIENT_ROLE="Client.setClientRole",r.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",r.ENABLE_DUAL_STREAM="Client.enableDualStream",r.DISABLE_DUAL_STREAM="Client.disableDualStream",r.JOIN="Client.join",r.LEAVE="Client.leave",r.PUBLISH="Client.publish",r.UNPUBLISH="Client.unpublish",r.SUBSCRIBE="Client.subscribe",r.MASS_SUBSCRIBE="Client.massSubscribe",r.MASS_UNSUBSCRIBE="Client.massUnsubscribe",r.UNSUBSCRIBE="Client.unsubscribe",r.RENEW_TOKEN="Client.renewToken",r.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",r.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",r.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",r.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",r.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",r.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",r.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",r.DATACHANNEL_FAILBACK="Client._datachannelFailback",r.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",r.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",r.START_LIVE_STREAMING="Client.startLiveStreaming",r.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",r.STOP_LIVE_STREAMING="Client.stopLiveStreaming",r.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",r.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",r.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",r.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",r.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",r.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",r.SET_CONFIG_DISTRIBUTE="_configDistribute",r.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",r.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",r.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",r.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",r.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",r.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",r.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",r.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",r.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",r.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",r.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",r.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",r.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",r.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",r.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",r.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",r.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",r.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",r.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",r.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",r.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",r.STREAM_TYPE_CHANGE="streamTypeChange",r.CONNECTION_STATE_CHANGE="connectionStateChange",r.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(dn||(dn={})),function(r){r.TRACER="tracer"}(Ht||(Ht={})),function(r){r.IDLE="IDLE",r.INITING="INITING",r.INITEND="INITEND"}(au||(au={})),function(r){r.STATE_CHANGE="state_change",r.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",r.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",r.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Qo||(Qo={})),function(r){r[r.ACCESS_POINT=101]="ACCESS_POINT",r[r.UNILBS=201]="UNILBS",r[r.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(kl||(kl={})),function(r){r[r.IIIEGAL_APPID=1]="IIIEGAL_APPID",r[r.IIIEGAL_UID=2]="IIIEGAL_UID",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Wh||(Wh={})),function(r){r[r.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",r[r.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",r[r.INTERNAL_ERROR=8]="INTERNAL_ERROR",r[r.NO_AUTHORIZED=9]="NO_AUTHORIZED",r[r.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",r[r.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",r[r.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",r[r.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",r[r.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",r[r.USER_OVERLOAD=16]="USER_OVERLOAD",r[r.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",r[r.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Ii||(Ii={})),function(r){r[r.NO_FLAG_SET=100]="NO_FLAG_SET",r[r.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",r[r.INVALID_FALG_SET=102]="INVALID_FALG_SET",r[r.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",r[r.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",r[r.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",r[r.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",r[r.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",r[r.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",r[r.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",r[r.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",r[r.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",r[r.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",r[r.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",r[r.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",r[r.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",r[r.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",r[r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",r[r.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Jn||(Jn={})),function(r){r[r.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",r[r.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",r[r.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",r[r.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",r[r.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",r[r.K_TICKET_INVALID=7]="K_TICKET_INVALID",r[r.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",r[r.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",r[r.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",r[r.K_UID_BANNED=14]="K_UID_BANNED",r[r.K_IP_BANNED=15]="K_IP_BANNED",r[r.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",r[r.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",r[r.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",r[r.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",r[r.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",r[r.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",r[r.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",r[r.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",r[r.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",r[r.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",r[r.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",r[r.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",r[r.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",r[r.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",r[r.ERR_INVALID_UID=117]="ERR_INVALID_UID",r[r.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",r[r.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",r[r.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",r[r.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",r[r.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",r[r.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",r[r.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",r[r.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",r[r.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",r[r.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",r[r.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",r[r.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",r[r.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",r[r.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",r[r.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",r[r.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",r[r.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",r[r.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",r[r.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",r[r.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",r[r.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",r[r.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",r[r.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",r[r.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",r[r.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",r[r.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",r[r.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",r[r.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",r[r.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",r[r.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",r[r.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",r[r.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",r[r.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",r[r.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",r[r.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",r[r.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",r[r.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Pe||(Pe={})),function(r){r[r.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",r[r.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",r[r.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(AS||(AS={})),function(r){r.LEAVE="LEAVE",r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.UID_BANNED="UID_BANNED",r.IP_BANNED="IP_BANNED",r.CHANNEL_BANNED="CHANNEL_BANNED",r.FALLBACK="FALLBACK",r.LICENSE_MISSING="LICENSE_MISSING",r.LICENSE_EXPIRED="LICENSE_EXPIRED",r.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",r.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",r.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",r.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(_t||(_t={})),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.MEDIA_RECONNECT_START="media-reconnect-start",r.MEDIA_RECONNECT_END="media-reconnect-end",r.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",r.USER_JOINED="user-joined",r.USER_LEAVED="user-left",r.USER_PUBLISHED="user-published",r.USER_UNPUBLISHED="user-unpublished",r.USER_INFO_UPDATED="user-info-updated",r.CLIENT_BANNED="client-banned",r.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",r.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",r.VOLUME_INDICATOR="volume-indicator",r.CRYPT_ERROR="crypt-error",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGED="stream-type-changed",r.STREAM_FALLBACK="stream-fallback",r.RECEIVE_METADATA="receive-metadata",r.STREAM_MESSAGE="stream-message",r.LIVE_STREAMING_ERROR="live-streaming-error",r.LIVE_STREAMING_WARNING="live-streaming-warning",r.INJECT_STREAM_STATUS="stream-inject-status",r.EXCEPTION="exception",r.ERROR="error",r.P2P_LOST="p2p_lost",r.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",r.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",r.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",r.PUBLISHED_USER_LIST="published-user-list",r.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",r.CONTENT_INSPECT_ERROR="content-inspect-error",r.CONTENT_INSPECT_RESULT="content-inspect-result"}(Ye||(Ye={})),function(r){r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED",r.FALLBACK="FALLBACK"}(kr||(kr={})),function(r){r.CONNECTING="connecting",r.CONNECTED="connected",r.RECONNECTING="reconnecting",r.CLOSED="closed"}(Tt||(Tt={})),function(r){r.WS_CONNECTED="ws_connected",r.WS_RECONNECTING="ws_reconnecting",r.WS_CLOSED="ws_closed",r.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",r.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",r.ON_BINARY_DATA="on_binary_data",r.REQUEST_RECOVER="request_recover",r.REQUEST_JOIN_INFO="request_join_info",r.REQUEST_REJOIN_INFO="req_rejoin_info",r.IS_P2P_DISCONNECTED="is_p2p_dis",r.DISCONNECT_P2P="dis_p2p",r.ABORT_P2P_EXECUTION="abort_p2p_execution",r.NEED_RENEW_SESSION="need-sid",r.REPORT_JOIN_GATEWAY="report_join_gateway",r.REQUEST_TIMEOUT="request_timeout",r.REQUEST_SUCCESS="request_success",r.JOIN_RESPONSE="join_response",r.DATACHANNEL_PRECONNECT="datachannel_preconnect",r.DATACHANNEL_CONNECTING="datachannel_connecting",r.DATACHANNEL_FAILBACK="datachannel_failback"}(Te||(Te={})),function(r){r.PING="ping",r.PING_BACK="ping_back",r.JOIN="join_v3",r.REJOIN="rejoin_v3",r.LEAVE="leave",r.SET_CLIENT_ROLE="set_client_role",r.PUBLISH="publish",r.UNPUBLISH="unpublish",r.SUBSCRIBE="subscribe",r.SUBSCRIBE_STREAMS="subscribe_streams",r.UNSUBSCRIBE="unsubscribe",r.UNSUBSCRIBE_STREAMS="unsubscribe_streams",r.SUBSCRIBE_CHANGE="subscribe_change",r.TRAFFIC_STATS="traffic_stats",r.RENEW_TOKEN="renew_token",r.SWITCH_VIDEO_STREAM="switch_video_stream",r.DEFAULT_VIDEO_STREAM="default_video_stream",r.SET_FALLBACK_OPTION="set_fallback_option",r.GATEWAY_INFO="gateway_info",r.CONTROL="control",r.SEND_METADATA="send_metadata",r.DATA_STREAM="data_stream",r.PICK_SVC_LAYER="pick_svc_layer",r.RESTART_ICE="restart_ice",r.CONNECT_PC="connect_pc",r.SET_VIDEO_PROFILE="set_video_profile",r.SET_PARAMETER="set_parameter"}(Le||(Le={})),function(r){r.PUBLISH_STATS="publish_stats",r.PUBLISH_RELATED_STATS="publish_related_stats",r.SUBSCRIBE_STATS="subscribe_stats",r.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",r.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",r.DENOISER_STATS="denoiser_stats",r.TRANSPORT_STATS="transport_stats",r.EXTENSION_USAGE_STATS="extension_usage_stats"}(zr||(zr={})),function(r){r.ON_USER_ONLINE="on_user_online",r.ON_USER_OFFLINE="on_user_offline",r.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",r.ON_PUBLISH_STREAM="on_publish_stream",r.ON_UPLINK_STATS="on_uplink_stats",r.ON_P2P_LOST="on_p2p_lost",r.ON_REMOVE_STREAM="on_remove_stream",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",r.ON_USER_BANNED="on_user_banned",r.ON_USER_LICENSE_BANNED="on_user_license_banned",r.ON_NOTIFICATION="on_notification",r.ON_CRYPT_ERROR="on_crypt_error",r.MUTE_AUDIO="mute_audio",r.MUTE_VIDEO="mute_video",r.UNMUTE_AUDIO="unmute_audio",r.UNMUTE_VIDEO="unmute_video",r.ON_P2P_OK="on_p2p_ok",r.RECEIVE_METADATA="receive_metadata",r.ON_DATA_STREAM="on_data_stream",r.ENABLE_LOCAL_VIDEO="enable_local_video",r.DISABLE_LOCAL_VIDEO="disable_local_video",r.ENABLE_LOCAL_AUDIO="enable_local_audio",r.DISABLE_LOCAL_AUDIO="disable_local_audio",r.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Ke||(Ke={})),function(r){r.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",r.NEED_ANSWER="NEED_ANSWER",r.NEED_RENEGOTIATE="NEED_RENEGOTIATE",r.P2P_LOST="P2P_LOST",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NEED_UNPUB="NEED_UNPUB",r.NEED_UNSUB="NEED_UNSUB",r.NEED_UPLOAD="NEED_UPLOAD",r.NEED_CONTROL="NEED_CONTROL",r.START_RECONNECT="START_RECONNECT",r.END_RECONNECT="END_RECONNECT",r.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(_k||(_k={})),function(r){r.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",r.RECEIVE_TRACK_BUFFER="receive_track_buffer",r.ON_AUDIO_BUFFER="on_audio_buffer",r.UPDATE_SOURCE="update_source"}(Yr||(Yr={}));const bS={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},OS={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Tk={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},XQ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Rk={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ge,hn,Ba;(function(r){r.CONNECTED="websocket:connected",r.RECONNECTING="websocket:reconnecting",r.WILL_RECONNECT="websocket:will_reconnect",r.CLOSED="websocket:closed",r.FAILED="websocket:failed",r.ON_MESSAGE="websocket:on_message",r.REQUEST_NEW_URLS="websocket:request_new_urls",r.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",r.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(Ge||(Ge={})),function(r){r.TRANSCODE="mix_streaming",r.RAW="raw_streaming",r.INJECT="inject_streaming"}(hn||(hn={})),function(r){r[r.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",r[r.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",r[r.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",r[r.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",r[r.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",r[r.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",r[r.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",r[r.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",r[r.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",r[r.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",r[r.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Ba||(Ba={}));const JQ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},NS={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function PS(r,i){zn(r.url,"".concat(i,".url"),1,1e3,!1),Ft(r.x)||Ot(r.x,"".concat(i,".x"),0,1e4),Ft(r.y)||Ot(r.y,"".concat(i,".y"),0,1e4),Ft(r.width)||Ot(r.width,"".concat(i,".width"),0,1e4),Ft(r.height)||Ot(r.height,"".concat(i,".height"),0,1e4),Ft(r.zOrder)||Ot(r.zOrder,"".concat(i,".zOrder"),0,255),Ft(r.alpha)||Ot(r.alpha,"".concat(i,".alpha"),0,1,!1)}const QQ={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},ZQ={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let _s,Ll,Xt,Ik,Rr,Ws,Lr,Ga,pn,Gt,on,xe,Mn,DS,kS,Wa,Ml,mt;function wk(r){if(!r.channelName)throw new j(V.INVALID_PARAMS,"invalid channelName in info");if(typeof r.uid!="number")throw new j(V.INVALID_PARAMS,"invalid uid in info, uid must be a number");return r.token&&zn(r.token,"info.token",1,2047),IS(r.uid),RS(r.channelName),!0}function Ck(r){return qn(r,"mediaSource",["screen","window","application"]),!0}(function(r){r.WARNING="@live_uap-warning",r.ERROR="@line_uap-error",r.PUBLISH_STREAM_STATUS="@live_uap-publish-status",r.INJECT_STREAM_STATUS="@live_uap-inject-status",r.WORKER_STATUS="@live_uap-worker-status",r.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(_s||(_s={})),function(r){r.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Ll||(Ll={})),function(r){r[r.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",r[r.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",r[r.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",r[r.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",r[r.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",r[r.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",r[r.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",r[r.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",r[r.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",r[r.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",r[r.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",r[r.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",r[r.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",r[r.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",r[r.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",r[r.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Xt||(Xt={})),function(r){r.CONNECT_FAILED="connect failed",r.CONNECT_TIMEOUT="connect timeout",r.WS_DISCONNECTED="websocket disconnected",r.REQUEST_TIMEOUT="request timeout",r.REQUEST_FAILED="request failed",r.WAIT_STATUS_TIMEOUT="wait status timeout",r.WAIT_STATUS_ERROR="wait status error",r.BAD_STATE="bad state",r.WS_ABORT="ws abort",r.AP_REQUEST_TIMEOUT="AP request timeout",r.AP_JSON_PARSE_ERROR="AP json parse error",r.AP_REQUEST_ERROR="AP request error",r.AP_REQUEST_ABORT="AP request abort"}(Ik||(Ik={})),function(r){r[r.SetSdkProfile=0]="SetSdkProfile",r[r.SetSourceChannel=1]="SetSourceChannel",r[r.SetSourceUserId=2]="SetSourceUserId",r[r.SetDestChannel=3]="SetDestChannel",r[r.StartPacketTransfer=4]="StartPacketTransfer",r[r.StopPacketTransfer=5]="StopPacketTransfer",r[r.UpdateDestChannel=6]="UpdateDestChannel",r[r.Reconnect=7]="Reconnect",r[r.SetVideoProfile=8]="SetVideoProfile"}(Rr||(Rr={})),function(r){r.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",r.NETWORK_CONNECTED="NETWORK_CONNECTED",r.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",r.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",r.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",r.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",r.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",r.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",r.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",r.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(Ws||(Ws={})),function(r){r.RELAY_STATE_IDLE="RELAY_STATE_IDLE",r.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",r.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",r.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Lr||(Lr={})),function(r){r.RELAY_OK="RELAY_OK",r.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",r.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",r.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Ga||(Ga={})),function(r){r.High="high",r.Low="low",r.Audio="audio",r.Screen="screen",r.ScreenLow="screen_low"}(pn||(pn={})),function(r){r.DISCONNECT="disconnect",r.CONNECTION_STATE_CHANGE="connection-state-change",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGE="stream-type-change",r.IS_P2P_DISCONNECTED="is-p2p-dis",r.DISCONNECT_P2P="dis-p2p",r.REQUEST_NEW_GATEWAY_LIST="req-gate-url",r.NEED_RENEW_SESSION="need-sid",r.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",r.JOIN_RESPONSE="join-response",r.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",r.RESET_CONNECTION_EVENTS="reset-connection-events",r.DATACHANNEL_PRECONNECT="datachannel_preconnect",r.DATACHANNEL_FAILBACK="datachannel_failback"}(Gt||(Gt={})),function(r){r[r.Nothing=0]="Nothing",r[r.Audio=1]="Audio",r[r.LwoVideo=2]="LwoVideo",r[r.Video=4]="Video",r[r.Data=8]="Data"}(on||(on={})),function(r){r.NEED_RENEGOTIATE="@need_renegotiate",r.NEED_REPLACE_TRACK="@need_replace_track",r.NEED_CLOSE="@need_close",r.NEED_ENABLE_TRACK="@need_enable_track",r.NEED_DISABLE_TRACK="@need_disable_track",r.NEED_SESSION_ID="@need_sid",r.SET_OPTIMIZATION_MODE="@set_optimization_mode",r.GET_STATS="@get_stats",r.GET_LOW_VIDEO_TRACK="@get_low_video_track",r.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",r.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",r.NEED_MUTE_TRACK="@need_mute_track",r.NEED_UNMUTE_TRACK="@need_unmute_track"}(xe||(xe={})),function(r){r.SCREEN_TRACK="screen_track",r.LOW_STREAM="low_stream"}(Mn||(Mn={})),function(r){r[r.HIGH_STREAM=0]="HIGH_STREAM",r[r.LOW_STREAM=1]="LOW_STREAM"}(DS||(DS={})),function(r){r[r.DISABLE=0]="DISABLE",r[r.LOW_STREAM=1]="LOW_STREAM",r[r.AUDIO_ONLY=2]="AUDIO_ONLY"}(kS||(kS={})),function(r){r.SOURCE_STATE_CHANGE="source-state-change",r.TRACK_ENDED="track-ended",r.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",r.CLOSED="closed"}(Wa||(Wa={})),function(r){r.FIRST_FRAME_DECODED="first-frame-decoded",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Ml||(Ml={})),function(r){r.CHINA="CHINA",r.ASIA="ASIA",r.NORTH_AMERICA="NORTH_AMERICA",r.EUROPE="EUROPE",r.JAPAN="JAPAN",r.INDIA="INDIA",r.KOREA="KOREA",r.HKMC="HKMC",r.US="US",r.OCEANIA="OCEANIA",r.SOUTH_AMERICA="SOUTH_AMERICA",r.AFRICA="AFRICA",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL"}(mt||(mt={}));const eZ=[mt.AFRICA,mt.ASIA,mt.CHINA,mt.EUROPE,mt.GLOBAL,mt.INDIA,mt.JAPAN,mt.NORTH_AMERICA,mt.OCEANIA,mt.OVERSEA,mt.SOUTH_AMERICA];let On;(function(r){r.CHINA="CN",r.ASIA="AS",r.NORTH_AMERICA="NA",r.EUROPE="EU",r.JAPAN="JP",r.INDIA="IN",r.KOREA="KR",r.HKMC="HK",r.US="US",r.OCEANIA="OC",r.SOUTH_AMERICA="SA",r.AFRICA="AF",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL"})(On||(On={}));const LS={CHINA:{},ASIA:{CODE:On.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:On.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:On.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:On.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:On.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:On.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:On.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:On.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:On.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:On.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:On.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:On.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:On.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};let $h,Ak,Be,ve,Qn,ot,hr,Ha,Zn,Xr,wi,Ci,fn,fo,zt;pS&&(LS.CHINA={CODE:On.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(r){r.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}($h||($h={}));class Ng extends Wt{constructor(i,s){super(),C(this,"onICEConnectionStateChange",void 0),C(this,"onConnectionStateChange",void 0),C(this,"onDTLSTransportStateChange",void 0),C(this,"onDTLSTransportError",void 0),C(this,"onICETransportStateChange",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoReceived",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0)}}(function(r){r.SEND="sendonly",r.RECV="recvonly",r.SENDRECV="sendrecv",r.INACTIVE="inactive"})(Ak||(Ak={})),function(r){r.VIDEO="video",r.AUDIO="audio"}(Be||(Be={})),function(r){r.LocalVideoTrack="videoTrack",r.LocalAudioTrack="audioTrack",r.LocalVideoLowTrack="videoLowTrack"}(ve||(ve={})),function(r){r.New="new",r.Connected="connected",r.Reconnecting="reconnecting",r.Disconnected="disconnected"}(Qn||(Qn={})),function(r){r.StateChange="stateChange",r.IceConnectionStateChange="iceConnectionStateChange",r.RequestMuteLocal="requestMuteLocal",r.RequestUnmuteLocal="requestUnmuteLocal",r.RequestRePublish="requestRePublish",r.RequestReSubscribe="requestReSubscribe",r.RequestUploadStats="requestUploadStats",r.MediaReconnectStart="MediaReconnectStart",r.MediaReconnectEnd="MediaReconnectEnd",r.NeedSignalRTT="NeedSignalRTT",r.RequestRestartICE="RequestRestartIce",r.PeerConnectionStateChange="PeerConnectionStateChange",r.RequestReconnect="RequestReconnect",r.RequestReconnectPC="RequestReconnectPC",r.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",r.P2PLost="P2PLost",r.UpdateVideoEncoder="UpdateVideoEncoder",r.ConnectionTypeChange="ConnectionTypeChange",r.RequestLowStreamParameter="RequestLowStreamParameter",r.QueryClientConnectionState="QueryClientConnectionState"}(ot||(ot={})),function(r){r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(hr||(hr={})),function(r){r.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(Ha||(Ha={})),function(r){r.ON_TRACK="on_track",r.ON_NODE="on_node"}(Zn||(Zn={})),function(r){r.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",r.REQUEST_CONSTRAINTS="request_constraints"}(Xr||(Xr={})),function(r){r.CONNECTING="CONNECTING",r.RECONNECTING="RECONNECTING",r.CONNECTED="CONNECTED",r.CLOSED="CLOSED"}(wi||(wi={})),function(r){r[r.CONNECT_AP=0]="CONNECT_AP",r[r.AP_CONNECTED=1]="AP_CONNECTED",r[r.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",r[r.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",r[r.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",r[r.CONNECT_WORKER=5]="CONNECT_WORKER",r[r.WORKER_CONNECTED=6]="WORKER_CONNECTED",r[r.CLOSED=7]="CLOSED"}(Ci||(Ci={})),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.STATE_CHANGE="state-change",r.INSPECT_RESULT="inspect-result",r.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",r.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(fn||(fn={})),function(r){r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED",r.FALLBACK="FALLBACK"}(fo||(fo={})),function(r){r.CONNECTED="transmitter:connected",r.RECONNECTING="transmitter:reconnecting",r.WILL_RECONNECT="transmitter:will_reconnect",r.CLOSED="transmitter:closed",r.FAILED="transmitter:failed",r.ON_MESSAGE="transmitter:on_message",r.REQUEST_NEW_URLS="transmitter:request_new_urls",r.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",r.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",r.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",r.FAILBACK="transmitter:failback"}(zt||(zt={}));const Mr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1};function er(){return Mr}let Tn;(function(r){r[r.CHOOSE_SERVER=11]="CHOOSE_SERVER",r[r.CLOUD_PROXY=18]="CLOUD_PROXY",r[r.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",r[r.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Tn||(Tn={}));var tZ=st,Kh=Array.isArray||function(r){return tZ(r)=="Array"},nZ=M,bk=Kh,rZ=ng,iZ=Fi,sZ=Ln("species"),Ok=nZ.Array,oZ=function(r){var i;return bk(r)&&(i=r.constructor,(rZ(i)&&(i===Ok||bk(i.prototype))||iZ(i)&&(i=i[sZ])===null)&&(i=void 0)),i===void 0?Ok:i},Nk=function(r,i){return new(oZ(r))(i===0?0:i)},aZ=La,cZ=ms,uZ=uo,lZ=Ho,dZ=Nk,Pk=w([].push),$a=function(r){var i=r==1,s=r==2,a=r==3,u=r==4,d=r==6,h=r==7,m=r==5||d;return function(g,p,E,v){for(var T,I,O=uZ(g),N=cZ(O),P=aZ(p,E),L=lZ(N),x=0,W=v||dZ,q=i?W(g,L):s||h?W(g,0):void 0;L>x;x++)if((m||x in N)&&(I=P(T=N[x],x,O),r))if(i)q[x]=I;else if(I)switch(r){case 3:return!0;case 5:return T;case 6:return x;case 2:Pk(q,T)}else switch(r){case 4:return!1;case 7:Pk(q,T)}return d?-1:a||u?u:q}},Dk={forEach:$a(0),map:$a(1),filter:$a(2),some:$a(3),every:$a(4),find:$a(5),findIndex:$a(6),filterReject:$a(7)},hZ=Dk.forEach,kk=Fy("forEach")?[].forEach:function(r){return hZ(this,r,arguments.length>1?arguments[1]:void 0)};lr({target:"Array",proto:!0,forced:[].forEach!=kk},{forEach:kk});var pZ=Ma("Array").forEach,fZ=$o,mZ=Pr,gZ=b,EZ=pZ,MS=Array.prototype,_Z={DOMTokenList:!0,NodeList:!0},vZ=function(r){var i=r.forEach;return r===MS||gZ(MS,r)&&i===MS.forEach||mZ(_Z,fZ(r))?EZ:i},yZ=uo,Lk=Gm;lr({target:"Object",stat:!0,forced:c(function(){Lk(1)})},{keys:function(r){return Lk(yZ(r))}});var SZ=Go.Object.keys,TZ=F2,RZ=lr,IZ=Kh,wZ=w([].reverse),Mk=[1,2];RZ({target:"Array",proto:!0,forced:String(Mk)===String(Mk.reverse())},{reverse:function(){return IZ(this)&&(this.length=this.length),wZ(this)}});var CZ=Ma("Array").reverse,AZ=b,bZ=CZ,xS=Array.prototype,OZ=function(r){var i=r.reverse;return r===xS||AZ(xS,r)&&i===xS.reverse?bZ:i},NZ=c,PZ=ul,DZ=Ln("species"),xk=function(r){return PZ>=51||!NZ(function(){var i=[];return(i.constructor={})[DZ]=function(){return{foo:1}},i[r](Boolean).foo!==1})},kZ=lr,LZ=M,Uk=Kh,MZ=ng,xZ=Fi,Vk=Hy,UZ=Ho,VZ=ka,FZ=Og,jZ=Ln,BZ=d0,GZ=xk("slice"),WZ=jZ("species"),US=LZ.Array,HZ=Math.max;kZ({target:"Array",proto:!0,forced:!GZ},{slice:function(r,i){var s,a,u,d=VZ(this),h=UZ(d),m=Vk(r,h),g=Vk(i===void 0?h:i,h);if(Uk(d)&&(s=d.constructor,(MZ(s)&&(s===US||Uk(s.prototype))||xZ(s)&&(s=s[WZ])===null)&&(s=void 0),s===US||s===void 0))return BZ(d,m,g);for(a=new(s===void 0?US:s)(HZ(g-m,0)),u=0;m<g;m++,u++)m in d&&FZ(a,u,d[m]);return a.length=u,a}});var $Z=Ma("Array").slice,KZ=b,qZ=$Z,VS=Array.prototype,zZ=function(r){var i=r.slice;return r===VS||KZ(VS,r)&&i===VS.slice?qZ:i};function ae(r,i,s,a,u){var d,h,m,g={};return vZ(d=SZ(a)).call(d,function(p){g[p]=a[p]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=TZ(h=OZ(m=zZ(s).call(s)).call(m)).call(h,function(p,E){return E(r,i,p)||p},g),u&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(u):void 0,g.initializer=void 0),g.initializer===void 0&&(AD(r,i,g),g=null),g}var YZ=Ma("Array").keys,XZ=$o,JZ=Pr,QZ=b,ZZ=YZ,FS=Array.prototype,eee={DOMTokenList:!0,NodeList:!0},cu=function(r){var i=r.keys;return r===FS||QZ(FS,r)&&i===FS.keys||JZ(eee,XZ(r))?ZZ:i};function Fk(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function jk(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Fk(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):Fk(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}let Pg=0,jS=0;function Hs(r,i,s,a){return new _e((u,d)=>{i.timeout=i.timeout||Q("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!s?(i.data=JSON.stringify(i.data),Pg+=jl(i.data)):s&&(i.data.size?Pg+=i.data.size:i.data instanceof FormData?Pg+=function(h){let m=0;return/DingTalk/i.test(navigator.userAgent)&&h.realFormData&&(h=h.realFormData),h.forEach(g=>{m+=typeof g=="string"?jl(g):g.size}),m+138}(i.data):Pg+=jl(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=r,gs.request(i).then(h=>{typeof h.data=="string"?jS+=jl(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?jS+=h.data.byteLength:jS+=jl(JSON.stringify(h.data)),a&&u({data:h.data,headers:h.headers}),u(h.data)}).catch(h=>{gs.isCancel(h)?d(new j(V.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new j(V.NETWORK_TIMEOUT,h.message)):h.response?d(new j(V.NETWORK_RESPONSE_ERROR,h.response.status)):d(new j(V.NETWORK_ERROR,h.message))})})}async function tee(r,i){const s=new Blob([i.data],{type:"buffer"});return await Hs(r,jk(jk({},i),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const an=new class extends Wt{set networkState(r){D.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+r),this.emit(Ha.NETWORK_STATE_CHANGE,r,this._networkState),r===hr.ONLINE?this.emit(Ha.ONLINE):r===hr.OFFLINE&&(this.onlineWaiter=new _e(i=>{this.once(Ha.ONLINE,()=>{this.onlineWaiter=void 0,i(hr.ONLINE)})}),this.emit(Ha.OFFLINE)),this._networkState=r}get networkState(){return this._networkState}constructor(){super(),C(this,"_moduleName","network-indicator"),C(this,"_networkState",hr.ONLINE),C(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=hr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=hr.OFFLINE})}};let BS=!1;const Ai=new class extends Wt{constructor(){super(...arguments),C(this,"onAutoplayFailed",void 0),C(this,"onAudioAutoplayFailed",void 0)}};function Bk(){if(bt(),!BS){const r=i=>{i.preventDefault(),BS=!1,Vh()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};BS=!0,Vh()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),D.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ai.onAutoplayFailed?Ai.onAutoplayFailed():Ai.onAudioAutoplayFailed?D.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):D.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ai.emit("autoplay-failed")}}function GS(r){return new TextEncoder().encode(r)}const Gk=function(r,i){const s=new Uint8Array(r.byteLength+i.byteLength);return s.set(new Uint8Array(r),0),s.set(new Uint8Array(i),r.byteLength),s},nee=async r=>function(i,s){let a="";return new Uint8Array(i).forEach(u=>{a+=u.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",GS(r)),16);function Wk(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function He(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Wk(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):Wk(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}function ke(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(i,s,a){const u=a.value;if(typeof u=="function"){const d=r.className||i.__className__||(i.constructor.name==="AgoraRTCClient"?"Client":i.constructor.name);a.value=function(){for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];let p=m;if(r.argsMap)try{p=r.argsMap(this,...m)}catch(v){D.warning(v),p=[]}try{JSON.stringify(p)}catch{D.warning("arguments for method ".concat(d,".").concat(s," not serializable for apiInvoke.")),p=[]}const E=(r.report||Ie).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(s),options:p,tag:Ht.TRACER,reportResult:r.reportResult},r.throttleTime);try{const v=u.apply(this,m);return v instanceof _e?v.then(T=>(E.onSuccess(r.reportResult&&T),T)).catch(T=>{throw E.onError(T),T}):(E.onSuccess(r.reportResult&&v),v)}catch(v){throw E.onError(v),v}}}return a}}const Ie=new class{constructor(){C(this,"baseInfoMap",new Map),C(this,"proxyServer",void 0),C(this,"clientList",Dl),C(this,"eventUploadTimer",void 0),C(this,"setSessionIdTimer",void 0),C(this,"url",void 0),C(this,"backupUrl",void 0),C(this,"_appId",void 0),C(this,"keyEventUploadPendingItems",[]),C(this,"normalEventUploadPendingItems",[]),C(this,"apiInvokeUploadPendingItems",[]),C(this,"apiInvokeCount",0),C(this,"ltsList",[]),C(this,"lastSendNormalEventTime",Date.now()),C(this,"customReportCounterTimer",void 0),C(this,"customReportCount",0),C(this,"extApiInvoke",async r=>{for(const i of r){const s=He(He({},i),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Ht.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Q("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Q("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(r){if(!this.baseInfoMap.has(r)&&!this.baseInfoMap.get(r))return void D.error("adjust session ".concat(r," start time, sid is not exist or info is undefined"));const i=this.baseInfoMap.get(r),s=Date.now(),a=i.startTime;i.startTime=s,D.debug("rewrite session ".concat(r," startTime: ").concat(s," , ").concat(s-a,"ms")),this.baseInfoMap.set(r,i)}setAppId(r){this._appId=r}reportApiInvoke(r,i,s){i.timeout=i.timeout||6e4,i.reportResult=i.reportResult===void 0||i.reportResult;const a=Date.now();this.apiInvokeCount+=1;const u=this.apiInvokeCount,d=()=>({tag:i.tag,invokeId:u,sid:r,name:i.name,apiInvokeTime:a,options:i.options,states:i.states||null}),h=!!Q("SHOW_REPORT_INVOKER_LOG");h&&D.info("".concat(i.name," start"),i.options);let m=!1;Bn(i.timeout).then(()=>{m||(this.sendApiInvoke(He(He({},d()),{},{error:V.API_INVOKE_TIMEOUT,success:!1})),D.debug("".concat(i.name," timeout")))});const g=new j(V.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:p=>{const E=()=>{if(m)throw g;return m=!0,this.sendApiInvoke(He(He({},d()),{},{success:!0},i.reportResult&&{result:p})),h&&D.info("".concat(i.name," onSuccess")),p};return s?eM(E,i.name+"Success",s,()=>m=!0):E()},onError:p=>{const E=()=>{if(m)throw p;m=!0,this.sendApiInvoke(He(He({},d()),{},{success:!1,error:p})),h&&D.info("".concat(i.name," onFailure"),p.toString())};return s?eM(E,i.name+"Error",s,()=>m=!0):E()}}}sessionInit(r,i){if(this.baseInfoMap.has(r))return;const s=Date.now(),a=this.createBaseInfo(r,s);a.cname=i.cname;const u=Object.assign({},{willUploadConsoleLog:Q("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:pS?"global":"oversea",areas:Q("AREAS")&&Q("AREAS").join(",")},i.extend),d=Date.now(),h=He(He({},a),{},{eventType:Xn.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,build:hS,lts:d,elapse:d-s,extend:JSON.stringify(u),mode:i.mode,process:Q("PROCESS_ID"),appType:Q("APP_TYPE"),success:!0,version:Hi});this.send({type:qt.SESSION,data:h},!0)}joinChooseServer(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He({},a),{},{eventType:Xn.JOIN_CHOOSE_SERVER,lts:u,eventElapse:u-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:u-s.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3});this.send({type:qt.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He({},a),{},{eventType:Xn.REQ_USER_ACCOUNT,lts:u,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:u-s.startTime,eventElapse:u-i.lts,extend:JSON.stringify(i.extend)});this.send({type:qt.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info;i.vid&&(a.vid=i.vid),a.uid=i.uid,a.cid=i.cid;const u=Date.now(),{firstSuccess:d,avoidJoinStartTime:h,isProxy:m,addr:g}=i,p=u-(d&&h?h:s.startTime),E=He(He({},a),{},{eventType:Xn.JOIN_GATEWAY,lts:u,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,elapse:p,eventElapse:u-i.lts,firstSuccess:d,signalChannel:i.signalChannel}),v=E.success?1:0;if(i.succ&&(s.lastJoinSuccessTime=u),d)this.send({type:qt.JOIN_GATEWAY,data:E},!0);else{let T;if(g)if(m){const O=g.match(/h=(\d{1,3}-){3}\d{1,3}/g),N=g.match(/p=[0-9]{1,6}/g);T={isSuccess:v,gatewayIp:O&&O.length?O[0].split("=")[1].replace(/-/g,"."):"",port:N&&N.length?N[0].split("=")[1]:"",isProxy:m?1:0}}else{const O=g.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),N=g.match(/:[0-9]{1,6}/g);T={isSuccess:v,gatewayIp:O&&O.length?O[0].split("//")[1].replace(/-/g,"."):"",port:N&&N.length?N[0].split(":")[1]:"",isProxy:m?1:0}}else T={isSuccess:v,gatewayIp:"",port:"",isProxy:m?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);const I=Object.assign({},E,T,{eventType:Xn.REJOIN_GATEWAY});this.send({type:qt.RE_JOIN_GATEWAY,data:I},!0)}}joinChannelTimeout(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=Date.now(),u=He(He({},s.info),{},{lts:a,timeout:i,elapse:a-s.startTime});this.send({type:qt.JOIN_CHANNEL_TIMEOUT,data:u},!0)}publish(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He({},a),{},{eventType:Xn.PUBLISH,lts:u,eventElapse:i.eventElapse,elapse:u-s.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:qt.PUBLISH,data:d},!0)}subscribe(r,i,s){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,d=Date.now(),h=He(He({},u),{},{eventType:Xn.SUBSCRIBE,lts:d,eventElapse:i.eventElapse,elapse:d-a.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof i.peerid=="string"?h.peerSuid=i.peerid:h.peer=i.peerid,this.send({type:qt.SUBSCRIBE,data:h},!0)}wsCompressorInit(r){var i;const s=[...cu(i=this.baseInfoMap).call(i)],a=s.length?s[0]:"UnableToGetSid",u=this.baseInfoMap.get(a);if(!u)return;const d=u.info,h=Date.now(),m=He(He({},d),{},{eventType:Xn.WS_COMPRESSOR_INIT,lts:h,eventElapse:r.eventElapse,elapse:h-u.startTime,status:r.status?1:2});this.send({type:qt.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(r,i,s,a){const u=this.baseInfoMap.get(r);if(!u)return;const d=u.info,h=Date.now(),m=He(He(He({},d),a),{},{elapse:h-u.startTime,eventType:i,lts:h,firstDecodeFrame:Math.max(h-u.startTime,0),apEnd:Math.max(a.apEnd-u.startTime,0),apStart:Math.max(a.apStart-u.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-u.startTime,0),joinGwStart:Math.max(a.joinGwStart-u.startTime,0),pcEnd:Math.max(a.pcEnd-u.startTime,0),pcStart:Math.max(a.pcStart-u.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-u.startTime,0),subscriberStart:Math.max(a.subscriberStart-u.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-u.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(r,i,s,a){const u=this.baseInfoMap.get(r);if(!u)return;const d=u.info,h=Date.now(),m=He(He(He({},d),a),{},{elapse:h-u.startTime,eventType:i,lts:h});this.send({type:s,data:m},!0)}onGatewayStream(r,i,s,a){const u=this.baseInfoMap.get(r);if(!u)return;const d=u.info,h=Date.now(),m=He(He(He({},d),a),{},{eventType:i,lts:h});this.send({type:s,data:m},!0)}streamSwitch(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He({},a),{},{eventType:Xn.STREAM_SWITCH,lts:u,isDual:i.isdual,elapse:u-s.startTime,success:i.succ});this.send({type:qt.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He({},a),{},{eventType:Xn.REQUEST_PROXY_APPCENTER,lts:u,eventElapse:u-i.lts,elapse:u-s.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:qt.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He({},a),{},{eventType:Xn.REQUEST_PROXY_WORKER_MANAGER,lts:u,eventElapse:u-i.lts,elapse:u-s.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:qt.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(r){this.proxyServer=r,r?D.debug("reportProxyServerurl: ".concat(r)):D.debug("disable reportProxyServerurl: ".concat(r))}peerPublishStatus(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He({},a),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:u,elapse:u-s.startTime,joinChannelSuccessElapse:u-(s.lastJoinSuccessTime||u),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:qt.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now();(function(d,h,m){const g=d[h];if(!g||typeof g!="string")return[d];d[h]="";const p=jl(JSON.stringify(d));let E=0;const v=[];let T=0;for(let I=0;I<g.length;I++)T+=g.charCodeAt(I)<=127?1:3,T<=m-p||(v[v.length]=du(du({},d),{},{[h]:g.substring(E,I)}),E=I,T=g.charCodeAt(I)<=127?1:3);return E!==g.length-1&&(v[v.length]=du(du({},d),{},{[h]:g.substring(E)})),v})(He(He(He({},a),i),{},{elapse:u-s.startTime,lts:u,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:qt.WORKER_EVENT,data:d},!0))}apworkerEvent(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He(He({},a),i),{},{elapse:u-s.startTime,lts:u});this.send({type:qt.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He(He({},a),i),{},{elapse:u-s.startTime,lts:u,extend:i.extend||void 0});this.send({type:qt.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const a=s.info,u=Date.now(),d=He(He(He({},a),i),{},{elapse:u-s.startTime,lts:u});this.send({type:qt.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(r,i){if(this.customReportCount+=i.length,this.customReportCount>Q("CUSTOM_REPORT_LIMIT"))throw new j(V.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=i.map(a=>({type:qt.USER_ANALYTICS,data:He({sid:r},a)}));try{Q("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(a){throw D.error("send custom report message failed",a.toString()),new j(V.CUSTOM_REPORT_SEND_FAILED,a.message)}}autoplayFailed(r,i,s,a){if(!r)return;const u=this.baseInfoMap.get(r);if(!u)return;const d=u.info,h=Date.now(),m=He(He({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-u.startTime,cbRegistered:Ai.onAutoplayFailed||Ai.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:i,trackId:a,extend:void 0});this.send({type:qt.AUTOPLAY_FAILED,data:m},!0)}sendApiInvoke(r){const i=Q("NOT_REPORT_EVENT");if(r.tag&&i.includes&&i.includes(r.tag))return!1;if(r.sid===null)return this.apiInvokeUploadPendingItems.push(r),!1;const s=this.baseInfoMap.get(r.sid);if(!s)return this.apiInvokeUploadPendingItems.push(r),!1;const{cname:a,uid:u,cid:d}=s.info;r.lts=r.lts||Date.now();let h;if(r.error)if(r.error instanceof j){const{code:g,message:p}=r.error;h=g||p||r.error.toString()}else h=r.error.toString();const m={invokeId:r.invokeId,sid:r.sid,cname:a,cid:d,uid:u,lts:r.lts,success:r.success,elapse:r.lts-s.startTime,execElapse:r.lts-r.apiInvokeTime,apiName:r.name,options:r.options?JSON.stringify(r.options):void 0,execStates:r.states?JSON.stringify(r.states):void 0,execResult:r.result?JSON.stringify(r.result):void 0,errorCode:r.error?h:void 0,errorMsg:r.error?JSON.stringify(r.error):void 0};return this.send({type:qt.API_INVOKE,data:m},!1),!0}appendSessionId(){this.clientList.forEach(r=>{if(r._sessionId){const i=this.apiInvokeUploadPendingItems.length;for(let s=0;s<i;s++){const a=this.apiInvokeUploadPendingItems.shift();a&&(a.sid=r._sessionId,this.sendApiInvoke(Object.assign({},a)))}}})}send(r,i){if(i)return this.keyEventUploadPendingItems.push(r),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(r),this.normalEventUploadPendingItems.length>Q("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(r,i){const s=[],a=[];for(;r.length;){const d=r.shift();s.length<20?s.push(d):a.push(d)}r.push(...a);for(const d of[...s]){var u;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),SS(u=this.ltsList).call(u,(h,m)=>h-m))}return i||(this.lastSendNormalEventTime=Date.now()),Q("ENABLE_EVENT_REPORT")&&s.length&&(Q("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{Q("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>Q("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Q("NORMAL_EVENT_QUEUE_CAPACITY")),D.warning("report: drop normal events"))))})(s)),r}async postDataToStatsCollector2(r){an.networkState===hr.OFFLINE&&await _e.race([an.onlineWaiter,Bn(2*vn.maxRetryTimeout)]);const i=u=>{let d=new Uint8Array;return u.forEach(h=>{const m=GS(JSON.stringify(h.data)),g=new ArrayBuffer(5),p=(v=>{let T=0;return Object.entries(qt).forEach(I=>{let[O,N]=I;N===v.type&&(T=CS[O])}),T})(h),E=new DataView(g);E.setUint16(0,m.byteLength,!0),E.setUint8(2,255&p),E.setUint8(3,p>>>8&255),E.setUint8(4,p>>>16&255),d=Gk(d,new Uint8Array(g)),d=Gk(d,m)}),d},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(Q("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let u=0;u<2;u+=1){u===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(Q("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await Hs(a,{timeout:1e4,data:i(r),headers:He(He({token:"32f24ab2ddb74f508aa9286c356cec84",biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(u===1)throw d;continue}return}}async postDataToStatsCollector(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:r.map(d=>JSON.stringify(d)),vid:(d=>{const h=d&&d.data.sid&&this.baseInfoMap.get(d.data.sid);return h&&h.info.vid&&+h.info.vid||0})(r[0])};an.networkState===hr.OFFLINE&&await _e.race([an.onlineWaiter,Bn(2*vn.maxRetryTimeout)]);const a=i?"/events/proto-raws":"/events/messages";let u=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("EVENT_REPORT_DOMAIN"),"&p=").concat(Q("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(Q("EVENT_REPORT_DOMAIN"),":").concat(Q("STATS_COLLECTOR_PORT")).concat(a));for(let d=0;d<2;d+=1){d===1&&(u=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Q("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Q("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(Q("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Q("STATS_COLLECTOR_PORT")).concat(a)));try{i?await tee(u,{timeout:1e4,data:s}):await Hs(u,{timeout:1e4,data:s})}catch(h){if(d===1)throw h;continue}return}}createBaseInfo(r,i){const s=Object.assign({},zQ);return s.sid=r,this.baseInfoMap.set(r,{info:s,startTime:i}),s}reportResourceTiming(r,i){const s=performance.getEntriesByName(r),a=s[s.length-1];a&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:a,tag:Ht.TRACER}).onSuccess()}};wg.on("REPORT_LOG_UPLOAD",r=>{r.networkState=an.networkState,Ie.reportApiInvoke(null,{name:"logUploadError",options:r,tag:Ht.TRACER})});class Hk extends Wt{constructor(i,s){super(),C(this,"trackMediaType",void 0),C(this,"_ID",void 0),C(this,"_hints",[]),C(this,"_isClosed",!1),C(this,"_originMediaStreamTrack",void 0),C(this,"_mediaStreamTrack",void 0),C(this,"_external",{}),this._ID=s||$t(8,"track-"),this._originMediaStreamTrack=i,this._mediaStreamTrack=i,function(a){Bh.includes(a)||Bh.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){if(!i){const s=Ie.reportApiInvoke(null,{name:dn.GET_MEDIA_STREAM_TRACK,options:[],tag:Ht.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?s.onSuccess(this._mediaStreamTrack.label):s.onSuccess("")}return this._mediaStreamTrack}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,function(i){const s=Bh.indexOf(i);s!==-1&&Bh.splice(s,1)}(this),this.emit(Wa.CLOSED)}}let Rn,ree=1;class Ir{constructor(i){C(this,"lockingPromise",_e.resolve()),C(this,"locks",0),C(this,"name",""),C(this,"lockId",void 0),this.lockId=ree++,i&&(this.name=i),D.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(i){let s;this.locks+=1,D.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof i=="string"?i:""));const a=new _e(d=>{s=()=>{this.locks-=1,D.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof i=="string"?i:"")),d()}}),u=this.lockingPromise.then(()=>s);return this.lockingPromise=this.lockingPromise.then(()=>a),u}}function xl(r,i){return function(s,a,u){const d=u.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return u.value=async function(){const h=this[i];if(!h)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(r));const m=await h.lock("From ".concat(r,".").concat(a));try{for(var g=arguments.length,p=new Array(g),E=0;E<g;E++)p[E]=arguments[E];return await d.apply(this,p)}finally{m()}},u}}class WS extends Hk{get muted(){return this._muted}get enabled(){return this._enabled}constructor(i,s){super(i,s),C(this,"_enabled",!0),C(this,"_muted",!1),C(this,"_isClosed",!1),C(this,"_enabledMutex",void 0),C(this,"processor",void 0),C(this,"processorContext",void 0),C(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ir("".concat(s)),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){return this._originMediaStreamTrack.label}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,D.debug("[".concat(this.getTrackId(),"] close")),this.emit(xe.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(i,s){i!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),i.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=i,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){D.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(Wa.TRACK_ENDED)}stateCheck(i,s){if(D.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(s,"]")),Gh(s,i),this._enabled&&this._muted&&i==="enabled"&&s===!1)throw new j(V.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&i==="muted"&&s===!0)throw new j(V.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function $k(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}(function(r){r.IOS_15_INTERRUPTION_START="ios15-interruption-start",r.IOS_15_INTERRUPTION_END="ios15-interruption-end",r.IOS_INTERRUPTION_START="ios-interruption-start",r.IOS_INTERRUPTION_END="ios-interruption-end",r.STATE_CHANGE="state-change"})(Rn||(Rn={}));const Kk=window.AudioContext||window.webkitAudioContext;let $i=null;const Ze=new class extends Wt{constructor(){super(...arguments),C(this,"prevState",void 0),C(this,"curState",void 0),C(this,"currentTime",void 0),C(this,"currentTimeStuckAt",void 0),C(this,"interruptDetectorTrack",void 0),C(this,"onLocalAudioTrackMute",()=>{D.info("ios15-interruption-start"),this.emit(Rn.IOS_15_INTERRUPTION_START)}),C(this,"onLocalAudioTrackUnmute",async()=>{D.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?D.info("ios15-interruption-end-canceled"):($i&&await $i.suspend(),this.emit(Rn.IOS_15_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(r){D.debug("webaudio bindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=r,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(r){D.debug("webaudio unbindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===r&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function iee(){if(!Kk)return void D.error("your browser is not support web audio");D.info("create audio context");const r=function(i){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?$k(Object(a),!0).forEach(function(u){C(i,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):$k(Object(a)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(a,u))})}return i}({},Q("WEBAUDIO_INIT_OPTIONS"));D.debug("audio context init option:",JSON.stringify(r)),$i=new Kk(r),Ze.curState=$i.state,$i.onstatechange=()=>{Ze.prevState=Ze.curState,Ze.curState=$i?$i.state:void 0,(dr()||Yo())&&Ze.prevState==="running"&&Ze.curState==="interrupted"&&(D.info("ios-interruption-start"),Ze.emit(Rn.IOS_INTERRUPTION_START)),(dr()||Yo())&&Ze.prevState==="interrupted"&&Ze.curState==="running"&&(D.info("ios-interruption-end"),Ze.emit(Rn.IOS_INTERRUPTION_END)),Ze.prevState!==Ze.curState&&(D.debug("AudioContext State Change","".concat(Ze.prevState,"=>").concat(Ze.curState)),Ze.emit(Rn.STATE_CHANGE))},setInterval(()=>{var i;const s=(i=$i)===null||i===void 0?void 0:i.currentTime;Ze.currentTime!==s?(Ze.currentTimeStuckAt&&(D.debug("AudioContext current time resume at ".concat(s)),Ze.currentTimeStuckAt=void 0),Ze.currentTime=s):(s!==Ze.currentTimeStuckAt&&(Ie.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Ht.TRACER}).onSuccess(),D.warning("AudioContext current time stuck at ".concat(s))),Ze.currentTimeStuckAt=s)},5e3),async function(i){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,u=!1,d=!1,h=!1;function m(P){i.state==="running"?g(!1):dr()||Yo()?i.state==="suspended"&&(g(!0),P&&i.resume().then(E,E)):i.state!=="closed"&&(g(!0),P&&i.resume().then(E,E))}function g(P){if(u!==P){u=P;for(let L=0,x=s;L<x.length;L+=1){const W=x[L];P?window.addEventListener(W,v,{capture:!0,passive:!0}):window.removeEventListener(W,v,{capture:!0,passive:!0})}}}function p(){m(!0)}function E(){m(!1)}function v(){m(!0)}function T(P){if(!h)if(a.paused)if(P){I(!1),h=!0;let L;try{L=a.play(),L?L.then(O,O):(a.addEventListener("playing",O),a.addEventListener("abort",O),a.addEventListener("error",O))}catch{O()}}else I(!0);else I(!1)}function I(P){if(d!==P){d=P;for(let L=0,x=s;L<x.length;L++){const W=x[L];P?window.addEventListener(W,N,{capture:!0,passive:!0}):window.removeEventListener(W,N,{capture:!0,passive:!0})}}}function O(){a.removeEventListener("playing",O),a.removeEventListener("abort",O),a.removeEventListener("error",O),h=!1,T(!1)}function N(){T(!0)}if(dr()){const P=i.createMediaStreamDestination(),L=document.createElement("div");L.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=L.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=P.stream,T(!0)}Ze.on(Rn.STATE_CHANGE,p),m(!1)}($i)}function Ul(){if(!$i){if(iee(),!$i)throw new j(V.NOT_SUPPORTED,"can not create audio context");return $i}return $i}function uu(r){if(function(){if(HS!==null)return HS;const a=Ul(),u=a.createBufferSource(),d=a.createGain(),h=a.createGain();u.connect(d),u.connect(h),u.disconnect(d);let m=!1;try{u.disconnect(d)}catch{m=!0}return u.disconnect(),HS=m,m}())return;const i=r.connect,s=r.disconnect;r.connect=(a,u,d)=>(r._inputNodes||(r._inputNodes=[]),r._inputNodes.includes(a)||(a instanceof AudioNode?(r._inputNodes.push(a),i.call(r,a,u,d)):i.call(r,a,u)),r),r.disconnect=(a,u,d)=>{s.call(r),a?JS(r._inputNodes,a):r._inputNodes=[];for(const h of r._inputNodes)i.call(r,h)}}let HS=null;function $S(r,i){let s=!1;const a=1/i;if(Q("DISABLE_WEBAUDIO")){const u=window.setInterval(()=>{s?window.clearInterval(u):r(performance.now()/1e3)},1e3*a)}else{const u=Ul();let d=u.createGain();d.gain.value=0,d.connect(u.destination);const h=()=>{if(s)return void(d=null);const m=u.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(u.currentTime+a),r(u.currentTime)};h()}return()=>{s=!0}}const Ka=D.prefix("[inject-node]");class see{constructor(){C(this,"nodeLists",[]),C(this,"prevNode",void 0),C(this,"nextNode",void 0)}get firstNode(){return this.nodeLists[0]}get lastNode(){return this.nodeLists[this.nodeLists.length-1]}get isActive(){return!!this.nodeLists.length}get isConnected(){return!(!this.prevNode||!this.nextNode)}connect(i,s){Ka.debug("connect audio node, current list:"+this.nodeLists.length),this.nodeLists.length?(this.prevNode&&this.prevNode.disconnect(),i.connect(this.firstNode),this.nextNode&&this.lastNode&&this.lastNode.disconnect(),this.lastNode.connect(s),this.nodeLists.forEach((a,u)=>{const d=this.nodeLists[u+1];d&&a.connect(d)})):i.connect(s),this.nextNode=s,this.prevNode=i}disconnect(){var i;Ka.debug("disconnect audio node, current list:"+this.nodeLists.length),this.nodeLists.forEach(s=>{s.disconnect()}),(i=this.prevNode)===null||i===void 0||i.disconnect(),this.prevNode=void 0,this.nextNode=void 0}addNode(i){Ka.debug("add node in inject node, current list:",this.nodeLists.length),this.prevNode&&this.nextNode?(this.firstNode||(Ka.debug("new node is the first node"),this.prevNode.disconnect(),this.prevNode.connect(i),i.connect(this.nextNode)),this.nextNode&&this.lastNode&&(this.lastNode.disconnect(this.nextNode),this.lastNode.connect(i),i.connect(this.nextNode)),this.nodeLists.push(i)):Ka.debug("add node is called before inject node connected")}removeNode(i){Ka.debug("remove node in inject node, current list:",this.nodeLists.length);const s=this.nodeLists.indexOf(i);if(s===-1)return void Ka.debug("$[inject-node] cannot find the node to be removed");const a=this.nodeLists[s+1],u=this.nodeLists[s-1];s===0&&this.prevNode&&this.nextNode&&(this.prevNode.disconnect(i),a?this.prevNode.connect(a):this.prevNode.connect(this.nextNode)),s===this.nodeLists.length-1&&this.nextNode&&u&&(u.disconnect(i),u.connect(this.nextNode)),s!==0&&s!==this.nodeLists.length-1&&(u.disconnect(i),u.connect(a)),Ka.debug("remove node in inject node success, current list:",this.nodeLists.length)}}class qk{constructor(){C(this,"context",void 0),C(this,"analyserNode",void 0),C(this,"sourceNode",void 0),this.context=Ul(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i==null||i.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||dr()||Yo()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let u=0;u<i.length;++u)i[u]=a[u]/128-1}const s=xa(i).call(i,(a,u)=>a+u*u,0)/i.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,s;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{D.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class zk extends Wt{get processSourceNode(){return this.sourceNode}set processedNode(i){var s;if(!this.isDestroyed&&this._processedNode!==i){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),C(this,"outputNode",void 0),C(this,"outputTrack",void 0),C(this,"isPlayed",!1),C(this,"sourceNode",void 0),C(this,"context",void 0),C(this,"audioBufferNode",void 0),C(this,"destNode",void 0),C(this,"injectNode",void 0),C(this,"audioOutputLevel",0),C(this,"volumeLevelAnalyser",void 0),C(this,"_processedNode",void 0),C(this,"playNode",void 0),C(this,"isDestroyed",!1),C(this,"onNoAudioInput",void 0),C(this,"isNoAudioInput",!1),C(this,"_noAudioInputCount",0),this.context=Ul(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),uu(this.outputNode),this.injectNode=new see,this.volumeLevelAnalyser=new qk}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Yr.ON_AUDIO_BUFFER,function(a){for(let u=0;u<a.outputBuffer.numberOfChannels;u+=1){const d=a.outputBuffer.getChannelData(u);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!er().webAudioMediaStreamDest)throw new j(V.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){this.context.state!=="running"&&ys(()=>{Ze.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(i>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;dr()||Yo()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let u=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(u=!0);return u?(this.isNoAudioInput=!1,!0):(await Bn(200),await this.checkHasAudioInput(i?i+1:1)&&u)}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}injectAudioNode(i){this.injectNode.addNode(i)}removeAudioNode(i){this.injectNode.removeNode(i)}disconnect(){var i,s;(i=this.processedNode)===null||i===void 0||i.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?(i=this.processedNode)===null||i===void 0||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Yk extends zk{get isFreeze(){return!1}constructor(i,s,a){var u;if(super(),C(this,"sourceNode",void 0),C(this,"track",void 0),C(this,"clonedTrack",void 0),C(this,"audioElement",void 0),C(this,"isCurrentTrackCloned",!1),C(this,"isRemoteTrack",!1),C(this,"originVolumeLevelAnalyser",void 0),C(this,"rebuildWebAudio",async()=>{if(D.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void D.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>D.info("resume success")),D.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),uu(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),uu(this.outputNode),this.emit(Yr.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),i.kind!=="audio")throw new j(V.UNEXPECTED_ERROR);this.track=i;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),uu(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,D.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));uu(g),this.originVolumeLevelAnalyser=new qk,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=bt();s&&h.os===Kn.IOS&&Number((u=h.osVersion)===null||u===void 0?void 0:u.split(".")[0])<15&&(Ze.on(Rn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const s=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(s),uu(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Yr.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),Ze.off("state-change",this.rebuildWebAudio),(i=this.originVolumeLevelAnalyser)===null||i===void 0||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const s=i.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),D.debug("create an unmuted track ".concat(s.id," from the original track ").concat(i.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));uu(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Xk(r,i){const s=(u,d)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||d:u:d,a={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxHeight:s(i.height,1080),maxWidth:s(i.width,1920)}}};return i.frameRate&&typeof i.frameRate!="number"?(a.video.mandatory.maxFrameRate=i.frameRate.max,a.video.mandatory.minFrameRate=i.frameRate.min):typeof i.frameRate=="number"&&(a.video.mandatory.maxFrameRate=i.frameRate),await navigator.mediaDevices.getUserMedia(a)}async function oee(r){const i=await Jk(r.mediaSource),s=await function(a){return new _e((u,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const g=document.createElement("div");g.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",g.setAttribute("style","height: 12%;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const E=document.createElement("div");E.setAttribute("style","text-align: right; padding: 16px 0;");const v=document.createElement("button");v.innerHTML="cancel",v.setAttribute("style","width: 85px;"),v.onclick=()=>{document.body.removeChild(T);const I=new Error("NotAllowedError");I.name="NotAllowedError",d(I)},E.appendChild(v),m.appendChild(g),m.appendChild(p),m.appendChild(E);const T=document.createElement("div");T.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),T.appendChild(h),T.appendChild(m),document.body.appendChild(T),a.map(I=>{if(I.id){const O=document.createElement("div");O.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let N=I.thumbnail;const{width:P}=N.getSize();P>1920&&(N=N.resize({width:1920})),O.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+N.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(I.name.replace(/[\u00A0-\u9999<>\&]/g,function(L){return"&#"+L.charCodeAt(0)+";"})+"</span>"),O.onclick=()=>{document.body.removeChild(T),u(I.id)},p.appendChild(O)}})})}(i);return await Xk(s,r)}async function Jk(r){let i=["window","screen"];r!=="application"&&r!=="window"||(i=["window"]),r==="screen"&&(i=["screen"]);const s=Qk();if(!s)throw new j(V.ELECTRON_IS_NULL);let a=null;try{var u;a=((u=s.desktopCapturer)===null||u===void 0?void 0:u.getSources({types:i}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{a=null}a&&a.then||(a=new _e((d,h)=>{s.desktopCapturer.getSources({types:i},(m,g)=>{m?h(m):d(g)})}));try{return await a}catch(d){throw new j(V.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}let Dg=null;function Qk(){if(Dg)return Dg;try{return Dg=window.require("electron"),Dg}catch{return null}}const KS=new Ir("safari");let Zk=!1,eL=!1;async function vs(r,i){let s=0,a=null;for(;s<2;)try{a=await aee(r,i,s>0);break}catch(u){if(u instanceof j)throw D.error("[".concat(i,"] ").concat(u.toString())),u;const d=kg(u.name||u.code||u,u.message);if(d.code===V.MEDIA_OPTION_INVALID){D.debug("[".concat(i,"] detect media option invalid, retry")),s+=1,await Bn(500);continue}throw D.error("[".concat(i,"] ").concat(d.toString())),d}if(!a)throw new j(V.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function aee(r,i,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new j(V.NOT_SUPPORTED,"can not find getUserMedia");s&&(r.video&&(delete r.video.width,delete r.video.height),r.screen&&(delete r.screen.width,delete r.screen.height));const a=er(),u=new MediaStream;if(r.audioSource&&u.addTrack(r.audioSource),r.videoSource&&u.addTrack(r.videoSource),!r.audio&&!r.video&&!r.screen)return D.debug("Using Video Source/ Audio Source"),u;if(r.screen)if(Qk())r.screen.sourceId?Vl(u,await Xk(r.screen.sourceId,r.screen)):Vl(u,await oee(r.screen));else if(K0()&&r.screen.extensionId&&r.screen.mandatory){if(!a.getStreamFromExtension)throw new j(V.NOT_SUPPORTED,"This browser does not support screen sharing");D.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const v=await(d=r.screen.extensionId,h=i,new _e((T,I)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},O=>{if(!O||!O.streamId)return D.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),O),void I(new j(V.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(O.streamId)})}catch(O){D.error("[".concat(h,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),O.toString()),I(new j(V.CHROME_PLUGIN_NOT_INSTALL))}}));r.screen.mandatory.chromeMediaSourceId=v,Vl(u,await navigator.mediaDevices.getUserMedia({video:{mandatory:r.screen.mandatory}}))}else if(a.getDisplayMedia){r.screen.mediaSource&&Ck(r.screen.mediaSource);const v={width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate,displaySurface:r.screen.mediaSource==="screen"?"monitor":r.screen.mediaSource};D.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:v,audio:!!r.screenAudio})),Vl(u,await navigator.mediaDevices.getDisplayMedia({video:v,audio:!!r.screenAudio}))}else{if(!tn())throw D.error("[".concat(i,"] This browser does not support screenSharing")),new j(V.NOT_SUPPORTED,"This browser does not support screen sharing");{r.screen.mediaSource&&Ck(r.screen.mediaSource);const v={video:{mediaSource:r.screen.mediaSource,width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate}};D.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(v))),Vl(u,await navigator.mediaDevices.getUserMedia(v))}}var d,h;if(!r.video&&!r.audio)return u;let m={video:r.video,audio:r.audio},g=Q("MEDIA_DEVICE_CONSTRAINTS");if(g)try{typeof g=="string"&&(g=JSON.parse(g)),m=function v(T,I){if(!tM(T)||!tM(I)||Array.isArray(T)&&!Array.isArray(I)||!Array.isArray(T)&&Array.isArray(I))return I;if(Array.isArray(I)&&Array.isArray(T)){const O=[...T];for(let N=0;N<I.length;N++)O[N]=v(T[N],I[N]);return O}{const O=du({},T);for(const N in I)Object.prototype.hasOwnProperty.call(I,N)&&(Object.prototype.hasOwnProperty.call(T,N)?O[N]=v(T[N],I[N]):O[N]=I[N]);return O}}(m,g)}catch{}D.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(m)),bt();let p,E=null;(Kr()||dr()||gg())&&(E=await KS.lock());try{p=await navigator.mediaDevices.getUserMedia(m)}catch(v){throw E&&E(),v}return m.audio&&(Zk=!0),m.video&&(eL=!0),Vl(u,p),E&&E(),u}function kg(r,i){switch(r){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new j(V.MEDIA_OPTION_INVALID,"".concat(r,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new j(V.DEVICE_NOT_FOUND,"".concat(r,": ").concat(i));case"NotSupportedError":return new j(V.NOT_SUPPORTED,"".concat(r,": ").concat(i));case"NotReadableError":return new j(V.NOT_READABLE,"".concat(r,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new j(V.PERMISSION_DENIED,"".concat(r,": ").concat(i));case"ConstraintNotSatisfiedError":return new j(V.CONSTRAINT_NOT_SATISFIED,"".concat(r,": ").concat(i));default:return D.error("getUserMedia unexpected error",r),new j(V.UNEXPECTED_ERROR,"".concat(r,": ").concat(i))}}function Vl(r,i){const s=r.getVideoTracks()[0],a=r.getAudioTracks()[0],u=i.getVideoTracks()[0],d=i.getAudioTracks()[0];d&&(a&&r.removeTrack(a),r.addTrack(d)),u&&(s&&r.removeTrack(s),r.addTrack(u))}const hi=new class extends Wt{get state(){return this._state}set state(r){r!==this._state&&(this.emit(Qo.STATE_CHANGE,r),this._state=r)}constructor(){super(),C(this,"_state",au.IDLE),C(this,"isAccessMicrophonePermission",!1),C(this,"isAccessCameraPermission",!1),C(this,"lastAccessMicrophonePermission",!1),C(this,"lastAccessCameraPermission",!1),C(this,"checkdeviceMatched",!1),C(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Q("ENUMERATE_DEVICES_INTERVAL")||z0()&&su())&&this.updateDevicesInfo()},Q("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(r=>D.error(r.toString()))}async enumerateDevices(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new j(V.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),u=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&r,h=!this.isAccessCameraPermission&&i;u.audio&&(d=!1),u.video&&(h=!1);let m=null,g=null,p=null;if(!s&&(d||h)){if(KS.isLocked&&(D.debug("[device manager] wait GUM lock"),(await KS.lock())(),D.debug("[device manager] GUM unlock")),Zk&&(d=!1,this.isAccessMicrophonePermission=!0),eL&&(h=!1,this.isAccessCameraPermission=!0),D.debug("[device manager] check media device permissions",r,i,d,h),d&&h){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(E){const v=kg(E.name||E.code||E,E.message);if(v.code===V.PERMISSION_DENIED)throw v;D.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:r})}catch(E){const v=kg(E.name||E.code||E,E.message);if(v.code===V.PERMISSION_DENIED)throw v;D.warning("getUserMedia failed in getDevices",v)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:i})}catch(E){const v=kg(E.name||E.code||E,E.message);if(v.code===V.PERMISSION_DENIED)throw v;D.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0}D.debug("[device manager] mic permission",r,"cam permission",i)}try{const E=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(v=>v.stop()),g&&g.getTracks().forEach(v=>v.stop()),p&&p.getTracks().forEach(v=>v.stop()),m=null,g=null,p=null,E}catch(E){return m&&m.getTracks().forEach(v=>v.stop()),g&&g.getTracks().forEach(v=>v.stop()),p&&p.getTracks().forEach(v=>v.stop()),m=null,g=null,p=null,new j(V.ENUMERATE_DEVICES_FAILED,E.toString()).throw()}}async getRecordingDevices(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,r)).filter(i=>i.kind==="audioinput")}async getCamerasDevices(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,r)).filter(i=>i.kind==="videoinput")}async getSpeakers(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,r)).filter(i=>i.kind==="audiooutput")}searchDeviceIdByName(r){let i=null;return this.deviceInfoMap.forEach(s=>{s.device.label===r&&(i=s.device.deviceId)}),i}async getDeviceById(r){const i=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===r);if(!i)throw new j(V.DEVICE_NOT_FOUND,"deviceId: ".concat(r));return i}async init(){this.state=au.INITING;try{await this.updateDevicesInfo(),this.state=au.INITEND}catch(r){throw D.warning("Device Detection functionality cannot start properly.",r.toString()),this.state=au.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new j(V.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),r}}async updateDevicesInfo(){const r=await this.enumerateDevices(!0,!0,!0),i=Date.now(),s=[];if(r[0]&&r[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const u=r.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=r.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");u&&d?d.groupId===u.groupId?D.debug("[device-check] default input ".concat(u.label," and output ").concat(d.label," is the same group")):D.warning("[device-check] default input ".concat(u.label," and output ").concat(d.label," is not the same group")):D.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(r);if(r.forEach(u=>{if(!u.deviceId)return;const d=this.deviceInfoMap.get("".concat(u.kind,"_").concat(u.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:i,updateAt:i,device:u,state:"ACTIVE"};this.deviceInfoMap.set("".concat(u.kind,"_").concat(u.deviceId),h),s.push(h)}d&&(d.updateAt=i)}),this.deviceInfoMap.forEach((u,d)=>{u.state==="ACTIVE"&&u.updateAt!==i&&(u.state="INACTIVE",s.push(u))}),this.state!==au.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(u=>{switch(u.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Qo.RECORDING_DEVICE_CHANGED,u);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Qo.CAMERA_DEVICE_CHANGED,u);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Qo.PLAYOUT_DEVICE_CHANGED,u)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(r){const i=r.filter(u=>u.kind==="audioinput"),s=r.filter(u=>u.kind==="videoinput"),a={audio:!1,video:!1};for(const u of i)if(u.label&&u.deviceId){a.audio=!0;break}for(const u of s)if(u.label&&u.deviceId){a.video=!0;break}return a}},cee=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],pi=new class{constructor(){C(this,"onAutoplayFailed",void 0),C(this,"elementMap",new Map),C(this,"elementStateMap",new Map),C(this,"elementsNeedToResume",[]),C(this,"sinkIdMap",new Map),C(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,s]=r;const a=this.elementStateMap.get(i),u=s.srcObject.getAudioTracks()[0];Rl()?u&&u.readyState==="live"&&Ze.curState==="running"&&(D.debug("auto resume after interruption for iOS 15"),s.pause(),s.play()):a&&a==="paused"&&u&&u.readyState==="live"&&Ze.curState==="running"&&(D.debug("auto resume after interruption for iOS"),s.play())})}),C(this,"autoResumeAfterInterruptionOnIOS15",()=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,s]=r;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(D.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),Ze.on(Rn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ze.on(Rn.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),Ze.on(Rn.STATE_CHANGE,()=>{dr()&&Ze.prevState==="suspended"&&Ze.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(r,i){const s=this.elementMap.get(r);if(this.sinkIdMap.set(r,i),s)try{await s.setSinkId(i)}catch(a){throw new j(V.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(r,i,s,a){if(this.elementMap.has(i))return;const u=document.createElement("audio");u.autoplay=!0,u.srcObject=new MediaStream([r]),this.bindAudioElementEvents(i,u),this.elementMap.set(i,u),this.elementStateMap.set(i,Yn.INIT),this.setVolume(i,s);const d=this.sinkIdMap.get(i);if(d)try{u.setSinkId(d).catch(m=>{D.warning("[".concat(i,"] set sink id failed"),m.toString())})}catch(m){D.warning("[".concat(i,"] set sink id failed"),m.toString())}const h=u.play();h&&h.then&&h.catch(m=>{a&&Ie.autoplayFailed(a,"audio",m.message,i),D.warning("audio element play warning",m.toString()),this.elementMap.has(i)&&m.name==="NotAllowedError"&&(D.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(u),ys(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Bk()}))})}updateTrack(r,i){const s=this.elementMap.get(r);s&&(s.srcObject=new MediaStream([i]))}isPlaying(r){return this.elementMap.has(r)}setVolume(r,i){const s=this.elementMap.get(r);s&&(i=Math.max(0,Math.min(100,i)),s.volume=i/100)}stop(r){const i=this.elementMap.get(r);if(this.sinkIdMap.delete(r),!i)return;const s=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(s,1),i.srcObject=null,i.remove(),this.elementMap.delete(r),this.elementStateMap.delete(r)}bindAudioElementEvents(r,i){cee.forEach(s=>{i.addEventListener(s,a=>{const u=this.elementStateMap.get(r),d=a.type==="pause"?"paused":a.type;if(D.debug("[".concat(r,"] audio-element-status change ").concat(u," => ").concat(d)),a.type==="error"){const h=i==null?void 0:i.error;h&&D.error("[".concat(r,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(r,d)})})}getPlayerState(r){return this.elementStateMap.get(r)||"uninit"}autoResumeAudioElement(){const r=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(s=>{D.debug("Auto resume audio element success")}).catch(s=>{D.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new _e(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{Vh()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0))})}};function nn(){return function(r,i,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new j(V.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var u=arguments.length,d=new Array(u),h=0;h<u;h++)d[h]=arguments[h];const m=a.apply(this,d);return m instanceof _e?new _e((g,p)=>{m.then(g).catch(p)}):m}),s}}var tL,nL,rL,iL,sL,oL,aL,cL,uL,lL,dL,hL,pL,fL,mL,gL,EL,_L,Ut,vL,yL,SL,TL,RL,IL,mo,wL,CL,AL,bL,OL,NL,PL,DL,kL,LL,Jr,uee=Ma("Array").values,lee=$o,dee=Pr,hee=b,pee=uee,qS=Array.prototype,fee={DOMTokenList:!0,NodeList:!0},Zo=function(r){var i=r.values;return r===qS||hee(qS,r)&&i===qS.values||dee(fee,lee(r))?pee:i};function ML(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function Lg(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?ML(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):ML(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}class xL extends Wt{constructor(i){super(),C(this,"name","VideoProcessorDestination"),C(this,"ID","0"),C(this,"_source",void 0),C(this,"videoContext",void 0),C(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new j(V.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new j(V.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(Zn.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Zn.ON_TRACK,void 0)}}class UL extends Wt{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,s){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"usageRegistry",[]),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"_chained",!1),this.trackId=i,this.direction=s}async getConstraints(){return await nr(this,Xr.REQUEST_CONSTRAINTS)}async requestApplyConstraints(i,s){var a;return D.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(s,i),Jt(this,Xr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Zo(a=this.constraintsMap).call(a)))}async requestRevertConstraints(i){var s;if(this.constraintsMap.has(i))return D.info("processor ".concat(i.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(i),Jt(this,Xr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Zo(s=this.constraintsMap).call(s)))}registerStats(i,s,a){this.statsRegistry.find(u=>u.processorID===i.ID&&u.processorName===i.name&&u.type===s)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:s,cb:a})}unregisterStats(i,s){const a=this.statsRegistry.findIndex(u=>u.processorID===i.ID&&u.processorName===i.name&&u.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:s,processorName:a,type:u,cb:d}of this.statsRegistry)try{const h=d();i.push({processorID:s,processorName:a,type:u,stats:h})}catch(h){D.error(new j(V.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,s){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:s})}unregisterUsage(i){const s=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof _e&&(a=await a),i.push(Lg(Lg({},a),{},{direction:this.direction}))}catch(a){D.error("gather extension usage error",a)}return i}getDirection(){return this.direction}}class VL extends Wt{constructor(i){super(),C(this,"name","AudioProcessorDestination"),C(this,"ID","0"),C(this,"inputTrack",void 0),C(this,"inputNode",void 0),C(this,"audioProcessorContext",void 0),C(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new j(V.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new j(V.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Zn.ON_TRACK,void 0),this.emit(Zn.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(Zn.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(Zn.ON_NODE,this.inputNode))}}class FL extends Wt{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,s,a){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"audioContext",void 0),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"usageRegistry",[]),C(this,"_chained",!1),this.audioContext=i,this.trackId=s,this.direction=a}async getConstraints(){return nr(this,Xr.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(i,s){var a;return D.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(s,i),Jt(this,Xr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Zo(a=this.constraintsMap).call(a)))}async requestRevertConstraints(i){var s;if(this.constraintsMap.has(i))return this.constraintsMap.delete(i),Jt(this,Xr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Zo(s=this.constraintsMap).call(s)))}registerStats(i,s,a){this.statsRegistry.find(u=>u.processorID===i.ID&&u.processorName===i.name&&u.type===s)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:s,cb:a})}unregisterStats(i,s){const a=this.statsRegistry.findIndex(u=>u.processorID===i.ID&&u.processorName===i.name&&u.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:s,processorName:a,type:u,cb:d}of this.statsRegistry)try{const h=d();i.push({processorID:s,processorName:a,type:u,stats:h})}catch(h){D.error(new j(V.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,s){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:s})}unregisterUsage(i){const s=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof _e&&(a=await a),i.push(Lg(Lg({},a),{},{direction:this.direction}))}catch(a){D.error("gather extension usage error",a)}return i}getDirection(){return this.direction}}class jL extends Wt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),C(this,"context",void 0),C(this,"processSourceNode",void 0),C(this,"outputTrack",void 0),C(this,"processedNode",void 0),C(this,"clonedTrack",void 0),C(this,"outputNode",void 0),this.outputNode=new mee}setVolume(){}createOutputTrack(){throw new j(V.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class mee{disconnect(){}connect(){}}function BL(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function zS(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?BL(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):BL(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}let tr=(tL=ke({argsMap:(r,i)=>[r.getTrackId(),i],throttleTime:300}),nL=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),rL=nn(),iL=xl("LocalAudioTrack","_enabledMutex"),sL=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),oL=nn(),aL=xl("LocalAudioTrack","_enabledMutex"),cL=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),uL=nn(),lL=nn(),dL=nn(),hL=ke({argsMap:r=>[r.getTrackId()]}),pL=nn(),fL=ke({argsMap:r=>[r.getTrackId()]}),mL=nn(),gL=ke({argsMap:r=>[r.getTrackId()]}),EL=ke({argsMap:(r,i)=>[r.getTrackId(),i.name]}),_L=ke({argsMap:r=>[r.getTrackId()]}),ae((Ut=class extends WS{get isPlaying(){return this._useAudioElement?pi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(r,i,s,a){super(r,s),C(this,"trackMediaType","audio"),C(this,"_encoderConfig",void 0),C(this,"_source",void 0),C(this,"_enabled",!0),C(this,"_volume",100),C(this,"_useAudioElement",!1),C(this,"_bypassWebAudio",!1),C(this,"processor",void 0),C(this,"processorContext",void 0),C(this,"processorDestination",void 0),C(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=i,this._getOriginVolumeLevel=!!a,Q("DISABLE_WEBAUDIO")?(this._source=new jL,this._useAudioElement=!0,this._bypassWebAudio=!0):(this._source=new Yk(r,!1,this._getOriginVolumeLevel?r:void 0),Q("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),this.processorContext=new FL(this._source.context,this.getTrackId(),"local"),this.processorDestination=new VL(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Yr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setVolume(r){Ot(r,"volume",0,1e3),this._volume=r,this._source.setVolume(r/100),this._useAudioElement&&pi.setVolume(this.getTrackId(),r);try{if(this._bypassWebAudio)return void D.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,Jt(this,xe.NEED_REPLACE_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{D.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(r){if(!this._useAudioElement)throw new j(V.NOT_SUPPORTED,"your browser does not support setting the audio output device");await pi.setSinkID(this.getTrackId(),r)}async setEnabled(r,i,s){return this._setEnabled(r,i,s)}async _setEnabled(r,i,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await Jt(this,xe.NEED_ENABLE_TRACK,this),D.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(r," success"))}catch(a){throw s||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await Jt(this,xe.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await Jt(this,xe.NEED_MUTE_TRACK,this):await Jt(this,xe.NEED_UNMUTE_TRACK,this))}getStats(){return qh(()=>{D.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),go(this,xe.GET_STATS)||zS({},bS)}setAudioFrameCallback(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!r)return this._source.removeAllListeners(Yr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(Yr.ON_AUDIO_BUFFER),this._source.on(Yr.ON_AUDIO_BUFFER,s=>r(s))}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] start audio playback in element")),pi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?pi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let r=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&pi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(r,i){this._originMediaStreamTrack!==r&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r.addEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:r,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(r))}renewMediaStreamTrack(r){return _e.resolve(void 0)}pipe(r){if(this._bypassWebAudio)throw new j(V.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===r)return r;if(r._source)throw new j(V.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(!this.processor)return;const i=this.processor;(r=this._source.processSourceNode)===null||r===void 0||r.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Zn.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await Jt(this,xe.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(Zn.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Zn.ON_TRACK),this.processorDestination.removeAllListeners(Zn.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Xr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Xr.REQUEST_CONSTRAINTS)}}).prototype,"setVolume",[tL],Object.getOwnPropertyDescriptor(Ut.prototype,"setVolume"),Ut.prototype),ae(Ut.prototype,"setPlaybackDevice",[nL,rL],Object.getOwnPropertyDescriptor(Ut.prototype,"setPlaybackDevice"),Ut.prototype),ae(Ut.prototype,"setEnabled",[iL,sL,oL],Object.getOwnPropertyDescriptor(Ut.prototype,"setEnabled"),Ut.prototype),ae(Ut.prototype,"setMuted",[aL,cL,uL],Object.getOwnPropertyDescriptor(Ut.prototype,"setMuted"),Ut.prototype),ae(Ut.prototype,"getStats",[lL],Object.getOwnPropertyDescriptor(Ut.prototype,"getStats"),Ut.prototype),ae(Ut.prototype,"setAudioFrameCallback",[dL],Object.getOwnPropertyDescriptor(Ut.prototype,"setAudioFrameCallback"),Ut.prototype),ae(Ut.prototype,"play",[hL,pL],Object.getOwnPropertyDescriptor(Ut.prototype,"play"),Ut.prototype),ae(Ut.prototype,"stop",[fL,mL],Object.getOwnPropertyDescriptor(Ut.prototype,"stop"),Ut.prototype),ae(Ut.prototype,"close",[gL],Object.getOwnPropertyDescriptor(Ut.prototype,"close"),Ut.prototype),ae(Ut.prototype,"pipe",[EL],Object.getOwnPropertyDescriptor(Ut.prototype,"pipe"),Ut.prototype),ae(Ut.prototype,"unpipe",[_L],Object.getOwnPropertyDescriptor(Ut.prototype,"unpipe"),Ut.prototype),Ut),Mg=(vL=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),yL=nn(),SL=xl("MicrophoneAudioTrack","_enabledMutex"),TL=ke({argsMap:(r,i,s)=>[r.getTrackId(),i,s]}),RL=nn(),IL=ke({argsMap:r=>[r.getTrackId()]}),ae((mo=class extends tr{get __className__(){return"MicrophoneAudioTrack"}constructor(r,i,s,a){super(r,i.encoderConfig?bg(i.encoderConfig):{},a,Q("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),C(this,"_config",void 0),C(this,"_deviceName","default"),C(this,"_constraints",void 0),C(this,"_originalConstraints",void 0),C(this,"_enabled",!0),this._config=i,this._constraints=s,this._originalConstraints=s,this._deviceName=r.label,typeof i.bypassWebAudio=="boolean"&&(this._bypassWebAudio=i.bypassWebAudio),Rl()&&Ze.bindInterruptDetectorTrack(this),this.bindProcessorContextEvents()}async setDevice(r){if(D.info("[".concat(this.getTrackId(),"] start set device to ").concat(r)),this._enabled)try{const i=await hi.getDeviceById(r),s={};s.audio=zS({},this._constraints),s.audio.deviceId={exact:r},this._originMediaStreamTrack.stop();let a=null;try{a=await vs(s,this.getTrackId())}catch(u){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),a=await vs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=i.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await hi.getDeviceById(r);this._deviceName=i.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}D.info("[".concat(this.getTrackId(),"] set device to ").concat(r," success"))}async setEnabled(r,i,s){if(i)return D.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(r);if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await Jt(this,xe.NEED_DISABLE_TRACK,this)}catch(h){throw D.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const u=zS({},this._constraints),d=hi.searchDeviceIdByName(this._deviceName);d&&!u.deviceId&&(u.deviceId=d);try{s||(this._enabled=!0);const h=await vs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Jt(this,xe.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}D.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),Rl()&&Ze.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((dr()||Yo())&&this._enabled&&!this._isClosed&&Ze.duringInterruption){const r=async()=>{Ze.off(Rn.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ze.on(Rn.IOS_INTERRUPTION_END,r)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(Wa.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,s=hi.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId=s),this._constraints=i,this._enabled){this._originMediaStreamTrack.stop();const a=await vs({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(Xr.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const a=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(a),i()}catch(a){s(a)}}),this.processorContext.on(Xr.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[vL,yL],Object.getOwnPropertyDescriptor(mo.prototype,"setDevice"),mo.prototype),ae(mo.prototype,"setEnabled",[SL,TL,RL],Object.getOwnPropertyDescriptor(mo.prototype,"setEnabled"),mo.prototype),ae(mo.prototype,"close",[IL],Object.getOwnPropertyDescriptor(mo.prototype,"close"),mo.prototype),mo),gee=(wL=ke({argsMap:(r,i)=>[r.getTrackId(),i,r.duration]}),CL=nn(),AL=ke({argsMap:r=>[r.getTrackId()]}),bL=nn(),OL=ke({argsMap:r=>[r.getTrackId()]}),NL=nn(),PL=ke({argsMap:r=>[r.getTrackId()]}),DL=nn(),kL=ke({argsMap:r=>[r.getTrackId()]}),LL=nn(),ae((Jr=class extends tr{get __className__(){return"BufferSourceAudioTrack"}constructor(r,i,s,a){super(i.createOutputTrack(),s,a),C(this,"source",void 0),C(this,"_bufferSource",void 0),this.source=r,this._bufferSource=i,this._bufferSource.on(Yr.AUDIO_SOURCE_STATE_CHANGE,u=>{this.emit(Wa.SOURCE_STATE_CHANGE,u)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(r){r&&this._bufferSource.updateOptions(r),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(r){this._bufferSource.seekAudioBuffer(r)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}}).prototype,"startProcessAudioBuffer",[wL,CL],Object.getOwnPropertyDescriptor(Jr.prototype,"startProcessAudioBuffer"),Jr.prototype),ae(Jr.prototype,"pauseProcessAudioBuffer",[AL,bL],Object.getOwnPropertyDescriptor(Jr.prototype,"pauseProcessAudioBuffer"),Jr.prototype),ae(Jr.prototype,"seekAudioBuffer",[OL,NL],Object.getOwnPropertyDescriptor(Jr.prototype,"seekAudioBuffer"),Jr.prototype),ae(Jr.prototype,"resumeProcessAudioBuffer",[PL,DL],Object.getOwnPropertyDescriptor(Jr.prototype,"resumeProcessAudioBuffer"),Jr.prototype),ae(Jr.prototype,"stopProcessAudioBuffer",[kL,LL],Object.getOwnPropertyDescriptor(Jr.prototype,"stopProcessAudioBuffer"),Jr.prototype),Jr);class Ki extends tr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=Ul().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,$t(8,"track-mix-")),C(this,"trackList",void 0),C(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return this.trackList.indexOf(i)!==-1}addAudioTrack(i){this.trackList.indexOf(i)===-1?(D.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):D.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(this.trackList.indexOf(i)!==-1){D.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}JS(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}}class Eee extends Wt{constructor(){super(...arguments),C(this,"resultStorage",new Map)}setLocalAudioStats(i,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(i,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(a))}setRemoteAudioStats(i,s){const a=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(i,s){const a=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(i,s,a){this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const u=this.resultStorage.get(i);if(u&&(u.result.push(a),u.result.length>=5)){const d=u.result.includes(!0);u.isPrevNormal&&!d&&this.emit("exception",GL[i],i,s),!u.isPrevNormal&&d&&this.emit("exception",GL[i]+2e3,i+"_RECOVER",s),u.isPrevNormal=d,u.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&i.receiveLevel===0)}checkAudioInputLevel(i,s){return s instanceof Ki&&!s.isActive||!!s.muted||i.sendVolumeLevel!==0}checkFramerateInput(i,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=ta(s._encoderConfig.frameRate));const u=i.captureFrameRate;return!a||!u||!(a>10&&u<5||a<10&&a>=5&&u<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,s){return!!s.muted||i.sendBitrate!==0}checkSendAudioBitrate(i,s){return s instanceof Ki&&!s.isActive||!!s.muted||i.sendBitrate!==0}checkVideoDecode(i){return i.receiveBitrate===0||i.decodeFrameRate!==0}}const GL={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},qi=new class{markSubscribeStart(r,i){performance.mark("agora-web-sdk/".concat(r,"/subscribe-").concat(i))}markPublishStart(r,i){performance.mark("agora-web-sdk/".concat(r,"/publish-").concat(i))}measureFromSubscribeStart(r,i){const s=performance.getEntriesByName("agora-web-sdk/".concat(r,"/subscribe-").concat(i));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(r,i){const s=performance.getEntriesByName("agora-web-sdk/".concat(r,"/publish-").concat(i));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function WL(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function lu(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?WL(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):WL(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}class Fl{constructor(i){C(this,"store",void 0),C(this,"onStatsException",void 0),C(this,"onUploadPublishDuration",void 0),C(this,"localStats",new Map),C(this,"remoteStats",new Map),C(this,"updateStatsInterval",void 0),C(this,"trafficStats",void 0),C(this,"trafficStatsPeerList",[]),C(this,"uplinkStats",void 0),C(this,"exceptionMonitor",void 0),C(this,"p2pChannel",void 0),C(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Eee,this.exceptionMonitor.on("exception",(s,a,u)=>{this.onStatsException&&this.onStatsException(s,a,u)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ve.LocalAudioTrack)||lu({},bS)}getLocalVideoTrackStats(){return this.localStats.get(ve.LocalVideoTrack)||lu({},OS)}getRemoteAudioTrackStats(i){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===d);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var u;const d=(u=this.remoteStats.get(i))===null||u===void 0?void 0:u.audioStats;d&&(a[i]=s(i,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRemoteNetworkQualityStats(i){const s={};if(i){var a;const u=(a=this.remoteStats.get(i))===null||a===void 0?void 0:a.networkStats;u&&(s[i]=u)}else Array.from(this.remoteStats.entries()).forEach(u=>{let[d,{networkStats:h}]=u;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(i){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===d);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var u;const d=(u=this.remoteStats.get(i))===null||u===void 0?void 0:u.videoStats;d&&(a[i]=s(i,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRTCStats(){let i=0,s=0,a=0,u=0;const d=this.localStats.get(ve.LocalAudioTrack);d&&(i+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(ve.LocalVideoTrack);h&&(i+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(ve.LocalVideoLowTrack);m&&(i+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:E,videoStats:v}=p;E&&(a+=E.receiveBytes,u+=E.receiveBitrate),v&&(a+=v.receiveBytes,u+=v.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:s,SendBytes:i,RecvBytes:a,RecvBitrate:u,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),i.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;const u=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=u!=null&&u.videoSSRC?qi.measureFromSubscribeStart(this.store.clientId,u.videoSSRC):0,h=u!=null&&u.audioSSRC?qi.measureFromSubscribeStart(this.store.clientId,u.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&D.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,s,a){if(!i)return!1;const u=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return u||!d}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(s=>{let[a,u]=s;switch(a){case ve.LocalVideoTrack:case ve.LocalVideoLowTrack:{const d=u,h=lu({},OS),m=i.getStats(),g=i.getLocalMedia(a);if(m){const p=m.videoSend.find(E=>E.ssrc===(g==null?void 0:g.ssrcs[0].ssrcId));if(p){const E=i.getLocalVideoSize(),v=i.getEncoderConfig(ve.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(h.codecType=p.codec),h.sendBytes=p.bytes,h.sendBitrate=d?8*Math.max(0,h.sendBytes-d.sendBytes):0,p.inputFrame?(h.captureFrameRate=p.inputFrame.frameRate,h.captureResolutionHeight=p.inputFrame.height,h.captureResolutionWidth=p.inputFrame.width):E&&(h.captureResolutionWidth=E.width,h.captureResolutionHeight=E.height),p.sentFrame?(h.sendFrameRate=p.sentFrame.frameRate,h.sendResolutionHeight=p.sentFrame.height,h.sendResolutionWidth=p.sentFrame.width):E&&(h.sendResolutionWidth=E.width,h.sendResolutionHeight=E.height),p.avgEncodeMs&&(h.encodeDelay=p.avgEncodeMs),v&&v.bitrateMax&&(h.targetSendBitrate=1e3*v.bitrateMax),h.sendPackets=p.packets,h.sendPacketsLost=p.packetsLost,h.totalDuration=d?d.totalDuration+1:1,h.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(h.totalFreezeTime+=1)}this.trafficStats&&(h.sendPacketsLost=this.trafficStats.B_pvlr4/100)}this.localStats.set(a,h),h&&g&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,g.track,h);break}case ve.LocalAudioTrack:{const d=u,h=lu({},bS),m=i.getStats(),g=i.getLocalMedia(a);if(m){const p=m.audioSend.find(E=>E.ssrc===(g==null?void 0:g.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(h.codecType=p.codec),p.inputLevel)h.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const E=i.getLocalAudioVolume();E&&(h.sendVolumeLevel=Math.round(32767*E))}h.sendBytes=p.bytes,h.sendPackets=p.packets,h.sendPacketsLost=p.packetsLost,h.sendBitrate=d?8*Math.max(0,h.sendBytes-d.sendBytes):0}}this.trafficStats&&(h.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(ve.LocalAudioTrack,h),h&&g&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,g.track,h);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(s=>{let[a,{videoStats:u,audioStats:d,videoPcStats:h}]=s;const m=d,g=u,p=h,E=lu({},Tk),v=lu({},Rk),T=lu({},XQ),{audioTrack:I,videoTrack:O,audioSSRC:N,videoSSRC:P}=i.getRemoteMedia(a),L=i.getStats(),x=L==null?void 0:L.audioRecv.find(X=>X.ssrc===N),W=L==null?void 0:L.videoRecv.find(X=>X.ssrc===P),q=this.trafficStats&&this.trafficStats.peer_delay.find(X=>X.peer_uid===a);if(x&&(x.codec!=="opus"&&x.codec!=="aac"&&x.codec!=="PCMU"&&x.codec!=="PCMA"&&x.codec!=="G722"||(E.codecType=x.codec),x.outputLevel?E.receiveLevel=Math.round(32767*x.outputLevel):I&&(E.receiveLevel=Math.round(32767*I.getVolumeLevel())),E.receiveBytes=x.bytes,E.receivePackets=x.packets,E.receivePacketsLost=x.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=m?8*Math.max(0,E.receiveBytes-m.receiveBytes):0,E.totalDuration=m?m.totalDuration+1:1,E.totalFreezeTime=m?m.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=x.jitterBufferMs,E.totalDuration>10&&Fl.isRemoteAudioFreeze(I)&&(E.totalFreezeTime+=1)),W){W.codec!=="H264"&&W.codec!=="VP8"&&W.codec!=="VP9"&&W.codec!=="AV1X"&&W.codec!=="AV1"||(v.codecType=W.codec),v.receiveBytes=W.bytes,v.receiveBitrate=g?8*Math.max(0,v.receiveBytes-g.receiveBytes):0,v.decodeFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,v.renderFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,W.outputFrame&&(v.renderFrameRate=W.outputFrame.frameRate),W.receivedFrame?(v.receiveFrameRate=W.receivedFrame.frameRate,v.receiveResolutionHeight=W.receivedFrame.height,v.receiveResolutionWidth=W.receivedFrame.width):O&&(v.receiveResolutionHeight=O._videoHeight||0,v.receiveResolutionWidth=O._videoWidth||0),W.framesRateFirefox!==void 0&&(v.receiveFrameRate=Math.round(W.framesRateFirefox)),v.receivePackets=W.packets,v.receivePacketsLost=W.packetsLost,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.totalDuration=g?g.totalDuration+1:1,v.totalFreezeTime=g?g.totalFreezeTime:0,v.receiveDelay=W.jitterBufferMs||0;const X=!!P&&i.getRemoteVideoIsReady(P);O&&X&&Fl.isRemoteVideoFreeze(O,W,p)&&(v.totalFreezeTime+=1),v.freezeRate=v.totalFreezeTime/v.totalDuration}q&&(E.end2EndDelay=q.B_ad,v.end2EndDelay=q.B_vd,E.transportDelay=q.B_ed,v.transportDelay=q.B_ed,E.currentPacketLossRate=q.B_ealr4/100,v.currentPacketLossRate=q.B_evlr4/100,T.uplinkNetworkQuality=q.B_punq?q.B_punq:0,T.downlinkNetworkQuality=q.B_pdnq?q.B_pdnq:0),this.remoteStats.set(a,{audioStats:E,videoStats:v,videoPcStats:W,networkStats:T}),I&&this.exceptionMonitor.setRemoteAudioStats(I,E),O&&this.exceptionMonitor.setRemoteVideoStats(O,v)})}}const ea=new class extends Wt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),C(this,"_lastHiddenTime",0),C(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),D.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function HL(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function xg(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?HL(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):HL(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}function Ug(r){return r.match(/^[\.\:\d]+$/)?"".concat(r.replace(/[^\d]/g,"-"),".").concat(Q("TURN_DOMAIN")):(D.info("Cannot recognized as IP address ".concat(r,". Used As Host instead")),r)}function $L(r,i){var s,a;const u=Q("GATEWAY_DOMAINS");let d=u[1]&&i.indexOf(u[1])!==-1?1:0;r.addresses=r.addresses||[];const h=r.addresses.map(g=>g.domain_prefix?{address:"".concat(g.domain_prefix,".").concat(u[d++%u.length],":").concat(g.port)}:g.ip.match(/^[\.\:\d]+$/)?{ip:g.ip,port:g.port,address:"".concat(g.ip.replace(/[^\d]/g,"-"),".").concat(u[d++%u.length],":").concat(g.port)}:(D.info("Cannot recognized as IP address ".concat(g.ip,". Used As Host instead")),{ip:g.ip,port:g.port,address:"".concat(g.ip,":").concat(g.port)}));if((s=r.detail)!==null&&s!==void 0&&s[18]&&typeof((a=r.detail)===null||a===void 0?void 0:a[18])=="string"){const g=r.detail[18],p=g==null?void 0:g.split(";");for(let E=0;E<p.length;E++){var m;const v=qo(m=p[E]).call(m);h[E]&&v&&(h[E].ip6=v)}}return{gatewayAddrs:h,uid:r.uid,cid:r.cid,cert:r.cert,vid:r.detail&&r.detail[8],uni_lbs_ip:r.detail&&r.detail[1],res:r,csIp:r.detail&&r.detail[502]}}function ta(r){return typeof r=="number"?r:r.exact||r.ideal||r.max||r.min||0}function KL(r){const i=r._encoderConfig;if(!i)return{};const s={resolution:i.width&&i.height?"".concat(ta(i.width),"x").concat(ta(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return typeof i.frameRate=="number"?(s.maxFrameRate=i.frameRate,s.minFrameRate=i.frameRate):i.frameRate&&(s.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,s.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),s}function qL(r,i,s){var a;const u=i.videoSend.find(m=>m.ssrc===r);if(!u)return null;const d=s==null||(a=s.videoSend.find(m=>m.ssrc===r))===null||a===void 0?void 0:a.inputFrame,h={id:$t(10,""),timestamp:new Date(i.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:u.ssrc.toString()};return u.inputFrame&&(d&&u.inputFrame.height===d.height||(h.A_fhi=u.inputFrame.height?u.inputFrame.height.toString():"0"),d&&u.inputFrame.width===d.width||(h.A_fwi=u.inputFrame.width?u.inputFrame.width.toString():"0"),d&&u.inputFrame.frameRate===d.frameRate||(h.A_fri=u.inputFrame.frameRate?u.inputFrame.frameRate.toString():"0")),h}function zL(r){return r>=0&&r<.17?1:r>=.17&&r<.36?2:r>=.36&&r<.59?3:r>=.59&&r<=1?4:r>1?5:0}function YS(r,i){let s,a,u;switch(i){case Tn.CHOOSE_SERVER:s=4096,a="choose server";break;case Tn.CLOUD_PROXY:s=1048576,a="proxy";break;case Tn.CLOUD_PROXY_5:s=4194304,a="proxy5";break;case Tn.CLOUD_PROXY_FALLBACK:s=4194310,a="proxy fallback";break;default:throw new j(V.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:r.detail&&r.detail[502],retry:!1})}if(r.response_body.forEach(d=>{d.buffer&&d.buffer.flag===s&&(u={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>xg(xg({},h),{},{ticket:d.buffer.cert})),server_ts:r.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:xg(xg({},d.buffer.detail),r.detail),flag:d.buffer.flag,opid:r.opid,cert:d.buffer.cert})}),!u)throw new j(V.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(a," from multi unilbs response"),{csIp:r.detail&&r.detail[502]});return u}async function _ee(r,i){return await _e.all(r.addresses.map(async s=>({address:Ug(s.ip),tcpport:s.port,udpport:s.port,username:i&&Q("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():Ri.username,password:i&&Q("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await nee(i.toString()):Ri.password})))}function vee(r,i){const s=i._videoWidth||i.getMediaStreamTrack(!0).getSettings().width;return s||D.warning("cannot get original video track's width, default scale down 4 times for low stream"),s?s/ta(r.width):4}function Vg(r){let{candidateType:i,relayProtocol:s,type:a,address:u,port:d,protocol:h}=r;return a==="local-candidate"?{candidateType:i,relayProtocol:s,protocol:h}:{candidateType:i,relayProtocol:s,address:u,port:d,protocol:h}}function YL(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function du(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?YL(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):YL(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}function jl(r){return window.TextEncoder?new TextEncoder().encode(r).length:r.length}function Bn(r){return new _e(i=>{window.setTimeout(i,r)})}function yee(r){const i=new j(V.TIMEOUT,"timeout");return new _e((s,a)=>{window.setTimeout(()=>a(i),r)})}function $t(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,r).toLowerCase();return s.length===r?"".concat(i).concat(s):"".concat(i).concat(s)+$t(r-s.length,"")}function XS(){return $t(32,"").toUpperCase()}const Fg=()=>{};function XL(r){return new _e((i,s)=>{let a=!1;const u=document.createElement("video");u.setAttribute("autoplay",""),u.setAttribute("muted",""),u.muted=!0,u.autoplay=!0,u.setAttribute("playsinline",""),u.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(u);const d=dr()?"canplay":"playing";u.addEventListener(d,()=>{const h=u.videoWidth,m=u.videoHeight;!h&&tn()||(a=!0,u.srcObject=null,u.remove(),i([h,m]))}),u.srcObject=new MediaStream([r]),u.play().catch(Fg),setTimeout(()=>{a||(u.srcObject=null,u.remove(),i([u.videoWidth,u.videoHeight]))},4e3)})}function Bl(r){return _e.all(r.map(i=>i.then(s=>{throw s},s=>s))).then(i=>{throw i},i=>i)}function nr(r,i){for(var s=arguments.length,a=new Array(s>2?s-2:0),u=2;u<s;u++)a[u-2]=arguments[u];return r.getListeners(i).length===0?_e.reject(new j(V.UNEXPECTED_ERROR,"can not emit promise")):new _e((d,h)=>{r.emit(i,...a,d,h)})}function Jt(r,i){if(r.getListeners(i).length===0)return _e.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),u=2;u<s;u++)a[u-2]=arguments[u];return nr(r,i,...a)}function go(r,i){if(r.getListeners(i).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),u=2;u<s;u++)a[u-2]=arguments[u];return hu(r,i,...a)}function hu(r,i){let s=null,a=null;for(var u=arguments.length,d=new Array(u>2?u-2:0),h=2;h<u;h++)d[h-2]=arguments[h];if(r.emit(i,...d,m=>{s=m},m=>{a=m}),a!==null)throw a;if(s===null)throw new j(V.UNEXPECTED_ERROR,"handler is not sync");return s}function JS(r,i){const s=r.indexOf(i);s!==-1&&r.splice(s,1)}function JL(r){const i=[];return r.forEach(s=>{i.indexOf(s)===-1&&i.push(s)}),i}function ys(r){_e.resolve().then(r)}function cn(r){return JSON.parse(JSON.stringify(r))}const QL={};function qh(r,i){QL[i]||(QL[i]=!0,r())}function QS(r){const i=window.atob(r),s=new Uint8Array(new ArrayBuffer(i.length));for(let a=0;a<i.length;a+=1)s[a]=i.charCodeAt(a);return s}function jg(r){let i="";for(let s=0;s<r.length;s+=1)i+=String.fromCharCode(r[s]);return window.btoa(i)}const ZL=new class{constructor(){C(this,"fnMap",new Map)}throttleByKey(r,i,s,a){for(var u=arguments.length,d=new Array(u>4?u-4:0),h=4;h<u;h++)d[h-4]=arguments[h];if(this.fnMap.has(i)){const m=this.fnMap.get(i);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout(()=>{const p=this.fnMap.get(i);p&&p.fn(...p.args),this.fnMap.delete(i)},s);this.fnMap.set(i,{fn:r,threshold:s,timer:g,args:d,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(i,du(du({},m),{},{fn:r,args:d,skipFn:a}))}else{const m=window.setTimeout(()=>{const g=this.fnMap.get(i);g&&g.fn(...g.args),this.fnMap.delete(i)},s);this.fnMap.set(i,{fn:r,threshold:s,timer:m,args:d,skipFn:a})}}},eM=ZL.throttleByKey.bind(ZL),zh=async r=>{let{fragementLength:i,referenceList:s,asyncMapHandler:a,allFailedhandler:u,promisesCollector:d}=r,h=0;const m=i;let g,p=0;const E=async()=>{const v=(()=>{const T=h*m,I=T+m;return s.slice(T,I).map(a)})();d&&d.push(...v);try{g=await Bl(v)}catch(T){if(p+=m,h++,!(p>=s.length))return void await E();u(T)}v.forEach(T=>T.cancel())};return await E(),g};function tM(r){return typeof r=="object"&&r!==null&&!(r instanceof RegExp)}var See=c,Tee=Ln("iterator"),nM=!See(function(){var r=new URL("b?a=1&b=2&c=3","http://a"),i=r.searchParams,s="";return r.pathname="c%20d",i.forEach(function(a,u){i.delete("b"),s+=u+a}),!r.toJSON||!i.sort||r.href!=="http://a/c%20d?a=1&c=3"||i.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!i[Tee]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||s!=="a1c3"||new URL("http://x",void 0).host!=="x"}),rM=de,Ree=w,Iee=Fe,wee=c,ZS=Gm,Cee=jm,Aee=be,bee=uo,Oee=ms,Gl=Object.assign,iM=Object.defineProperty,Nee=Ree([].concat),Pee=!Gl||wee(function(){if(rM&&Gl({b:1},Gl(iM({},"a",{enumerable:!0,get:function(){iM(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var r={},i={},s=Symbol(),a="abcdefghijklmnopqrst";return r[s]=7,a.split("").forEach(function(u){i[u]=u}),Gl({},r)[s]!=7||ZS(Gl({},i)).join("")!=a})?function(r,i){for(var s=bee(r),a=arguments.length,u=1,d=Cee.f,h=Aee.f;a>u;)for(var m,g=Oee(arguments[u++]),p=d?Nee(ZS(g),d(g)):ZS(g),E=p.length,v=0;E>v;)m=p[v++],rM&&!Iee(h,g,m)||(s[m]=g[m]);return s}:Gl,Dee=ji,kee=uN,Lee=La,Mee=Fe,xee=uo,Uee=function(r,i,s,a){try{return a?i(Dee(s)[0],s[1]):i(s)}catch(u){kee(r,"throw",u)}},Vee=sN,Fee=ng,jee=Ho,sM=Og,Bee=Yy,Gee=Km,oM=M.Array,pu=w,eT=2147483647,Wee=/[^\0-\u007E]/,aM=/[.\u3002\uFF0E\uFF61]/g,cM="Overflow: input needs wider integers to process",uM=M.RangeError,Hee=pu(aM.exec),Wl=Math.floor,tT=String.fromCharCode,lM=pu("".charCodeAt),dM=pu([].join),qa=pu([].push),$ee=pu("".replace),Kee=pu("".split),qee=pu("".toLowerCase),hM=function(r){return r+22+75*(r<26)},zee=function(r,i,s){var a=0;for(r=s?Wl(r/700):r>>1,r+=Wl(r/i);r>455;)r=Wl(r/35),a+=36;return Wl(a+36*r/(r+38))},Yee=function(r){var i,s,a=[],u=(r=function(L){for(var x=[],W=0,q=L.length;W<q;){var X=lM(L,W++);if(X>=55296&&X<=56319&&W<q){var ie=lM(L,W++);(64512&ie)==56320?qa(x,((1023&X)<<10)+(1023&ie)+65536):(qa(x,X),W--)}else qa(x,X)}return x}(r)).length,d=128,h=0,m=72;for(i=0;i<r.length;i++)(s=r[i])<128&&qa(a,tT(s));var g=a.length,p=g;for(g&&qa(a,"-");p<u;){var E=eT;for(i=0;i<r.length;i++)(s=r[i])>=d&&s<E&&(E=s);var v=p+1;if(E-d>Wl((eT-h)/v))throw uM(cM);for(h+=(E-d)*v,d=E,i=0;i<r.length;i++){if((s=r[i])<d&&++h>eT)throw uM(cM);if(s==d){for(var T=h,I=36;;){var O=I<=m?1:I>=m+26?26:I-m;if(T<O)break;var N=T-O,P=36-O;qa(a,tT(hM(O+N%P))),T=Wl(N/P),I+=36}qa(a,tT(hM(T))),m=zee(h,v,p==g),h=0,p++}}h++,d++}return dM(a,"")},Xee=M.TypeError,nT=lr,Bg=M,rT=js,Gg=Fe,Eo=w,pM=nM,fM=ml,Jee=xN,Qee=nu,Zee=CN,iT=fl,mM=c0,sT=z,ete=Pr,tte=La,nte=$o,rte=ji,gM=Fi,zi=Ua,ite=Nh,EM=Hn,oT=Yy,ste=Km,Hl=function(r,i){if(r<i)throw Xee("Not enough arguments");return r},ote=ik,ate=Ln("iterator"),Wg="URLSearchParams",_M="URLSearchParamsIterator",vM=iT.set,$s=iT.getterFor(Wg),cte=iT.getterFor(_M),yM=rT("fetch"),Hg=rT("Request"),Yh=rT("Headers"),aT=Hg&&Hg.prototype,SM=Yh&&Yh.prototype,ute=Bg.RegExp,lte=Bg.TypeError,TM=Bg.decodeURIComponent,dte=Bg.encodeURIComponent,hte=Eo("".charAt),RM=Eo([].join),fu=Eo([].push),cT=Eo("".replace),pte=Eo([].shift),IM=Eo([].splice),wM=Eo("".split),fte=Eo("".slice),mte=/\+/g,CM=Array(4),gte=function(r){return CM[r-1]||(CM[r-1]=ute("((?:%[\\da-f]{2}){"+r+"})","gi"))},Ete=function(r){try{return TM(r)}catch{return r}},AM=function(r){var i=cT(r,mte," "),s=4;try{return TM(i)}catch{for(;s;)i=cT(i,gte(s--),Ete);return i}},_te=/[!'()~]|%20/g,vte={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},yte=function(r){return vte[r]},bM=function(r){return cT(dte(r),_te,yte)},uT=Zee(function(r,i){vM(this,{type:_M,iterator:oT($s(r).entries),kind:i})},"Iterator",function(){var r=cte(this),i=r.kind,s=r.iterator.next(),a=s.value;return s.done||(s.value=i==="keys"?a.key:i==="values"?a.value:[a.key,a.value]),s},!0),OM=function(r){this.entries=[],this.url=null,r!==void 0&&(gM(r)?this.parseObject(r):this.parseQuery(typeof r=="string"?hte(r,0)==="?"?fte(r,1):r:zi(r)))};OM.prototype={type:Wg,bindURL:function(r){this.url=r,this.update()},parseObject:function(r){var i,s,a,u,d,h,m,g=ste(r);if(g)for(s=(i=oT(r,g)).next;!(a=Gg(s,i)).done;){if(d=(u=oT(rte(a.value))).next,(h=Gg(d,u)).done||(m=Gg(d,u)).done||!Gg(d,u).done)throw lte("Expected sequence with length 2");fu(this.entries,{key:zi(h.value),value:zi(m.value)})}else for(var p in r)ete(r,p)&&fu(this.entries,{key:p,value:zi(r[p])})},parseQuery:function(r){if(r)for(var i,s,a=wM(r,"&"),u=0;u<a.length;)(i=a[u++]).length&&(s=wM(i,"="),fu(this.entries,{key:AM(pte(s)),value:AM(RM(s,"="))}))},serialize:function(){for(var r,i=this.entries,s=[],a=0;a<i.length;)r=i[a++],fu(s,bM(r.key)+"="+bM(r.value));return RM(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var $g=function(){mM(this,Xh);var r=arguments.length>0?arguments[0]:void 0;vM(this,new OM(r))},Xh=$g.prototype;if(Jee(Xh,{append:function(r,i){Hl(arguments.length,2);var s=$s(this);fu(s.entries,{key:zi(r),value:zi(i)}),s.updateURL()},delete:function(r){Hl(arguments.length,1);for(var i=$s(this),s=i.entries,a=zi(r),u=0;u<s.length;)s[u].key===a?IM(s,u,1):u++;i.updateURL()},get:function(r){Hl(arguments.length,1);for(var i=$s(this).entries,s=zi(r),a=0;a<i.length;a++)if(i[a].key===s)return i[a].value;return null},getAll:function(r){Hl(arguments.length,1);for(var i=$s(this).entries,s=zi(r),a=[],u=0;u<i.length;u++)i[u].key===s&&fu(a,i[u].value);return a},has:function(r){Hl(arguments.length,1);for(var i=$s(this).entries,s=zi(r),a=0;a<i.length;)if(i[a++].key===s)return!0;return!1},set:function(r,i){Hl(arguments.length,1);for(var s,a=$s(this),u=a.entries,d=!1,h=zi(r),m=zi(i),g=0;g<u.length;g++)(s=u[g]).key===h&&(d?IM(u,g--,1):(d=!0,s.value=m));d||fu(u,{key:h,value:m}),a.updateURL()},sort:function(){var r=$s(this);ote(r.entries,function(i,s){return i.key>s.key?1:-1}),r.updateURL()},forEach:function(r){for(var i,s=$s(this).entries,a=tte(r,arguments.length>1?arguments[1]:void 0),u=0;u<s.length;)a((i=s[u++]).value,i.key,this)},keys:function(){return new uT(this,"keys")},values:function(){return new uT(this,"values")},entries:function(){return new uT(this,"entries")}},{enumerable:!0}),fM(Xh,ate,Xh.entries,{name:"entries"}),fM(Xh,"toString",function(){return $s(this).serialize()},{enumerable:!0}),Qee($g,Wg),nT({global:!0,forced:!pM},{URLSearchParams:$g}),!pM&&sT(Yh)){var Ste=Eo(SM.has),Tte=Eo(SM.set),NM=function(r){if(gM(r)){var i,s=r.body;if(nte(s)===Wg)return i=r.headers?new Yh(r.headers):new Yh,Ste(i,"content-type")||Tte(i,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ite(r,{body:EM(0,zi(s)),headers:EM(0,i)})}return r};if(sT(yM)&&nT({global:!0,enumerable:!0,forced:!0},{fetch:function(r){return yM(r,arguments.length>1?NM(arguments[1]):{})}}),sT(Hg)){var lT=function(r){return mM(this,aT),new Hg(r,arguments.length>1?NM(arguments[1]):{})};aT.constructor=lT,lT.prototype=aT,nT({global:!0,forced:!0},{Request:lT})}}var Ss,Rte={URLSearchParams:$g,getState:$s},Ite=lr,dT=de,wte=nM,hT=M,PM=La,Ts=w,Cte=Bm.f,Kg=ml,Ate=c0,pT=Pr,fT=Pee,$l=function(r){var i=xee(r),s=Fee(this),a=arguments.length,u=a>1?arguments[1]:void 0,d=u!==void 0;d&&(u=Lee(u,a>2?arguments[2]:void 0));var h,m,g,p,E,v,T=Gee(i),I=0;if(!T||this==oM&&Vee(T))for(h=jee(i),m=s?new this(h):oM(h);h>I;I++)v=d?u(i[I],I):i[I],sM(m,I,v);else for(E=(p=Bee(i,T)).next,m=s?new this:[];!(g=Mee(E,p)).done;I++)v=d?Uee(p,u,[g.value,I],!0):g.value,sM(m,I,v);return m.length=I,m},Ks=ES,bte=PP.codeAt,Ote=function(r){var i,s,a=[],u=Kee($ee(qee(r),aM,"."),".");for(i=0;i<u.length;i++)s=u[i],qa(a,Hee(Wee,s)?"xn--"+Yee(s):s);return dM(a,".")},na=Ua,Nte=nu,DM=Rte,kM=fl,Pte=kM.set,qg=kM.getterFor("URL"),Dte=DM.URLSearchParams,kte=DM.getState,Jh=hT.URL,mT=hT.TypeError,zg=hT.parseInt,Lte=Math.floor,LM=Math.pow,Rs=Ts("".charAt),qs=Ts(/./.exec),Qh=Ts([].join),Mte=Ts(1 .toString),xte=Ts([].pop),Kl=Ts([].push),MM=Ts("".replace),Ute=Ts([].shift),Vte=Ts("".split),Zh=Ts("".slice),Yg=Ts("".toLowerCase),Fte=Ts([].unshift),gT="Invalid scheme",mu="Invalid host",xM="Invalid port",UM=/[a-z]/i,jte=/[\d+-.a-z]/i,ET=/\d/,Bte=/^0x/i,Gte=/^[0-7]+$/,Wte=/^\d+$/,VM=/^[\da-f]+$/i,Hte=/[\0\t\n\r #%/:<>?@[\\\]^|]/,$te=/[\0\t\n\r #/:<>?@[\\\]^|]/,Kte=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,qte=/[\t\n\r]/g,ep=function(r){var i,s,a,u;if(typeof r=="number"){for(i=[],s=0;s<4;s++)Fte(i,r%256),r=Lte(r/256);return Qh(i,".")}if(typeof r=="object"){for(i="",a=function(d){for(var h=null,m=1,g=null,p=0,E=0;E<8;E++)d[E]!==0?(p>m&&(h=g,m=p),g=null,p=0):(g===null&&(g=E),++p);return p>m&&(h=g,m=p),h}(r),s=0;s<8;s++)u&&r[s]===0||(u&&(u=!1),a===s?(i+=s?":":"::",u=!0):(i+=Mte(r[s],16),s<7&&(i+=":")));return"["+i+"]"}return r},Xg={},FM=fT({},Xg,{" ":1,'"':1,"<":1,">":1,"`":1}),jM=fT({},FM,{"#":1,"?":1,"{":1,"}":1}),_T=fT({},jM,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),za=function(r,i){var s=bte(r,0);return s>32&&s<127&&!pT(i,r)?r:encodeURIComponent(r)},Jg={ftp:21,file:null,http:80,https:443,ws:80,wss:443},tp=function(r,i){var s;return r.length==2&&qs(UM,Rs(r,0))&&((s=Rs(r,1))==":"||!i&&s=="|")},BM=function(r){var i;return r.length>1&&tp(Zh(r,0,2))&&(r.length==2||(i=Rs(r,2))==="/"||i==="\\"||i==="?"||i==="#")},zte=function(r){return r==="."||Yg(r)==="%2e"},vT={},GM={},yT={},WM={},HM={},ST={},$M={},KM={},Qg={},Zg={},TT={},RT={},IT={},wT={},qM={},CT={},ql={},_o={},zM={},gu={},ra={},AT=function(r,i,s){var a,u,d,h=na(r);if(i){if(u=this.parse(h))throw mT(u);this.searchParams=null}else{if(s!==void 0&&(a=new AT(s,!0)),u=this.parse(h,null,a))throw mT(u);(d=kte(new Dte)).bindURL(this),this.searchParams=d}};AT.prototype={type:"URL",parse:function(r,i,s){var a,u,d,h,m,g=this,p=i||vT,E=0,v="",T=!1,I=!1,O=!1;for(r=na(r),i||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,r=MM(r,Kte,"")),r=MM(r,qte,""),a=$l(r);E<=a.length;){switch(u=a[E],p){case vT:if(!u||!qs(UM,u)){if(i)return gT;p=yT;continue}v+=Yg(u),p=GM;break;case GM:if(u&&(qs(jte,u)||u=="+"||u=="-"||u=="."))v+=Yg(u);else{if(u!=":"){if(i)return gT;v="",p=yT,E=0;continue}if(i&&(g.isSpecial()!=pT(Jg,v)||v=="file"&&(g.includesCredentials()||g.port!==null)||g.scheme=="file"&&!g.host))return;if(g.scheme=v,i)return void(g.isSpecial()&&Jg[g.scheme]==g.port&&(g.port=null));v="",g.scheme=="file"?p=wT:g.isSpecial()&&s&&s.scheme==g.scheme?p=WM:g.isSpecial()?p=KM:a[E+1]=="/"?(p=HM,E++):(g.cannotBeABaseURL=!0,Kl(g.path,""),p=zM)}break;case yT:if(!s||s.cannotBeABaseURL&&u!="#")return gT;if(s.cannotBeABaseURL&&u=="#"){g.scheme=s.scheme,g.path=Ks(s.path),g.query=s.query,g.fragment="",g.cannotBeABaseURL=!0,p=ra;break}p=s.scheme=="file"?wT:ST;continue;case WM:if(u!="/"||a[E+1]!="/"){p=ST;continue}p=Qg,E++;break;case HM:if(u=="/"){p=Zg;break}p=_o;continue;case ST:if(g.scheme=s.scheme,u==Ss)g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ks(s.path),g.query=s.query;else if(u=="/"||u=="\\"&&g.isSpecial())p=$M;else if(u=="?")g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ks(s.path),g.query="",p=gu;else{if(u!="#"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ks(s.path),g.path.length--,p=_o;continue}g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ks(s.path),g.query=s.query,g.fragment="",p=ra}break;case $M:if(!g.isSpecial()||u!="/"&&u!="\\"){if(u!="/"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,p=_o;continue}p=Zg}else p=Qg;break;case KM:if(p=Qg,u!="/"||Rs(v,E+1)!="/")continue;E++;break;case Qg:if(u!="/"&&u!="\\"){p=Zg;continue}break;case Zg:if(u=="@"){T&&(v="%40"+v),T=!0,d=$l(v);for(var N=0;N<d.length;N++){var P=d[N];if(P!=":"||O){var L=za(P,_T);O?g.password+=L:g.username+=L}else O=!0}v=""}else if(u==Ss||u=="/"||u=="?"||u=="#"||u=="\\"&&g.isSpecial()){if(T&&v=="")return"Invalid authority";E-=$l(v).length+1,v="",p=TT}else v+=u;break;case TT:case RT:if(i&&g.scheme=="file"){p=CT;continue}if(u!=":"||I){if(u==Ss||u=="/"||u=="?"||u=="#"||u=="\\"&&g.isSpecial()){if(g.isSpecial()&&v=="")return mu;if(i&&v==""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(v))return h;if(v="",p=ql,i)return;continue}u=="["?I=!0:u=="]"&&(I=!1),v+=u}else{if(v=="")return mu;if(h=g.parseHost(v))return h;if(v="",p=IT,i==RT)return}break;case IT:if(!qs(ET,u)){if(u==Ss||u=="/"||u=="?"||u=="#"||u=="\\"&&g.isSpecial()||i){if(v!=""){var x=zg(v,10);if(x>65535)return xM;g.port=g.isSpecial()&&x===Jg[g.scheme]?null:x,v=""}if(i)return;p=ql;continue}return xM}v+=u;break;case wT:if(g.scheme="file",u=="/"||u=="\\")p=qM;else{if(!s||s.scheme!="file"){p=_o;continue}if(u==Ss)g.host=s.host,g.path=Ks(s.path),g.query=s.query;else if(u=="?")g.host=s.host,g.path=Ks(s.path),g.query="",p=gu;else{if(u!="#"){BM(Qh(Ks(a,E),""))||(g.host=s.host,g.path=Ks(s.path),g.shortenPath()),p=_o;continue}g.host=s.host,g.path=Ks(s.path),g.query=s.query,g.fragment="",p=ra}}break;case qM:if(u=="/"||u=="\\"){p=CT;break}s&&s.scheme=="file"&&!BM(Qh(Ks(a,E),""))&&(tp(s.path[0],!0)?Kl(g.path,s.path[0]):g.host=s.host),p=_o;continue;case CT:if(u==Ss||u=="/"||u=="\\"||u=="?"||u=="#"){if(!i&&tp(v))p=_o;else if(v==""){if(g.host="",i)return;p=ql}else{if(h=g.parseHost(v))return h;if(g.host=="localhost"&&(g.host=""),i)return;v="",p=ql}continue}v+=u;break;case ql:if(g.isSpecial()){if(p=_o,u!="/"&&u!="\\")continue}else if(i||u!="?")if(i||u!="#"){if(u!=Ss&&(p=_o,u!="/"))continue}else g.fragment="",p=ra;else g.query="",p=gu;break;case _o:if(u==Ss||u=="/"||u=="\\"&&g.isSpecial()||!i&&(u=="?"||u=="#")){if((m=Yg(m=v))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),u=="/"||u=="\\"&&g.isSpecial()||Kl(g.path,"")):zte(v)?u=="/"||u=="\\"&&g.isSpecial()||Kl(g.path,""):(g.scheme=="file"&&!g.path.length&&tp(v)&&(g.host&&(g.host=""),v=Rs(v,0)+":"),Kl(g.path,v)),v="",g.scheme=="file"&&(u==Ss||u=="?"||u=="#"))for(;g.path.length>1&&g.path[0]==="";)Ute(g.path);u=="?"?(g.query="",p=gu):u=="#"&&(g.fragment="",p=ra)}else v+=za(u,jM);break;case zM:u=="?"?(g.query="",p=gu):u=="#"?(g.fragment="",p=ra):u!=Ss&&(g.path[0]+=za(u,Xg));break;case gu:i||u!="#"?u!=Ss&&(u=="'"&&g.isSpecial()?g.query+="%27":g.query+=u=="#"?"%23":za(u,Xg)):(g.fragment="",p=ra);break;case ra:u!=Ss&&(g.fragment+=za(u,FM))}E++}},parseHost:function(r){var i,s,a;if(Rs(r,0)=="["){if(Rs(r,r.length-1)!="]"||!(i=function(u){var d,h,m,g,p,E,v,T=[0,0,0,0,0,0,0,0],I=0,O=null,N=0,P=function(){return Rs(u,N)};if(P()==":"){if(Rs(u,1)!=":")return;N+=2,O=++I}for(;P();){if(I==8)return;if(P()!=":"){for(d=h=0;h<4&&qs(VM,P());)d=16*d+zg(P(),16),N++,h++;if(P()=="."){if(h==0||(N-=h,I>6))return;for(m=0;P();){if(g=null,m>0){if(!(P()=="."&&m<4))return;N++}if(!qs(ET,P()))return;for(;qs(ET,P());){if(p=zg(P(),10),g===null)g=p;else{if(g==0)return;g=10*g+p}if(g>255)return;N++}T[I]=256*T[I]+g,++m!=2&&m!=4||I++}if(m!=4)return;break}if(P()==":"){if(N++,!P())return}else if(P())return;T[I++]=d}else{if(O!==null)return;N++,O=++I}}if(O!==null)for(E=I-O,I=7;I!=0&&E>0;)v=T[I],T[I--]=T[O+E-1],T[O+--E]=v;else if(I!=8)return;return T}(Zh(r,1,-1))))return mu;this.host=i}else if(this.isSpecial()){if(r=Ote(r),qs(Hte,r)||(i=function(u){var d,h,m,g,p,E,v,T=Vte(u,".");if(T.length&&T[T.length-1]==""&&T.length--,(d=T.length)>4)return u;for(h=[],m=0;m<d;m++){if((g=T[m])=="")return u;if(p=10,g.length>1&&Rs(g,0)=="0"&&(p=qs(Bte,g)?16:8,g=Zh(g,p==8?1:2)),g==="")E=0;else{if(!qs(p==10?Wte:p==8?Gte:VM,g))return u;E=zg(g,p)}Kl(h,E)}for(m=0;m<d;m++)if(E=h[m],m==d-1){if(E>=LM(256,5-d))return null}else if(E>255)return null;for(v=xte(h),m=0;m<h.length;m++)v+=h[m]*LM(256,3-m);return v}(r))===null)return mu;this.host=i}else{if(qs($te,r))return mu;for(i="",s=$l(r),a=0;a<s.length;a++)i+=za(s[a],Xg);this.host=i}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return pT(Jg,this.scheme)},shortenPath:function(){var r=this.path,i=r.length;!i||this.scheme=="file"&&i==1&&tp(r[0],!0)||r.length--},serialize:function(){var r=this,i=r.scheme,s=r.username,a=r.password,u=r.host,d=r.port,h=r.path,m=r.query,g=r.fragment,p=i+":";return u!==null?(p+="//",r.includesCredentials()&&(p+=s+(a?":"+a:"")+"@"),p+=ep(u),d!==null&&(p+=":"+d)):i=="file"&&(p+="//"),p+=r.cannotBeABaseURL?h[0]:h.length?"/"+Qh(h,"/"):"",m!==null&&(p+="?"+m),g!==null&&(p+="#"+g),p},setHref:function(r){var i=this.parse(r);if(i)throw mT(i);this.searchParams.update()},getOrigin:function(){var r=this.scheme,i=this.port;if(r=="blob")try{return new zl(r.path[0]).origin}catch{return"null"}return r!="file"&&this.isSpecial()?r+"://"+ep(this.host)+(i!==null?":"+i:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(r){this.parse(na(r)+":",vT)},getUsername:function(){return this.username},setUsername:function(r){var i=$l(na(r));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<i.length;s++)this.username+=za(i[s],_T)}},getPassword:function(){return this.password},setPassword:function(r){var i=$l(na(r));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<i.length;s++)this.password+=za(i[s],_T)}},getHost:function(){var r=this.host,i=this.port;return r===null?"":i===null?ep(r):ep(r)+":"+i},setHost:function(r){this.cannotBeABaseURL||this.parse(r,TT)},getHostname:function(){var r=this.host;return r===null?"":ep(r)},setHostname:function(r){this.cannotBeABaseURL||this.parse(r,RT)},getPort:function(){var r=this.port;return r===null?"":na(r)},setPort:function(r){this.cannotHaveUsernamePasswordPort()||((r=na(r))==""?this.port=null:this.parse(r,IT))},getPathname:function(){var r=this.path;return this.cannotBeABaseURL?r[0]:r.length?"/"+Qh(r,"/"):""},setPathname:function(r){this.cannotBeABaseURL||(this.path=[],this.parse(r,ql))},getSearch:function(){var r=this.query;return r?"?"+r:""},setSearch:function(r){(r=na(r))==""?this.query=null:(Rs(r,0)=="?"&&(r=Zh(r,1)),this.query="",this.parse(r,gu)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var r=this.fragment;return r?"#"+r:""},setHash:function(r){(r=na(r))!=""?(Rs(r,0)=="#"&&(r=Zh(r,1)),this.fragment="",this.parse(r,ra)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var zl=function(r){var i=Ate(this,eE),s=arguments.length>1?arguments[1]:void 0,a=Pte(i,new AT(r,!1,s));dT||(i.href=a.serialize(),i.origin=a.getOrigin(),i.protocol=a.getProtocol(),i.username=a.getUsername(),i.password=a.getPassword(),i.host=a.getHost(),i.hostname=a.getHostname(),i.port=a.getPort(),i.pathname=a.getPathname(),i.search=a.getSearch(),i.searchParams=a.getSearchParams(),i.hash=a.getHash())},eE=zl.prototype,Is=function(r,i){return{get:function(){return qg(this)[r]()},set:i&&function(s){return qg(this)[i](s)},configurable:!0,enumerable:!0}};if(dT&&Cte(eE,{href:Is("serialize","setHref"),origin:Is("getOrigin"),protocol:Is("getProtocol","setProtocol"),username:Is("getUsername","setUsername"),password:Is("getPassword","setPassword"),host:Is("getHost","setHost"),hostname:Is("getHostname","setHostname"),port:Is("getPort","setPort"),pathname:Is("getPathname","setPathname"),search:Is("getSearch","setSearch"),searchParams:Is("getSearchParams"),hash:Is("getHash","setHash")}),Kg(eE,"toJSON",function(){return qg(this).serialize()},{enumerable:!0}),Kg(eE,"toString",function(){return qg(this).serialize()},{enumerable:!0}),Jh){var YM=Jh.createObjectURL,XM=Jh.revokeObjectURL;YM&&Kg(zl,"createObjectURL",PM(YM,Jh)),XM&&Kg(zl,"revokeObjectURL",PM(XM,Jh))}Nte(zl,"URL"),Ite({global:!0,forced:!wte,sham:!dT},{URL:zl});var JM=Go.URL;const Yte={[kl.ACCESS_POINT]:{[Jn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Jn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Jn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Jn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Jn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Jn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Jn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[kl.UNILBS]:{[Ii.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ii.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ii.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ii.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ii.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ii.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ii.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ii.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ii.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ii.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ii.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ii.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[kl.STRING_UID_ALLOCATOR]:{[Wh.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Wh.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Wh.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function tE(r){const i=Yte[Math.floor(r/1e4)];if(!i)return{desc:"unkonw error",retry:!1};const s=i[r%1e4];if(!s){if(Math.floor(r/1e4)===kl.ACCESS_POINT){const a=r%1e4;if(a.toString()[0]==="1")return{desc:r.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:r.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return s}const Xte={[Pe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Pe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Pe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Pe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Pe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Pe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Pe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Pe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Pe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Pe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Pe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Pe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Pe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Pe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Pe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Pe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Pe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Pe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Pe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Pe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Pe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Pe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Pe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Pe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Pe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Pe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Pe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Pe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Pe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Pe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Pe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Pe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Pe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Pe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Pe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Pe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Pe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Pe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Pe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Pe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Pe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Pe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Pe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Pe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Pe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Pe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Pe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Pe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Pe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Pe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Pe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Pe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Pe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Pe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Pe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Pe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Pe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Pe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Pe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Pe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Pe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Pe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Pe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Pe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function np(r){return Xte[r]||{desc:"UNKNOW_ERROR_".concat(r),action:"failed"}}class Jte extends Wt{get queue(){return[...this.highPriorityQueue,...this.lowPriorityQueue]}constructor(i){super(),C(this,"lowPriorityQueue",[]),C(this,"highPriorityQueue",[]),C(this,"AgoraWebSocketManager",void 0),this.AgoraWebSocketManager=i}reset(){this.lowPriorityQueue=[],this.highPriorityQueue=[]}pushMessage(i){arguments.length>1&&arguments[1]!==void 0&&arguments[1]?this.highPriorityQueue.push(i):this.lowPriorityQueue.push(i),this.sendMessage()}sendMessage(){const i=this.queue.length;let s=0;s=i<5?15*i:60+3*(i-4),setTimeout(()=>{this._sendMessage()},s)}_sendMessage(){if(!this.queue.length)return;const i=this.AgoraWebSocketManager.getConnection();if(!i||i.readyState!==1)return;const s=this.queue.shift();return this.lowPriorityQueue.includes(s)?this.lowPriorityQueue.shift():this.highPriorityQueue.shift(),i.send(s.compressed),s}}function QM(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}class Yl extends Wt{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){["tryNext","recover"].includes(i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(Ge.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ge.CONNECTED):this._state==="closed"?this.emit(Ge.CLOSED):this._state==="failed"&&this.emit(Ge.FAILED))}resetReconnectCount(i){D.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],u=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4?arguments[4]:void 0;super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"urls",void 0),C(this,"_reconnectMode","tryNext"),C(this,"reconnectReason",void 0),C(this,"_initMutex",new Ir("websocket")),C(this,"name",void 0),C(this,"_state","closed"),C(this,"reconnectInterrupter",void 0),C(this,"websocket",void 0),C(this,"retryConfig",void 0),C(this,"reconnectCount",0),C(this,"forceCloseTimeout",5e3),C(this,"onlineReconnectListener",void 0),C(this,"messageSender",void 0),C(this,"useCompress",void 0),C(this,"tryDoubleDomain",!1),C(this,"wsInflateLength",0),C(this,"wsDeflateLength",0),C(this,"closeEstablishingWs",()=>{}),C(this,"store",void 0),C(this,"joinChannelServiceRecordIndex",void 0),this.store=d,this.name=i,this.retryConfig=function(E){for(var v=1;v<arguments.length;v++){var T=arguments[v]!=null?arguments[v]:{};v%2?QM(Object(T),!0).forEach(function(I){C(E,I,T[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(T)):QM(Object(T)).forEach(function(I){Object.defineProperty(E,I,Object.getOwnPropertyDescriptor(T,I))})}return E}({},s),this.useCompress=a,this.tryDoubleDomain=u;const{timeout:h,timeoutFactor:m}=s,g=Math.max(300,Math.floor(3*h/5)),p=Math.max(1.2,Math.floor(8*m)/10);hr.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=p),an.on(Ha.NETWORK_STATE_CHANGE,(E,v)=>{E!==v&&(this.resetReconnectCount("network state change: ".concat(v," -> ").concat(E)),E===hr.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=s;const a=(u,d)=>{this.urls=i;const h=this.urls[this.currentURLIndex];this.state="connecting",this.messageSender=new Jte(this),this.createWebSocketConnection(h).then(u).catch(d),this.once(Ge.CLOSED,()=>d(new j(V.WS_DISCONNECT))),this.once(Ge.CONNECTED,()=>u())};return this._initMutex.lock().then(u=>new _e((d,h)=>{a(d,h)}).then(()=>{u()}).catch(()=>{u()}))}close(i,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,s){if(!this.websocket)return void D.warning("[".concat(this.name,"] can not reconnect, no websocket"));var a;i!==void 0&&(this.reconnectMode=i),D.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((a=this.store)===null||a===void 0||a.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinChannelServiceRecordIndex));const u=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),u&&u.bind(this.websocket)({code:9999,reason:s})}sendMessageWithJSON(i){const s=JSON.stringify(i);return{compressed:s,compressedLength:s.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}sendMessage(i){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1],a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new j(V.WS_ABORT,"websocket is not ready");try{let u=null;u=a?this.sendMessageWithUint8Array(i):this.sendMessageWithJSON(i),s?this.websocket.send(u.compressed):this.messageSender.pushMessage(u)}catch(u){throw new j(V.WS_ERR,"send websocket message error"+u.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(i,s){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new _e((a,u)=>{var d;const h=E=>{var v;(v=this.store)===null||v===void 0||v.signalChannelOpen(),D.debug("[".concat(this.name,"] websocket opened:"),E),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a()},m=async E=>{if(D.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const v=go(this,Ge.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,T=await this.reconnectWithAction(v);if(this.state==="closed")return void D.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return u(new j(V.WS_DISCONNECT,"websocket reconnect failed: ".concat(E.code))),void this.close(!0);a()}else u(new j(V.WS_DISCONNECT,"websocket close: ".concat(E.code))),this.close()},g=E=>{this.emit(Ge.ON_MESSAGE,E)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Q("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(i=Q("GATEWAY_WSS_ADDRESS")),D.debug("[".concat(this.name,"] start connect, url: ").concat(i));const p=(d=this.store)===null||d===void 0?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(i,!!s,p).then(E=>{var v;this.websocket=E,h&&h(E.url),E.onclose=m,E.onmessage=g,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this.joinChannelServiceRecordIndex=p}).catch(E=>{var v;if((v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:E instanceof j&&E.code===V.WS_ABORT?"aborted":"error",errors:[E]},p),this.state!=="closed"){if(E instanceof j&&E.code===V.WS_ERR){const T=new j(V.WS_ERR,"init websocket failed! Error: ".concat(E.toString()));return D.error("[".concat(this.name,"]").concat(T)),void u(T)}m&&m(E)}else u(new j(V.WS_DISCONNECT,"websocket is closed: ".concat(E.toString())))})})}async reconnectWithAction(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||an.networkState!==hr.OFFLINE||(this.onlineReconnectListener=an.onlineWaiter&&an.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>{a=!1},s){const h=lS(this.reconnectCount,this.retryConfig);D.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(i)),await _e.race([Bn(h),this.onlineReconnectListener||new _e(()=>{})])}if(this.state==="closed"||!a)return!1;this.reconnectCount+=1;const u=async(h,m)=>{this.emit(Ge.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(i==="retry"){const h=this.urls[this.currentURLIndex];this.emit(Ge.RECONNECT_WAITTING_FINISH,i),await u(h,i)}else if(i==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);D.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const h=this.urls[this.currentURLIndex];this.emit(Ge.RECONNECT_WAITTING_FINISH,i),await u(h,i)}else if(i==="recover"){D.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ge.RECONNECT_WAITTING_FINISH,i),this.urls=await nr(this,Ge.REQUEST_NEW_URLS),this.currentURLIndex=0;const h=this.urls[this.currentURLIndex];await u(h,i)}return!0}catch(h){var d;return D.error("[".concat(this.name,"] reconnect failed"),h.toString()),h!=null&&(d=h.data)!==null&&d!==void 0&&d.desc&&Array.isArray(h.data.desc)&&h.data.desc.length&&h.data.desc.includes("dynamic key expired")?(this.emit(Ge.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(i,s)}}async chooseBestWebsocketConnection(i,s,a){return new _e((u,d)=>{let h=!1;const m=[];this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),m.forEach(N=>{N.onclose=null,N.onopen=null,N.onmessage=null,N.close()}),d(new j(V.WS_ABORT,"choose best websocket aborted"))};const g=Q("GATEWAY_DOMAINS");let p;const E=i.indexOf("?h="),v=g.find(N=>E!==-1?i.includes(N,E):i.includes(N));D.debug("[choose-best-ws] currentDomain: ",v,", domains: ",g);let T=!this.tryDoubleDomain||s||!v;if(!T&&v){var I;const N=Date.now();try{g.forEach(P=>{const L=E===-1?i.replace(v,P):i.substr(0,E)+i.substr(E).replace(v,P),x=new WebSocket(L);x.binaryType="arraybuffer",m.push(x),D.debug("[choose-best-ws] ws is connecting:",x.url)})}catch{for(D.debug("[choose-best-ws] ws create failed, fallback to single url"),m.forEach(L=>L.close());m.length;)m.pop();T=!0}(I=this.store)===null||I===void 0||I.recordJoinChannelService({urls:m.map(P=>P.url),service:"gateway"},a),m.forEach(P=>{P.onopen=()=>{if(h)return;const L=Date.now()-N;D.debug("[choose-best-ws] ws open cost ".concat(L,"ms")),m.filter(x=>x!==P).forEach(x=>{D.debug("[choose-best-ws]close backup websocket: ".concat(x.url)),x.close()}),h=!0,u(P)},P.onclose=L=>{p=L,!h&&(m.find(x=>!(x.readyState===WebSocket.CLOSED||x.readyState===WebSocket.CLOSING))||(D.debug("[choose-best-ws] all websocket is closed"),h=!0,d(p)))},P.onmessage=L=>{D.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(L.data))}}),Bn(this.forceCloseTimeout).then(()=>{m.forEach(P=>{P.readyState!==WebSocket.OPEN&&P.close()})})}if(T){var O;let N;D.debug("[choose-best-ws] use single url: ",i),(O=this.store)===null||O===void 0||O.recordJoinChannelService({urls:[i],service:"gateway"},a);try{N=new WebSocket(i),m.push(N),N.binaryType="arraybuffer"}catch(P){const L=new j(V.WS_ERR,"init websocket failed! Error: ".concat(P.toString()));return D.error("[".concat(this.name,"]").concat(L)),void d(L)}N.onopen=()=>{u(N)},N.onclose=P=>{d(P)},N.onmessage=P=>{D.debug("[choose-best-ws]".concat(N.url," onmessage: ").concat(P.data))},Bn(this.forceCloseTimeout).then(()=>{N&&N.readyState!==WebSocket.OPEN&&N.close()})}}).then(u=>(this.closeEstablishingWs=void 0,u)).catch(u=>{throw this.closeEstablishingWs=void 0,u})}}class ZM{constructor(i){C(this,"input",[]),C(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}mean(){var i;return this.input.length===0?0:xa(i=this.input).call(i,(s,a)=>s+a)/this.input.length}}class ex extends Wt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Tt.CONNECTED?this.emit(Te.WS_CONNECTED):i===Tt.RECONNECTING?this.emit(Te.WS_RECONNECTING,this._websocketReconnectReason):i===Tt.CLOSED&&this.emit(Te.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,s){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Tt.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new ZM(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Te.ON_BINARY_DATA,a.data);const u=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(u,"_id")){const d="res-@".concat(u._id);this.emit(d,u._result,u._message)}else if(Object.prototype.hasOwnProperty.call(u,"_type")){if(this.emit(u._type,u._message),u._type===Ke.ON_NOTIFICATION&&this.handleNotification(u._message),u._type===Ke.ON_USER_BANNED)switch(u._message.error_code){case 14:this.close(_t.UID_BANNED);break;case 15:this.close(_t.IP_BANNED);break;case 16:this.close(_t.CHANNEL_BANNED)}if(u._type===Ke.ON_USER_LICENSE_BANNED)switch(u._message.error_code){case Pe.ERR_LICENSE_MISSING:this.close(_t.LICENSE_MISSING);break;case Pe.ERR_LICENSE_EXPIRED:this.close(_t.LICENSE_EXPIRED);break;case Pe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_t.LICENSE_MINUTES_EXCEEDED);break;case Pe.ERR_LICENSE_PERIOD_INVALID:this.close(_t.LICENSE_PERIOD_INVALID);break;case Pe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_t.LICENSE_MULTIPLE_SDK_SERVICE);break;case Pe.ERR_LICENSE_ILLEGAL:this.close(_t.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new Yl("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Tt.CONNECTED&&this.reconnect("retry",kr.OFFLINE)})}async request(i,s,a,u){const d=$t(6,""),h={_id:d,_type:i,_message:s},m=this.websocket.connectionID,g=()=>new _e((O,N)=>{if(this.connectionState===Tt.CONNECTED)return O();const P=()=>{this.off(Te.WS_CLOSED,L),O()},L=()=>{this.off(Te.WS_CONNECTED,P),N(new j(V.WS_ABORT))};this.once(Te.WS_CONNECTED,P),this.once(Te.WS_CLOSED,L),i!==Le.PUBLISH&&i!==Le.SUBSCRIBE&&i!==Le.UNSUBSCRIBE&&i!==Le.UNPUBLISH&&i!==Le.CONTROL&&i!==Le.RESTART_ICE||this.once(Te.DISCONNECT_P2P,()=>{N(new j(V.DISCONNECT_P2P))}),i!==Le.PUBLISH&&i!==Le.RESTART_ICE||this.once(Te.ABORT_P2P_EXECUTION,()=>{N(new j(V.DISCONNECT_P2P))})});if(this.connectionState!==Tt.CONNECTING&&this.connectionState!==Tt.RECONNECTING||i===Le.JOIN||i===Le.REJOIN||await g(),this.websocket.sendMessage(h,!0),u)return;const p=new _e((O,N)=>{let P=!1;const L=(W,q)=>{P=!0,O({isSuccess:W==="success",message:q||{}}),this.off(Te.WS_CLOSED,x),this.off(Te.WS_RECONNECTING,x),this.emit(Te.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(d),L);const x=()=>{N(new j(V.WS_ABORT,"type: ".concat(i))),this.off(Te.WS_CLOSED,x),this.off(Te.WS_RECONNECTING,x),this.off("res-@".concat(d),L)};this.once(Te.WS_CLOSED,x),this.once(Te.WS_RECONNECTING,x),Bn(Q("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||P||(D.warning("ws request timeout, type: ".concat(i)),this.emit(Te.REQUEST_TIMEOUT,i,s))})});let E=null;try{E=await p}catch(O){if(this.connectionState===Tt.CLOSED||i===Le.LEAVE)throw new j(V.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?O.throw():i===Le.JOIN||i===Le.REJOIN?null:(await g(),await this.request(i,s))}if(E.isSuccess)return E.message;const v=Number(E.message.error_code||E.message.code),T=np(v),I=new j(V.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(E.message.error_str),{code:v,data:E.message});return T.action==="success"?E.message:(D.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(v,", message: ").concat(T.desc,", action: ").concat(T.action)),v===Pe.ERR_TOO_MANY_BROADCASTERS?((i===Le.JOIN||i===Le.REJOIN)&&(this.initError=I,this.close()),I.throw()):T.action==="failed"?I.throw():T.action==="quit"?(this.initError=I,this.close(),I.throw()):(v===Pe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",kr.MULTI_IP)):this.reconnect(T.action,kr.SERVER_ERROR),i===Le.JOIN||i===Le.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new _e(a=>{const u=d=>{(!s||s(d))&&(this.off(i,u),a(d))};this.on(i,u)})}upload(i,s){const a={_type:i,_message:s};try{this.websocket.sendMessage(a)}catch{const d=Q("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Tt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Q("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,s){const a={_type:i,_message:s};this.websocket.sendMessage(a)}init(i,s){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new _e((a,u)=>{this.once(Te.WS_CONNECTED,()=>a(this.joinResponse)),this.once(Te.WS_CLOSED,()=>u(this.initError||new j(V.WS_ABORT))),this.connectionState=Tt.CONNECTING,this.websocket.init(i).catch(u),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{s&&this.openConnectionTime===void 0&&(D.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),u(new j(V.INIT_WEBSOCKET_TIMEOUT)))},Q("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||_t.LEAVE,this.connectionState=Tt.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===_t.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Yl("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Te.ABORT_P2P_EXECUTION);const i=await nr(this,Te.REQUEST_JOIN_INFO),s=await this.request(Le.JOIN,i);if(!s)return this.emit(Te.REPORT_JOIN_GATEWAY,V.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Te.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new j(V.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=hu(this,Te.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(Le.REJOIN,i);return!!s&&(this.connectionState=Tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(Ke.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Ke.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Ke.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Ke.MUTE_AUDIO,{uid:a.uid}):this.emit(Ke.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Ke.MUTE_VIDEO,{uid:a.uid}):this.emit(Ke.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Ke.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Ke.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Ke.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Ke.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Ke.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}handleNotification(i){D.debug("[".concat(this.clientId,"] receive notification: "),i);const s=np(i.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_t.UID_BANNED),void this.close()):void this.reconnect(s.action,kr.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=Q("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(D.warning("PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>Q("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",kr.TIMEOUT):this.request(Le.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),Q("REPORT_STATS")&&this.send(Le.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:s}=this.websocket.getWsInflateData();i!==0&&s!==0&&this.upload(zr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(Ge.RECONNECT_WAITTING_FINISH,i=>{this.emit(Te.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Ge.RECONNECT_CREATE_CONNECTION,i=>{this.emit(Te.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Ge.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ge.CLOSED,()=>{this.connectionState=Tt.CLOSED}),this.websocket.on(Ge.FAILED,()=>{this._disconnectedReason=_t.NETWORK_ERROR,this.connectionState=Tt.CLOSED}),this.websocket.on(Ge.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===Tt.CONNECTED?this.connectionState=Tt.RECONNECTING:this.connectionState=Tt.CONNECTING}),this.websocket.on(Ge.WILL_RECONNECT,(i,s)=>{if(hu(this,Te.IS_P2P_DISCONNECTED)&&i==="retry")return D.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Te.NEED_RENEW_SESSION),this.emit(Te.DISCONNECT_P2P),s("tryNext");i!=="retry"&&(D.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(Te.NEED_RENEW_SESSION),this.emit(Te.DISCONNECT_P2P)),s(i)}),this.websocket.on(Ge.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{D.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",kr.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(Te.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof j&&i.code===V.UNEXPECTED_RESPONSE&&i.data.code===Pe.ERR_NO_AUTHORIZED)return D.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",kr.SERVER_ERROR);D.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",kr.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Ge.REQUEST_NEW_URLS,(i,s)=>{nr(this,Te.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(Ge.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function tx(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}class Qte extends Wt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){["tryNext","recover"].includes(i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(zt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(zt.CONNECTED):this._state==="closed"?this.emit(zt.CLOSED):this._state==="failed"&&this.emit(zt.FAILED))}constructor(i,s,a,u){super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"reconnectReason",void 0),C(this,"_reconnectMode","tryNext"),C(this,"_initMutex",void 0),C(this,"_name",void 0),C(this,"_state","closed"),C(this,"_reconnectInterrupter",void 0),C(this,"_url",void 0),C(this,"_retryConfig",void 0),C(this,"_reconnectCount",0),C(this,"_forceCloseTimeout",5e3),C(this,"_onlineReconnectListener",void 0),C(this,"_messageSender",void 0),C(this,"_closeEstablishingTransmitter",()=>{}),C(this,"_store",void 0),C(this,"_joinChannelServiceRecordIndex",void 0),C(this,"_transmitter",void 0),C(this,"_useCompress",void 0),C(this,"_inflateLength",0),C(this,"_deflateLength",0),this._store=u,this._name=i,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?tx(Object(m),!0).forEach(function(g){C(d,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(m)):tx(Object(m)).forEach(function(g){Object.defineProperty(d,g,Object.getOwnPropertyDescriptor(m,g))})}return d}({},s),this._useCompress=a}resetReconnectCount(i){D.debug("".concat(this._name," reset reconnect count, reason: ").concat(i)),this._reconnectCount=0}close(i,s){var a;if(this.currentURLIndex=0,this.resetReconnectCount("close"),(a=this._messageSender)===null||a===void 0||a.reset(),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const u=this._transmitter;s?setTimeout(()=>u.close(),500):u.close(),this._transmitter=void 0}this.state=i?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(i,s){if(!this._transmitter)return void D.warning("[".concat(this._name,"] can not reconnect, no websocket"));var a;i!==void 0&&(this.reconnectMode=i),D.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((a=this._store)===null||a===void 0||a.recordJoinChannelService({status:"error",errors:[new Error(s)]},this._joinChannelServiceRecordIndex));const u=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),u&&u.bind(this._transmitter)({code:9999,reason:s})}getInflateData(){const i=this._inflateLength,s=this._deflateLength;return this.clearInflateData(),{inflateLength:i,deflateLength:s}}setInflateData(i){this._deflateLength=this._deflateLength+i.originLength,this._inflateLength=this._inflateLength+i.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function nx(r,i,s){if("getBigUint64"in DataView.prototype)return r.getBigUint64(i,s);const a=r.getUint32(i,s),u=r.getUint32(i+4,s),d=Number(!!s),h=Number(!s);return BigInt(a*h+u*d)<<BigInt(32)|BigInt(a*d+u*h)}function rx(r,i,s,a){if("setBigUint64"in DataView.prototype)return r.setBigUint64(i,s,a);const u=Number(s>>BigInt(32)),d=Number(s&BigInt(4294967295));a?(r.setUint32(i+4,u,a),r.setUint32(i,d,a)):(r.setUint32(i,u,a),r.setUint32(i+4,d,a))}let Yi;(function(r){r[r.Default=0]="Default",r[r.Ack=1]="Ack"})(Yi||(Yi={}));class Zte{constructor(i,s,a){C(this,"version",1),C(this,"initialRTO",void 0),C(this,"maxBatchAckCount",void 0),C(this,"maxRTO",void 0),C(this,"initialRTT",void 0),C(this,"ID",void 0),C(this,"rtt",void 0),C(this,"packetNumber",1),C(this,"rtoRatioMap",new Map),C(this,"timeoutMap",new Map),C(this,"unorderedPacketQueue",[]),C(this,"batchAckPacketQueue",[]),C(this,"lastOrderedPacketNumber",0),C(this,"batchAckTimer",void 0),C(this,"sendImpl",void 0),C(this,"receiveImpl",void 0),this.sendImpl=i,this.receiveImpl=s,this.ID=$t(7,"transmitter-"),this.initialRTO=(a==null?void 0:a.initialRTO)!==void 0?a.initialRTO:Q("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(a==null?void 0:a.initialRTT)!==void 0?a.initialRTT:Q("TRANSMITTER_INITIAL_RTT"),this.rtt=(a==null?void 0:a.initialRTT)!==void 0?a.initialRTT:Q("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(a==null?void 0:a.maxBatchAckCount)!==void 0?a.maxBatchAckCount:Q("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(a==null?void 0:a.maxRTO)!==void 0?a.maxRTO:Q("TRANSMITTER_MAX_RTO")}packetize(i,s){return{type:Yi.Default,version:this.version,packetNumber:s,payload:i}}serialize(i){switch(i.type){case Yi.Default:{let s;typeof i.payload=="string"?s=new TextEncoder().encode(i.payload):s=i.payload;const a=new ArrayBuffer(s.length+15),u=new DataView(a);return u.setUint16(0,i.version),u.setUint8(2,i.type),u.setUint32(3,i.packetNumber),rx(u,7,BigInt(i.sendTs)),new Uint8Array(u.buffer).set(s,15),a}case Yi.Ack:{const s=new ArrayBuffer(16),a=new DataView(s);return a.setUint16(0,i.version),a.setUint8(2,i.type),a.setUint32(3,i.maxAckPacketNumber),a.setUint8(7,i.shift),rx(a,8,BigInt(i.ackSendTs)),s}}}deserialize(i){const s=new DataView(i),a=s.getUint16(0),u=s.getUint8(2);switch(u){case Yi.Default:{const d=s.getUint32(3),h=nx(s,7),m=i.slice(15),g=new TextDecoder().decode(m);return{version:a,type:u,packetNumber:d,sendTs:Number(h),payload:g}}case Yi.Ack:{const d=s.getUint32(3),h=s.getUint8(7),m=nx(s,8);return{version:a,type:u,maxAckPacketNumber:d,shift:h,ackSendTs:Number(m)}}default:throw D.error("[".concat(this.ID,"] Unrecognized packet type ").concat(u)),new Error("Unrecognized packet type ".concat(u))}}sendMessage(i){const s=this.packetize(i,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const a=this.calculateRTO(s),u=window.setTimeout(()=>{this.resendMessage(s)},a);this.timeoutMap.set(s.packetNumber,u),this.sendPacket(s)}onData(i){const s=this.deserialize(i);s.type===Yi.Default?this.ack(s):s.type===Yi.Ack&&(this.updateRTT(s,Math.round(performance.now())),this.clearRTO(s))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(i=>{let[s,a]=i;window.clearTimeout(a)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(i){const s=this.calculateRTO(i),a=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,a),this.sendPacket(i)}calculateRTO(i){const s=this.rtoRatioMap.get(i.packetNumber);if(s===void 0)return this.rtoRatioMap.set(i.packetNumber,1),this.initialRTO;{const a=9*this.rtt/8*s;return this.rtoRatioMap.set(i.packetNumber,s+1),a>this.maxRTO?this.maxRTO:a}}updateRTT(i,s){const a=i.ackSendTs;this.rtt=this.rtt*(7/8)+(s-a-this.rtt)/8}ack(i){if(i.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(i):(this.batchAckPacketQueue.push(i),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(i.payload);;){const s=this.unorderedPacketQueue[0];if(!s){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(s.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(i.packetNumber<=this.lastOrderedPacketNumber){const s={ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:Yi.Ack,version:this.version};this.sendPacket(s)}else if(i.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[i.packetNumber-this.lastOrderedPacketNumber-2]=i;const s={ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:Yi.Ack,version:this.version};this.sendPacket(s)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const i={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Yi.Ack,version:this.version};this.sendPacket(i),this.batchAckPacketQueue=[]}sendPacket(i){i.type===Yi.Default&&(i.sendTs=Math.round(performance.now()));const s=this.serialize(i);this.sendImpl(s)}clearRTO(i){for(let s=i.maxAckPacketNumber-i.shift;s<=i.maxAckPacketNumber;s++){const a=this.timeoutMap.get(s);a!==void 0&&window.clearTimeout(a),this.timeoutMap.delete(s),this.rtoRatioMap.delete(s)}}}class ene extends Wt{get queue(){return[...this.highPriorityQueue,...this.lowPriorityQueue]}constructor(i){super(),C(this,"lowPriorityQueue",[]),C(this,"highPriorityQueue",[]),C(this,"AgoraTransmissionManager",void 0),this.AgoraTransmissionManager=i}reset(){this.lowPriorityQueue=[],this.highPriorityQueue=[]}pushMessage(i){arguments.length>1&&arguments[1]!==void 0&&arguments[1]?this.highPriorityQueue.push(i):this.lowPriorityQueue.push(i),this.sendMessage()}sendMessage(){const i=this.queue.length;let s=0;s=i<5?15*i:60+3*(i-4),setTimeout(()=>{this._sendMessage()},s)}_sendMessage(){if(!this.queue.length)return;const i=this.AgoraTransmissionManager.getConnection();if(!i)return;const s=this.queue.shift();return this.lowPriorityQueue.includes(s)?this.lowPriorityQueue.shift():this.highPriorityQueue.shift(),i.sendMessage(s.compressed),s}}class ix extends Qte{constructor(i,s){super(i,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),C(this,"_initMutex",void 0),C(this,"_reconnectInterrupter",void 0),C(this,"_url",void 0),C(this,"_transmitter",void 0),C(this,"_addresses",void 0),C(this,"_reliableTransmission",void 0),this._initMutex=new Ir("datachannel");const{timeout:a,timeoutFactor:u}=s,d=Math.max(300,Math.floor(3*a/5)),h=Math.max(1.2,Math.floor(8*u)/10);hr.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),an.on(Ha.NETWORK_STATE_CHANGE,(m,g)=>{m!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(m)),m===hr.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=u))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=s;const a=(u,d)=>{this._addresses=i,this.currentURLIndex=this._addresses.findIndex(m=>m.fingerprint||Q("FINGERPRINT"));const h=this._addresses[this.currentURLIndex];this.state="connecting",this._messageSender=new ene(this),this.createTransmitterConnection(h).then(u).catch(d),this.once(zt.CLOSED,()=>d(new j(V.WS_DISCONNECT))),this.once(zt.CONNECTED,()=>u())};return this._initMutex.lock().then(u=>new _e((d,h)=>{a(d,h)}).then(()=>{u()}).catch(()=>{u()}))}sendMessage(i){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1],a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new j(V.WS_ABORT,"datachannel is not ready");try{let u=null;u=a?this.sendMessageWithUint8Array(i):this.sendMessageWithJSON(i),s?this._reliableTransmission.sendMessage(u.compressed):this._messageSender.pushMessage(u)}catch(u){throw new j(V.WS_ERR,"send datachannel signal message error"+u.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(i){const s=JSON.stringify(i);return{compressed:s,compressedLength:s.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}createTransmitterConnection(i){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(i.ip,":").concat(i.port),new _e((s,a)=>{var u;const d=()=>{D.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s()},h=async E=>{var v;if((v=this._closeEstablishingTransmitter)===null||v===void 0||v.call(this),D.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const T=go(this,zt.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,I=await this.reconnectWithAction(T);if(this.state==="closed")return void D.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!I)return a(new j(V.WS_DISCONNECT,"datachannel reconnect failed: ".concat(E.code))),void this.close(!0);s()}else a(new j(V.WS_DISCONNECT,"datachannel close: ".concat(E.code))),this.close()},m=E=>{var v;(v=this._reliableTransmission)===null||v===void 0||v.onData(E.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),D.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(i)));const g=(u=this._store)===null||u===void 0?void 0:u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),p=Date.now();nr(this,zt.TO_CONNECT_DATACHANNEL,i).then(E=>{var v,T;if(!E)throw new Error("transmissonInfo not exist yet");const{transmitter:I,close:O}=E;this._transmitter=I,(v=this._store)===null||v===void 0||v.signalChannelOpen();const N=Date.now()-p;D.debug("[choose dc] dc open cost ".concat(N,"ms")),this._reliableTransmission=new Zte(P=>{var L;this._transmitter&&this._transmitter.readyState==="open"&&((L=this._transmitter)===null||L===void 0||L.send(P))},P=>{typeof P=="string"&&this.emit(zt.ON_MESSAGE,P)}),this._closeEstablishingTransmitter=()=>{var P;(P=this._reliableTransmission)===null||P===void 0||P.close(),this._reliableTransmission=void 0,O()},d&&d(),I.onclose=h,I.onmessage=m,(T=this._store)===null||T===void 0||T.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this._joinChannelServiceRecordIndex=g}).catch(E=>{var v;if((v=this._store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:E instanceof j&&E.code===V.WS_ABORT?"aborted":"error",errors:[E]},g),this.state!=="closed"){if(E instanceof j&&E.code===V.WS_ERR){const T=new j(V.WS_ERR,"init datachannel failed! Error: ".concat(E.toString()));return D.error("[".concat(this._name,"]").concat(T)),void a(T)}h&&h(E)}else a(new j(V.WS_DISCONNECT,"datachannel is closed: ".concat(E.toString())))})})}async reconnectWithAction(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||an.networkState!==hr.OFFLINE||(this._onlineReconnectListener=an.onlineWaiter&&an.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let a=!0;if(this._reconnectInterrupter=()=>{a=!1},s){const h=lS(this._reconnectCount,this._retryConfig);D.debug("[".concat(this._name,"] wait ").concat(h,"ms to reconnect datachannel, mode: ").concat(i)),await _e.race([Bn(h),this._onlineReconnectListener||new _e(()=>{})])}if(this.state==="closed"||!a)return!1;this._reconnectCount+=1;const u=async(h,m)=>{this.emit(zt.RECONNECT_CREATE_CONNECTION,m),await this.createTransmitterConnection(h)};try{if(i==="retry"){const h=this._addresses[this.currentURLIndex];this.emit(zt.RECONNECT_WAITTING_FINISH,i),await u(h,i)}else if(i==="tryNext"){this.currentURLIndex+=1;for(let m=this.currentURLIndex;m<this._addresses.length;m++){if(this._addresses[m].fingerprint||Q("FINGERPRINT")){this.currentURLIndex=m;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return D.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);D.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const h=this._addresses[this.currentURLIndex];this.emit(zt.RECONNECT_WAITTING_FINISH,i),await u(h,i)}else i==="recover"&&(D.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(zt.RECONNECT_WAITTING_FINISH,i),this.emit(zt.FAILBACK));return!0}catch(h){var d;return D.error("[".concat(this._name,"] reconnect failed"),h.toString()),h!=null&&(d=h.data)!==null&&d!==void 0&&d.desc&&Array.isArray(h.data.desc)&&h.data.desc.length&&h.data.desc.includes("dynamic key expired")?(this.emit(zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(i,s)}}}class ia extends Wt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Tt.CONNECTED?this.emit(Te.WS_CONNECTED):i===Tt.RECONNECTING?this.emit(Te.WS_RECONNECTING,this._websocketReconnectReason):i===Tt.CLOSED&&this.emit(Te.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,s){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Tt.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new ZM(5)),C(this,"pingpongTimer",void 0),C(this,"inflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",a=>{if(a instanceof ArrayBuffer)return void this.emit(Te.ON_BINARY_DATA,a);const u=JSON.parse(a);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(u,"_id")){const d="res-@".concat(u._id);this.emit(d,u._result,u._message)}else if(Object.prototype.hasOwnProperty.call(u,"_type")&&(this.emit(u._type,u._message),u._type===Ke.ON_NOTIFICATION&&this.handleNotification(u._message),u._type===Ke.ON_USER_BANNED))switch(u._message.error_code){case 14:this.close(_t.UID_BANNED);break;case 15:this.close(_t.IP_BANNED);break;case 16:this.close(_t.CHANNEL_BANNED)}}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new ix("gateway-".concat(this.clientId),this.spec.retryConfig,!0,s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Tt.CONNECTED&&this.reconnect("retry",fo.OFFLINE)})}async request(i,s,a,u){const d=$t(6,""),h={_id:d,_type:i,_message:s},m=this.websocket.connectionID,g=()=>new _e((O,N)=>{if(this.connectionState===Tt.CONNECTED)return O();const P=()=>{this.off(Te.WS_CLOSED,L),O()},L=()=>{this.off(Te.WS_CONNECTED,P),N(new j(V.WS_ABORT))};this.once(Te.WS_CONNECTED,P),this.once(Te.WS_CLOSED,L),i!==Le.PUBLISH&&i!==Le.SUBSCRIBE&&i!==Le.UNSUBSCRIBE&&i!==Le.UNPUBLISH&&i!==Le.CONTROL&&i!==Le.RESTART_ICE||this.once(Te.DISCONNECT_P2P,()=>{N(new j(V.DISCONNECT_P2P))}),i!==Le.PUBLISH&&i!==Le.RESTART_ICE||this.once(Te.ABORT_P2P_EXECUTION,()=>{N(new j(V.DISCONNECT_P2P))})});if(this.connectionState!==Tt.CONNECTING&&this.connectionState!==Tt.RECONNECTING||i===Le.JOIN||i===Le.REJOIN||await g(),i===Le.LEAVE&&(this.websocket.unbindDcCloseEventListener(),u=!0),this.websocket.sendMessage(h,!0,!1),u)return;const p=new _e((O,N)=>{let P=!1;const L=(W,q)=>{P=!0,O({isSuccess:W==="success",message:q||{}}),this.off(Te.WS_CLOSED,x),this.off(Te.WS_RECONNECTING,x),this.emit(Te.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(d),L);const x=()=>{N(new j(V.WS_ABORT,"type: ".concat(i))),this.off(Te.WS_CLOSED,x),this.off(Te.WS_RECONNECTING,x),this.off("res-@".concat(d),L)};this.once(Te.WS_CLOSED,x),this.once(Te.WS_RECONNECTING,x),Bn(Q("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||P||(D.warning("dc request timeout, type: ".concat(i)),this.emit(Te.REQUEST_TIMEOUT,i,s))})});let E=null;try{E=await p}catch(O){if(this.connectionState===Tt.CLOSED||i===Le.LEAVE)throw new j(V.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?O.throw():i===Le.JOIN||i===Le.REJOIN?null:(await g(),await this.request(i,s))}if(E.isSuccess)return E.message;const v=Number(E.message.error_code||E.message.code),T=np(v),I=new j(V.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(E.message.error_str),{code:v,data:E.message});return T.action==="success"?E.message:(D.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(v,", message: ").concat(T.desc,", action: ").concat(T.action)),v===Pe.ERR_TOO_MANY_BROADCASTERS?((i===Le.JOIN||i===Le.REJOIN)&&(this.initError=I,this.close()),I.throw()):T.action==="failed"?I.throw():T.action==="quit"?(this.initError=I,this.close(),I.throw()):(v===Pe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",fo.MULTI_IP)):this.reconnect(T.action,fo.SERVER_ERROR),i===Le.JOIN||i===Le.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new _e(a=>{const u=d=>{(!s||s(d))&&(this.off(i,u),a(d))};this.on(i,u)})}upload(i,s){const a={_type:i,_message:s};try{this.websocket.sendMessage(a)}catch{const d=Q("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Tt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},Q("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,s){const a={_type:i,_message:s};this.websocket.sendMessage(a)}init(i,s){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new _e((a,u)=>{this.once(Te.WS_CONNECTED,()=>a(this.joinResponse)),this.once(Te.WS_CLOSED,()=>u(this.initError||new j(V.WS_ABORT))),this.connectionState=Tt.CONNECTING,this.websocket.init(i).catch(u),this.websocket.once(zt.FAILBACK,()=>{this.openConnectionTime===void 0&&u(new j(V.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{s&&this.openConnectionTime===void 0&&(D.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),u(new j(V.INIT_DATACHANNEL_TIMEOUT)))},Q("DC_JOIN_WITH_FAILBACK"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||_t.LEAVE,this.connectionState=Tt.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),i===_t.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new ix("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Te.ABORT_P2P_EXECUTION);const i=await nr(this,Te.DATACHANNEL_CONNECTING),s=await this.request(Le.JOIN,i);if(!s)return this.emit(Te.REPORT_JOIN_GATEWAY,V.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Te.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new j(V.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=hu(this,Te.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(Le.REJOIN,i);return!!s&&(this.connectionState=Tt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(Ke.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Ke.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Ke.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Ke.MUTE_AUDIO,{uid:a.uid}):this.emit(Ke.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Ke.MUTE_VIDEO,{uid:a.uid}):this.emit(Ke.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Ke.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Ke.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Ke.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Ke.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Ke.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}handleNotification(i){D.debug("[".concat(this.clientId,"] receive notification: "),i);const s=np(i.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_t.UID_BANNED),void this.close()):void this.reconnect(s.action,fo.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=Q("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(D.warning("PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>Q("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",fo.TIMEOUT):this.request(Le.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),Q("REPORT_STATS")&&this.send(Le.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleInflateData(){const{inflateLength:i,deflateLength:s}=this.websocket.getInflateData();i!==0&&s!==0&&this.upload(zr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(zt.RECONNECT_WAITTING_FINISH,i=>{this.emit(Te.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(zt.RECONNECT_CREATE_CONNECTION,i=>{this.emit(Te.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(zt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(zt.CLOSED,()=>{this.connectionState=Tt.CLOSED}),this.websocket.on(zt.FAILED,()=>{this._disconnectedReason=_t.NETWORK_ERROR,this.connectionState=Tt.CLOSED}),this.websocket.on(zt.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===Tt.CONNECTED?this.connectionState=Tt.RECONNECTING:this.connectionState=Tt.CONNECTING}),this.websocket.on(zt.WILL_RECONNECT,(i,s)=>{if(hu(this,Te.IS_P2P_DISCONNECTED)&&i==="retry")return D.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Te.NEED_RENEW_SESSION),this.emit(Te.DISCONNECT_P2P),s("tryNext");i!=="retry"&&(D.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(Te.NEED_RENEW_SESSION),this.emit(Te.DISCONNECT_P2P)),s(i)}),this.websocket.on(zt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{D.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",fo.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(Te.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof j&&i.code===V.UNEXPECTED_RESPONSE&&i.data.code===Pe.ERR_NO_AUTHORIZED)return D.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",fo.SERVER_ERROR);D.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",fo.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(zt.REQUEST_NEW_URLS,(i,s)=>{nr(this,Te.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(zt.TO_CONNECT_DATACHANNEL,async(i,s,a)=>nr(this,Te.DATACHANNEL_PRECONNECT,i).then(s).catch(a)),this.websocket.on(zt.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Te.DATACHANNEL_FAILBACK)})}}function sx(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function vo(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?sx(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):sx(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}const bT=new Map;class tne extends Wt{get state(){return this._state}set state(i){if(i===this._state)return;const s=this._state;this._state=i,i==="DISCONNECTED"&&this._disconnectedReason?this.emit(Gt.CONNECTION_STATE_CHANGE,i,s,this._disconnectedReason):this.emit(Gt.CONNECTION_STATE_CHANGE,i,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){D.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,s){super(),C(this,"store",void 0),C(this,"joinInfo",void 0),C(this,"key",void 0),C(this,"signal",void 0),C(this,"role",void 0),C(this,"inChannelInfo",{joinAt:null,duration:0}),C(this,"spec",void 0),C(this,"_state","DISCONNECTED"),C(this,"_statsCollector",void 0),C(this,"_disconnectedReason",void 0),C(this,"isSignalRecover",!1),C(this,"hasChangeBGPAddress",!1),C(this,"trafficStatsInterval",void 0),C(this,"networkQualityInterval",void 0),C(this,"_joinGatewayStartTime",0),C(this,"_signalTimeout",!1),C(this,"_clientRoleOptions",void 0),C(this,"_isProactiveJoin",!1),this.store=i,this.spec=s;const a=er().supportDataChannel&&Q("SIGNAL_CHANNEL");this.signal=a?new ia(vo(vo({},s),{},{retryConfig:s.websocketRetryConfig}),i):new ex(vo(vo({},s),{},{retryConfig:s.websocketRetryConfig}),i),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(i,s,a){if(this.signal instanceof ia){let g=!1;i.cloudProxyServer!=="disabled"?(D.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(i.cloudProxyServer,")")),g=!0):"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length>255||"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length<22?(D.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),g=!0):i.apResponse.addresses.some(p=>p.fingerprint)||Q("FINGERPRINT")||(D.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),g=!0),g&&this.resetSignal()}this.store.joinGatewayStart(),i.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const u=Date.now();let d=bT.get(i.cname);if(d||(d=new Map,bT.set(i.cname,d)),this._isProactiveJoin=!0,d.has(i.uid)){const g=new j(V.UID_CONFLICT);throw Ie.joinGateway(i.sid,{lts:u,succ:!1,ec:g.message,addr:null,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:this.signal instanceof ia?"1":"0"}),this._isProactiveJoin=!1,g}d.set(i.uid,!0),this.joinInfo=i,this.key=s;let h=0;this.joinGatewayStartTime=u;const m=i.proxyServer;try{let g;if(D.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof ia?"datachannel":"websocket"," join uid ").concat(h)),this.signal instanceof ia)g=await this.signal.init(i.apResponse.addresses,a);else{const p=i.proxyServer,E=p?i.gatewayAddrs.map(v=>{const T=v.address.split(":");return"wss://".concat(p,"/ws/?h=").concat(T[0],"&p=").concat(T[1])}):i.gatewayAddrs.map(v=>"wss://".concat(v.address));g=await this.signal.init(E,a)}h=g.uid,D.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof ia?"datachannel":"websocket"," join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(g){throw g&&g.code===V.INIT_WEBSOCKET_TIMEOUT?(D.warning("[".concat(this.store.clientId,"] User join failed"),g.toString()),g):g&&g.code===V.INIT_DATACHANNEL_TIMEOUT?(D.warning("[".concat(this.store.clientId,"] User join datachannel failed"),g.toString()),this.resetSignal(),g):(D.error("[".concat(this.store.clientId,"] User join failed"),g.toString()),Ie.joinGateway(i.sid,{lts:u,succ:!1,ec:g.message,addr:this.signal.url,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:this.signal instanceof ia?"1":"0"}),this._isProactiveJoin=!1,d.delete(i.uid),this.signal.close(),g)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),D.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(g=>{D.warning("[".concat(this.store.clientId,"] get traffic stats error"),g.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Gt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Gt.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Gt.NETWORK_QUALITY,{uplinkNetworkQuality:zL(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:zL(this._statsCollector.trafficStats.B_dnq)}):this.emit(Gt.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==_t.FALLBACK&&(this.state="DISCONNECTING");try{i||this.signal.connectionState!==Tt.CONNECTED||await function(a,u){return u===1/0?a:_e.race([a,yee(u)])}(this.signal.request(Le.LEAVE,void 0,!0),3e3)}catch(a){D.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==_t.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(i,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(V.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:Q("PUB_EXTEND"),tcc:!!Q("PUBLISH_TCC")};try{return(await this.signal.request(Le.PUBLISH,u,!0))._message}catch(d){if(a&&d.data&&d.data.code===Pe.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(i,s),this.publish(i,s,!1);throw d}}async unpublish(i,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(V.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Le.UNPUBLISH,{stream_id:s,ortc:i},!0)}catch(a){D.warning("unpublish warning: ",a)}}async subscribe(i,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(V.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const u={stream_id:i,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,tcc:!!Q("SUBSCRIBE_TCC"),extend:Q("SUB_EXTEND"),ssrcId:s.ssrcId};try{return(await this.signal.request(Le.SUBSCRIBE,u,!0))._message}catch(d){if(a&&d.data&&d.data.code===Pe.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(i,s),await this.subscribe(i,s,!1);throw d}}async subscribeAll(i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new j(V.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:i,dtx:!1};try{return await this.signal.request(Le.SUBSCRIBE_STREAMS,a,!0)}catch(u){if(s&&u.data&&u.data.code===Pe.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),u.toString()),await this.tryMassUnsubBeforeResub(i),await this.subscribeAll(i,!1);throw u}}async setVideoProfile(i){const s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let u=a.frameRate,d=a.width,h=a.height,m=!0;return typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,u||(m=!1)),m?{stream_type:0,width:d,height:h,fps:u,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(i);if(s)return this.signal.request(Le.SET_VIDEO_PROFILE,s);D.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(i,s){try{await this.signal.request(Le.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:i,stream_id:s},!0)}catch(a){D.warning("unsubscribe warning: ",a)}}async massUnsubscribe(i){try{await this.signal.request(Le.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){D.warning("unsubscribeAll warning: ",s)}}async reconnectPC(i){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:u}=i;return{gatewayEstablishParams:await this.signal.request(Le.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:u}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Le.GATEWAY_INFO)}renewToken(i){return this.signal.request(Le.RENEW_TOKEN,i)}async setClientRole(i,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),this.state!=="CONNECTED")return void(this.role=i);let a;a=i==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(Le.SET_CLIENT_ROLE,{role:i,level:a,client_ts:Date.now()}),this.role=i}async setRemoteVideoStreamType(i,s){await this.signal.request(Le.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:s})}async setDefaultRemoteVideoStreamType(i){await this.signal.request(Le.DEFAULT_VIDEO_STREAM,{stream_type:i})}async setStreamFallbackOption(i,s){await this.signal.request(Le.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:s})}async pickSVCLayer(i,s){await this.signal.request(Le.PICK_SVC_LAYER,{stream_id:i,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),vo({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Le.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=bT.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Ri.username,password:Ri.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(vo(vo({},Ri),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const i=await this.signal.request(Le.TRAFFIC_STATS,void 0,!0);i.timestamp=Date.now(),i.peer_delay.forEach(s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(u=>u.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&ys(()=>{this.emit(Gt.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(i)}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new j(V.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let a=Q("REPORT_APP_SCENARIO");if(typeof a!="string")try{a=JSON.stringify(a)}catch{a=void 0}a&&a.length>128&&(a=void 0);const u=vo({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Hi,browser:navigator.userAgent,process_id:Q("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:Q("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:{enablePublishedUserList:Q("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Q("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof Q("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?Q("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof Q("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?Q("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof Q("ENABLE_USER_LICENSE_CHECK")=="boolean"?Q("ENABLE_USER_LICENSE_CHECK"):void 0}},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(u.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(u.aes_mode=this.joinInfo.aesmode,Q("ENCRYPT_AES")?(u.aes_secret=this.joinInfo.aespassword,u.aes_encrypt=!0):u.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(u.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(u.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(u.default_video_stream=this.joinInfo.defaultVideoStream),u}getRejoinMessage(){if(!this.joinInfo)throw new j(V.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Te.WS_RECONNECT_WAITTING_FINISH,i=>{["tryNext","recover"].includes(i)&&this.joinInfo&&Ie.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Te.WS_RECONNECT_CREATE_CONNECTION,i=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Te.WS_RECONNECTING,i=>{this.joinInfo&&Ie.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i||kr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ie.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Te.WS_CLOSED,i=>{let s;switch(i){case _t.LEAVE:s=kr.LEAVE;break;case _t.UID_BANNED:case _t.IP_BANNED:case _t.CHANNEL_BANNED:case _t.SERVER_ERROR:s=kr.SERVER_ERROR;break;case _t.FALLBACK:s=kr.FALLBACK;break;case _t.LICENSE_MISSING:case _t.LICENSE_EXPIRED:case _t.LICENSE_MINUTES_EXCEEDED:case _t.LICENSE_PERIOD_INVALID:case _t.LICENSE_MULTIPLE_SDK_SERVICE:case _t.LICENSE_ILLEGAL:s=i;break;default:s=kr.NETWORK_ERROR}D.debug("[signal] websocket closed, reason: ".concat(s||"undefined -> "+kr.NETWORK_ERROR)),this.joinInfo&&Ie.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:i===_t.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=i,i!==_t.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Te.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(D.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),Ie.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ia?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const i=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!i)return void D.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(i));Dt("EVENT_REPORT_DOMAIN",i[1]),Dt("EVENT_REPORT_BACKUP_DOMAIN",i[1]),Dt("LOG_UPLOAD_SERVER","".concat(i[1],":6444"))}}),this.signal.on(Ke.ON_UPLINK_STATS,i=>{this._statsCollector.updateUplinkStats(i)}),this.signal.on(Te.REQUEST_RECOVER,(i,s,a)=>{if(!this.joinInfo)return a(new j(V.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));i&&(this.joinInfo.multiIP=i,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,nr(this,Gt.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on(Te.REQUEST_JOIN_INFO,async i=>{var s;this.updateTurnConfigFromSignal();const{iceParameters:a,dtlsParameters:u,rtpCapabilities:d}=await nr(this,Gt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(s=this.joinInfo)===null||s===void 0?void 0:s.turnServer});i(this.getJoinMessage({ortc:{iceParameters:a,dtlsParameters:u,rtpCapabilities:d,version:"2"}}))}),this.signal.on(Te.REQUEST_REJOIN_INFO,i=>{i(this.getRejoinMessage())}),this.signal.on(Te.REPORT_JOIN_GATEWAY,(i,s)=>{this.joinInfo&&(Ie.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ia?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(Te.IS_P2P_DISCONNECTED,i=>{i(hu(this,Gt.IS_P2P_DISCONNECTED))}),this.signal.on(Te.DISCONNECT_P2P,()=>{this.emit(Gt.DISCONNECT_P2P)}),this.signal.on(Te.NEED_RENEW_SESSION,()=>{this.emit(Gt.NEED_RENEW_SESSION)}),this.signal.on(Te.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Te.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Te.JOIN_RESPONSE,i=>{const s=this.getCurrentGatewayAddress();this.emit(Gt.JOIN_RESPONSE,i,s)}),this.signal.on(Te.DATACHANNEL_PRECONNECT,async(i,s,a)=>{this.updateTurnConfigFromSignal();const u=this.getCurrentGatewayAddress();return nr(this,Gt.DATACHANNEL_PRECONNECT,i,u).then(s).catch(a)}),this.signal.on(Te.DATACHANNEL_CONNECTING,async i=>{const{iceParameters:s,dtlsParameters:a,rtpCapabilities:u}=await nr(this,Gt.REQUEST_DC_CONNECTION_PARAMS);i(this.getJoinMessage({ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:u,version:"2"}}))}),this.signal.on(Te.DATACHANNEL_FAILBACK,()=>{D.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Gt.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(i,s){try{await this.signal.request(Le.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:i,ortc:[s]},!0)}catch(a){throw D.warning("unsubscribe warning",a),a}}async tryUnpubBeforeRepub(i,s){try{await this.signal.request(Le.UNPUBLISH,{stream_id:i,ortc:s},!0)}catch(a){throw D.warning("unpublish warning: ",a),a}}async tryMassUnsubBeforeResub(i){const s={users:i.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(Le.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw D.warning("massUnsubscribe warning",a),a}}async muteLocal(i,s){const a={action:i.find(u=>u.stream_type===pn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:s};try{await this.signal.request(Le.CONTROL,a,!0,!0)}catch(u){throw D.warning("gateway unmuteLocal warning: ",u),u}}async unmuteLocal(i,s){const a={action:i.find(u=>u.stream_type===pn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:s};try{await this.signal.request(Le.CONTROL,a,!0,!0)}catch(u){throw D.warning("gateway muteLocal warning: ",u),u}}uploadStats(i,s){this.signal.upload(i,s)}getSignalRTT(){return this.signal.rtt}async restartICE(i){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:i};try{return await this.signal.request(Le.RESTART_ICE,s,!0)}catch(a){throw D.warning("P2PChannel.restartICE warning: ",a),a}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,kr.P2P_FAILED)}getCurrentGatewayAddress(){var i;if(!Q("GATEWAY_WSS_ADDRESS"))return(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(i){await this.signal.request(Le.SET_PARAMETER,{enablePublishAudioFilter:i})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(_t.FALLBACK)),this.signal=new ex(vo(vo({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Gt.RESET_CONNECTION_EVENTS)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */function ox(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function ax(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?ox(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):ox(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}(function(){var r;function i($){var Z=0;return function(){return Z<$.length?{done:!1,value:$[Z++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function($,Z,se){return $==Array.prototype||$==Object.prototype||($[Z]=se.value),$},a,u=function($){$=[typeof globalThis=="object"&&globalThis,$,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var Z=0;Z<$.length;++Z){var se=$[Z];if(se&&se.Math==Math)return se}throw Error("Cannot find global object")}(this);function d($,Z){if(Z)e:{var se=u;$=$.split(".");for(var pe=0;pe<$.length-1;pe++){var Oe=$[pe];if(!(Oe in se))break e;se=se[Oe]}(Z=Z(pe=se[$=$[$.length-1]]))!=pe&&Z!=null&&s(se,$,{configurable:!0,writable:!0,value:Z})}}function h($){return($={next:$})[Symbol.iterator]=function(){return this},$}function m($){var Z=typeof Symbol<"u"&&Symbol.iterator&&$[Symbol.iterator];return Z?Z.call($):{next:i($)}}if(d("Symbol",function($){function Z(Oe,ce){this.A=Oe,s(this,"description",{configurable:!0,writable:!0,value:ce})}if($)return $;Z.prototype.toString=function(){return this.A};var se="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",pe=0;return function Oe(ce){if(this instanceof Oe)throw new TypeError("Symbol is not a constructor");return new Z(se+(ce||"")+"_"+pe++,ce)}}),d("Symbol.iterator",function($){if($)return $;$=Symbol("Symbol.iterator");for(var Z="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),se=0;se<Z.length;se++){var pe=u[Z[se]];typeof pe=="function"&&typeof pe.prototype[$]!="function"&&s(pe.prototype,$,{configurable:!0,writable:!0,value:function(){return h(i(this))}})}return $}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var g;e:{var p={};try{p.__proto__={a:!0},g=p.a;break e}catch{}g=!1}a=g?function($,Z){if($.__proto__=Z,$.__proto__!==Z)throw new TypeError($+" is not extensible");return $}:null}var E=a;function v(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function T($){if($.m)throw new TypeError("Generator is already running");$.m=!0}function I($,Z){return $.h=3,{value:Z}}function O($){this.g=new v,this.G=$}function N($,Z,se,pe){try{var Oe=Z.call($.g.j,se);if(!(Oe instanceof Object))throw new TypeError("Iterator result "+Oe+" is not an object");if(!Oe.done)return $.g.m=!1,Oe;var ce=Oe.value}catch(A){return $.g.j=null,$.g.s(A),P($)}return $.g.j=null,pe.call($.g,ce),P($)}function P($){for(;$.g.h;)try{var Z=$.G($.g);if(Z)return $.g.m=!1,{value:Z.value,done:!1}}catch(se){$.g.v=void 0,$.g.s(se)}if($.g.m=!1,$.g.l){if(Z=$.g.l,$.g.l=null,Z.F)throw Z.D;return{value:Z.return,done:!0}}return{value:void 0,done:!0}}function L($){this.next=function(Z){return $.o(Z)},this.throw=function(Z){return $.s(Z)},this.return=function(Z){return function(se,pe){T(se.g);var Oe=se.g.j;return Oe?N(se,"return"in Oe?Oe.return:function(ce){return{value:ce,done:!0}},pe,se.g.return):(se.g.return(pe),P(se))}($,Z)},this[Symbol.iterator]=function(){return this}}function x($,Z){return Z=new L(new O(Z)),E&&$.prototype&&E(Z,$.prototype),Z}if(v.prototype.o=function($){this.v=$},v.prototype.s=function($){this.l={D:$,F:!0},this.h=this.C||this.u},v.prototype.return=function($){this.l={return:$},this.h=this.u},O.prototype.o=function($){return T(this.g),this.g.j?N(this,this.g.j.next,$,this.g.o):(this.g.o($),P(this))},O.prototype.s=function($){return T(this.g),this.g.j?N(this,this.g.j.throw,$,this.g.o):(this.g.s($),P(this))},d("Array.prototype.entries",function($){return $||function(){return function(Z,se){Z instanceof String&&(Z+="");var pe=0,Oe=!1,ce={next:function(){if(!Oe&&pe<Z.length){var A=pe++;return{value:se(A,Z[A]),done:!1}}return Oe=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce}(this,function(Z,se){return[Z,se]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var W=function($,Z){for(var se=0;se<$.length;se++)Z($[se])},q=function($){return $.replace(/\r?\n|\r/g,`\r
`)},X=function($,Z,se){return Z instanceof Blob?(se=se!==void 0?String(se+""):typeof Z.name=="string"?Z.name:"blob",Z.name===se&&Object.prototype.toString.call(Z)!=="[object Blob]"||(Z=new File([Z],se)),[String($),Z]):[String($),String(Z)]},ie=function($,Z){if($.length<Z)throw new TypeError(Z+" argument required, but only "+$.length+" present.")},ee=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,le=ee.FormData,he=ee.XMLHttpRequest&&ee.XMLHttpRequest.prototype.send,ue=ee.Request&&ee.fetch,Ce=ee.navigator&&ee.navigator.sendBeacon,De=ee.Element&&ee.Element.prototype,je=ee.Symbol&&Symbol.toStringTag;je&&(Blob.prototype[je]||(Blob.prototype[je]="Blob"),"File"in ee&&!File.prototype[je]&&(File.prototype[je]="File"));try{new File([],"")}catch{ee.File=function(Z,se,pe){return Z=new Blob(Z,pe||{}),Object.defineProperties(Z,{name:{value:se},lastModified:{value:+(pe&&pe.lastModified!==void 0?new Date(pe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),je&&Object.defineProperty(Z,je,{value:"File"}),Z}}var fe=function($){return $.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},J=function($){this.i=[];var Z=this;$&&W($.elements,function(se){if(se.name&&!se.disabled&&se.type!=="submit"&&se.type!=="button"&&!se.matches("form fieldset[disabled] *"))if(se.type==="file"){var pe=se.files&&se.files.length?se.files:[new File([],"",{type:"application/octet-stream"})];W(pe,function(Oe){Z.append(se.name,Oe)})}else se.type==="select-multiple"||se.type==="select-one"?W(se.options,function(Oe){!Oe.disabled&&Oe.selected&&Z.append(se.name,Oe.value)}):se.type==="checkbox"||se.type==="radio"?se.checked&&Z.append(se.name,se.value):(pe=se.type==="textarea"?q(se.value):se.value,Z.append(se.name,pe))})};if((r=J.prototype).append=function($,Z,se){ie(arguments,2),this.i.push(X($,Z,se))},r.delete=function($){ie(arguments,1);var Z=[];$=String($),W(this.i,function(se){se[0]!==$&&Z.push(se)}),this.i=Z},r.entries=function $(){var Z,se=this;return x($,function(pe){if(pe.h==1&&(Z=0),pe.h!=3)return Z<se.i.length?pe=I(pe,se.i[Z]):(pe.h=0,pe=void 0),pe;Z++,pe.h=2})},r.forEach=function($,Z){ie(arguments,1);for(var se=m(this),pe=se.next();!pe.done;pe=se.next()){var Oe=m(pe.value);pe=Oe.next().value,Oe=Oe.next().value,$.call(Z,Oe,pe,this)}},r.get=function($){ie(arguments,1);var Z=this.i;$=String($);for(var se=0;se<Z.length;se++)if(Z[se][0]===$)return Z[se][1];return null},r.getAll=function($){ie(arguments,1);var Z=[];return $=String($),W(this.i,function(se){se[0]===$&&Z.push(se[1])}),Z},r.has=function($){ie(arguments,1),$=String($);for(var Z=0;Z<this.i.length;Z++)if(this.i[Z][0]===$)return!0;return!1},r.keys=function $(){var Z,se,pe,Oe,ce=this;return x($,function(A){if(A.h==1&&(Z=m(ce),se=Z.next()),A.h!=3)return se.done?void(A.h=0):(pe=se.value,Oe=m(pe),I(A,Oe.next().value));se=Z.next(),A.h=2})},r.set=function($,Z,se){ie(arguments,2),$=String($);var pe=[],Oe=X($,Z,se),ce=!0;W(this.i,function(A){A[0]===$?ce&&(ce=!pe.push(Oe)):pe.push(A)}),ce&&pe.push(Oe),this.i=pe},r.values=function $(){var Z,se,pe,Oe,ce=this;return x($,function(A){if(A.h==1&&(Z=m(ce),se=Z.next()),A.h!=3)return se.done?void(A.h=0):(pe=se.value,(Oe=m(pe)).next(),I(A,Oe.next().value));se=Z.next(),A.h=2})},J.prototype._asNative=function(){for(var $=new le,Z=m(this),se=Z.next();!se.done;se=Z.next()){var pe=m(se.value);se=pe.next().value,pe=pe.next().value,$.append(se,pe)}return $},J.prototype._blob=function(){var $="----formdata-polyfill-"+Math.random(),Z=[],se="--"+$+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(pe,Oe){return typeof pe=="string"?Z.push(se+fe(q(Oe))+`"\r
\r
`+q(pe)+`\r
`):Z.push(se+fe(q(Oe))+'"; filename="'+fe(pe.name)+`"\r
Content-Type: `+(pe.type||"application/octet-stream")+`\r
\r
`,pe,`\r
`)}),Z.push("--"+$+"--"),new Blob(Z,{type:"multipart/form-data; boundary="+$})},J.prototype[Symbol.iterator]=function(){return this.entries()},J.prototype.toString=function(){return"[object FormData]"},De&&!De.matches&&(De.matches=De.matchesSelector||De.mozMatchesSelector||De.msMatchesSelector||De.oMatchesSelector||De.webkitMatchesSelector||function($){for(var Z=($=(this.document||this.ownerDocument).querySelectorAll($)).length;0<=--Z&&$.item(Z)!==this;);return-1<Z}),je&&(J.prototype[je]="FormData"),he){var ne=ee.XMLHttpRequest.prototype.setRequestHeader;ee.XMLHttpRequest.prototype.setRequestHeader=function($,Z){ne.call(this,$,Z),$.toLowerCase()==="content-type"&&(this.B=!0)},ee.XMLHttpRequest.prototype.send=function($){$ instanceof J?($=$._blob(),this.B||this.setRequestHeader("Content-Type",$.type),he.call(this,$)):he.call(this,$)}}ue&&(ee.fetch=function($,Z){return Z&&Z.body&&Z.body instanceof J&&(Z.body=Z.body._blob()),ue.call(this,$,Z)}),Ce&&(ee.navigator.sendBeacon=function($,Z){return Z instanceof J&&(Z=Z._asNative()),Ce.call(this,$,Z)}),ee.FormData=J}})();let OT=1;function nne(r,i,s,a,u){OT+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:OT,requestId:OT,version:Hi,cname:s.cname},h={service_name:i,json_body:JSON.stringify(d)};let m,g,p=r[0];return po(async()=>{m=Date.now();const E=await Hs(p,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,E.code!==0){const I=new j(V.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:g});throw D.error(I.toString()),I}const v=JSON.parse(E.json_body);if(v.code!==200){const I=new j(V.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(v.code,", reason: ").concat(v.reason),{code:v.code,responseTime:g});throw D.error(I.toString()),I}if(!v.servers||v.servers.length===0){const I=new j(V.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:g});throw D.error(I.toString()),I}const T=function(I,O){return{addressList:I.servers.map(N=>"wss://".concat(N.address.replace(/\./g,"-"),".").concat(Q("WORKER_DOMAIN"),":").concat(N.wss,"?serviceName=").concat(encodeURIComponent(O))),workerToken:I.workerToken,vid:I.vid}}(v,i);return Q("LIVE_STREAMING_ADDRESS")&&(T.addressList=Q("LIVE_STREAMING_ADDRESS")instanceof Array?Q("LIVE_STREAMING_ADDRESS"):[Q("LIVE_STREAMING_ADDRESS")]),ax(ax({},T),{},{responseTime:g})},(E,v)=>(Ie.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(E.addressList),firstSuccess:v===0,responseTime:g,serverIp:r[v%r.length]}),!1),(E,v)=>(Ie.apworkerEvent(s.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:i,responseTime:g,serverIp:r[v%r.length]}),!!(E.code!==V.OPERATION_ABORTED&&E.code!==V.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(p=r[(v+1)%r.length],!0)),u)}let NT=1;function cx(r,i,s,a){let{url:u,areaCode:d}=r;const h=Date.now();let m;const[g,p]=hx(i,d,[Tn.CHOOSE_SERVER]);let E=an.networkState;return po(async()=>{E&&an.networkState===hr.OFFLINE&&an.onlineWaiter&&await _e.race([an.onlineWaiter,Bn(a&&a.maxRetryTimeout||vn.maxRetryTimeout)]),E=an.networkState;const{data:v,headers:T}=await Hs(u,{data:g,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=T.http3==="1"?1:-1,Ie.reportResourceTiming(u,i.sid),lx(v,u,i,h,[Tn.CHOOSE_SERVER],m);const I=YS(v,Tn.CHOOSE_SERVER);return dx(I),$L(I,u)},v=>(v&&Ie.joinChooseServer(i.sid,{lts:h,succ:!0,csAddr:u,opid:p,serverList:v.gatewayAddrs.map(T=>T.address),ec:null,cid:v.cid.toString(),uid:v.uid.toString(),csIp:v.csIp,unilbsServerIds:[Tn.CHOOSE_SERVER].toString(),isHttp3:m}),!1),v=>v.code!==V.OPERATION_ABORTED&&(v.code===V.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(Ie.joinChooseServer(i.sid,{lts:h,succ:!1,csAddr:u,serverList:null,opid:p,ec:v.code,csIp:v.data&&v.data.csIp,unilbsServerIds:[Tn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:m}),D.warning("[".concat(i.clientId,"] Choose server network error, retry"),v),!0)),a)}function ux(r,i,s,a){let u,{url:d,areaCode:h,serviceIds:m}=r;const g=Date.now(),[p,E]=hx(i,h,m);let v;return po(async()=>{v&&an.networkState===hr.OFFLINE&&an.onlineWaiter&&await _e.race([an.onlineWaiter,Bn(a&&a.maxRetryTimeout||vn.maxRetryTimeout)]),v=an.networkState;const{data:T,headers:I}=await Hs(d,{data:p,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=I.http3==="1"?1:-1,Ie.reportResourceTiming(d,i.sid),lx(T,d,i,g,m,u);const O=YS(T,Tn.CHOOSE_SERVER),N=YS(T,i.cloudProxyServer==="proxy5"?Tn.CLOUD_PROXY_5:i.cloudProxyServer==="proxy3"||i.cloudProxyServer==="proxy4"?Tn.CLOUD_PROXY:Tn.CLOUD_PROXY_FALLBACK);return dx(O),{gatewayInfo:$L(O,d),proxyInfo:N,url:d}},T=>(T.gatewayInfo&&Ie.joinChooseServer(i.sid,{lts:g,succ:!0,csAddr:d,serverList:T.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:E,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:u}),T.proxyInfo&&Ie.joinWebProxyAP(i.sid,{lts:g,sucess:1,apServerAddr:d,turnServerAddrList:T.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:m.toString()}),!1),T=>T.code!==V.OPERATION_ABORTED&&(T.code===V.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(Ie.joinWebProxyAP(i.sid,{lts:g,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:T.code,eventType:i.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:v})}),D.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),T),!0)),a)}const lx=(r,i,s,a,u,d)=>{const h=[],m=g=>{g.flag===4096?Ie.joinChooseServer(s.sid,{lts:a,succ:!1,csAddr:i,opid:r.opid,serverList:null,ec:g.error.message,csIp:g.error.data&&g.error.data.csIp,unilbsServerIds:u.toString(),isHttp3:d}):g.flag!==1048576&&g.flag!==4194304&&g.flag!==4194310||Ie.joinWebProxyAP(s.sid,{lts:a,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:g.error.code,eventType:s.cloudProxyServer,unilbsServerIds:u.toString()})};if(r.response_body.forEach(g=>{const p=g.buffer.code;if(g.uri===23&&p===0&&!g.buffer.edges_services)if(g.buffer.flag===4194310)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),g.buffer.edges_services=[];else{const E={error:new j(V.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:r.detail[502]}),flag:g.buffer.flag};h.push(E),m(E)}if(p!==0){const E=tE(p),v={error:new j(V.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:r.detail[502]}),flag:g.buffer.flag};g.buffer.flag===4194310?D.warning(v.error.toString()):h.push(v),m(v)}}),h.length)throw D.warning("[".concat(s.clientId,"] multi unilbs ").concat(i," failed, ").concat(h.map(g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message,", retry: ").concat(g.error.data.retry)).join(" | "))),new j(V.CAN_NOT_GET_GATEWAY_SERVER,h.map(g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message)).join(" | "),{retry:!!h.find(g=>g.error.data.retry),csIp:r.detail[502],desc:[...new Set(h.map(g=>{var p,E;return g==null||(p=g.error)===null||p===void 0||(E=p.data)===null||E===void 0?void 0:E.desc}).filter(g=>!!g))]})},dx=r=>{var i,s;if(r.addresses&&r.addresses.length===0&&r.code===0)throw new j(V.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:r.detail&&r.detail[502]});if((i=r.detail)!==null&&i!==void 0&&i[19]&&typeof((s=r.detail)===null||s===void 0?void 0:s[19])=="string"){const u=r.detail[19],d=u==null?void 0:u.split(";");for(let h=0;h<d.length;h++){var a;const m=qo(a=d[h]).call(a);r.addresses[h]&&d&&(r.addresses[h].fingerprint=m)}}if(Q("GATEWAY_ADDRESS")&&Q("GATEWAY_ADDRESS").length>0){D.debug("assign gateway address to",Q("GATEWAY_ADDRESS"));const u=Q("GATEWAY_ADDRESS").map(d=>{var h,m;const g=(h=(m=r.addresses.find(p=>p.ip===d.ip&&p.port===d.port))===null||m===void 0?void 0:m.fingerprint)!==null&&h!==void 0?h:"";return{ip:d.ip,port:d.port,ticket:r.addresses[0]&&r.addresses[0].ticket,fingerprint:g}});r.addresses=u}},rne=(r,i)=>{if(r.response_body&&r.response_body.length){const s=r.response_body[0];if(s.buffer.code!==0){const a=tE(s.buffer.code);throw new j(V.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw D.debug("update ticket request received ap response without response body:",i),new j(V.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},hx=(r,i,s)=>{const a=Math.floor(Math.random()*1e12),u={appid:r.appId,client_ts:Date.now(),opid:a,sid:r.sid,request_bodies:[{uri:22,buffer:{cname:r.cname,detail:{6:r.stringUid,11:i,12:Q("USE_NEW_TOKEN")?"1":void 0},key:r.token,service_ids:s,uid:r.uid||0}}]};u.request_bodies.forEach(h=>{r.multiIP&&r.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[r.multiIP.uni_lbs_ip],vos_ip:[r.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(u)),[d,a]},ine=(r,i)=>{const s=Math.floor(Math.random()*1e12),a={appid:r.appId,client_ts:Date.now(),opid:s,sid:r.sid,request_bodies:[{uri:28,buffer:{cname:r.cname,detail:{1:"",6:r.stringUid,12:"1"},token:r.token,service_ids:i,uid:r.uid||0,edges_services:r.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},u=new FormData;return u.append("request",JSON.stringify(a)),[u,s]};let PT=0;const nE=()=>{const r=Q("AREAS");return r.length===0&&r.push(mt.GLOBAL),xa(r).call(r,(i,s,a)=>{const u=sne(s);return u?a===0?u:"".concat(i,",").concat(u):i},"")},sne=r=>r===mt.OVERSEA?"".concat(On.ASIA,",").concat(On.EUROPE,",").concat(On.AFRICA,",").concat(On.NORTH_AMERICA,",").concat(On.SOUTH_AMERICA,",").concat(On.OCEANIA):On[r],rE={GLOBAL:{ASIA:[mt.CHINA,mt.JAPAN,mt.INDIA,mt.KOREA,mt.HKMC],EUROPE:[],NORTH_AMERICA:[mt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},DT=Object.keys(rE[mt.GLOBAL]),px=[mt.CHINA,mt.NORTH_AMERICA,mt.EUROPE,mt.ASIA,mt.JAPAN,mt.INDIA,mt.OCEANIA,mt.SOUTH_AMERICA,mt.AFRICA,mt.KOREA,mt.HKMC,mt.US],one=function(r,i){let s=[];if(r.includes(mt.GLOBAL)){const d=[mt.GLOBAL,mt.OVERSEA],h=Object.keys(LS);if(i===mt.GLOBAL)throw new j(V.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===mt.CHINA)s=[mt.OVERSEA];else if(u=i,DT.includes(u)){const m=(a=i,rE[mt.GLOBAL][a]||[]),g=[...d,i,...m];s=h.filter(p=>!g.includes(p))}else if(function(m){let g=!1;return DT.forEach(p=>{rE[mt.GLOBAL][p].includes(m)&&(g=!0)}),g}(i)){const m=function(p){let E;return DT.forEach(v=>{rE[mt.GLOBAL][v].includes(p)&&(E=v)}),E}(i),g=[...d,m,i];s=h.filter(p=>!g.includes(p))}else s=r;s=function(m){const g=[];return px.forEach(p=>{m.includes(p)&&g.push(p)}),g.concat(m.filter(p=>!px.includes(p)))}(s)}else s=r;var a,u;return s};async function kT(r,i,s,a){return{gatewayInfo:await async function(d,h,m,g){let p=null;const E=[],v=async()=>{const I=Q("WEBCS_DOMAIN").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(P=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:nE()})),O=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:I.map(P=>P.url)}),N=await zh({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:I,asyncMapHandler:P=>(D.debug("[".concat(d.clientId,"] Connect to choose_server:"),P.url),cx(P,d,h,m)),allFailedhandler:P=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},O),P[0]},promisesCollector:E});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},O),N},T=async()=>{if(await Bn(1e3),p!==null)return p;const I=Q("WEBCS_DOMAIN_BACKUP_LIST").map(P=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:nE()})),O=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:I.map(P=>P.url)}),N=await zh({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:I,asyncMapHandler:P=>(D.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),P.url),cx(P,d,h,m)),allFailedhandler:P=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},O),P[0]},promisesCollector:E});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},O),N};try{return p=await Bl([v(),T()]),E.length&&E.forEach(I=>I.cancel&&typeof I.cancel=="function"&&I.cancel()),p}catch(I){throw I[0]}}(r,i,s,a)}}async function fx(r,i,s,a,u){const d=r.cloudProxyServer;if(d==="disabled"){if(!a)return;if(r.useLocalAccessPoint)return await kT(r,i,s,u);if(Q("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:p,proxyInfo:E}=await gx(r,i,s,u);return r.turnServer&&r.turnServer.mode!=="auto"||(r.turnServer={mode:"manual",servers:E.map(v=>({turnServerURL:v.address,tcpport:v.tcpport||Ri.tcpport,udpport:v.udpport||Ri.udpport,username:v.username||Ri.username,password:v.password||Ri.password,forceturn:Q("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE"),security:!0}))}),{gatewayInfo:p}}return await kT(r,i,s,u)}const{proxyInfo:h,gatewayInfo:m}=await gx(r,i,s,u),g={gatewayInfo:m};return r.turnServer={mode:"manual",servers:h.map(p=>({turnServerURL:p.address,tcpport:d==="proxy3"?void 0:p.tcpport?p.tcpport:Ri.tcpport,udpport:d==="proxy4"?void 0:p.udpport?p.udpport:Ri.udpport,username:p.username||Ri.username,password:p.password||Ri.password,forceturn:d!=="proxy4",security:d==="proxy5"}))},D.debug("[".concat(r.clientId,"] set proxy server: ").concat(r.proxyServer,", mode: ").concat(d)),g}async function mx(r,i,s,a,u){const d=Q("ACCOUNT_REGISTER").slice(0,Q("AJAX_REQUEST_CONCURRENT"));let h=[];h=i.proxyServer?d.map(g=>"https://".concat(i.proxyServer,"/ap/?url=").concat(g+"/api/v1")):d.map(g=>"https://".concat(g,"/api/v1"));const m=u==null?void 0:u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await async function(p,E,v,T,I){const O=Date.now(),N={sid:v.sid,opid:10,appid:v.appId,string_uid:E};let P=p[0];const L=await po(()=>Hs(P+"".concat(P.indexOf("?")===-1?"?":"&","action=stringuid"),{data:N,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(x,W)=>{if(x.code===0){if(x.uid<=0||x.uid>=Math.pow(2,32))throw D.error("Invalid Uint Uid ".concat(E," => ").concat(x.uid),x),Ie.reqUserAccount(N.sid,{lts:O,success:!1,serverAddr:P,stringUid:N.string_uid,uid:x.uid,errorCode:V.INVALID_UINT_UID_FROM_STRING_UID,extend:N}),new j(V.INVALID_UINT_UID_FROM_STRING_UID);return Ie.reqUserAccount(N.sid,{lts:O,success:!0,serverAddr:P,stringUid:N.string_uid,uid:x.uid,errorCode:null,extend:N}),!1}const q=tE(x.code);return q.retry&&(P=p[(W+1)%p.length]),Ie.reqUserAccount(N.sid,{lts:O,success:!1,serverAddr:P,stringUid:N.string_uid,uid:x.uid,errorCode:q.desc,extend:N}),q.retry},(x,W)=>x.code!==V.OPERATION_ABORTED&&(Ie.reqUserAccount(N.sid,{lts:O,success:!1,serverAddr:P,stringUid:N.string_uid,uid:null,errorCode:x.code,extend:N}),P=p[(W+1)%p.length],!0),I);if(L.code!==0){const x=tE(L.code);throw new j(V.UNEXPECTED_RESPONSE,x.desc)}return L}(h,r,i,s,a);return u==null||u.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw u==null||u.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function ane(r,i,s){const a=Q("CDS_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(m=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")).map(m=>function(g,p,E,v){const T=bt(),I={flag:64,cipher_method:0,features:{device:T.name,system:T.os,system_general:navigator.userAgent,vendor:p.appId,version:Hi,cname:p.cname,sid:p.sid,session_id:p.sid,detail:"",proxyServer:p.proxyServer}};return po(()=>Hs(g,{data:I,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==V.OPERATION_ABORTED,v)}(m,r,i,s));let u=null,d=null,h={};try{u=await Bl(a)}catch(m){if(m.code===V.OPERATION_ABORTED)throw m;d=m}if(a.forEach(m=>m.cancel()),Ie.reportApiInvoke(r.sid,{name:dn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:u}}).onSuccess(),u&&u.test_tags)try{h=function(m){if(!m.test_tags)return{};const g=m.test_tags,p=Object.keys(g),E={};return p.forEach(v=>{var T;const I=qo(T=v.slice(4)).call(T),O=JSON.parse(g[v])[1];E[I]=O}),E}(u)}catch{}return h}async function gx(r,i,s,a){const u=Q("PROXY_SERVER_TYPE3"),d=(I,O,N)=>{let P=N||u;return Array.isArray(P)&&(P=O%2==0?u[1]:u[0]),"https://".concat(P,"/ap/?url=").concat(I)};let h=null;const m=[],g=async()=>{const I=Q("WEBCS_DOMAIN").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map((P,L)=>{let x;return x=r.cloudProxyServer==="disabled"&&r.proxyServer?d("".concat(P,"/api/v2/transpond/webrtc?v=2"),L,r.proxyServer):r.cloudProxyServer==="disabled"||r.cloudProxyServer==="fallback"?"https://".concat(P,"/api/v2/transpond/webrtc?v=2"):d("".concat(P,"/api/v2/transpond/webrtc?v=2"),L),{url:x,areaCode:nE(),serviceIds:[Tn.CHOOSE_SERVER,r.cloudProxyServer==="proxy5"?Tn.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Tn.CLOUD_PROXY:Tn.CLOUD_PROXY_FALLBACK]}}),O=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:I.map(P=>P.url)}),N=await zh({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:I,asyncMapHandler:P=>(D.debug("[".concat(r.clientId,"] Connect to choose_server:"),P.url),ux(P,r,i,s)),allFailedhandler:P=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},O),P[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},O),N},p=async()=>{if(await Bn(1e3),h!==null)return h;const I=Q("WEBCS_DOMAIN_BACKUP_LIST").map((P,L)=>{let x;return x=r.cloudProxyServer==="disabled"&&r.proxyServer?d("".concat(P,"/api/v2/transpond/webrtc?v=2"),L,r.proxyServer):r.cloudProxyServer==="disabled"||r.cloudProxyServer==="fallback"?"https://".concat(P,"/api/v2/transpond/webrtc?v=2"):d("".concat(P,"/api/v2/transpond/webrtc?v=2"),L),{url:x,areaCode:nE(),serviceIds:[Tn.CHOOSE_SERVER,r.cloudProxyServer==="proxy5"?Tn.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Tn.CLOUD_PROXY:Tn.CLOUD_PROXY_FALLBACK]}}),O=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:I.map(P=>P.url)}),N=await zh({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:I,asyncMapHandler:P=>(D.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),P.url),ux(P,r,i,s)),allFailedhandler:P=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},O),P[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},O),N};let E,v,T;try{({gatewayInfo:E,proxyInfo:v,url:T}=await Bl([g(),p()]))}catch(I){throw I[0]}if(m.length&&m.forEach(I=>I.cancel&&typeof I.cancel=="function"&&I.cancel()),!E||!v)throw new j(V.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(r.apUrl=T,r.cloudProxyServer!=="disabled"&&Array.isArray(u)&&T){const I=new JM(T).host;u.includes(I)&&(r.proxyServer=I,D.setProxyServer(I),Ie.setProxyServer(I))}return h={gatewayInfo:E,proxyInfo:await _ee(v,E.uid)},h}async function Ex(r,i,s,a){const u=Q("UAP_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(d=>i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return await nne(u,r,i,s,a)}async function cne(r,i,s){const a=Q("UAP_AP").slice(0,Q("AJAX_REQUEST_CONCURRENT")).map(u=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")).map(u=>function(d,h,m,g){const p={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:Hi,cname:h.cname,uid:h.uid.toString(),requestId:NT,seq:NT};NT+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(p)};return po(async()=>{const v=await Hs(d,{data:E,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(v.code!==0){const I=new j(V.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw D.error(I.toString()),I}const T=JSON.parse(v.json_body);if(T.code!==200){const I=new j(V.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw D.error(I.toString()),I}if(!T.servers||T.servers.length===0){const I=new j(V.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw D.error(I.toString()),I}return{vid:T.vid,workerToken:T.workerToken,addressList:(Q("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(Q("WORKER_DOMAIN"),":").concat(I.wss))}},void 0,v=>!!(v.code!==V.OPERATION_ABORTED&&v.code!==V.UNEXPECTED_RESPONSE||v.data&&v.data.retry),g)}(u,r,i,s));try{const u=await Bl(a);return a.forEach(d=>d.cancel()),u}catch(u){throw u[0]}}async function une(r,i,s){let a=null;const u=[],d=async h=>{const m=Q(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return h&&(await Bn(1e3),a!==null)?a:await zh({fragementLength:Q("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(D.debug("[".concat(r.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),function(p,E,v,T){const[I]=ine(E,[Tn.CHOOSE_SERVER]);let O=an.networkState;return po(async()=>{O&&an.networkState===hr.OFFLINE&&an.onlineWaiter&&await _e.race([an.onlineWaiter,Bn(T&&T.maxRetryTimeout||vn.maxRetryTimeout)]),O=an.networkState;const N=await Hs(p,{data:I,cancelToken:v,headers:{"Content-Type":"multipart/form-data;"}},!0);return rne(N,p)},()=>!1,N=>N.code!==V.OPERATION_ABORTED&&(N.code===V.UPDATE_TICKET_FAILED?N.data.retry:(D.warning("[".concat(E.clientId,"] update ticket network error, retry"),N),!0)),T)}(g,r,i,s)),allFailedhandler:g=>{throw g[0]},promisesCollector:u})};try{return a=await Bl([d(!1),d(!0)]),u.length&&u.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function _x(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function vx(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?_x(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):_x(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}class lne extends Wt{constructor(){super(),C(this,"configs",void 0),C(this,"joinInfo",void 0),C(this,"cancelToken",void 0),C(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),C(this,"interval",void 0),C(this,"mutex",new Ir("config-distribute")),C(this,"mutableParamsRead",!1)}startGetConfigDistribute(i,s){this.joinInfo=i,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),Q("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Q("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ie.reportApiInvoke(null,{options:void 0,name:dn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Ht.TRACER}).onSuccess(JSON.stringify(mS))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void D.debug("[config-distribute] get config distribute interrupted have no joininfo");let i;const s=await this.mutex.lock();try{i=await ane(this.joinInfo,this.cancelToken,this.retryConfig),D.debug("[config-distribute] get config distribute",JSON.stringify(i)),i.limit_bitrate&&this.handleBitrateLimit(i.limit_bitrate),this.cacheGlobalParameterConfig(i),this.configs=i}catch(a){const u=new j(V.NETWORK_RESPONSE_ERROR,a);D.warning("[config-distribute] ".concat(u.toString()))}finally{s()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(i){var s;(s=i)&&s.uplink&&s.id&&s.uplink.max_bitrate!==void 0&&s.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==i.id&&this.emit($h.UPDATE_BITRATE_LIMIT,i):this.emit($h.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&vx({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(i){var s;const a=SS(s=Object.keys(i).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(s);for(let d=0;d<a.length;d++)for(let h=a.length-1;h>d;h--){const m=a[h];if(typeof i[m].__priority=="number"){const g=i[m].__priority,p=a[h-1];if(typeof i[p].__priority=="number"){if(!(g>i[p].__priority))continue;{const E=m;a[h]=a[h-1],a[h-1]=E}}else{const E=m;a[h]=a[h-1],a[h-1]=E}}}const u={};a.forEach(d=>{const h=i[d],m=h.__expires;Object.keys(h).forEach(g=>{g==="__priority"||g==="__expires"||Object.prototype.hasOwnProperty.call(u,g)||(u[g]=vx({value:h[g]},m&&{expires:m}))})});try{const d=JSON.stringify(u),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),D.debug("Caching global parameters ".concat(d))}catch(d){D.error("Error caching global parameters:",d.message)}}}function yx(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function rp(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?yx(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):yx(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}class dne extends Wt{constructor(i,s,a,u){super(),C(this,"spec",void 0),C(this,"token",void 0),C(this,"websocket",void 0),C(this,"pingpongTimer",void 0),C(this,"reconnectMode","retry"),C(this,"serviceMode",void 0),C(this,"reqId",0),C(this,"commandReqId",0),C(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),C(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===hn.INJECT?this.emit(_s.INJECT_STREAM_STATUS,h):(Ie.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===hn.TRANSCODE?1:2}),this.emit(_s.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=i,this.serviceMode=u,this.websocket=new Yl("live-streaming",a),this.websocket.on(Ge.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ge.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ge.REQUEST_NEW_URLS,(d,h)=>{nr(this,_s.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Ge.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}async request(i,s,a,u){this.reqId+=1,i==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new j(V.UNEXPECTED_ERROR);const m=rp({command:i,sdkVersion:Hi==="4.16.1"?"0.0.1":Hi,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new j(V.WS_DISCONNECT);const g=()=>new _e((T,I)=>{this.websocket.once(Ge.CLOSED,()=>I(new j(V.WS_ABORT))),this.websocket.once(Ge.CONNECTED,T)});this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const p=new _e((T,I)=>{const O=()=>{I(new j(V.WS_ABORT))};this.websocket.once(Ge.RECONNECTING,O),this.websocket.once(Ge.CLOSED,O),this.once("@".concat(h,"-").concat(this.spec.sid),N=>{T(N)})});u&&Ie.workerEvent(this.spec.sid,rp(rp({},u),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const E=Date.now();this.websocket.sendMessage(m);let v=null;try{v=await p}catch(T){if(this.websocket.state==="closed")throw T;return await g(),await this.request(i,s,a)}return u&&Ie.workerEvent(this.spec.sid,rp(rp({},u),{},{requestId:d,actionType:"response",payload:JSON.stringify(v.serverResponse),serverCode:v.code,success:v.code===200,responseTime:Date.now()-E})),v.code!==200&&this.handleResponseError(v),v}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i=Hi==="4.16.1"?"0.0.1":Hi;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case Xt.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void D.warning("live stream response already exists stream");case Xt.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Xt.LIVE_STREAM_RESPONSE_BAD_STREAM:case Xt.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new j(V.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case Xt.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;throw new j(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xt.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new j(V.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case Xt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new j(V.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(_s.WARNING,s,i.serverResponse.url)}case Xt.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new j(V.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(_s.WARNING,s,i.serverResponse.url)}case Xt.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new j(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xt.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new j(V.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case Xt.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new j(V.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(_s.WARNING,s,i.serverResponse.url)}case Xt.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new j(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case Xt.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new j(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Xt.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xt.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;throw new j(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xt.ERROR_FAIL_SEND_MESSAGE:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;if(i.serverResponse.command==="UpdateTranscoding"||i.serverResponse.command==="ControlStream")return new j(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new j(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new j(V.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Fg)},6e3)}}function Sx(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function xr(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?Sx(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):Sx(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}class hne extends Wt{constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vn,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vn;super(),C(this,"onLiveStreamWarning",void 0),C(this,"onLiveStreamError",void 0),C(this,"onInjectStatusChange",void 0),C(this,"spec",void 0),C(this,"retryTimeout",1e4),C(this,"connection",void 0),C(this,"httpRetryConfig",void 0),C(this,"wsRetryConfig",void 0),C(this,"streamingTasks",new Map),C(this,"isStartingStreamingTask",!1),C(this,"taskMutex",new Ir("live-streaming")),C(this,"cancelToken",gs.CancelToken.source()),C(this,"transcodingConfig",void 0),C(this,"injectConfig",xr({},ZQ)),C(this,"injectLoopTimes",0),C(this,"uapResponse",void 0),C(this,"lastTaskId",1),C(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(i){const s=xr(xr({},QQ),i);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(D.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>xr(xr(xr({},JQ),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Ft(h.width)||Ot(h.width,"config.width",0,1e4),Ft(h.height)||Ot(h.height,"config.height",0,1e4),Ft(h.videoBitrate)||Ot(h.videoBitrate,"config.videoBitrate",1,1e6),Ft(h.videoFrameRate)||Ot(h.videoFrameRate,"config.videoFrameRate"),Ft(h.lowLatency)||Gh(h.lowLatency,"config.lowLatency"),Ft(h.audioSampleRate)||qn(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ft(h.audioBitrate)||Ot(h.audioBitrate,"config.audioBitrate",1,128),Ft(h.audioChannels)||qn(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ft(h.videoGop)||Ot(h.videoGop,"config.videoGop"),Ft(h.videoCodecProfile)||qn(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ft(h.userCount)||Ot(h.userCount,"config.userCount",0,17),Ft(h.backgroundColor)||Ot(h.backgroundColor,"config.backgroundColor",0,16777215),Ft(h.userConfigExtraInfo)||zn(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Ft(h.transcodingUsers)&&(Jo(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,g)=>{IS(m.uid),Ft(m.x)||Ot(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),Ft(m.y)||Ot(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),Ft(m.width)||Ot(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),Ft(m.height)||Ot(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),Ft(m.zOrder)||Ot(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),Ft(m.alpha)||Ot(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),Ft(h.watermark)||PS(h.watermark,"watermark"),Ft(h.backgroundImage)||PS(h.backgroundImage,"backgroundImage"),h.images&&!Ft(h.images)&&(Jo(h.images,"config.images"),h.images.forEach((m,g)=>{PS(m,"images[".concat(g,"]"))}))}(s);const a=[];s.images&&a.push(...s.images.map(h=>xr(xr(xr({},NS),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(xr(xr(xr({},NS),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(xr(xr(xr({},NS),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>xr({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const u=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?_e.resolve(h.uid):mx(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await _e.all(u)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Zo(d=this.streamingTasks).call(d)).map(m=>m.taskId).join("#")});D.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{D.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{D.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{D.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})})}}setInjectStreamConfig(i,s){this.injectConfig=Object.assign({},this.injectConfig,i),this.injectLoopTimes=s}async startLiveStreamingTask(i,s,a){var u;if(Array.from(Zo(u=this.streamingTasks).call(u)).find(g=>g.mode===hn.INJECT)&&s===hn.INJECT)return new j(V.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&s===hn.TRANSCODE)throw new j(V.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let d={command:"PublishStream",ts:Date.now(),url:i,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};D.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(s));const h=await this.taskMutex.lock();if(!this.connection&&a)return void h();if(this.streamingTasks.get(i)&&!a)return h(),new j(V.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(g){throw h(),g}switch(s){case hn.TRANSCODE:d.transcodingConfig=xr({},this.transcodingConfig);break;case hn.RAW:break;case hn.INJECT:d={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:i,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(d.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const m=this.lastTaskId++;try{const g=new _e((E,v)=>{Bn(this.retryTimeout).then(()=>{if(a)return v(a);const T=this.statusError.get(i);return T?(this.statusError.delete(i),v(T)):void 0})}),p=await _e.race([this.connection.request("request",{clientRequest:d},!0,{url:i,command:"PublishStream",workerType:s===hn.TRANSCODE?1:2,requestByUser:!a,tid:m.toString()}),g]);this.isStartingStreamingTask=!1,D.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(i,{clientRequest:d,mode:s,url:i,taskId:m}),h()}catch(g){if(h(),this.isStartingStreamingTask=!1,!g.data||!g.data.retry||a)throw g;return g.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(i,s,g)):await this.startLiveStreamingTask(i,s,g)}}stopLiveStreamingTask(i){return new _e((s,a)=>{const u=this.streamingTasks.get(i);if(!u||!this.connection)return new j(V.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=u.mode;u.abortTask=()=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),s()},this.connection.request("request",{clientRequest:{command:d===hn.INJECT?"UninjectStream":"UnpublishStream",url:u.url}},!1,{url:i,command:"UnPublishStream",workerType:d===hn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(i),this.streamingTasks.size===0&&d!==hn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),s(),d===hn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Ba.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,i)}).catch(a)})}async controlInjectStream(i,s,a,u){const d=this.streamingTasks.get(i);if(!d||!this.connection||d.mode!==hn.INJECT)throw new j(V.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:i,control:s,audioVolume:a,position:u}})).serverResponse}resetAllTask(){var i;const s=Array.from(Zo(i=this.streamingTasks).call(i));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch(u=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,u)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=gs.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(i){if(this.connection)throw new j(V.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await nr(this,Ll.REQUEST_WORKER_MANAGER_LIST,i);return this.uapResponse=s,this.connection=new dne(s.workerToken,this.spec,this.wsRetryConfig,i),this.connection.on(_s.WARNING,(a,u)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(u,a)),this.connection.on(_s.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(_s.INJECT_STREAM_STATUS,a=>this.handleInjectStreamServerStatus(a)),this.connection.on(_s.REQUEST_NEW_ADDRESS,(a,u)=>{if(!this.connection)return u(new j(V.UNEXPECTED_ERROR,"can not get new live streaming address list"));nr(this,Ll.REQUEST_WORKER_MANAGER_LIST,i).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(u)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(i){const s=i.serverStatus&&i.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),u=i.reason;switch(i.code){case Xt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new j(V.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(a)return D.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Xt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new j(V.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,u);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Xt.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xt.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Zo(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(D.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new j(V.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{D.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(g=>{D.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}));return}}}handleInjectStreamServerStatus(i){const s=Number(i.uid),a=i.serverStatus&&i.serverStatus.url;switch(i.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Ba.INJECT_STREAM_STATUS_START_SUCCESS,s,a));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Ba.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,s,a),void this.streamingTasks.delete(a);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Ba.INJECT_STREAM_STATUS_START_UNAUTHORIZED,s,a),void this.streamingTasks.delete(a);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Ba.INJECT_STREAM_STATUS_BROKEN,s,a),void this.streamingTasks.delete(a);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Ba.INJECT_STREAM_STATUS_START_TIMEOUT,s,a),void this.streamingTasks.delete(a);default:return void D.debug("inject stream server status",i)}}hasUrl(i){return this.streamingTasks.has(i)}}class Tx{constructor(){C(this,"destChannelMediaInfos",new Map),C(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){wk(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){wk(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){RS(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Rx(r){if(!(r instanceof Tx))return new j(V.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=r.getSrcChannelMediaInfo(),s=r.getDestChannelMediaInfo();if(!i)return new j(V.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new j(V.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class pne extends Wt{constructor(i,s,a){super(),C(this,"ws",void 0),C(this,"requestId",1),C(this,"heartBeatTimer",void 0),C(this,"joinInfo",void 0),C(this,"clientId",void 0),C(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),C(this,"onClose",u=>{this.emit("close"),this.dispose()}),C(this,"onMessage",u=>{const d=JSON.parse(u.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=i,this.clientId=s,this.ws=new Yl("cross-channel-".concat(this.clientId),a),this.ws.on(Ge.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ge.CONNECTED,this.onOpen),this.ws.on(Ge.ON_MESSAGE,this.onMessage),this.ws.on(Ge.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(i){const s=this.requestId++;return i.requestId=s,i.seq=s,this.ws.sendMessage(i),s}waitStatus(i){return new _e((s,a)=>{const u=window.setTimeout(()=>{a(new j(V.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,d=>{window.clearTimeout(u),d.state&&d.state!==0?a(new j(V.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(u),a(new j(V.WS_ABORT))})})}async request(i){if(this.ws.state==="closed")throw new j(V.WS_DISCONNECT);const s=()=>new _e((h,m)=>{this.ws.once(Ge.CLOSED,()=>m(new j(V.WS_ABORT))),this.ws.once(Ge.CONNECTED,h)});this.ws.state!=="connected"&&await s();const a=this.sendMessage(i),u=new _e((h,m)=>{const g=()=>{m(new j(V.WS_ABORT))};this.ws.once(Ge.RECONNECTING,g),this.ws.once(Ge.CLOSED,g),this.once("req_".concat(a),h),Bn(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(Ge.RECONNECTING,g),this.ws.off(Ge.CLOSED,g),m(new j(V.TIMEOUT,"cross channel ws request timeout"))})}),d=await u;if(!d||d.code!==200)throw new j(V.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(i){this.ws.removeAllListeners(Ge.REQUEST_NEW_URLS),this.ws.on(Ge.REQUEST_NEW_URLS,s=>{s(i)}),await this.ws.init(i)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const s=this.requestId++;return i.requestId=s,this.ws.sendMessage(i),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class fne extends Wt{set state(i){i!==this._state&&(i!==Lr.RELAY_STATE_FAILURE&&(this.errorCode=Ga.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,s,a,u){super(),C(this,"joinInfo",void 0),C(this,"sid",void 0),C(this,"clientId",void 0),C(this,"cancelToken",gs.CancelToken.source()),C(this,"workerToken",void 0),C(this,"requestId",0),C(this,"signal",void 0),C(this,"prevChannelMediaConfig",void 0),C(this,"httpRetryConfig",void 0),C(this,"_state",Lr.RELAY_STATE_IDLE),C(this,"errorCode",Ga.RELAY_OK),C(this,"onStatus",d=>{D.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",Ws.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",Ws.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Ga.SRC_TOKEN_EXPIRED,this.state=Lr.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Ga.DEST_TOKEN_EXPIRED,this.state=Lr.RELAY_STATE_FAILURE))}),C(this,"onReconnect",async()=>{D.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ws.NETWORK_DISCONNECTED),this.state=Lr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==Lr.RELAY_STATE_IDLE&&(D.error("auto restart channel media relay failed",d.toString()),this.errorCode=Ga.SERVER_CONNECTION_LOST,this.state=Lr.RELAY_STATE_FAILURE)})}),this.joinInfo=i,this.clientId=s,this.sid=XS(),this.signal=new pne(this.joinInfo,this.clientId,a),this.httpRetryConfig=u}async startChannelMediaRelay(i){if(this.state!==Lr.RELAY_STATE_IDLE)throw new j(V.INVALID_OPERATION);this.state=Lr.RELAY_STATE_CONNECTING,await this.connect(),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(i)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new j(V.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new j(V.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new j(V.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=i}async updateChannelMediaRelay(i){if(this.state!==Lr.RELAY_STATE_RUNNING)throw new j(V.INVALID_OPERATION);await this.sendUpdateMessage(i),this.prevChannelMediaConfig=i}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),D.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Lr.RELAY_STATE_IDLE,this.dispose()}dispose(){D.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=gs.CancelToken.source(),this.state=Lr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const i=await cne(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=i.workerToken,await this.signal.connect(i.addressList),this.emit("event",Ws.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(i){const s=this.genMessage(Rr.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(Rr.SetSdkProfile,i);await this.signal.request(a),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const u=this.genMessage(Rr.SetSourceChannel,i);await this.signal.request(u),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ws.PACKET_JOINED_SRC_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(Rr.SetSourceUserId,i);await this.signal.request(d),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Rr.SetDestChannel,i);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ws.PACKET_JOINED_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Rr.StartPacketTransfer,i);await this.signal.request(m),this.emit("event",Ws.PACKET_SENT_TO_DEST_CHANNEL),this.state=Lr.RELAY_STATE_RUNNING,D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(i){const s=this.genMessage(Rr.UpdateDestChannel,i);await this.signal.request(s),this.emit("event",Ws.PACKET_UPDATE_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const i=this.genMessage(Rr.StopPacketTransfer);await this.signal.request(i),D.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(i,s){const a=[],u=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Hi,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.16.1"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(i){case Rr.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Rr.SetSourceChannel:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new j(V.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case Rr.SetSourceUserId:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new j(V.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case Rr.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new j(V.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(p=>{a.push(p.channelName),u.push(p.uid+""),d.push(p.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:u,token:d},h;case Rr.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Rr.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Rr.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Rr.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new j(V.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(p=>{a.push(p.channelName),u.push(p.uid+""),d.push(p.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:u,token:d},h}return h}}const LT=r=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new _e((s,a)=>{i.toBlob(async u=>{if(i.remove(),u){const d=await Ix(u);s({buffer:d,width:i.width,height:i.height})}else a(new j(V.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,1)})},Ix=async r=>{const i=await r.arrayBuffer();return new Uint8Array(i)};function wx(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function Cx(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?wx(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):wx(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}class Ax{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(D.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}constructor(i){C(this,"trackId",void 0),C(this,"config",void 0),C(this,"onFirstVideoFrameDecoded",void 0),C(this,"freezeTimeCounterList",[]),C(this,"renderFreezeAccTime",0),C(this,"timeUpdatedCount",0),C(this,"freezeTime",0),C(this,"playbackTime",0),C(this,"lastTimeUpdatedTime",0),C(this,"autoplayFailed",!1),C(this,"videoTrack",void 0),C(this,"container",void 0),C(this,"videoElement",void 0),C(this,"videoElementCheckInterval",void 0),C(this,"_videoElementStatus",Yn.NONE),C(this,"slot",void 0),C(this,"isGettingVideoDimensions",!1),C(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Yn.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=Yn.CANPLAY;break;case"stalled":this.videoElementStatus=Yn.STALLED;break;case"suspend":this.videoElementStatus=Yn.SUSPEND;break;case"pause":this.videoElementStatus=Yn.PAUSED,dr()||Yo()||Kr()&&this.autoplayFailed||!this.videoElement||!this.videoTrack||this.videoTrack.readyState!=="live"||(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Yn.WAITING;break;case"abort":this.videoElementStatus=Yn.ABORT;break;case"ended":this.videoElementStatus=Yn.ENDED;break;case"emptied":this.videoElementStatus=Yn.EMPTIED;break;case"error":{var a;this.videoElementStatus=Yn.ERROR;const u=(a=this.videoElement)===null||a===void 0?void 0:a.error;u&&D.error("[".concat(this.trackId,"] media error, code: ").concat(u.code,", message: ").concat(u.message));break}case"timeupdate":{const u=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=u);const d=u-this.lastTimeUpdatedTime,h=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=u,ea.lastVisibleTime<ea.lastHiddenTime||h<ea.lastHiddenTime||h<ea.lastVisibleTime)return;for(d>Q("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=d),this.playbackTime+=d;this.playbackTime>=6e3;){this.playbackTime-=6e3;const m=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(m),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),C(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&this.videoElement.videoWidth*this.videoElement.videoHeight>4)return D.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),C(this,"autoResumeAfterInterruption",()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&Ze.curState==="running"&&(q0()?(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):SD()?(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):yD()&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))}),C(this,"autoResumeAfterInterruptionOnIOS15",()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(q0()?(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):SD()?(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):yD()&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))}),this.slot=i.element,this.trackId=i.trackId,this.updateConfig(i),Ze.on(Rn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ze.on(Rn.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}updateConfig(i){this.config=i,this.trackId=i.trackId;const s=i.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){if(this.videoElement){const s=this.videoElement.play();s&&s.catch&&s.catch(u=>{i&&Ie.autoplayFailed(i,"video",u.message,this.trackId),u.name==="NotAllowedError"?(D.warning("detected video element autoplay failed",u),this.autoplayFailed=!0,this.handleAutoPlayFailed()):D.warning("[".concat(this.trackId,"] play warning: "),u)});const a=bt();if((a.name==="Safari"&&Number(a.version)===15||Rl())&&s&&s.then&&s.catch){const u=()=>{this.config.mirror&&this.videoElement&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(u).catch(u)}}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");if(!s)return D.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,i.width,i.height);const a=s.getImageData(0,0,i.width,i.height);return i.remove(),a}async getCurrentFrameToUint8Array(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(!this.videoElement)return await LT(i);const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const u=a.getContext("2d");return u?(u.drawImage(this.videoElement,0,0,a.width,a.height),new _e((d,h)=>{a.toBlob(async m=>{if(a.remove(),m){const g=await Ix(m);d({buffer:g,width:a.width,height:a.height})}else h(new j(V.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},i,s<0?.1:s>1?1:s)})):await LT(i)}destroy(){if(Ze.off(Rn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ze.off(Rn.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement.remove(),this.videoElement=void 0),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){if(!this.videoElement&&(this.videoElementStatus=Yn.INIT,this.videoElement=document.createElement("video"),this.container&&this.container.appendChild(this.videoElement),bx.forEach(d=>{this.videoElement&&this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=Yn.DESTROYED)},1e3),Q("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,s;let d;const h=(m,g)=>{if(this.videoElementStatus===Yn.PLAYING){if(d){const v=g.presentationTime-d.presentationTime;v>Q("VIDEO_FREEZE_DURATION")&&ea.lastVisibleTime>=ea.lastHiddenTime&&d.timestamp>ea.lastVisibleTime&&d.timestamp>ea.lastHiddenTime&&(this.renderFreezeAccTime+=v)}d=Cx(Cx({},g),{},{timestamp:m})}var p,E;Q("ENABLE_VIDEO_FRAME_CALLBACK")&&((p=this.videoElement)===null||p===void 0||(E=p.requestVideoFrameCallback)===null||E===void 0||E.call(p,h))};(i=(s=this.videoElement).requestVideoFrameCallback)===null||i===void 0||i.call(s,h)}this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0",z0()&&(this.videoElement.poster="noposter");const a=bt();a.name==="Safari"&&Number(a.version)===15||Rl()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,tn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,tn()&&this.videoElement.load());const u=this.videoElement.play();u!==void 0&&u.catch(d=>{D.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}removeVideoElement(){if(this.videoElement){bx.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=void 0,this.videoElementStatus=Yn.NONE}}handleAutoPlayFailed(){if(this.videoElement){const i=s=>{s.preventDefault(),this.videoElement&&(this.videoElement.play().then(()=>{D.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{D.error(a)}),this.autoplayFailed=!1,Vh()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0)))};Vh()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),Bk()}}getVideoElement(){return this.videoElement}getContainerElement(){return this.container}}const bx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];var Ox={exports:{}};function mne(r,i,s){const a=r.createShader(s);if(!a)return new j(V.WEBGL_INTERNAL_ERROR,"can not create shader").throw();if(r.shaderSource(a,i),r.compileShader(a),!r.getShaderParameter(a,r.COMPILE_STATUS)){const u=r.getShaderInfoLog(a);return r.deleteShader(a),new j(V.WEBGL_INTERNAL_ERROR,"error compiling shader:"+u).throw()}return a}function gne(r,i,s,a){const u=[];for(let d=0;d<i.length;++d){const h=d===0?r.VERTEX_SHADER:r.FRAGMENT_SHADER;u.push(mne(r,i[d],h))}return function(d,h,m,g){const p=d.createProgram();if(!p)throw new j(V.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(h.forEach(E=>{d.attachShader(p,E)}),m&&m.forEach((E,v)=>{d.bindAttribLocation(p,g?g[v]:v,E)}),d.linkProgram(p),!d.getProgramParameter(p,d.LINK_STATUS)){const E=d.getProgramInfoLog(p);throw d.deleteProgram(p),new j(V.WEBGL_INTERNAL_ERROR,"error in program linking:"+E)}return p}(r,u,s,a)}(function(r,i){var s;s=()=>(()=>{var a={3536:(m,g,p)=>{var E=p(1910);m.exports=E},8171:(m,g,p)=>{p(6450);var E=p(4058).Object,v=m.exports=function(T,I,O){return E.defineProperty(T,I,O)};E.defineProperty.sham&&(v.sham=!0)},2956:(m,g,p)=>{p(7627),p(6274),p(5967),p(8881),p(4560),p(7206),p(4349),p(7971);var E=p(4058);m.exports=E.Promise},3685:(m,g,p)=>{m.exports=p(621)},621:(m,g,p)=>{var E=p(3536);m.exports=E},4883:(m,g,p)=>{var E=p(7475),v=p(9826),T=TypeError;m.exports=function(I){if(E(I))return I;throw T(v(I)+" is not a function")}},174:(m,g,p)=>{var E=p(4284),v=p(9826),T=TypeError;m.exports=function(I){if(E(I))return I;throw T(v(I)+" is not a constructor")}},1851:(m,g,p)=>{var E=p(7475),v=String,T=TypeError;m.exports=function(I){if(typeof I=="object"||E(I))return I;throw T("Can't set "+v(I)+" as a prototype")}},8479:m=>{m.exports=function(){}},5743:(m,g,p)=>{var E=p(7046),v=TypeError;m.exports=function(T,I){if(E(I,T))return T;throw v("Incorrect invocation")}},6059:(m,g,p)=>{var E=p(941),v=String,T=TypeError;m.exports=function(I){if(E(I))return I;throw T(v(I)+" is not an object")}},1692:(m,g,p)=>{var E=p(4529),v=p(9413),T=p(623),I=function(O){return function(N,P,L){var x,W=E(N),q=T(W),X=v(L,q);if(O&&P!=P){for(;q>X;)if((x=W[X++])!=x)return!0}else for(;q>X;X++)if((O||X in W)&&W[X]===P)return O||X||0;return!O&&-1}};m.exports={includes:I(!0),indexOf:I(!1)}},3765:(m,g,p)=>{var E=p(5329);m.exports=E([].slice)},1385:(m,g,p)=>{var E=p(9813)("iterator"),v=!1;try{var T=0,I={next:function(){return{done:!!T++}},return:function(){v=!0}};I[E]=function(){return this},Array.from(I,function(){throw 2})}catch{}m.exports=function(O,N){if(!N&&!v)return!1;var P=!1;try{var L={};L[E]=function(){return{next:function(){return{done:P=!0}}}},O(L)}catch{}return P}},2532:(m,g,p)=>{var E=p(4163),v=E({}.toString),T=E("".slice);m.exports=function(I){return T(v(I),8,-1)}},9697:(m,g,p)=>{var E=p(2885),v=p(7475),T=p(2532),I=p(9813)("toStringTag"),O=Object,N=T(function(){return arguments}())=="Arguments";m.exports=E?T:function(P){var L,x,W;return P===void 0?"Undefined":P===null?"Null":typeof(x=function(q,X){try{return q[X]}catch{}}(L=O(P),I))=="string"?x:N?T(L):(W=T(L))=="Object"&&v(L.callee)?"Arguments":W}},3489:(m,g,p)=>{var E=p(953),v=p(1136),T=p(9677),I=p(5988);m.exports=function(O,N,P){for(var L=v(N),x=I.f,W=T.f,q=0;q<L.length;q++){var X=L[q];E(O,X)||P&&E(P,X)||x(O,X,W(N,X))}}},4160:(m,g,p)=>{var E=p(5981);m.exports=!E(function(){function v(){}return v.prototype.constructor=null,Object.getPrototypeOf(new v)!==v.prototype})},3538:m=>{m.exports=function(g,p){return{value:g,done:p}}},2029:(m,g,p)=>{var E=p(5746),v=p(5988),T=p(1887);m.exports=E?function(I,O,N){return v.f(I,O,T(1,N))}:function(I,O,N){return I[O]=N,I}},1887:m=>{m.exports=function(g,p){return{enumerable:!(1&g),configurable:!(2&g),writable:!(4&g),value:p}}},5929:(m,g,p)=>{var E=p(2029);m.exports=function(v,T,I,O){return O&&O.enumerable?v[T]=I:E(v,T,I),v}},5609:(m,g,p)=>{var E=p(1899),v=Object.defineProperty;m.exports=function(T,I){try{v(E,T,{value:I,configurable:!0,writable:!0})}catch{E[T]=I}return I}},5746:(m,g,p)=>{var E=p(5981);m.exports=!E(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},6616:m=>{var g=typeof document=="object"&&document.all,p=g===void 0&&g!==void 0;m.exports={all:g,IS_HTMLDDA:p}},1333:(m,g,p)=>{var E=p(1899),v=p(941),T=E.document,I=v(T)&&v(T.createElement);m.exports=function(O){return I?T.createElement(O):{}}},3281:m=>{m.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},3321:(m,g,p)=>{var E=p(8501),v=p(6049);m.exports=!E&&!v&&typeof window=="object"&&typeof document=="object"},8501:m=>{m.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},4470:(m,g,p)=>{var E=p(2861),v=p(1899);m.exports=/ipad|iphone|ipod/i.test(E)&&v.Pebble!==void 0},2749:(m,g,p)=>{var E=p(2861);m.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(E)},6049:(m,g,p)=>{var E=p(2532),v=p(1899);m.exports=E(v.process)=="process"},8045:(m,g,p)=>{var E=p(2861);m.exports=/web0s(?!.*chrome)/i.test(E)},2861:(m,g,p)=>{var E=p(626);m.exports=E("navigator","userAgent")||""},3385:(m,g,p)=>{var E,v,T=p(1899),I=p(2861),O=T.process,N=T.Deno,P=O&&O.versions||N&&N.version,L=P&&P.v8;L&&(v=(E=L.split("."))[0]>0&&E[0]<4?1:+(E[0]+E[1])),!v&&I&&(!(E=I.match(/Edge\/(\d+)/))||E[1]>=74)&&(E=I.match(/Chrome\/(\d+)/))&&(v=+E[1]),m.exports=v},6759:m=>{m.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3995:(m,g,p)=>{var E=p(5329),v=Error,T=E("".replace),I=String(v("zxcasd").stack),O=/\n\s*at [^:]*:[^\n]*/,N=O.test(I);m.exports=function(P,L){if(N&&typeof P=="string"&&!v.prepareStackTrace)for(;L--;)P=T(P,O,"");return P}},8780:(m,g,p)=>{var E=p(5981),v=p(1887);m.exports=!E(function(){var T=Error("a");return!("stack"in T)||(Object.defineProperty(T,"stack",v(1,7)),T.stack!==7)})},6887:(m,g,p)=>{var E=p(1899),v=p(9730),T=p(5329),I=p(7475),O=p(9677).f,N=p(7252),P=p(4058),L=p(6843),x=p(2029),W=p(953),q=function(X){var ie=function(ee,le,he){if(this instanceof ie){switch(arguments.length){case 0:return new X;case 1:return new X(ee);case 2:return new X(ee,le)}return new X(ee,le,he)}return v(X,this,arguments)};return ie.prototype=X.prototype,ie};m.exports=function(X,ie){var ee,le,he,ue,Ce,De,je,fe,J=X.target,ne=X.global,$=X.stat,Z=X.proto,se=ne?E:$?E[J]:(E[J]||{}).prototype,pe=ne?P:P[J]||x(P,J,{})[J],Oe=pe.prototype;for(he in ie)ee=!N(ne?he:J+($?".":"#")+he,X.forced)&&se&&W(se,he),Ce=pe[he],ee&&(De=X.dontCallGetSet?(fe=O(se,he))&&fe.value:se[he]),ue=ee&&De?De:ie[he],ee&&typeof Ce==typeof ue||(je=X.bind&&ee?L(ue,E):X.wrap&&ee?q(ue):Z&&I(ue)?T(ue):ue,(X.sham||ue&&ue.sham||Ce&&Ce.sham)&&x(je,"sham",!0),x(pe,he,je),Z&&(W(P,le=J+"Prototype")||x(P,le,{}),x(P[le],he,ue),X.real&&Oe&&!Oe[he]&&x(Oe,he,ue)))}},5981:m=>{m.exports=function(g){try{return!!g()}catch{return!0}}},9730:(m,g,p)=>{var E=p(8285),v=Function.prototype,T=v.apply,I=v.call;m.exports=typeof Reflect=="object"&&Reflect.apply||(E?I.bind(T):function(){return I.apply(T,arguments)})},6843:(m,g,p)=>{var E=p(5329),v=p(4883),T=p(8285),I=E(E.bind);m.exports=function(O,N){return v(O),N===void 0?O:T?I(O,N):function(){return O.apply(N,arguments)}}},8285:(m,g,p)=>{var E=p(5981);m.exports=!E(function(){var v=function(){}.bind();return typeof v!="function"||v.hasOwnProperty("prototype")})},8834:(m,g,p)=>{var E=p(8285),v=Function.prototype.call;m.exports=E?v.bind(v):function(){return v.apply(v,arguments)}},9417:(m,g,p)=>{var E=p(5746),v=p(953),T=Function.prototype,I=E&&Object.getOwnPropertyDescriptor,O=v(T,"name"),N=O&&function(){}.name==="something",P=O&&(!E||E&&I(T,"name").configurable);m.exports={EXISTS:O,PROPER:N,CONFIGURABLE:P}},4163:(m,g,p)=>{var E=p(8285),v=Function.prototype,T=v.call,I=E&&v.bind.bind(T,T);m.exports=E?I:function(O){return function(){return T.apply(O,arguments)}}},5329:(m,g,p)=>{var E=p(2532),v=p(4163);m.exports=function(T){if(E(T)==="Function")return v(T)}},626:(m,g,p)=>{var E=p(4058),v=p(1899),T=p(7475),I=function(O){return T(O)?O:void 0};m.exports=function(O,N){return arguments.length<2?I(E[O])||I(v[O]):E[O]&&E[O][N]||v[O]&&v[O][N]}},2902:(m,g,p)=>{var E=p(9697),v=p(4229),T=p(2119),I=p(2077),O=p(9813)("iterator");m.exports=function(N){if(!T(N))return v(N,O)||v(N,"@@iterator")||I[E(N)]}},3476:(m,g,p)=>{var E=p(8834),v=p(4883),T=p(6059),I=p(9826),O=p(2902),N=TypeError;m.exports=function(P,L){var x=arguments.length<2?O(P):L;if(v(x))return T(E(x,P));throw N(I(P)+" is not iterable")}},4229:(m,g,p)=>{var E=p(4883),v=p(2119);m.exports=function(T,I){var O=T[I];return v(O)?void 0:E(O)}},1899:(m,g,p)=>{var E=function(v){return v&&v.Math==Math&&v};m.exports=E(typeof globalThis=="object"&&globalThis)||E(typeof window=="object"&&window)||E(typeof self=="object"&&self)||E(typeof p.g=="object"&&p.g)||function(){return this}()||Function("return this")()},953:(m,g,p)=>{var E=p(5329),v=p(9678),T=E({}.hasOwnProperty);m.exports=Object.hasOwn||function(I,O){return T(v(I),O)}},7748:m=>{m.exports={}},4845:(m,g,p)=>{var E=p(1899);m.exports=function(v,T){var I=E.console;I&&I.error&&(arguments.length==1?I.error(v):I.error(v,T))}},5463:(m,g,p)=>{var E=p(626);m.exports=E("document","documentElement")},2840:(m,g,p)=>{var E=p(5746),v=p(5981),T=p(1333);m.exports=!E&&!v(function(){return Object.defineProperty(T("div"),"a",{get:function(){return 7}}).a!=7})},7026:(m,g,p)=>{var E=p(5329),v=p(5981),T=p(2532),I=Object,O=E("".split);m.exports=v(function(){return!I("z").propertyIsEnumerable(0)})?function(N){return T(N)=="String"?O(N,""):I(N)}:I},1302:(m,g,p)=>{var E=p(5329),v=p(7475),T=p(3030),I=E(Function.toString);v(T.inspectSource)||(T.inspectSource=function(O){return I(O)}),m.exports=T.inspectSource},3794:(m,g,p)=>{var E=p(941),v=p(2029);m.exports=function(T,I){E(I)&&"cause"in I&&v(T,"cause",I.cause)}},5402:(m,g,p)=>{var E,v,T,I=p(7093),O=p(1899),N=p(941),P=p(2029),L=p(953),x=p(3030),W=p(4262),q=p(7748),X="Object already initialized",ie=O.TypeError,ee=O.WeakMap;if(I||x.state){var le=x.state||(x.state=new ee);le.get=le.get,le.has=le.has,le.set=le.set,E=function(ue,Ce){if(le.has(ue))throw ie(X);return Ce.facade=ue,le.set(ue,Ce),Ce},v=function(ue){return le.get(ue)||{}},T=function(ue){return le.has(ue)}}else{var he=W("state");q[he]=!0,E=function(ue,Ce){if(L(ue,he))throw ie(X);return Ce.facade=ue,P(ue,he,Ce),Ce},v=function(ue){return L(ue,he)?ue[he]:{}},T=function(ue){return L(ue,he)}}m.exports={set:E,get:v,has:T,enforce:function(ue){return T(ue)?v(ue):E(ue,{})},getterFor:function(ue){return function(Ce){var De;if(!N(Ce)||(De=v(Ce)).type!==ue)throw ie("Incompatible receiver, "+ue+" required");return De}}}},6782:(m,g,p)=>{var E=p(9813),v=p(2077),T=E("iterator"),I=Array.prototype;m.exports=function(O){return O!==void 0&&(v.Array===O||I[T]===O)}},7475:(m,g,p)=>{var E=p(6616),v=E.all;m.exports=E.IS_HTMLDDA?function(T){return typeof T=="function"||T===v}:function(T){return typeof T=="function"}},4284:(m,g,p)=>{var E=p(5329),v=p(5981),T=p(7475),I=p(9697),O=p(626),N=p(1302),P=function(){},L=[],x=O("Reflect","construct"),W=/^\s*(?:class|function)\b/,q=E(W.exec),X=!W.exec(P),ie=function(le){if(!T(le))return!1;try{return x(P,L,le),!0}catch{return!1}},ee=function(le){if(!T(le))return!1;switch(I(le)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return X||!!q(W,N(le))}catch{return!0}};ee.sham=!0,m.exports=!x||v(function(){var le;return ie(ie.call)||!ie(Object)||!ie(function(){le=!0})||le})?ee:ie},7252:(m,g,p)=>{var E=p(5981),v=p(7475),T=/#|\.prototype\./,I=function(x,W){var q=N[O(x)];return q==L||q!=P&&(v(W)?E(W):!!W)},O=I.normalize=function(x){return String(x).replace(T,".").toLowerCase()},N=I.data={},P=I.NATIVE="N",L=I.POLYFILL="P";m.exports=I},2119:m=>{m.exports=function(g){return g==null}},941:(m,g,p)=>{var E=p(7475),v=p(6616),T=v.all;m.exports=v.IS_HTMLDDA?function(I){return typeof I=="object"?I!==null:E(I)||I===T}:function(I){return typeof I=="object"?I!==null:E(I)}},2529:m=>{m.exports=!0},6664:(m,g,p)=>{var E=p(626),v=p(7475),T=p(7046),I=p(2302),O=Object;m.exports=I?function(N){return typeof N=="symbol"}:function(N){var P=E("Symbol");return v(P)&&T(P.prototype,O(N))}},3091:(m,g,p)=>{var E=p(6843),v=p(8834),T=p(6059),I=p(9826),O=p(6782),N=p(623),P=p(7046),L=p(3476),x=p(2902),W=p(7609),q=TypeError,X=function(ee,le){this.stopped=ee,this.result=le},ie=X.prototype;m.exports=function(ee,le,he){var ue,Ce,De,je,fe,J,ne,$=he&&he.that,Z=!(!he||!he.AS_ENTRIES),se=!(!he||!he.IS_RECORD),pe=!(!he||!he.IS_ITERATOR),Oe=!(!he||!he.INTERRUPTED),ce=E(le,$),A=function(G){return ue&&W(ue,"normal",G),new X(!0,G)},U=function(G){return Z?(T(G),Oe?ce(G[0],G[1],A):ce(G[0],G[1])):Oe?ce(G,A):ce(G)};if(se)ue=ee.iterator;else if(pe)ue=ee;else{if(!(Ce=x(ee)))throw q(I(ee)+" is not iterable");if(O(Ce)){for(De=0,je=N(ee);je>De;De++)if((fe=U(ee[De]))&&P(ie,fe))return fe;return new X(!1)}ue=L(ee,Ce)}for(J=se?ee.next:ue.next;!(ne=v(J,ue)).done;){try{fe=U(ne.value)}catch(G){W(ue,"throw",G)}if(typeof fe=="object"&&fe&&P(ie,fe))return fe}return new X(!1)}},7609:(m,g,p)=>{var E=p(8834),v=p(6059),T=p(4229);m.exports=function(I,O,N){var P,L;v(I);try{if(!(P=T(I,"return"))){if(O==="throw")throw N;return N}P=E(P,I)}catch(x){L=!0,P=x}if(O==="throw")throw N;if(L)throw P;return v(P),N}},3847:(m,g,p)=>{var E=p(5143).IteratorPrototype,v=p(9290),T=p(1887),I=p(904),O=p(2077),N=function(){return this};m.exports=function(P,L,x,W){var q=L+" Iterator";return P.prototype=v(E,{next:T(+!W,x)}),I(P,q,!1,!0),O[q]=N,P}},5105:(m,g,p)=>{var E=p(6887),v=p(8834),T=p(2529),I=p(9417),O=p(7475),N=p(3847),P=p(249),L=p(8929),x=p(904),W=p(2029),q=p(5929),X=p(9813),ie=p(2077),ee=p(5143),le=I.PROPER,he=I.CONFIGURABLE,ue=ee.IteratorPrototype,Ce=ee.BUGGY_SAFARI_ITERATORS,De=X("iterator"),je="keys",fe="values",J="entries",ne=function(){return this};m.exports=function($,Z,se,pe,Oe,ce,A){N(se,Z,pe);var U,G,re,Ne=function(ut){if(ut===Oe&&et)return et;if(!Ce&&ut in Et)return Et[ut];switch(ut){case je:case fe:case J:return function(){return new se(this,ut)}}return function(){return new se(this)}},ht=Z+" Iterator",At=!1,Et=$.prototype,mn=Et[De]||Et["@@iterator"]||Oe&&Et[Oe],et=!Ce&&mn||Ne(Oe),xt=Z=="Array"&&Et.entries||mn;if(xt&&(U=P(xt.call(new $)))!==Object.prototype&&U.next&&(T||P(U)===ue||(L?L(U,ue):O(U[De])||q(U,De,ne)),x(U,ht,!0,!0),T&&(ie[ht]=ne)),le&&Oe==fe&&mn&&mn.name!==fe&&(!T&&he?W(Et,"name",fe):(At=!0,et=function(){return v(mn,this)})),Oe)if(G={values:Ne(fe),keys:ce?et:Ne(je),entries:Ne(J)},A)for(re in G)(Ce||At||!(re in Et))&&q(Et,re,G[re]);else E({target:Z,proto:!0,forced:Ce||At},G);return T&&!A||Et[De]===et||q(Et,De,et,{name:Oe}),ie[Z]=et,G}},5143:(m,g,p)=>{var E,v,T,I=p(5981),O=p(7475),N=p(941),P=p(9290),L=p(249),x=p(5929),W=p(9813),q=p(2529),X=W("iterator"),ie=!1;[].keys&&("next"in(T=[].keys())?(v=L(L(T)))!==Object.prototype&&(E=v):ie=!0),!N(E)||I(function(){var ee={};return E[X].call(ee)!==ee})?E={}:q&&(E=P(E)),O(E[X])||x(E,X,function(){return this}),m.exports={IteratorPrototype:E,BUGGY_SAFARI_ITERATORS:ie}},2077:m=>{m.exports={}},623:(m,g,p)=>{var E=p(3057);m.exports=function(v){return E(v.length)}},5331:m=>{var g=Math.ceil,p=Math.floor;m.exports=Math.trunc||function(E){var v=+E;return(v>0?p:g)(v)}},6132:(m,g,p)=>{var E,v,T,I,O,N,P,L,x=p(1899),W=p(6843),q=p(9677).f,X=p(2941).set,ie=p(2749),ee=p(4470),le=p(8045),he=p(6049),ue=x.MutationObserver||x.WebKitMutationObserver,Ce=x.document,De=x.process,je=x.Promise,fe=q(x,"queueMicrotask"),J=fe&&fe.value;J||(E=function(){var ne,$;for(he&&(ne=De.domain)&&ne.exit();v;){$=v.fn,v=v.next;try{$()}catch(Z){throw v?I():T=void 0,Z}}T=void 0,ne&&ne.enter()},ie||he||le||!ue||!Ce?!ee&&je&&je.resolve?((P=je.resolve(void 0)).constructor=je,L=W(P.then,P),I=function(){L(E)}):he?I=function(){De.nextTick(E)}:(X=W(X,x),I=function(){X(E)}):(O=!0,N=Ce.createTextNode(""),new ue(E).observe(N,{characterData:!0}),I=function(){N.data=O=!O})),m.exports=J||function(ne){var $={fn:ne,next:void 0};T&&(T.next=$),v||(v=$,I()),T=$}},9520:(m,g,p)=>{var E=p(4883),v=TypeError,T=function(I){var O,N;this.promise=new I(function(P,L){if(O!==void 0||N!==void 0)throw v("Bad Promise constructor");O=P,N=L}),this.resolve=E(O),this.reject=E(N)};m.exports.f=function(I){return new T(I)}},4649:(m,g,p)=>{var E=p(5803);m.exports=function(v,T){return v===void 0?arguments.length<2?"":T:E(v)}},9290:(m,g,p)=>{var E,v=p(6059),T=p(9938),I=p(6759),O=p(7748),N=p(5463),P=p(1333),L=p(4262)("IE_PROTO"),x=function(){},W=function(ie){return"<script>"+ie+"<\/script>"},q=function(ie){ie.write(W("")),ie.close();var ee=ie.parentWindow.Object;return ie=null,ee},X=function(){try{E=new ActiveXObject("htmlfile")}catch{}var ie,ee;X=typeof document<"u"?document.domain&&E?q(E):((ee=P("iframe")).style.display="none",N.appendChild(ee),ee.src=String("javascript:"),(ie=ee.contentWindow.document).open(),ie.write(W("document.F=Object")),ie.close(),ie.F):q(E);for(var le=I.length;le--;)delete X.prototype[I[le]];return X()};O[L]=!0,m.exports=Object.create||function(ie,ee){var le;return ie!==null?(x.prototype=v(ie),le=new x,x.prototype=null,le[L]=ie):le=X(),ee===void 0?le:T.f(le,ee)}},9938:(m,g,p)=>{var E=p(5746),v=p(3937),T=p(5988),I=p(6059),O=p(4529),N=p(4771);g.f=E&&!v?Object.defineProperties:function(P,L){I(P);for(var x,W=O(L),q=N(L),X=q.length,ie=0;X>ie;)T.f(P,x=q[ie++],W[x]);return P}},5988:(m,g,p)=>{var E=p(5746),v=p(2840),T=p(3937),I=p(6059),O=p(3894),N=TypeError,P=Object.defineProperty,L=Object.getOwnPropertyDescriptor;g.f=E?T?function(x,W,q){if(I(x),W=O(W),I(q),typeof x=="function"&&W==="prototype"&&"value"in q&&"writable"in q&&!q.writable){var X=L(x,W);X&&X.writable&&(x[W]=q.value,q={configurable:"configurable"in q?q.configurable:X.configurable,enumerable:"enumerable"in q?q.enumerable:X.enumerable,writable:!1})}return P(x,W,q)}:P:function(x,W,q){if(I(x),W=O(W),I(q),v)try{return P(x,W,q)}catch{}if("get"in q||"set"in q)throw N("Accessors not supported");return"value"in q&&(x[W]=q.value),x}},9677:(m,g,p)=>{var E=p(5746),v=p(8834),T=p(6760),I=p(1887),O=p(4529),N=p(3894),P=p(953),L=p(2840),x=Object.getOwnPropertyDescriptor;g.f=E?x:function(W,q){if(W=O(W),q=N(q),L)try{return x(W,q)}catch{}if(P(W,q))return I(!v(T.f,W,q),W[q])}},946:(m,g,p)=>{var E=p(5629),v=p(6759).concat("length","prototype");g.f=Object.getOwnPropertyNames||function(T){return E(T,v)}},7857:(m,g)=>{g.f=Object.getOwnPropertySymbols},249:(m,g,p)=>{var E=p(953),v=p(7475),T=p(9678),I=p(4262),O=p(4160),N=I("IE_PROTO"),P=Object,L=P.prototype;m.exports=O?P.getPrototypeOf:function(x){var W=T(x);if(E(W,N))return W[N];var q=W.constructor;return v(q)&&W instanceof q?q.prototype:W instanceof P?L:null}},7046:(m,g,p)=>{var E=p(5329);m.exports=E({}.isPrototypeOf)},5629:(m,g,p)=>{var E=p(5329),v=p(953),T=p(4529),I=p(1692).indexOf,O=p(7748),N=E([].push);m.exports=function(P,L){var x,W=T(P),q=0,X=[];for(x in W)!v(O,x)&&v(W,x)&&N(X,x);for(;L.length>q;)v(W,x=L[q++])&&(~I(X,x)||N(X,x));return X}},4771:(m,g,p)=>{var E=p(5629),v=p(6759);m.exports=Object.keys||function(T){return E(T,v)}},6760:(m,g)=>{var p={}.propertyIsEnumerable,E=Object.getOwnPropertyDescriptor,v=E&&!p.call({1:2},1);g.f=v?function(T){var I=E(this,T);return!!I&&I.enumerable}:p},8929:(m,g,p)=>{var E=p(5329),v=p(6059),T=p(1851);m.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var I,O=!1,N={};try{(I=E(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(N,[]),O=N instanceof Array}catch{}return function(P,L){return v(P),T(L),O?I(P,L):P.__proto__=L,P}}():void 0)},5623:(m,g,p)=>{var E=p(2885),v=p(9697);m.exports=E?{}.toString:function(){return"[object "+v(this)+"]"}},9811:(m,g,p)=>{var E=p(8834),v=p(7475),T=p(941),I=TypeError;m.exports=function(O,N){var P,L;if(N==="string"&&v(P=O.toString)&&!T(L=E(P,O))||v(P=O.valueOf)&&!T(L=E(P,O))||N!=="string"&&v(P=O.toString)&&!T(L=E(P,O)))return L;throw I("Can't convert object to primitive value")}},1136:(m,g,p)=>{var E=p(626),v=p(5329),T=p(946),I=p(7857),O=p(6059),N=v([].concat);m.exports=E("Reflect","ownKeys")||function(P){var L=T.f(O(P)),x=I.f;return x?N(L,x(P)):L}},4058:m=>{m.exports={}},2:m=>{m.exports=function(g){try{return{error:!1,value:g()}}catch(p){return{error:!0,value:p}}}},7742:(m,g,p)=>{var E=p(1899),v=p(6991),T=p(7475),I=p(7252),O=p(1302),N=p(9813),P=p(3321),L=p(8501),x=p(2529),W=p(3385),q=v&&v.prototype,X=N("species"),ie=!1,ee=T(E.PromiseRejectionEvent),le=I("Promise",function(){var he=O(v),ue=he!==String(v);if(!ue&&W===66||x&&(!q.catch||!q.finally))return!0;if(!W||W<51||!/native code/.test(he)){var Ce=new v(function(je){je(1)}),De=function(je){je(function(){},function(){})};if((Ce.constructor={})[X]=De,!(ie=Ce.then(function(){})instanceof De))return!0}return!ue&&(P||L)&&!ee});m.exports={CONSTRUCTOR:le,REJECTION_EVENT:ee,SUBCLASSING:ie}},6991:(m,g,p)=>{var E=p(1899);m.exports=E.Promise},6584:(m,g,p)=>{var E=p(6059),v=p(941),T=p(9520);m.exports=function(I,O){if(E(I),v(O)&&O.constructor===I)return O;var N=T.f(I);return(0,N.resolve)(O),N.promise}},1542:(m,g,p)=>{var E=p(6991),v=p(1385),T=p(7742).CONSTRUCTOR;m.exports=T||!v(function(I){E.all(I).then(void 0,function(){})})},8397:m=>{var g=function(){this.head=null,this.tail=null};g.prototype={add:function(p){var E={item:p,next:null};this.head?this.tail.next=E:this.head=E,this.tail=E},get:function(){var p=this.head;if(p)return this.head=p.next,this.tail===p&&(this.tail=null),p.item}},m.exports=g},8219:(m,g,p)=>{var E=p(2119),v=TypeError;m.exports=function(T){if(E(T))throw v("Can't call method on "+T);return T}},4431:(m,g,p)=>{var E=p(626),v=p(5988),T=p(9813),I=p(5746),O=T("species");m.exports=function(N){var P=E(N),L=v.f;I&&P&&!P[O]&&L(P,O,{configurable:!0,get:function(){return this}})}},904:(m,g,p)=>{var E=p(2885),v=p(5988).f,T=p(2029),I=p(953),O=p(5623),N=p(9813)("toStringTag");m.exports=function(P,L,x,W){if(P){var q=x?P:P.prototype;I(q,N)||v(q,N,{configurable:!0,value:L}),W&&!E&&T(q,"toString",O)}}},4262:(m,g,p)=>{var E=p(8726),v=p(9418),T=E("keys");m.exports=function(I){return T[I]||(T[I]=v(I))}},3030:(m,g,p)=>{var E=p(1899),v=p(5609),T="__core-js_shared__",I=E[T]||v(T,{});m.exports=I},8726:(m,g,p)=>{var E=p(2529),v=p(3030);(m.exports=function(T,I){return v[T]||(v[T]=I!==void 0?I:{})})("versions",[]).push({version:"3.26.0",mode:E?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})},487:(m,g,p)=>{var E=p(6059),v=p(174),T=p(2119),I=p(9813)("species");m.exports=function(O,N){var P,L=E(O).constructor;return L===void 0||T(P=E(L)[I])?N:v(P)}},4620:(m,g,p)=>{var E=p(5329),v=p(2435),T=p(5803),I=p(8219),O=E("".charAt),N=E("".charCodeAt),P=E("".slice),L=function(x){return function(W,q){var X,ie,ee=T(I(W)),le=v(q),he=ee.length;return le<0||le>=he?x?"":void 0:(X=N(ee,le))<55296||X>56319||le+1===he||(ie=N(ee,le+1))<56320||ie>57343?x?O(ee,le):X:x?P(ee,le,le+2):ie-56320+(X-55296<<10)+65536}};m.exports={codeAt:L(!1),charAt:L(!0)}},3405:(m,g,p)=>{var E=p(3385),v=p(5981);m.exports=!!Object.getOwnPropertySymbols&&!v(function(){var T=Symbol();return!String(T)||!(Object(T)instanceof Symbol)||!Symbol.sham&&E&&E<41})},2941:(m,g,p)=>{var E,v,T,I,O=p(1899),N=p(9730),P=p(6843),L=p(7475),x=p(953),W=p(5981),q=p(5463),X=p(3765),ie=p(1333),ee=p(8348),le=p(2749),he=p(6049),ue=O.setImmediate,Ce=O.clearImmediate,De=O.process,je=O.Dispatch,fe=O.Function,J=O.MessageChannel,ne=O.String,$=0,Z={};try{E=O.location}catch{}var se=function(A){if(x(Z,A)){var U=Z[A];delete Z[A],U()}},pe=function(A){return function(){se(A)}},Oe=function(A){se(A.data)},ce=function(A){O.postMessage(ne(A),E.protocol+"//"+E.host)};ue&&Ce||(ue=function(A){ee(arguments.length,1);var U=L(A)?A:fe(A),G=X(arguments,1);return Z[++$]=function(){N(U,void 0,G)},v($),$},Ce=function(A){delete Z[A]},he?v=function(A){De.nextTick(pe(A))}:je&&je.now?v=function(A){je.now(pe(A))}:J&&!le?(I=(T=new J).port2,T.port1.onmessage=Oe,v=P(I.postMessage,I)):O.addEventListener&&L(O.postMessage)&&!O.importScripts&&E&&E.protocol!=="file:"&&!W(ce)?(v=ce,O.addEventListener("message",Oe,!1)):v="onreadystatechange"in ie("script")?function(A){q.appendChild(ie("script")).onreadystatechange=function(){q.removeChild(this),se(A)}}:function(A){setTimeout(pe(A),0)}),m.exports={set:ue,clear:Ce}},9413:(m,g,p)=>{var E=p(2435),v=Math.max,T=Math.min;m.exports=function(I,O){var N=E(I);return N<0?v(N+O,0):T(N,O)}},4529:(m,g,p)=>{var E=p(7026),v=p(8219);m.exports=function(T){return E(v(T))}},2435:(m,g,p)=>{var E=p(5331);m.exports=function(v){var T=+v;return T!=T||T===0?0:E(T)}},3057:(m,g,p)=>{var E=p(2435),v=Math.min;m.exports=function(T){return T>0?v(E(T),9007199254740991):0}},9678:(m,g,p)=>{var E=p(8219),v=Object;m.exports=function(T){return v(E(T))}},6935:(m,g,p)=>{var E=p(8834),v=p(941),T=p(6664),I=p(4229),O=p(9811),N=p(9813),P=TypeError,L=N("toPrimitive");m.exports=function(x,W){if(!v(x)||T(x))return x;var q,X=I(x,L);if(X){if(W===void 0&&(W="default"),q=E(X,x,W),!v(q)||T(q))return q;throw P("Can't convert object to primitive value")}return W===void 0&&(W="number"),O(x,W)}},3894:(m,g,p)=>{var E=p(6935),v=p(6664);m.exports=function(T){var I=E(T,"string");return v(I)?I:I+""}},2885:(m,g,p)=>{var E={};E[p(9813)("toStringTag")]="z",m.exports=String(E)==="[object z]"},5803:(m,g,p)=>{var E=p(9697),v=String;m.exports=function(T){if(E(T)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return v(T)}},9826:m=>{var g=String;m.exports=function(p){try{return g(p)}catch{return"Object"}}},9418:(m,g,p)=>{var E=p(5329),v=0,T=Math.random(),I=E(1 .toString);m.exports=function(O){return"Symbol("+(O===void 0?"":O)+")_"+I(++v+T,36)}},2302:(m,g,p)=>{var E=p(3405);m.exports=E&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},3937:(m,g,p)=>{var E=p(5746),v=p(5981);m.exports=E&&v(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},8348:m=>{var g=TypeError;m.exports=function(p,E){if(p<E)throw g("Not enough arguments");return p}},7093:(m,g,p)=>{var E=p(1899),v=p(7475),T=E.WeakMap;m.exports=v(T)&&/native code/.test(String(T))},9813:(m,g,p)=>{var E=p(1899),v=p(8726),T=p(953),I=p(9418),O=p(3405),N=p(2302),P=v("wks"),L=E.Symbol,x=L&&L.for,W=N?L:L&&L.withoutSetter||I;m.exports=function(q){if(!T(P,q)||!O&&typeof P[q]!="string"){var X="Symbol."+q;O&&T(L,q)?P[q]=L[q]:P[q]=N&&x?x(X):W(X)}return P[q]}},9812:(m,g,p)=>{var E=p(6887),v=p(7046),T=p(249),I=p(8929),O=p(3489),N=p(9290),P=p(2029),L=p(1887),x=p(3995),W=p(3794),q=p(3091),X=p(4649),ie=p(9813),ee=p(8780),le=ie("toStringTag"),he=Error,ue=[].push,Ce=function(je,fe){var J,ne=arguments.length>2?arguments[2]:void 0,$=v(De,this);I?J=I(he(),$?T(this):De):(J=$?this:N(De),P(J,le,"Error")),fe!==void 0&&P(J,"message",X(fe)),ee&&P(J,"stack",x(J.stack,1)),W(J,ne);var Z=[];return q(je,ue,{that:Z}),P(J,"errors",Z),J};I?I(Ce,he):O(Ce,he,{name:!0});var De=Ce.prototype=N(he.prototype,{constructor:L(1,Ce),message:L(1,""),name:L(1,"AggregateError")});E({global:!0,constructor:!0,arity:2},{AggregateError:Ce})},7627:(m,g,p)=>{p(9812)},6274:(m,g,p)=>{var E=p(4529),v=p(8479),T=p(2077),I=p(5402),O=p(5988).f,N=p(5105),P=p(3538),L=p(2529),x=p(5746),W="Array Iterator",q=I.set,X=I.getterFor(W);m.exports=N(Array,"Array",function(ee,le){q(this,{type:W,target:E(ee),index:0,kind:le})},function(){var ee=X(this),le=ee.target,he=ee.kind,ue=ee.index++;return!le||ue>=le.length?(ee.target=void 0,P(void 0,!0)):P(he=="keys"?ue:he=="values"?le[ue]:[ue,le[ue]],!1)},"values");var ie=T.Arguments=T.Array;if(v("keys"),v("values"),v("entries"),!L&&x&&ie.name!=="values")try{O(ie,"name",{value:"values"})}catch{}},6450:(m,g,p)=>{var E=p(6887),v=p(5746),T=p(5988).f;E({target:"Object",stat:!0,forced:Object.defineProperty!==T,sham:!v},{defineProperty:T})},5967:()=>{},4560:(m,g,p)=>{var E=p(6887),v=p(8834),T=p(4883),I=p(9520),O=p(2),N=p(3091);E({target:"Promise",stat:!0},{allSettled:function(P){var L=this,x=I.f(L),W=x.resolve,q=x.reject,X=O(function(){var ie=T(L.resolve),ee=[],le=0,he=1;N(P,function(ue){var Ce=le++,De=!1;he++,v(ie,L,ue).then(function(je){De||(De=!0,ee[Ce]={status:"fulfilled",value:je},--he||W(ee))},function(je){De||(De=!0,ee[Ce]={status:"rejected",reason:je},--he||W(ee))})}),--he||W(ee)});return X.error&&q(X.value),x.promise}})},6890:(m,g,p)=>{var E=p(6887),v=p(8834),T=p(4883),I=p(9520),O=p(2),N=p(3091);E({target:"Promise",stat:!0,forced:p(1542)},{all:function(P){var L=this,x=I.f(L),W=x.resolve,q=x.reject,X=O(function(){var ie=T(L.resolve),ee=[],le=0,he=1;N(P,function(ue){var Ce=le++,De=!1;he++,v(ie,L,ue).then(function(je){De||(De=!0,ee[Ce]=je,--he||W(ee))},q)}),--he||W(ee)});return X.error&&q(X.value),x.promise}})},7206:(m,g,p)=>{var E=p(6887),v=p(8834),T=p(4883),I=p(626),O=p(9520),N=p(2),P=p(3091),L="No one promise resolved";E({target:"Promise",stat:!0},{any:function(x){var W=this,q=I("AggregateError"),X=O.f(W),ie=X.resolve,ee=X.reject,le=N(function(){var he=T(W.resolve),ue=[],Ce=0,De=1,je=!1;P(x,function(fe){var J=Ce++,ne=!1;De++,v(he,W,fe).then(function($){ne||je||(je=!0,ie($))},function($){ne||je||(ne=!0,ue[J]=$,--De||ee(new q(ue,L)))})}),--De||ee(new q(ue,L))});return le.error&&ee(le.value),X.promise}})},3376:(m,g,p)=>{var E=p(6887),v=p(2529),T=p(7742).CONSTRUCTOR,I=p(6991),O=p(626),N=p(7475),P=p(5929),L=I&&I.prototype;if(E({target:"Promise",proto:!0,forced:T,real:!0},{catch:function(W){return this.then(void 0,W)}}),!v&&N(I)){var x=O("Promise").prototype.catch;L.catch!==x&&P(L,"catch",x,{unsafe:!0})}},6934:(m,g,p)=>{var E,v,T,I=p(6887),O=p(2529),N=p(6049),P=p(1899),L=p(8834),x=p(5929),W=p(8929),q=p(904),X=p(4431),ie=p(4883),ee=p(7475),le=p(941),he=p(5743),ue=p(487),Ce=p(2941).set,De=p(6132),je=p(4845),fe=p(2),J=p(8397),ne=p(5402),$=p(6991),Z=p(7742),se=p(9520),pe="Promise",Oe=Z.CONSTRUCTOR,ce=Z.REJECTION_EVENT,A=Z.SUBCLASSING,U=ne.getterFor(pe),G=ne.set,re=$&&$.prototype,Ne=$,ht=re,At=P.TypeError,Et=P.document,mn=P.process,et=se.f,xt=et,ut=!!(Et&&Et.createEvent&&P.dispatchEvent),Vr="unhandledrejection",pt=function(Me){var Rt;return!(!le(Me)||!ee(Rt=Me.then))&&Rt},kt=function(Me,Rt){var jt,rn,ns,gp=Rt.value,k4=Rt.state==1,wR=k4?Me.ok:Me.fail,L4=Me.resolve,TE=Me.reject,od=Me.domain;try{wR?(k4||(Rt.rejection===2&&SE(Rt),Rt.rejection=1),wR===!0?jt=gp:(od&&od.enter(),jt=wR(gp),od&&(od.exit(),ns=!0)),jt===Me.promise?TE(At("Promise-chain cycle")):(rn=pt(jt))?L(rn,jt,L4,TE):L4(jt)):TE(gp)}catch(eie){od&&!ns&&od.exit(),TE(eie)}},ts=function(Me,Rt){Me.notified||(Me.notified=!0,De(function(){for(var jt,rn=Me.reactions;jt=rn.get();)kt(jt,Me);Me.notified=!1,Rt&&!Me.rejection&&rd(Me)}))},ir=function(Me,Rt,jt){var rn,ns;ut?((rn=Et.createEvent("Event")).promise=Rt,rn.reason=jt,rn.initEvent(Me,!1,!0),P.dispatchEvent(rn)):rn={promise:Rt,reason:jt},!ce&&(ns=P["on"+Me])?ns(rn):Me===Vr&&je("Unhandled promise rejection",jt)},rd=function(Me){L(Ce,P,function(){var Rt,jt=Me.facade,rn=Me.value;if(mp(Me)&&(Rt=fe(function(){N?mn.emit("unhandledRejection",rn,jt):ir(Vr,jt,rn)}),Me.rejection=N||mp(Me)?2:1,Rt.error))throw Rt.value})},mp=function(Me){return Me.rejection!==1&&!Me.parent},SE=function(Me){L(Ce,P,function(){var Rt=Me.facade;N?mn.emit("rejectionHandled",Rt):ir("rejectionhandled",Rt,Me.value)})},id=function(Me,Rt,jt){return function(rn){Me(Rt,rn,jt)}},sd=function(Me,Rt,jt){Me.done||(Me.done=!0,jt&&(Me=jt),Me.value=Rt,Me.state=2,ts(Me,!0))},IR=function(Me,Rt,jt){if(!Me.done){Me.done=!0,jt&&(Me=jt);try{if(Me.facade===Rt)throw At("Promise can't be resolved itself");var rn=pt(Rt);rn?De(function(){var ns={done:!1};try{L(rn,Rt,id(IR,ns,Me),id(sd,ns,Me))}catch(gp){sd(ns,gp,Me)}}):(Me.value=Rt,Me.state=1,ts(Me,!1))}catch(ns){sd({done:!1},ns,Me)}}};if(Oe&&(ht=(Ne=function(Me){he(this,ht),ie(Me),L(E,this);var Rt=U(this);try{Me(id(IR,Rt),id(sd,Rt))}catch(jt){sd(Rt,jt)}}).prototype,(E=function(Me){G(this,{type:pe,done:!1,notified:!1,parent:!1,reactions:new J,rejection:!1,state:0,value:void 0})}).prototype=x(ht,"then",function(Me,Rt){var jt=U(this),rn=et(ue(this,Ne));return jt.parent=!0,rn.ok=!ee(Me)||Me,rn.fail=ee(Rt)&&Rt,rn.domain=N?mn.domain:void 0,jt.state==0?jt.reactions.add(rn):De(function(){kt(rn,jt)}),rn.promise}),v=function(){var Me=new E,Rt=U(Me);this.promise=Me,this.resolve=id(IR,Rt),this.reject=id(sd,Rt)},se.f=et=function(Me){return Me===Ne||Me===void 0?new v(Me):xt(Me)},!O&&ee($)&&re!==Object.prototype)){T=re.then,A||x(re,"then",function(Me,Rt){var jt=this;return new Ne(function(rn,ns){L(T,jt,rn,ns)}).then(Me,Rt)},{unsafe:!0});try{delete re.constructor}catch{}W&&W(re,ht)}I({global:!0,constructor:!0,wrap:!0,forced:Oe},{Promise:Ne}),q(Ne,pe,!1,!0),X(pe)},4349:(m,g,p)=>{var E=p(6887),v=p(2529),T=p(6991),I=p(5981),O=p(626),N=p(7475),P=p(487),L=p(6584),x=p(5929),W=T&&T.prototype;if(E({target:"Promise",proto:!0,real:!0,forced:!!T&&I(function(){W.finally.call({then:function(){}},function(){})})},{finally:function(X){var ie=P(this,O("Promise")),ee=N(X);return this.then(ee?function(le){return L(ie,X()).then(function(){return le})}:X,ee?function(le){return L(ie,X()).then(function(){throw le})}:X)}}),!v&&N(T)){var q=O("Promise").prototype.finally;W.finally!==q&&x(W,"finally",q,{unsafe:!0})}},8881:(m,g,p)=>{p(6934),p(6890),p(3376),p(5921),p(4069),p(4482)},5921:(m,g,p)=>{var E=p(6887),v=p(8834),T=p(4883),I=p(9520),O=p(2),N=p(3091);E({target:"Promise",stat:!0,forced:p(1542)},{race:function(P){var L=this,x=I.f(L),W=x.reject,q=O(function(){var X=T(L.resolve);N(P,function(ie){v(X,L,ie).then(x.resolve,W)})});return q.error&&W(q.value),x.promise}})},4069:(m,g,p)=>{var E=p(6887),v=p(8834),T=p(9520);E({target:"Promise",stat:!0,forced:p(7742).CONSTRUCTOR},{reject:function(I){var O=T.f(this);return v(O.reject,void 0,I),O.promise}})},4482:(m,g,p)=>{var E=p(6887),v=p(626),T=p(2529),I=p(6991),O=p(7742).CONSTRUCTOR,N=p(6584),P=v("Promise"),L=T&&!O;E({target:"Promise",stat:!0,forced:T||O},{resolve:function(x){return N(L&&this===P?I:this,x)}})},7971:(m,g,p)=>{var E=p(4620).charAt,v=p(5803),T=p(5402),I=p(5105),O=p(3538),N="String Iterator",P=T.set,L=T.getterFor(N);I(String,"String",function(x){P(this,{type:N,string:v(x),index:0})},function(){var x,W=L(this),q=W.string,X=W.index;return X>=q.length?O(void 0,!0):(x=E(q,X),W.index+=x.length,O(x,!1))})},7634:(m,g,p)=>{p(6274);var E=p(3281),v=p(1899),T=p(9697),I=p(2029),O=p(2077),N=p(9813)("toStringTag");for(var P in E){var L=v[P],x=L&&L.prototype;x&&T(x)!==N&&I(x,N,P),O[P]=O.Array}},1910:(m,g,p)=>{var E=p(8171);m.exports=E},7460:(m,g,p)=>{var E=p(2956);p(7634),m.exports=E},9662:(m,g,p)=>{var E=p(614),v=p(6330),T=TypeError;m.exports=function(I){if(E(I))return I;throw T(v(I)+" is not a function")}},6077:(m,g,p)=>{var E=p(614),v=String,T=TypeError;m.exports=function(I){if(typeof I=="object"||E(I))return I;throw T("Can't set "+v(I)+" as a prototype")}},1223:(m,g,p)=>{var E=p(5112),v=p(30),T=p(3070).f,I=E("unscopables"),O=Array.prototype;O[I]==null&&T(O,I,{configurable:!0,value:v(null)}),m.exports=function(N){O[I][N]=!0}},9670:(m,g,p)=>{var E=p(111),v=String,T=TypeError;m.exports=function(I){if(E(I))return I;throw T(v(I)+" is not an object")}},1318:(m,g,p)=>{var E=p(5656),v=p(1400),T=p(6244),I=function(O){return function(N,P,L){var x,W=E(N),q=T(W),X=v(L,q);if(O&&P!=P){for(;q>X;)if((x=W[X++])!=x)return!0}else for(;q>X;X++)if((O||X in W)&&W[X]===P)return O||X||0;return!O&&-1}};m.exports={includes:I(!0),indexOf:I(!1)}},4326:(m,g,p)=>{var E=p(84),v=E({}.toString),T=E("".slice);m.exports=function(I){return T(v(I),8,-1)}},648:(m,g,p)=>{var E=p(1694),v=p(614),T=p(4326),I=p(5112)("toStringTag"),O=Object,N=T(function(){return arguments}())=="Arguments";m.exports=E?T:function(P){var L,x,W;return P===void 0?"Undefined":P===null?"Null":typeof(x=function(q,X){try{return q[X]}catch{}}(L=O(P),I))=="string"?x:N?T(L):(W=T(L))=="Object"&&v(L.callee)?"Arguments":W}},9920:(m,g,p)=>{var E=p(2597),v=p(3887),T=p(1236),I=p(3070);m.exports=function(O,N,P){for(var L=v(N),x=I.f,W=T.f,q=0;q<L.length;q++){var X=L[q];E(O,X)||P&&E(P,X)||x(O,X,W(N,X))}}},8544:(m,g,p)=>{var E=p(7293);m.exports=!E(function(){function v(){}return v.prototype.constructor=null,Object.getPrototypeOf(new v)!==v.prototype})},6178:m=>{m.exports=function(g,p){return{value:g,done:p}}},8880:(m,g,p)=>{var E=p(9781),v=p(3070),T=p(9114);m.exports=E?function(I,O,N){return v.f(I,O,T(1,N))}:function(I,O,N){return I[O]=N,I}},9114:m=>{m.exports=function(g,p){return{enumerable:!(1&g),configurable:!(2&g),writable:!(4&g),value:p}}},8052:(m,g,p)=>{var E=p(614),v=p(3070),T=p(6339),I=p(3072);m.exports=function(O,N,P,L){L||(L={});var x=L.enumerable,W=L.name!==void 0?L.name:N;if(E(P)&&T(P,W,L),L.global)x?O[N]=P:I(N,P);else{try{L.unsafe?O[N]&&(x=!0):delete O[N]}catch{}x?O[N]=P:v.f(O,N,{value:P,enumerable:!1,configurable:!L.nonConfigurable,writable:!L.nonWritable})}return O}},3072:(m,g,p)=>{var E=p(7854),v=Object.defineProperty;m.exports=function(T,I){try{v(E,T,{value:I,configurable:!0,writable:!0})}catch{E[T]=I}return I}},9781:(m,g,p)=>{var E=p(7293);m.exports=!E(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},4154:m=>{var g=typeof document=="object"&&document.all,p=g===void 0&&g!==void 0;m.exports={all:g,IS_HTMLDDA:p}},317:(m,g,p)=>{var E=p(7854),v=p(111),T=E.document,I=v(T)&&v(T.createElement);m.exports=function(O){return I?T.createElement(O):{}}},8324:m=>{m.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(m,g,p)=>{var E=p(317)("span").classList,v=E&&E.constructor&&E.constructor.prototype;m.exports=v===Object.prototype?void 0:v},8113:(m,g,p)=>{var E=p(5005);m.exports=E("navigator","userAgent")||""},7392:(m,g,p)=>{var E,v,T=p(7854),I=p(8113),O=T.process,N=T.Deno,P=O&&O.versions||N&&N.version,L=P&&P.v8;L&&(v=(E=L.split("."))[0]>0&&E[0]<4?1:+(E[0]+E[1])),!v&&I&&(!(E=I.match(/Edge\/(\d+)/))||E[1]>=74)&&(E=I.match(/Chrome\/(\d+)/))&&(v=+E[1]),m.exports=v},748:m=>{m.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},1060:(m,g,p)=>{var E=p(1702),v=Error,T=E("".replace),I=String(v("zxcasd").stack),O=/\n\s*at [^:]*:[^\n]*/,N=O.test(I);m.exports=function(P,L){if(N&&typeof P=="string"&&!v.prepareStackTrace)for(;L--;)P=T(P,O,"");return P}},2914:(m,g,p)=>{var E=p(7293),v=p(9114);m.exports=!E(function(){var T=Error("a");return!("stack"in T)||(Object.defineProperty(T,"stack",v(1,7)),T.stack!==7)})},2109:(m,g,p)=>{var E=p(7854),v=p(1236).f,T=p(8880),I=p(8052),O=p(3072),N=p(9920),P=p(4705);m.exports=function(L,x){var W,q,X,ie,ee,le=L.target,he=L.global,ue=L.stat;if(W=he?E:ue?E[le]||O(le,{}):(E[le]||{}).prototype)for(q in x){if(ie=x[q],X=L.dontCallGetSet?(ee=v(W,q))&&ee.value:W[q],!P(he?q:le+(ue?".":"#")+q,L.forced)&&X!==void 0){if(typeof ie==typeof X)continue;N(ie,X)}(L.sham||X&&X.sham)&&T(ie,"sham",!0),I(W,q,ie,L)}}},7293:m=>{m.exports=function(g){try{return!!g()}catch{return!0}}},2104:(m,g,p)=>{var E=p(4374),v=Function.prototype,T=v.apply,I=v.call;m.exports=typeof Reflect=="object"&&Reflect.apply||(E?I.bind(T):function(){return I.apply(T,arguments)})},4374:(m,g,p)=>{var E=p(7293);m.exports=!E(function(){var v=function(){}.bind();return typeof v!="function"||v.hasOwnProperty("prototype")})},6916:(m,g,p)=>{var E=p(4374),v=Function.prototype.call;m.exports=E?v.bind(v):function(){return v.apply(v,arguments)}},6530:(m,g,p)=>{var E=p(9781),v=p(2597),T=Function.prototype,I=E&&Object.getOwnPropertyDescriptor,O=v(T,"name"),N=O&&function(){}.name==="something",P=O&&(!E||E&&I(T,"name").configurable);m.exports={EXISTS:O,PROPER:N,CONFIGURABLE:P}},84:(m,g,p)=>{var E=p(4374),v=Function.prototype,T=v.call,I=E&&v.bind.bind(T,T);m.exports=E?I:function(O){return function(){return T.apply(O,arguments)}}},1702:(m,g,p)=>{var E=p(4326),v=p(84);m.exports=function(T){if(E(T)==="Function")return v(T)}},5005:(m,g,p)=>{var E=p(7854),v=p(614),T=function(I){return v(I)?I:void 0};m.exports=function(I,O){return arguments.length<2?T(E[I]):E[I]&&E[I][O]}},8173:(m,g,p)=>{var E=p(9662),v=p(8554);m.exports=function(T,I){var O=T[I];return v(O)?void 0:E(O)}},7854:(m,g,p)=>{var E=function(v){return v&&v.Math==Math&&v};m.exports=E(typeof globalThis=="object"&&globalThis)||E(typeof window=="object"&&window)||E(typeof self=="object"&&self)||E(typeof p.g=="object"&&p.g)||function(){return this}()||Function("return this")()},2597:(m,g,p)=>{var E=p(1702),v=p(7908),T=E({}.hasOwnProperty);m.exports=Object.hasOwn||function(I,O){return T(v(I),O)}},3501:m=>{m.exports={}},490:(m,g,p)=>{var E=p(5005);m.exports=E("document","documentElement")},4664:(m,g,p)=>{var E=p(9781),v=p(7293),T=p(317);m.exports=!E&&!v(function(){return Object.defineProperty(T("div"),"a",{get:function(){return 7}}).a!=7})},8361:(m,g,p)=>{var E=p(1702),v=p(7293),T=p(4326),I=Object,O=E("".split);m.exports=v(function(){return!I("z").propertyIsEnumerable(0)})?function(N){return T(N)=="String"?O(N,""):I(N)}:I},9587:(m,g,p)=>{var E=p(614),v=p(111),T=p(7674);m.exports=function(I,O,N){var P,L;return T&&E(P=O.constructor)&&P!==N&&v(L=P.prototype)&&L!==N.prototype&&T(I,L),I}},2788:(m,g,p)=>{var E=p(1702),v=p(614),T=p(5465),I=E(Function.toString);v(T.inspectSource)||(T.inspectSource=function(O){return I(O)}),m.exports=T.inspectSource},8340:(m,g,p)=>{var E=p(111),v=p(8880);m.exports=function(T,I){E(I)&&"cause"in I&&v(T,"cause",I.cause)}},9909:(m,g,p)=>{var E,v,T,I=p(4811),O=p(7854),N=p(111),P=p(8880),L=p(2597),x=p(5465),W=p(6200),q=p(3501),X="Object already initialized",ie=O.TypeError,ee=O.WeakMap;if(I||x.state){var le=x.state||(x.state=new ee);le.get=le.get,le.has=le.has,le.set=le.set,E=function(ue,Ce){if(le.has(ue))throw ie(X);return Ce.facade=ue,le.set(ue,Ce),Ce},v=function(ue){return le.get(ue)||{}},T=function(ue){return le.has(ue)}}else{var he=W("state");q[he]=!0,E=function(ue,Ce){if(L(ue,he))throw ie(X);return Ce.facade=ue,P(ue,he,Ce),Ce},v=function(ue){return L(ue,he)?ue[he]:{}},T=function(ue){return L(ue,he)}}m.exports={set:E,get:v,has:T,enforce:function(ue){return T(ue)?v(ue):E(ue,{})},getterFor:function(ue){return function(Ce){var De;if(!N(Ce)||(De=v(Ce)).type!==ue)throw ie("Incompatible receiver, "+ue+" required");return De}}}},614:(m,g,p)=>{var E=p(4154),v=E.all;m.exports=E.IS_HTMLDDA?function(T){return typeof T=="function"||T===v}:function(T){return typeof T=="function"}},4705:(m,g,p)=>{var E=p(7293),v=p(614),T=/#|\.prototype\./,I=function(x,W){var q=N[O(x)];return q==L||q!=P&&(v(W)?E(W):!!W)},O=I.normalize=function(x){return String(x).replace(T,".").toLowerCase()},N=I.data={},P=I.NATIVE="N",L=I.POLYFILL="P";m.exports=I},8554:m=>{m.exports=function(g){return g==null}},111:(m,g,p)=>{var E=p(614),v=p(4154),T=v.all;m.exports=v.IS_HTMLDDA?function(I){return typeof I=="object"?I!==null:E(I)||I===T}:function(I){return typeof I=="object"?I!==null:E(I)}},1913:m=>{m.exports=!1},2190:(m,g,p)=>{var E=p(5005),v=p(614),T=p(7976),I=p(3307),O=Object;m.exports=I?function(N){return typeof N=="symbol"}:function(N){var P=E("Symbol");return v(P)&&T(P.prototype,O(N))}},3061:(m,g,p)=>{var E=p(3383).IteratorPrototype,v=p(30),T=p(9114),I=p(8003),O=p(7497),N=function(){return this};m.exports=function(P,L,x,W){var q=L+" Iterator";return P.prototype=v(E,{next:T(+!W,x)}),I(P,q,!1,!0),O[q]=N,P}},1656:(m,g,p)=>{var E=p(2109),v=p(6916),T=p(1913),I=p(6530),O=p(614),N=p(3061),P=p(9518),L=p(7674),x=p(8003),W=p(8880),q=p(8052),X=p(5112),ie=p(7497),ee=p(3383),le=I.PROPER,he=I.CONFIGURABLE,ue=ee.IteratorPrototype,Ce=ee.BUGGY_SAFARI_ITERATORS,De=X("iterator"),je="keys",fe="values",J="entries",ne=function(){return this};m.exports=function($,Z,se,pe,Oe,ce,A){N(se,Z,pe);var U,G,re,Ne=function(ut){if(ut===Oe&&et)return et;if(!Ce&&ut in Et)return Et[ut];switch(ut){case je:case fe:case J:return function(){return new se(this,ut)}}return function(){return new se(this)}},ht=Z+" Iterator",At=!1,Et=$.prototype,mn=Et[De]||Et["@@iterator"]||Oe&&Et[Oe],et=!Ce&&mn||Ne(Oe),xt=Z=="Array"&&Et.entries||mn;if(xt&&(U=P(xt.call(new $)))!==Object.prototype&&U.next&&(T||P(U)===ue||(L?L(U,ue):O(U[De])||q(U,De,ne)),x(U,ht,!0,!0),T&&(ie[ht]=ne)),le&&Oe==fe&&mn&&mn.name!==fe&&(!T&&he?W(Et,"name",fe):(At=!0,et=function(){return v(mn,this)})),Oe)if(G={values:Ne(fe),keys:ce?et:Ne(je),entries:Ne(J)},A)for(re in G)(Ce||At||!(re in Et))&&q(Et,re,G[re]);else E({target:Z,proto:!0,forced:Ce||At},G);return T&&!A||Et[De]===et||q(Et,De,et,{name:Oe}),ie[Z]=et,G}},3383:(m,g,p)=>{var E,v,T,I=p(7293),O=p(614),N=p(111),P=p(30),L=p(9518),x=p(8052),W=p(5112),q=p(1913),X=W("iterator"),ie=!1;[].keys&&("next"in(T=[].keys())?(v=L(L(T)))!==Object.prototype&&(E=v):ie=!0),!N(E)||I(function(){var ee={};return E[X].call(ee)!==ee})?E={}:q&&(E=P(E)),O(E[X])||x(E,X,function(){return this}),m.exports={IteratorPrototype:E,BUGGY_SAFARI_ITERATORS:ie}},7497:m=>{m.exports={}},6244:(m,g,p)=>{var E=p(7466);m.exports=function(v){return E(v.length)}},6339:(m,g,p)=>{var E=p(7293),v=p(614),T=p(2597),I=p(9781),O=p(6530).CONFIGURABLE,N=p(2788),P=p(9909),L=P.enforce,x=P.get,W=Object.defineProperty,q=I&&!E(function(){return W(function(){},"length",{value:8}).length!==8}),X=String(String).split("String"),ie=m.exports=function(ee,le,he){String(le).slice(0,7)==="Symbol("&&(le="["+String(le).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),he&&he.getter&&(le="get "+le),he&&he.setter&&(le="set "+le),(!T(ee,"name")||O&&ee.name!==le)&&(I?W(ee,"name",{value:le,configurable:!0}):ee.name=le),q&&he&&T(he,"arity")&&ee.length!==he.arity&&W(ee,"length",{value:he.arity});try{he&&T(he,"constructor")&&he.constructor?I&&W(ee,"prototype",{writable:!1}):ee.prototype&&(ee.prototype=void 0)}catch{}var ue=L(ee);return T(ue,"source")||(ue.source=X.join(typeof le=="string"?le:"")),ee};Function.prototype.toString=ie(function(){return v(this)&&x(this).source||N(this)},"toString")},4758:m=>{var g=Math.ceil,p=Math.floor;m.exports=Math.trunc||function(E){var v=+E;return(v>0?p:g)(v)}},6277:(m,g,p)=>{var E=p(1340);m.exports=function(v,T){return v===void 0?arguments.length<2?"":T:E(v)}},30:(m,g,p)=>{var E,v=p(9670),T=p(6048),I=p(748),O=p(3501),N=p(490),P=p(317),L=p(6200)("IE_PROTO"),x=function(){},W=function(ie){return"<script>"+ie+"<\/script>"},q=function(ie){ie.write(W("")),ie.close();var ee=ie.parentWindow.Object;return ie=null,ee},X=function(){try{E=new ActiveXObject("htmlfile")}catch{}var ie,ee;X=typeof document<"u"?document.domain&&E?q(E):((ee=P("iframe")).style.display="none",N.appendChild(ee),ee.src=String("javascript:"),(ie=ee.contentWindow.document).open(),ie.write(W("document.F=Object")),ie.close(),ie.F):q(E);for(var le=I.length;le--;)delete X.prototype[I[le]];return X()};O[L]=!0,m.exports=Object.create||function(ie,ee){var le;return ie!==null?(x.prototype=v(ie),le=new x,x.prototype=null,le[L]=ie):le=X(),ee===void 0?le:T.f(le,ee)}},6048:(m,g,p)=>{var E=p(9781),v=p(3353),T=p(3070),I=p(9670),O=p(5656),N=p(1956);g.f=E&&!v?Object.defineProperties:function(P,L){I(P);for(var x,W=O(L),q=N(L),X=q.length,ie=0;X>ie;)T.f(P,x=q[ie++],W[x]);return P}},3070:(m,g,p)=>{var E=p(9781),v=p(4664),T=p(3353),I=p(9670),O=p(4948),N=TypeError,P=Object.defineProperty,L=Object.getOwnPropertyDescriptor;g.f=E?T?function(x,W,q){if(I(x),W=O(W),I(q),typeof x=="function"&&W==="prototype"&&"value"in q&&"writable"in q&&!q.writable){var X=L(x,W);X&&X.writable&&(x[W]=q.value,q={configurable:"configurable"in q?q.configurable:X.configurable,enumerable:"enumerable"in q?q.enumerable:X.enumerable,writable:!1})}return P(x,W,q)}:P:function(x,W,q){if(I(x),W=O(W),I(q),v)try{return P(x,W,q)}catch{}if("get"in q||"set"in q)throw N("Accessors not supported");return"value"in q&&(x[W]=q.value),x}},1236:(m,g,p)=>{var E=p(9781),v=p(6916),T=p(5296),I=p(9114),O=p(5656),N=p(4948),P=p(2597),L=p(4664),x=Object.getOwnPropertyDescriptor;g.f=E?x:function(W,q){if(W=O(W),q=N(q),L)try{return x(W,q)}catch{}if(P(W,q))return I(!v(T.f,W,q),W[q])}},8006:(m,g,p)=>{var E=p(6324),v=p(748).concat("length","prototype");g.f=Object.getOwnPropertyNames||function(T){return E(T,v)}},5181:(m,g)=>{g.f=Object.getOwnPropertySymbols},9518:(m,g,p)=>{var E=p(2597),v=p(614),T=p(7908),I=p(6200),O=p(8544),N=I("IE_PROTO"),P=Object,L=P.prototype;m.exports=O?P.getPrototypeOf:function(x){var W=T(x);if(E(W,N))return W[N];var q=W.constructor;return v(q)&&W instanceof q?q.prototype:W instanceof P?L:null}},7976:(m,g,p)=>{var E=p(1702);m.exports=E({}.isPrototypeOf)},6324:(m,g,p)=>{var E=p(1702),v=p(2597),T=p(5656),I=p(1318).indexOf,O=p(3501),N=E([].push);m.exports=function(P,L){var x,W=T(P),q=0,X=[];for(x in W)!v(O,x)&&v(W,x)&&N(X,x);for(;L.length>q;)v(W,x=L[q++])&&(~I(X,x)||N(X,x));return X}},1956:(m,g,p)=>{var E=p(6324),v=p(748);m.exports=Object.keys||function(T){return E(T,v)}},5296:(m,g)=>{var p={}.propertyIsEnumerable,E=Object.getOwnPropertyDescriptor,v=E&&!p.call({1:2},1);g.f=v?function(T){var I=E(this,T);return!!I&&I.enumerable}:p},7674:(m,g,p)=>{var E=p(1702),v=p(9670),T=p(6077);m.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var I,O=!1,N={};try{(I=E(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(N,[]),O=N instanceof Array}catch{}return function(P,L){return v(P),T(L),O?I(P,L):P.__proto__=L,P}}():void 0)},2140:(m,g,p)=>{var E=p(6916),v=p(614),T=p(111),I=TypeError;m.exports=function(O,N){var P,L;if(N==="string"&&v(P=O.toString)&&!T(L=E(P,O))||v(P=O.valueOf)&&!T(L=E(P,O))||N!=="string"&&v(P=O.toString)&&!T(L=E(P,O)))return L;throw I("Can't convert object to primitive value")}},3887:(m,g,p)=>{var E=p(5005),v=p(1702),T=p(8006),I=p(5181),O=p(9670),N=v([].concat);m.exports=E("Reflect","ownKeys")||function(P){var L=T.f(O(P)),x=I.f;return x?N(L,x(P)):L}},2626:(m,g,p)=>{var E=p(3070).f;m.exports=function(v,T,I){I in v||E(v,I,{configurable:!0,get:function(){return T[I]},set:function(O){T[I]=O}})}},4488:(m,g,p)=>{var E=p(8554),v=TypeError;m.exports=function(T){if(E(T))throw v("Can't call method on "+T);return T}},8003:(m,g,p)=>{var E=p(3070).f,v=p(2597),T=p(5112)("toStringTag");m.exports=function(I,O,N){I&&!N&&(I=I.prototype),I&&!v(I,T)&&E(I,T,{configurable:!0,value:O})}},6200:(m,g,p)=>{var E=p(2309),v=p(9711),T=E("keys");m.exports=function(I){return T[I]||(T[I]=v(I))}},5465:(m,g,p)=>{var E=p(7854),v=p(3072),T="__core-js_shared__",I=E[T]||v(T,{});m.exports=I},2309:(m,g,p)=>{var E=p(1913),v=p(5465);(m.exports=function(T,I){return v[T]||(v[T]=I!==void 0?I:{})})("versions",[]).push({version:"3.26.0",mode:E?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})},6293:(m,g,p)=>{var E=p(7392),v=p(7293);m.exports=!!Object.getOwnPropertySymbols&&!v(function(){var T=Symbol();return!String(T)||!(Object(T)instanceof Symbol)||!Symbol.sham&&E&&E<41})},1400:(m,g,p)=>{var E=p(9303),v=Math.max,T=Math.min;m.exports=function(I,O){var N=E(I);return N<0?v(N+O,0):T(N,O)}},5656:(m,g,p)=>{var E=p(8361),v=p(4488);m.exports=function(T){return E(v(T))}},9303:(m,g,p)=>{var E=p(4758);m.exports=function(v){var T=+v;return T!=T||T===0?0:E(T)}},7466:(m,g,p)=>{var E=p(9303),v=Math.min;m.exports=function(T){return T>0?v(E(T),9007199254740991):0}},7908:(m,g,p)=>{var E=p(4488),v=Object;m.exports=function(T){return v(E(T))}},7593:(m,g,p)=>{var E=p(6916),v=p(111),T=p(2190),I=p(8173),O=p(2140),N=p(5112),P=TypeError,L=N("toPrimitive");m.exports=function(x,W){if(!v(x)||T(x))return x;var q,X=I(x,L);if(X){if(W===void 0&&(W="default"),q=E(X,x,W),!v(q)||T(q))return q;throw P("Can't convert object to primitive value")}return W===void 0&&(W="number"),O(x,W)}},4948:(m,g,p)=>{var E=p(7593),v=p(2190);m.exports=function(T){var I=E(T,"string");return v(I)?I:I+""}},1694:(m,g,p)=>{var E={};E[p(5112)("toStringTag")]="z",m.exports=String(E)==="[object z]"},1340:(m,g,p)=>{var E=p(648),v=String;m.exports=function(T){if(E(T)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return v(T)}},6330:m=>{var g=String;m.exports=function(p){try{return g(p)}catch{return"Object"}}},9711:(m,g,p)=>{var E=p(1702),v=0,T=Math.random(),I=E(1 .toString);m.exports=function(O){return"Symbol("+(O===void 0?"":O)+")_"+I(++v+T,36)}},3307:(m,g,p)=>{var E=p(6293);m.exports=E&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},3353:(m,g,p)=>{var E=p(9781),v=p(7293);m.exports=E&&v(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},4811:(m,g,p)=>{var E=p(7854),v=p(614),T=E.WeakMap;m.exports=v(T)&&/native code/.test(String(T))},5112:(m,g,p)=>{var E=p(7854),v=p(2309),T=p(2597),I=p(9711),O=p(6293),N=p(3307),P=v("wks"),L=E.Symbol,x=L&&L.for,W=N?L:L&&L.withoutSetter||I;m.exports=function(q){if(!T(P,q)||!O&&typeof P[q]!="string"){var X="Symbol."+q;O&&T(L,q)?P[q]=L[q]:P[q]=N&&x?x(X):W(X)}return P[q]}},9191:(m,g,p)=>{var E=p(5005),v=p(2597),T=p(8880),I=p(7976),O=p(7674),N=p(9920),P=p(2626),L=p(9587),x=p(6277),W=p(8340),q=p(1060),X=p(2914),ie=p(9781),ee=p(1913);m.exports=function(le,he,ue,Ce){var De="stackTraceLimit",je=Ce?2:1,fe=le.split("."),J=fe[fe.length-1],ne=E.apply(null,fe);if(ne){var $=ne.prototype;if(!ee&&v($,"cause")&&delete $.cause,!ue)return ne;var Z=E("Error"),se=he(function(pe,Oe){var ce=x(Ce?Oe:pe,void 0),A=Ce?new ne(pe):new ne;return ce!==void 0&&T(A,"message",ce),X&&T(A,"stack",q(A.stack,2)),this&&I($,this)&&L(A,this,se),arguments.length>je&&W(A,arguments[je]),A});if(se.prototype=$,J!=="Error"?O?O(se,Z):N(se,Z,{name:!0}):ie&&De in ne&&(P(se,ne,De),P(se,ne,"prepareStackTrace")),N(se,ne),!ee)try{$.name!==J&&T($,"name",J),$.constructor=se}catch{}return se}}},6992:(m,g,p)=>{var E=p(5656),v=p(1223),T=p(7497),I=p(9909),O=p(3070).f,N=p(1656),P=p(6178),L=p(1913),x=p(9781),W="Array Iterator",q=I.set,X=I.getterFor(W);m.exports=N(Array,"Array",function(ee,le){q(this,{type:W,target:E(ee),index:0,kind:le})},function(){var ee=X(this),le=ee.target,he=ee.kind,ue=ee.index++;return!le||ue>=le.length?(ee.target=void 0,P(void 0,!0)):P(he=="keys"?ue:he=="values"?le[ue]:[ue,le[ue]],!1)},"values");var ie=T.Arguments=T.Array;if(v("keys"),v("values"),v("entries"),!L&&x&&ie.name!=="values")try{O(ie,"name",{value:"values"})}catch{}},1703:(m,g,p)=>{var E=p(2109),v=p(7854),T=p(2104),I=p(9191),O=v.WebAssembly,N=Error("e",{cause:7}).cause!==7,P=function(x,W){var q={};q[x]=I(x,W,N),E({global:!0,constructor:!0,arity:1,forced:N},q)},L=function(x,W){if(O&&O[x]){var q={};q[x]=I("WebAssembly."+x,W,N),E({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:N},q)}};P("Error",function(x){return function(W){return T(x,this,arguments)}}),P("EvalError",function(x){return function(W){return T(x,this,arguments)}}),P("RangeError",function(x){return function(W){return T(x,this,arguments)}}),P("ReferenceError",function(x){return function(W){return T(x,this,arguments)}}),P("SyntaxError",function(x){return function(W){return T(x,this,arguments)}}),P("TypeError",function(x){return function(W){return T(x,this,arguments)}}),P("URIError",function(x){return function(W){return T(x,this,arguments)}}),L("CompileError",function(x){return function(W){return T(x,this,arguments)}}),L("LinkError",function(x){return function(W){return T(x,this,arguments)}}),L("RuntimeError",function(x){return function(W){return T(x,this,arguments)}})},3948:(m,g,p)=>{var E=p(7854),v=p(8324),T=p(8509),I=p(6992),O=p(8880),N=p(5112),P=N("iterator"),L=N("toStringTag"),x=I.values,W=function(X,ie){if(X){if(X[P]!==x)try{O(X,P,x)}catch{X[P]=x}if(X[L]||O(X,L,ie),v[ie]){for(var ee in I)if(X[ee]!==I[ee])try{O(X,ee,I[ee])}catch{X[ee]=I[ee]}}}};for(var q in v)W(E[q]&&E[q].prototype,q);W(T,"DOMTokenList")},6226:(m,g,p)=>{m.exports=p(7460)},7445:(m,g,p)=>{m.exports=p(3685)}},u={};function d(m){var g=u[m];if(g!==void 0)return g.exports;var p=u[m]={exports:{}};return a[m](p,p.exports,d),p.exports}d.n=m=>{var g=m&&m.__esModule?()=>m.default:()=>m;return d.d(g,{a:g}),g},d.d=(m,g)=>{for(var p in g)d.o(g,p)&&!d.o(m,p)&&Object.defineProperty(m,p,{enumerable:!0,get:g[p]})},d.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),d.o=(m,g)=>Object.prototype.hasOwnProperty.call(m,g),d.r=m=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})};var h={};return(()=>{d.r(h),d.d(h,{AudioExtension:()=>he,AudioProcessor:()=>ee,Extension:()=>le,PromiseMutex:()=>je,Ticker:()=>Ce,VideoProcessor:()=>ie,logger:()=>N,reporter:()=>x});var m=d(7445);function g(fe,J,ne){return J in fe?m(fe,J,{value:ne,enumerable:!0,configurable:!0,writable:!0}):fe[J]=ne,fe}d(1703),d(6992),d(3948);var p=d(6226),E=d.n(p);const v=Date.now(),T={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4};function I(){const fe=new Date;return fe.toTimeString().split(" ")[0]+":"+fe.getMilliseconds()}const O=fe=>{for(const J in T)if(Object.prototype.hasOwnProperty.call(T,J)&&T[J]===fe)return J;return"DEFAULT"},N=new class{constructor(){g(this,"logLevel",T.DEBUG),g(this,"hookLog",void 0)}debug(){for(var fe=arguments.length,J=new Array(fe),ne=0;ne<fe;ne++)J[ne]=arguments[ne];const $=[T.DEBUG].concat(J);this.log.apply(this,$)}info(){for(var fe=arguments.length,J=new Array(fe),ne=0;ne<fe;ne++)J[ne]=arguments[ne];const $=[T.INFO].concat(J);this.log.apply(this,$)}warning(){for(var fe=arguments.length,J=new Array(fe),ne=0;ne<fe;ne++)J[ne]=arguments[ne];const $=[T.WARNING].concat(J);this.log.apply(this,$)}error(){for(var fe=arguments.length,J=new Array(fe),ne=0;ne<fe;ne++)J[ne]=arguments[ne];const $=[T.ERROR].concat(J);this.log.apply(this,$)}log(){for(var fe,J=arguments.length,ne=new Array(J),$=0;$<J;$++)ne[$]=arguments[$];if(Date.now()-v<100)return void setTimeout(()=>{this.log(...ne)},Date.now()-v);const Z=Math.max(0,Math.min(4,ne[0]));if(ne[0]=I()+" Agora-Extension [".concat(O(Z),"]:"),Z<this.logLevel)return;const se=I()+" %cAgora-Extension [".concat(O(Z),"]:");let pe=[];switch(Z){case T.DEBUG:pe=[se,"color: #64B5F6;"].concat(ne.slice(1)),console.log.apply(console,pe);break;case T.INFO:pe=[se,"color: #1E88E5; font-weight: bold;"].concat(ne.slice(1)),console.log.apply(console,pe);break;case T.WARNING:pe=[se,"color: #FB8C00; font-weight: bold;"].concat(ne.slice(1)),console.warn.apply(console,pe);break;case T.ERROR:pe=[se,"color: #B00020; font-weight: bold;"].concat(ne.slice(1)),console.error.apply(console,pe)}(fe=this.hookLog)===null||fe===void 0||fe.call(this,Z,pe)}};function P(fe,J){var ne=Object.keys(fe);if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(fe);J&&($=$.filter(function(Z){return Object.getOwnPropertyDescriptor(fe,Z).enumerable})),ne.push.apply(ne,$)}return ne}function L(fe){for(var J=1;J<arguments.length;J++){var ne=arguments[J]!=null?arguments[J]:{};J%2?P(Object(ne),!0).forEach(function($){g(fe,$,ne[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(fe,Object.getOwnPropertyDescriptors(ne)):P(Object(ne)).forEach(function($){Object.defineProperty(fe,$,Object.getOwnPropertyDescriptor(ne,$))})}return fe}const x=new class{constructor(){g(this,"apiInvokeMsgQueue",[]),g(this,"hookApiInvoke",void 0)}reportApiInvoke(fe){fe.timeout=fe.timeout||6e4,fe.reportResult=fe.reportResult===void 0||fe.reportResult;const J=Date.now(),ne=()=>({name:fe.name,apiInvokeTime:J,options:fe.options});let $=!1;var Z;(Z=fe.timeout,new(E())(pe=>{window.setTimeout(pe,Z)})).then(()=>{$||(this.sendApiInvoke(L(L({},ne()),{},{error:"API_INVOKE_TIMEOUT",success:!1})),N.debug("".concat(fe.name," timeout")))});const se=new Error("".concat(fe.name,": this api invoke is end"));return{onSuccess:pe=>{if($)throw se;$=!0,this.sendApiInvoke(L(L({},ne()),{},{success:!0},fe.reportResult&&{result:pe}))},onError:pe=>{if($)throw pe;$=!0,this.sendApiInvoke(L(L({},ne()),{},{success:!1,error:pe.toString()}))}}}sendApiInvoke(fe){this.hookApiInvoke?(this.hookApiInvoke([...this.apiInvokeMsgQueue,fe]),this.apiInvokeMsgQueue=[]):this.apiInvokeMsgQueue.push(fe)}};function W(fe,J){var ne=Object.keys(fe);if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(fe);J&&($=$.filter(function(Z){return Object.getOwnPropertyDescriptor(fe,Z).enumerable})),ne.push.apply(ne,$)}return ne}function q(fe){for(var J=1;J<arguments.length;J++){var ne=arguments[J]!=null?arguments[J]:{};J%2?W(Object(ne),!0).forEach(function($){g(fe,$,ne[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(fe,Object.getOwnPropertyDescriptors(ne)):W(Object(ne)).forEach(function($){Object.defineProperty(fe,$,Object.getOwnPropertyDescriptor(ne,$))})}return fe}class X extends class{constructor(){g(this,"_events",{}),g(this,"addListener",this.on)}getListeners(J){return this._events[J]?this._events[J].map(ne=>ne.listener):[]}on(J,ne){this._events[J]||(this._events[J]=[]);const $=this._events[J];this._indexOfListener($,ne)===-1&&$.push({listener:ne,once:!1})}once(J,ne){this._events[J]||(this._events[J]=[]);const $=this._events[J];this._indexOfListener($,ne)===-1&&$.push({listener:ne,once:!0})}off(J,ne){if(!this._events[J])return;const $=this._events[J],Z=this._indexOfListener($,ne);Z!==-1&&$.splice(Z,1),this._events[J].length===0&&delete this._events[J]}removeAllListeners(J){J?delete this._events[J]:this._events={}}emit(J){this._events[J]||(this._events[J]=[]);const ne=this._events[J].map(pe=>pe);for(var $=arguments.length,Z=new Array($>1?$-1:0),se=1;se<$;se++)Z[se-1]=arguments[se];for(let pe=0;pe<ne.length;pe+=1){const Oe=ne[pe];Oe.once&&this.off(J,Oe.listener),Oe.listener.apply(this,Z||[])}}_indexOfListener(J,ne){let $=J.length;for(;$--;)if(J[$].listener===ne)return $;return-1}emitAsPromise(J){for(var ne=arguments.length,$=new Array(ne>1?ne-1:0),Z=1;Z<ne;Z++)$[Z-1]=arguments[Z];return this.getListeners(J).length===0?E().reject(new Error("No promise event handler.")):new(E())((se,pe)=>{this.emit(J,...$,se,pe)})}emitAsPromiseNoResponse(J){for(var ne=arguments.length,$=new Array(ne>1?ne-1:0),Z=1;Z<ne;Z++)$[Z-1]=arguments[Z];return this.getListeners(J).length===0?E().resolve():new(E())((se,pe)=>{this.emit(J,...$,se,pe)})}}{get enabled(){return this._enabled}output(J,ne){if(this.outputTrack===J)return;const $=x.reportApiInvoke({name:"".concat(this.name,".output"),options:{track:J==null?void 0:J.toString()}});this.outputTrack=J,this.destination&&this.destination.updateInput({track:J,context:ne}),$.onSuccess()}constructor(){super(),g(this,"inputTrack",void 0),g(this,"outputTrack",void 0),g(this,"_enabled",!0),g(this,"_source",void 0),g(this,"ID",function J(){let ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,$=arguments.length>1?arguments[1]:void 0;const Z=Math.random().toString(16).substr(2,ne).toLowerCase();return Z.length===ne?"".concat($).concat(Z):"".concat($).concat(Z)+J(ne-Z.length,"")}(6,"")),g(this,"destination",void 0),g(this,"context",void 0),g(this,"name",void 0)}enable(){if(this._enabled)return;const J=x.reportApiInvoke({name:"".concat(this.name,".enable"),options:!0});N.info("".concat(this.name,"-").concat(this.ID," enabled")),this._enabled=!0;try{var ne;const $=(ne=this.onEnableChange)===null||ne===void 0?void 0:ne.call(this,this._enabled);if($ instanceof E())return $.then(()=>{J.onSuccess()}).catch(Z=>{throw J.onError(Z),Z});J.onSuccess()}catch($){throw J.onError($),$}}disable(){if(!this._enabled)return;const J=x.reportApiInvoke({name:"".concat(this.name,".enable"),options:!1});N.info("".concat(this.name,"-").concat(this.ID," disabled")),this._enabled=!1;try{var ne;const $=(ne=this.onEnableChange)===null||ne===void 0?void 0:ne.call(this,this._enabled);if($ instanceof E())return $.then(()=>{J.onSuccess()}).catch(Z=>{throw J.onError(Z),Z});J.onSuccess()}catch($){throw J.onError($),$}}}class ie extends X{get kind(){return"video"}pipe(J){const ne=x.reportApiInvoke({name:"".concat(this.name,".pipe"),options:{processor:J.name}});if(this.destination===J)return ne.onSuccess(),J;if(J._source){const $=new Error("Processor ".concat(J.name," already being piped, please call ").concat(J._source.name,".unpipe() beforehand."));throw ne.onError($),$}return this.destination&&this.unpipe(),this.destination=J,J._source=this,this.context&&this.destination.updateInput({track:this.outputTrack,context:this.context}),ne.onSuccess(),J}unpipe(){if(!this.destination)return;const J=x.reportApiInvoke({name:"".concat(this.name,".unpipe"),options:{processor:this.destination.name}});N.info("unpiping processor ".concat(this.destination.name,"-").concat(this.destination.ID));try{const ne=this.destination;this.destination._source=void 0,this.destination=void 0,ne.reset()}finally{J.onSuccess()}}updateInput(J){var ne,$;J.context!==this.context&&(this.context=J.context,(ne=this.onPiped)===null||ne===void 0||ne.call(this,this.context),this.destination&&this.destination.updateInput({track:this.outputTrack,context:J.context})),J.track&&this.inputTrack!==J.track&&(this.inputTrack=J.track,($=this.onTrack)===null||$===void 0||$.call(this,J.track,this.context))}reset(){var J;this.context&&this.context.requestRevertConstraints(this),this.inputTrack=void 0,this.context=void 0,(J=this.onUnpiped)===null||J===void 0||J.call(this),this.destination&&this.destination.reset()}}class ee extends X{constructor(){super(...arguments),g(this,"inputNode",void 0),g(this,"outputNode",void 0),g(this,"destination",void 0),g(this,"context",void 0)}get kind(){return"audio"}pipe(J){const ne=x.reportApiInvoke({name:"".concat(this.name,".pipe"),options:{processor:J.name}});if(this.destination===J)return ne.onSuccess(),J;if(J._source){const $=new Error("Processor ".concat(J.name," already being piped, please call ").concat(J._source.name,".unpipe() beforehand."));throw ne.onError($),$}return this.destination&&this.unpipe(),this.destination=J,J._source=this,this.context&&this.destination.updateInput({track:this.outputTrack,node:this.outputNode,context:this.context}),ne.onSuccess(),J}unpipe(){if(!this.destination)return;N.info("unpiping processor ".concat(this.destination.name,"-").concat(this.destination.ID));const J=x.reportApiInvoke({name:"".concat(this.name,".unpipe"),options:{processor:this.destination.name}});try{var ne;let $=this.destination;(ne=this.outputNode)===null||ne===void 0||ne.disconnect(),this.destination._source=void 0,this.destination=void 0,$.reset()}finally{J.onSuccess()}}output(J,ne){if(J instanceof MediaStreamTrack)super.output(J,ne);else if(J instanceof AudioNode){if(this.outputNode===J)return;const $=x.reportApiInvoke({name:"".concat(this.name,".output"),options:q(q({},J instanceof MediaStreamTrack&&{track:J.toString()}),J instanceof AudioNode&&{audioNode:J.toString()})});this.outputNode=J,this.destination&&this.destination.updateInput({node:J,context:ne}),$.onSuccess()}}updateInput(J){var ne,$,Z;J.context!==this.context&&(this.context=J.context,(ne=this.onPiped)===null||ne===void 0||ne.call(this,this.context),this.destination&&this.destination.updateInput({track:this.outputTrack,node:this.outputNode,context:J.context})),J.track&&this.inputTrack!==J.track&&(this.inputTrack=J.track,($=this.onTrack)===null||$===void 0||$.call(this,J.track,this.context)),J.node&&this.inputNode!==J.node&&(this.inputNode=J.node,(Z=this.onNode)===null||Z===void 0||Z.call(this,J.node,this.context))}reset(){var J;this.context&&this.context.requestRevertConstraints(this),this.inputTrack=void 0,this.inputNode=void 0,(J=this.onUnpiped)===null||J===void 0||J.call(this,this.context),this.context=void 0,this.destination&&this.destination.reset()}}class le{constructor(){g(this,"__registered__",!1),g(this,"logger",N),g(this,"reporter",x),g(this,"parameters",{})}createProcessor(){if(!this.__registered__)throw new Error("Extension not registered yet!");return this._createProcessor()}}class he extends le{}let ue;class Ce{get running(){return this._running}constructor(J,ne){if(g(this,"type",void 0),g(this,"interval",void 0),g(this,"fn",void 0),g(this,"_running",!1),g(this,"_osc",void 0),!J)throw new Error;if(ne<=0)throw new Error;this.type=J,this.interval=ne}add(J){this.fn=J}remove(){this.fn=void 0}start(){if(!this._running)switch(this._running=!0,this.type){case"Timer":{const J=()=>{setTimeout(()=>{this.fn&&this.fn(),this._running&&J()},this.interval)};J();break}case"RAF":{const J=ne=>{requestAnimationFrame($=>{$-ne<this.interval?this._running&&J(ne):(this.fn&&this.fn(),this._running&&J($))})};J(performance.now());break}case"Oscillator":{ue||(ue=new AudioContext);const J=ue.createGain();let ne;J.gain.value=0,J.connect(ue.destination);const $=()=>{this.fn&&this.fn(),ne&&ne.disconnect(),ne=ue.createOscillator(),this._osc=ne,ne.connect(J),this._running&&(ne.onended=$,ne.start(0),ne.stop(ue.currentTime+this.interval/1e3))};$();break}}}stop(){this._running=!1,this._osc&&(this._osc.onended=null,this._osc=void 0)}}let De=1;class je{constructor(J){g(this,"lockingPromise",E().resolve()),g(this,"locks",0),g(this,"name",""),g(this,"lockId",void 0),this.lockId=De++,J&&(this.name=J)}get isLocked(){return this.locks>0}lock(J){let ne;this.locks+=1;const $=new(E())(se=>{ne=()=>{this.locks-=1,se()}}),Z=this.lockingPromise.then(()=>ne);return this.lockingPromise=this.lockingPromise.then(()=>$),Z}}})(),h})(),r.exports=s()})(Ox);var Nx;!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(Nx=HTMLCanvasElement.prototype.getContext,function(){let r=arguments;return r[0]==="webgl"&&(r=[].slice.call(arguments),r[0]="experimental-webgl"),Nx.apply(null,r)}));const Ene=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function Px(r){const i=new Uint8Array([99,114,121,112,116,105,105]),s=i.length,a=r,u=a.length,d=new Uint8Array(u),h=new Uint8Array(256);for(let v=0;v<256;v++)h[v]=v;let m=0;for(let v=0;v<256;v++)m=(m+h[v]+i[v%s])%256,[h[v],h[m]]=[h[m],h[v]];let g,p=0;m=0;for(let v=0;v<0+u;v++)p=(p+1)%256,m=(m+h[p])%256,[h[p],h[m]]=[h[m],h[p]],g=h[(h[p]+h[m])%256],v>=0&&(d[v-0]=a[v-0]^g);const E=String.fromCharCode.apply(null,Array.from(d));return Function("var winSize = 5; return `"+E+"`")()}const _ne=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class Dx{constructor(i,s){C(this,"program",void 0),C(this,"gl",void 0),C(this,"kernel",void 0),this.gl=i,this.kernel=s||_ne,this.program=function(a,u){const d=Px(u),h=gne(a,[Px(Ene),d]);{const m=a.getAttribLocation(h,"a_position"),g=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,g),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),a.STATIC_DRAW),a.enableVertexAttribArray(m);const p=2,E=a.FLOAT,v=!1,T=0,I=0;a.vertexAttribPointer(m,p,E,v,T,I)}{const m=a.getAttribLocation(h,"a_texCoord"),g=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,g),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),a.STATIC_DRAW),a.enableVertexAttribArray(m);const p=2,E=a.FLOAT,v=!1,T=0,I=0;a.vertexAttribPointer(m,p,E,v,T,I)}return h}(this.gl,this.kernel)}setUniforms(){const i=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(i,1)}}class sa extends Dx{constructor(i,s,a,u){super(i,s),C(this,"xOffset",void 0),C(this,"yOffset",void 0),C(this,"denoiseLevel",5),this.xOffset=1/a,this.yOffset=1/u}setUniforms(){const i=this.gl.getUniformLocation(this.program,"u_flipY"),s=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),a=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(s,this.xOffset,this.yOffset),this.gl.uniform1f(a,this.denoiseLevel),this.gl.uniform1f(i,1)}setParameters(i){i.denoiseLevel!==void 0&&(this.denoiseLevel=i.denoiseLevel)}setSize(i,s){this.xOffset=1/i,this.yOffset=1/s}}const vne=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class yne extends sa{constructor(i,s,a){super(i,vne,s,a)}}const Sne=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class Tne extends sa{constructor(i,s,a){super(i,Sne,s,a)}}const Rne=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class Ine extends sa{constructor(i,s,a){super(i,Rne,s,a)}}const wne=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],Cne=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],kx=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],Ane=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class bne extends sa{constructor(i,s,a,u){super(i,wne,a,u),C(this,"inputTexture",void 0),C(this,"lightLevel",.1),C(this,"rednessLevel",.5),C(this,"mskin_he_max",175/180*3.141593),C(this,"mskin_he_min",115/180*3.141593),C(this,"mskin_hc_max",173/180*3.141593),C(this,"mskin_hc_min",116/180*3.141593),C(this,"mskin_hc_axis",2.04203545),C(this,"mfacts_rotate_c",0),C(this,"mfacts_rotate_le",0),C(this,"mfacts_rotate_ge",0),C(this,"tab_addr",null),C(this,"lutTextures",[]),this.inputTexture=s,this.init()}setUniforms(){const i=this.gl.getUniformLocation(this.program,"u_flipY"),s=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(s,this.denoiseLevel),this.gl.uniform1f(i,1);const a=this.gl.getUniformLocation(this.program,"light");this.gl.uniform1f(a,this.lightLevel);const u=this.gl.getUniformLocation(this.program,"redness");this.gl.uniform1f(u,this.rednessLevel);const d=this.gl.getUniformLocation(this.program,"skin_he_max"),h=this.gl.getUniformLocation(this.program,"skin_he_min"),m=this.gl.getUniformLocation(this.program,"skin_hc_max"),g=this.gl.getUniformLocation(this.program,"skin_hc_min"),p=this.gl.getUniformLocation(this.program,"skin_hc_axis"),E=this.gl.getUniformLocation(this.program,"facts_rotate_c"),v=this.gl.getUniformLocation(this.program,"facts_rotate_le"),T=this.gl.getUniformLocation(this.program,"facts_rotate_ge");this.gl.uniform1f(d,this.mskin_he_max),this.gl.uniform1f(h,this.mskin_he_min),this.gl.uniform1f(m,this.mskin_hc_max),this.gl.uniform1f(g,this.mskin_hc_min),this.gl.uniform1f(p,this.mskin_hc_axis),this.gl.uniform1f(E,this.mfacts_rotate_c),this.gl.uniform1f(v,this.mfacts_rotate_le),this.gl.uniform1f(T,this.mfacts_rotate_ge);const I=this.gl.getUniformLocation(this.program,"u_originImage");this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(I,2);const O=["lighten_lut"],N=[this.gl.TEXTURE3];for(let P=0;P<O.length;P++){const L=this.gl.getUniformLocation(this.program,O[P]);this.gl.activeTexture(N[P]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[P]),this.gl.uniform1i(L,P+3)}}setParameters(i){i.denoiseLevel!==void 0&&(this.denoiseLevel=i.denoiseLevel),i.lightLevel!==void 0&&(this.lightLevel=i.lightLevel),i.rednessLevel!==void 0&&(this.rednessLevel=i.rednessLevel,this.updateRedness(this.rednessLevel)),i.lighteningContrastLevel&&this.updateLut(i.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(kx);const i=[this.tab_addr],s=[256],a=[1];for(let u=0;u<i.length;u++){const d=this.gl.createTexture();if(!d)throw new j(V.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,s[u],a[u],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,i[u]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(d)}}updateRedness(i){let a,u,d=i,h=d;d>1&&(d=1),d<0&&(d=0),h>1&&(h=1),h<0&&(h=0),this.mfacts_rotate_c=.8*d,h<.8&&(h=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*h)/180*3.141593,this.mskin_hc_min=(116-4*h)/180*3.141593,this.mskin_hc_axis=(117-4*h)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),this.mskin_hc_min<3.141593/2&&(this.mskin_hc_min=3.141593/2),this.mskin_hc_axis<3.141593/2&&(this.mskin_hc_axis=3.141593/2),this.mskin_he_min<3.141593/2&&(this.mskin_he_min=3.141593/2),this.mskin_hc_max>3.141593&&(this.mskin_hc_max=3.141593),this.mskin_hc_axis>3.141593&&(this.mskin_hc_axis=3.141593),this.mskin_he_max>3.141593&&(this.mskin_he_max=3.141593),a=this.mskin_he_max-this.mskin_hc_max,u=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=a>.01?this.mfacts_rotate_c*u/a:this.mfacts_rotate_c,a=this.mskin_hc_min-this.mskin_he_min,u=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=a>.01?this.mfacts_rotate_c*u/a:this.mfacts_rotate_c}updateLut(i){let s=null;if(i===0&&(s=kx),i===1&&(s=Ane),i===2&&(s=Cne),!s)throw new j(V.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+i);this.tab_addr=new Uint8Array(s);const a=[this.tab_addr],u=[256],d=[1];for(let h=0;h<a.length;h++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[h]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,u[h],d[h],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,a[h])}}class One{constructor(){C(this,"gl",null),C(this,"canvas",null),C(this,"programs",[]),C(this,"commonProgram",null),C(this,"inputTexture",null),C(this,"outputTextures",[]),C(this,"fbos",[]),C(this,"originalFrameWidth",0),C(this,"originalFrameHeight",0),C(this,"enableBeauty",!1),C(this,"denoiseLevel",5),C(this,"lightLevel",.35),C(this,"rednessLevel",.5),C(this,"lighteningContrastLevel",1)}setEnableBeauty(i){this.enableBeauty=!!i}init(i,s,a){if(!er().supportWebGL)throw new j(V.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=a.getContext("webgl"),!this.gl)throw new j(V.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(i,s),!this.inputTexture)throw new j(V.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=a,this.programs.push(new Dx(this.gl)),this.programs.push(new yne(this.gl,i,s)),this.programs.push(new Tne(this.gl,i,s)),this.programs.push(new Ine(this.gl,i,s)),this.programs.push(new bne(this.gl,this.inputTexture,i,s)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(i){if(!this.gl||!this.commonProgram||!this.canvas)return void D.warning("video effect manager is not init!");let s=0;if(this.originalFrameHeight===i.videoWidth&&this.originalFrameWidth===i.videoHeight)s=2;else if(this.originalFrameHeight!==i.videoHeight||this.originalFrameWidth!==i.videoWidth){if(D.debug("beauty effect: resolution changed ".concat(this.originalFrameWidth,"x").concat(this.originalFrameHeight," -> ").concat(i.videoWidth,"x").concat(i.videoHeight)),i.videoHeight===0||i.videoWidth===0)return void D.debug("beauty effect: skip 0 resolution frame");this.canvas.width=i.videoWidth,this.canvas.height=i.videoHeight,i.setAttribute("width",i.videoWidth.toString()),i.setAttribute("height",i.videoHeight.toString()),this.release(),this.init(i.videoWidth,i.videoHeight,this.canvas)}this.gl.viewport(0,0,i.videoWidth,i.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i);const a=this.enableBeauty?this.programs.length-1:0;for(let d=0;d<=a;d++){const h=this.programs[d].program;this.gl.useProgram(h);const m=this.gl.getUniformLocation(h,"u_image");this.programs[d].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[s+d%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[s+d%2]),this.gl.uniform1i(m,0)}this.gl.useProgram(this.commonProgram);const u=this.gl.getUniformLocation(this.commonProgram,"u_flipY");this.gl.uniform1f(u,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}setDenoiseLevel(i){this.programs.forEach(s=>{s instanceof sa&&s.setParameters({denoiseLevel:i})}),this.denoiseLevel=i}setLightLevel(i){this.programs.forEach(s=>{s instanceof sa&&s.setParameters({lightLevel:i})}),this.lightLevel=i}setRednessLevel(i){this.programs.forEach(s=>{s instanceof sa&&s.setParameters({rednessLevel:i})}),this.rednessLevel=i}setContrastLevel(i){this.programs.forEach(s=>{s instanceof sa&&s.setParameters({lighteningContrastLevel:i})}),this.lighteningContrastLevel=i}setSize(i,s){this.programs.forEach(a=>{a instanceof sa&&a.setSize(i,s)})}release(){this.gl=null,this.commonProgram=null,this.inputTexture=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(i,s){if(!this.gl)throw new j(V.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let a=0;a<4;a++){const u=this.gl.createTexture();if(!u)throw new j(V.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,u),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),a<2?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,i,s,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,s,i,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);const d=this.gl.createFramebuffer();if(!d)throw new j(V.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,d),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,u,0),this.outputTextures.push(u),this.fbos.push(d)}this.gl.viewport(0,0,i,s),this.originalFrameWidth=i,this.originalFrameHeight=s}}class Nne{constructor(){C(this,"targetFrameRate",0),C(this,"recordedFrameCount",0),C(this,"recordingTime",2),C(this,"recordID",void 0)}async startRecordBeautyEffectOutput(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(this.recordID)throw new j(V.UNEXPECTED_ERROR,"another beauty effect recording is in progress");const a=$t(6,"");return this.recordID=a,this.targetFrameRate=i,this.recordedFrameCount=0,this.recordingTime=s,await Bn(1e3*this.recordingTime),this.recordID!==a?(this.recordID=void 0,!0):(this.recordID=void 0,this.recordedFrameCount<this.targetFrameRate*this.recordingTime/2?(D.warning("detect beauty effect overload, current framerate",this.recordedFrameCount/2),!1):(D.debug("beauty effect current framerate",this.recordedFrameCount/2),!0))}stopRecordBeautyEffectOutput(){this.targetFrameRate=0,this.recordedFrameCount=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class Pne extends Ox.exports.VideoProcessor{constructor(){super(),C(this,"name","BeautyProcessor"),C(this,"fps",15),C(this,"canvas",void 0),C(this,"video",void 0),C(this,"manager",void 0),C(this,"overloadDetector",new Nne),C(this,"stopChromeBackgroundLoop",null),C(this,"onOverload",void 0),C(this,"stopLoop",void 0),C(this,"lastRenderTime",0),this.fps=30,this.manager=new One,this._enabled=!1}async onEnableChange(i){this.manager.setEnableBeauty(i),this.context&&this.inputTrack&&(i?await this.startEffect(this.inputTrack,this.context):await this.stopEffect(this.inputTrack,this.context))}async setBeautyEffectOptions(i){if(function(s){s.smoothnessLevel!==void 0&&Ot(s.smoothnessLevel,"options.smoothnessLevel",0,1,!1),s.lighteningLevel!==void 0&&Ot(s.lighteningLevel,"options.lighteningLevel",0,1,!1),s.rednessLevel!==void 0&&Ot(s.rednessLevel,"options.rednessLevel",0,1,!1),s.lighteningContrastLevel!==void 0&&qn(s.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2])}(i),i.smoothnessLevel!==void 0){const s=Math.max(.1,10*i.smoothnessLevel);this.manager.setDenoiseLevel(s)}if(i.lighteningLevel!==void 0){const s=Math.max(.1,i.lighteningLevel/2);this.manager.setLightLevel(s)}if(i.rednessLevel!==void 0){const s=Math.max(.01,i.rednessLevel);this.manager.setRednessLevel(s)}if(i.lighteningContrastLevel!==void 0){const s=i.lighteningContrastLevel;this.manager.setContrastLevel(s)}}async onTrack(i,s){var a;this.video&&this.enabled&&((a=this.stopLoop)===null||a===void 0||a.call(this),await this.stopEffect(i,s)),await this.startEffect(i,s)}async startEffect(i,s){if(!this.enabled)return;const a=bt(),u=await this.renderWithWebGL(i);this.output(u,s),D.info("start video effect, output:",this.outputTrack),this.overloadDetector.startRecordBeautyEffectOutput(this.fps).then(m=>{m||this.onOverload&&this.onOverload()});let d=!1;this.stopLoop=()=>{d=!0};const h=()=>{this.enabled&&!d&&requestAnimationFrame(h);const m=Date.now(),g=1e3/this.fps,p=this.lastRenderTime?m-this.lastRenderTime:g;p<g||(this.lastRenderTime=m-(p-g),this.video&&this.video.paused&&this.video.play(),this.enabled&&this.video&&(this.manager.render(this.video),this.outputTrack&&this.outputTrack.requestFrame&&this.outputTrack.requestFrame(),this.overloadDetector.addFrame()))};requestAnimationFrame(h),a.name===It.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?this.stopChromeBackgroundLoop=$S(()=>{this.enabled&&this.video&&this.manager.render(this.video),this.outputTrack&&this.outputTrack.requestFrame&&this.outputTrack.requestFrame(),this.overloadDetector.addFrame()},this.fps):this.stopChromeBackgroundLoop&&(this.stopChromeBackgroundLoop(),this.stopChromeBackgroundLoop=null)},!1)}async renderWithWebGL(i){this.canvas&&(this.canvas.remove(),this.canvas=void 0),this.video&&(this.video.remove(),this.video=void 0),this.canvas=document.createElement("canvas"),this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.video.setAttribute("style","display:none"),this.video.srcObject=new MediaStream([i]);const s=new _e(m=>{const g=()=>{this.video&&this.video.removeEventListener("playing",g),m(void 0)};this.video&&this.video.addEventListener("playing",g)});this.video.play(),await s;const a=i.getSettings(),u=a.width||this.video.videoWidth,d=a.height||this.video.videoHeight;if(a.frameRate&&this.fps!==a.frameRate&&(this.fps=a.frameRate,D.debug("beauty video processor: set fps to",this.fps)),D.debug("beauty video processor: width ".concat(u," height ").concat(d)),!u||!d)throw new j(V.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");this.canvas.width=u,this.canvas.height=d,this.video.setAttribute("width",u.toString()),this.video.setAttribute("height",d.toString()),this.manager.init(u,d,this.canvas);const h=er();return this.canvas.captureStream(h.supportRequestFrame?0:this.fps).getVideoTracks()[0]}async stopEffect(i,s){D.info("stop video effect"),this.overloadDetector.stopRecordBeautyEffectOutput(),this.manager.release(),this.canvas&&this.canvas.remove(),this.video&&this.video.remove(),this.canvas=void 0,this.video=void 0,this.output(i,s)}}function MT(r){const i={};if(r.facingMode&&(i.facingMode=r.facingMode),r.cameraId&&(i.deviceId={exact:r.cameraId}),!r.encoderConfig)return i;const s=Nl(r.encoderConfig);return i.width=s.width,i.height=s.height,!RD()&&s.frameRate&&(i.frameRate=s.frameRate),bt().name===It.EDGE&&typeof i.frameRate=="object"&&(i.frameRate.max=60),tn()&&(i.frameRate={ideal:30,max:30}),i}function Dne(r){const i={};r.screenSourceType&&(i.mediaSource=r.screenSourceType),r.extensionId&&K0()&&(i.extensionId=r.extensionId),r.electronScreenSourceId&&(i.sourceId=r.electronScreenSourceId);const s=r.encoderConfig?fS(r.encoderConfig):null;return i.mandatory={chromeMediaSource:"desktop",maxWidth:s?s.width:void 0,maxHeight:s?s.height:void 0},s&&s.frameRate&&(typeof s.frameRate=="number"?(i.mandatory.maxFrameRate=s.frameRate,i.mandatory.minFrameRate=s.frameRate):(i.mandatory.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||void 0,i.mandatory.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||void 0),i.frameRate=s.frameRate),s&&s.width&&(i.width=s.width),s&&s.height&&(i.height=s.height),i}function Lx(r){const i={};if(RD()||(r.AGC!==void 0&&(i.autoGainControl=r.AGC),r.AEC!==void 0&&(i.echoCancellation=r.AEC),r.ANS!==void 0&&(i.noiseSuppression=r.ANS,K0()&&r.ANS&&(i.googHighpassFilter=r.ANS))),r.encoderConfig){const s=bg(r.encoderConfig);i.channelCount=s.stereo?2:1,i.sampleRate=s.sampleRate,i.sampleSize=s.sampleSize}return r.microphoneId&&(i.deviceId={exact:r.microphoneId}),z0()&&(i.sampleRate=void 0),i}var Xl,iE;(function(r){r.COVERED="COVERED",r.POSITION="POSITION",r.SIZE="SIZE",r.STYLE="STYLE"})(Xl||(Xl={})),function(r){r.UNMOUNTED="UNMOUNTED",r.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(iE||(iE={}));var Mx,xx,Ux,Vx,Fx,jx,Bx,Gx,Wx,Hx,$x,Kx,qx,zx,Yx,Xx,Jx,Qx,Zx,eU,tU,at,nU,rU,iU,sU,oU,aU,cU,uU,Xi,lU=new class{constructor(){C(this,"_clientSize",null),C(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),C(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),C(this,"getStyle",r=>window.getComputedStyle(r,null)),C(this,"checkCssVisibleProperty",r=>{let i=!0;const s=this.getStyle(r),{display:a,visibility:u,opacity:d,filter:h}=s;return(a==="none"||["hidden","collapse"].includes(u)||Number(d)<.1)&&(i=!1),i?(h&&h.split(" ").filter(m=>{const g=m.split("(")[0];return["brightness","blur","opacity"].includes(g)}).map(m=>{const[g,p]=m.split(/\(|\)/);return[g,Number(p.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,p]=m;switch(g){case"brightness":(p<.1||p>3)&&(i=!1);break;case"blur":p>3&&(i=!1);break;case"opacity":p<.1&&(i=!1)}}),i):!1}),C(this,"checkPropertyUpToAllParentNodes",(r,i)=>{let s=!0,a=!0;const u=h=>i(h);let d=r;for(;d&&a;)u(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s}),C(this,"checkActualCssVisibleIncludeInherit",r=>this.checkPropertyUpToAllParentNodes(r,this.checkCssVisibleProperty)),C(this,"getSizeAboutClient",r=>{const{width:i,height:s,left:a,right:u,top:d,bottom:h}=r.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:i,height:s,left:a,right:u,top:d,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}}),C(this,"checkActualSize",()=>{const{width:r,height:i,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(r,i,s)}),C(this,"elementFromPoint",(r,i)=>document.elementFromPoint?document.elementFromPoint(r,i):null),C(this,"checkCoverForAPoint",(r,i,s)=>{const a=this.elementFromPoint(r,i);return a!==null&&a!==s}),C(this,"getPointPositionList",()=>{const{width:r,height:i,left:s,top:a}=this._clientSize,u=r/6,d=i/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let p=0;p<5;p++){const E=(s*m+(g===0?.1:g===4?(u*g*m-1e5)/m:u*g)*m)/m,v=(a*m+(p===0?.1:p===4?(d*p*m-1e5)/m:d*p)*m)/m;h.push({x:E,y:v})}return[...h]}),C(this,"checkElementCover",r=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,r)).filter(i=>!!i).length>6),C(this,"checkSizeIsVisible",(r,i,s)=>(r>50||s/r<=10)&&(i>50||s/i<=10)),C(this,"checkSizeOfPartInClient",()=>{const{left:r,right:i,top:s,bottom:a,clientHeight:u,clientWidth:d,clientMin:h}=this._clientSize;let m,g,p,E;if(r<0)m=0;else{if(!(r<d))return!1;m=r}if(i<0)return!1;if(g=i<d?i:d,s<0)p=0;else{if(!(s<u))return!1;p=s}if(a<0)return!1;E=a<u?a:u;const v=g-m,T=E-p;return this.checkSizeIsVisible(v,T,h)}),C(this,"returnHiddenResult",r=>(this._clientSize=null,{visible:!1,reason:r})),C(this,"checkOneElementVisible",r=>{if(r instanceof HTMLElement){if(this.checkElementIsMountedOnDom(r)){if(this.checkActualCssVisibleIncludeInherit(r)){if(this._clientSize=this.getSizeAboutClient(r),this.checkElementCover(r))return this.returnHiddenResult(Xl.COVERED);{const i=this.checkActualSize(),s=this.checkSizeOfPartInClient();return i&&!s?this.returnHiddenResult(Xl.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Xl.SIZE)}}return this.returnHiddenResult(Xl.STYLE)}return this.returnHiddenResult(iE.UNMOUNTED)}return this.returnHiddenResult(iE.INVALID_HTML_ELEMENT)}),C(this,"checkElementIsMountedOnDom",r=>this.checkPropertyUpToAllParentNodes(r,i=>i.nodeName.toUpperCase()!=="HTML"?i.parentElement!==null:!!document.documentElement))}};function dU(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function Jl(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?dU(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):dU(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}let un=(Mx=ke({argsMap:(r,i,s)=>[r.getTrackId(),typeof i=="string"?i:"HTMLElement",s]}),xx=nn(),Ux=ke({argsMap:r=>[r.getTrackId()]}),Vx=xl("LocalVideoTrack","_enabledMutex"),Fx=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),jx=nn(),Bx=xl("LocalVideoTrack","_enabledMutex"),Gx=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),Wx=nn(),Hx=nn(),$x=ke({argsMap:(r,i,s)=>[r.getTrackId(),i,s]}),Kx=nn(),qx=nn(),zx=nn(),Yx=nn(),Xx=nn(),Jx=nn(),Qx=nn(),Zx=ke({argsMap:(r,i)=>[r.getTrackId(),i.name]}),eU=ke({argsMap:r=>[r.getTrackId()]}),tU=ke({argsMap:r=>[r.getTrackId()]}),ae((at=class jH extends WS{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Yn.PLAYING)}get __className__(){return"LocalVideoTrack"}constructor(i,s,a,u,d,h){super(i,d),C(this,"trackMediaType","video"),C(this,"_player",void 0),C(this,"_videoBeautyProcessor",void 0),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"_encoderConfig",void 0),C(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),C(this,"_optimizationMode",void 0),C(this,"_videoHeight",void 0),C(this,"_videoWidth",void 0),C(this,"_forceBitrateLimit",void 0),C(this,"_enabled",!0),C(this,"processorDestination",void 0),C(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this._encoderConfig=s,this._scalabiltyMode=a,this._optimizationMode=u,this._hints=h||[],this._hints.indexOf(Mn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),this.processorContext=new UL(this.getTrackId(),"local"),this.processorDestination=new xL(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof i=="string"){const u=document.getElementById(i);u?i=u:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback"),JSON.stringify(s));const a=Jl(Jl(Jl({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=new Ax(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const u=this.getVideoElementVisibleStatus();this.emit(Wa.VIDEO_ELEMENT_VISIBLE_STATUS,u)}catch{}},Q("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(i,s){if(!s){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),i),!i){this._originMediaStreamTrack.enabled=!1;try{await Jt(this,xe.NEED_DISABLE_TRACK,this)}catch(a){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Jt(this,xe.NEED_ENABLE_TRACK,this)}catch(a){throw D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(i){i!==this._muted&&(this.stateCheck("muted",i),this._muted=i,this._originMediaStreamTrack.enabled=!i,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(i)),i?await Jt(this,xe.NEED_MUTE_TRACK,this):await Jt(this,xe.NEED_UNMUTE_TRACK,this))}getStats(){return qh(()=>{D.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),go(this,xe.GET_STATS)||Jl({},OS)}async setBeautyEffect(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i||this._videoBeautyProcessor){if(_D()===Kn.IOS||_D()===Kn.ANDROID)throw new j(V.INVALID_OPERATION,"can not enable beauty effect on mobile device");if(!this._enabled&&i)throw new j(V.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled");if(D.info("[".concat(this.getTrackId(),"] start setBeautyEffect"),i,JSON.stringify(s)),this._videoBeautyProcessor||i){try{if(!this._videoBeautyProcessor)if(this._videoBeautyProcessor=new Pne,this.processor){const a=this.processor;this.pipe(this._videoBeautyProcessor).pipe(a)}else this.pipe(this._videoBeautyProcessor).pipe(this.processorDestination);await this._videoBeautyProcessor.setBeautyEffectOptions(s),i?await this._videoBeautyProcessor.enable():await this._videoBeautyProcessor.disable()}catch(a){throw D.error("[".concat(this.getTrackId(),"] setBeautyEffect error"),a.toString()),a}D.info("[".concat(this.getTrackId(),"] setBeautyEffect success"))}}}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(i,s):await LT(i)}clone(i,s,a,u){const d=this._mediaStreamTrack.clone();return new jH(d,i,s,a,u)}async setBitrateLimit(i){if(D.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i){this._forceBitrateLimit=i,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<i.max_bitrate?this._encoderConfig.bitrateMax:i.max_bitrate:this._encoderConfig.bitrateMax=i.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=i.min_bitrate);try{await Jt(this,xe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw()}}}async setOptimizationMode(i){if(i!=="motion"&&i!=="detail"&&i!=="balanced")return void D.error(V.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=i,await Jt(this,xe.SET_OPTIMIZATION_MODE,this)}catch(a){throw this._optimizationMode=s,D.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}D.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(i,")"))}setScalabiltyMode(i){if(i.numSpatialLayers===1&&i.numTemporalLayers!==1)return D.error(V.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=i,D.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){XL(this._originMediaStreamTrack).then(i=>{let[s,a]=i;this._videoHeight=a,this._videoWidth=s}).catch(Fg)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!i||!s||!a)return;const[u,d]=function(h,m,g){const p=Q("BITRATE_ADAPTER_TYPE");let E;const v=200*Math.pow(g/15,.6)*Math.pow(h*m/640/360,.75),T=v;if(p==="STANDARD_BITRATE")E=4*v;else{if(p!=="COMPATIABLE_BITRATE")return;E=2*v}return[Math.floor(E),Math.floor(T)]}(i,s,a)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=u,D.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(u,", brMin: ").concat(d,"]")))}getVideoElementVisibleStatus(){try{var i,s;const a=this==null||(i=this._player)===null||i===void 0?void 0:i.getContainerElement(),u={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=u;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=lU.checkOneElementVisible(d),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const p=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(a){throw new j(V.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(i){}pipe(i){if(this._videoBeautyProcessor&&i!==this._videoBeautyProcessor)return this._videoBeautyProcessor.pipe(i);if(this.processor===i)return i;if(i._source)throw new j(V.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;if(this._videoBeautyProcessor&&this.processor===this._videoBeautyProcessor)return void this._videoBeautyProcessor.unpipe();const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}bindProcessorDestinationEvents(){this.processorDestination.on(Zn.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,xe.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Zn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Xr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Xr.REQUEST_CONSTRAINTS)}}).prototype,"play",[Mx,xx],Object.getOwnPropertyDescriptor(at.prototype,"play"),at.prototype),ae(at.prototype,"stop",[Ux],Object.getOwnPropertyDescriptor(at.prototype,"stop"),at.prototype),ae(at.prototype,"setEnabled",[Vx,Fx,jx],Object.getOwnPropertyDescriptor(at.prototype,"setEnabled"),at.prototype),ae(at.prototype,"setMuted",[Bx,Gx,Wx],Object.getOwnPropertyDescriptor(at.prototype,"setMuted"),at.prototype),ae(at.prototype,"getStats",[Hx],Object.getOwnPropertyDescriptor(at.prototype,"getStats"),at.prototype),ae(at.prototype,"setBeautyEffect",[$x,Kx],Object.getOwnPropertyDescriptor(at.prototype,"setBeautyEffect"),at.prototype),ae(at.prototype,"getCurrentFrameData",[qx],Object.getOwnPropertyDescriptor(at.prototype,"getCurrentFrameData"),at.prototype),ae(at.prototype,"getCurrentFrameImage",[zx],Object.getOwnPropertyDescriptor(at.prototype,"getCurrentFrameImage"),at.prototype),ae(at.prototype,"setBitrateLimit",[Yx],Object.getOwnPropertyDescriptor(at.prototype,"setBitrateLimit"),at.prototype),ae(at.prototype,"setOptimizationMode",[Xx],Object.getOwnPropertyDescriptor(at.prototype,"setOptimizationMode"),at.prototype),ae(at.prototype,"setScalabiltyMode",[Jx],Object.getOwnPropertyDescriptor(at.prototype,"setScalabiltyMode"),at.prototype),ae(at.prototype,"updateMediaStreamTrackResolution",[Qx],Object.getOwnPropertyDescriptor(at.prototype,"updateMediaStreamTrackResolution"),at.prototype),ae(at.prototype,"pipe",[Zx],Object.getOwnPropertyDescriptor(at.prototype,"pipe"),at.prototype),ae(at.prototype,"unpipe",[eU],Object.getOwnPropertyDescriptor(at.prototype,"unpipe"),at.prototype),ae(at.prototype,"close",[tU],Object.getOwnPropertyDescriptor(at.prototype,"close"),at.prototype),at),hU=(nU=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),rU=nn(),iU=xl("CameraVideoTrack","_enabledMutex"),sU=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),oU=nn(),aU=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),cU=nn(),uU=ke({argsMap:r=>[r.getTrackId()]}),ae((Xi=class extends un{get __className__(){return"CameraVideoTrack"}constructor(r,i,s,a,u,d){super(r,i.encoderConfig?Nl(i.encoderConfig):{},a,u,d),C(this,"_config",void 0),C(this,"_originalConstraints",void 0),C(this,"_constraints",void 0),C(this,"_enabled",!0),C(this,"_deviceName","default"),C(this,"tryResumeVideoForIOS15WeChat",async()=>{Rl()&&!q0()&&TD()&&this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=r.label,this._config.encoderConfig&&(this._encoderConfig=Nl(this._config.encoderConfig)),Ze.on(Rn.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),Ze.on(Rn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),this.bindProcessorContextEvents()}async setDevice(r){if(D.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await hi.getDeviceById(r),s={};s.video=Jl({},this._constraints),s.video.deviceId={exact:r},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let a=null;try{a=await vs(s,this.getTrackId())}catch(u){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),a=await vs({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await hi.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}D.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),i||(this._enabled=!1);try{await Jt(this,xe.NEED_DISABLE_TRACK,this)}catch(u){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),u.toString()),u}return void D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}const s=Jl({},this._constraints),a=hi.searchDeviceIdByName(this._deviceName);a&&!s.deviceId&&(s.deviceId={exact:a});try{const u=await vs({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!1),await Jt(this,xe.NEED_ENABLE_TRACK,this)}catch(u){throw D.error("[".concat(this.getTrackId(),"] setEnabled true error"),u.toString()),u}this.updateMediaStreamTrackResolution(),D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setEncoderConfiguration(r,i){if(!this._enabled)throw new j(V.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Nl(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin);const s=cn(this._config);s.encoderConfig=r;const a=MT(s);(Kr()||dr()||Yo())&&(a.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(u){const d=new j(V.UNEXPECTED_ERROR,u.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=s,this._constraints=a,this._originalConstraints=a,this._encoderConfig=r,this._hints.indexOf(Mn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Jt(this,xe.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((dr()||Yo())&&this._enabled&&!this._isClosed&&Ze.duringInterruption){const r=async()=>{Ze.off(Rn.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ze.on(Rn.IOS_INTERRUPTION_END,r)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(Wa.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,s=hi.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId={exact:s}),this._enabled){const a=await vs({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ze.off(Rn.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),Ze.off(Rn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}bindProcessorContextEvents(){this.processorContext.on(Xr.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const a=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(a),i()}catch(a){s(a)}}),this.processorContext.on(Xr.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[nU,rU],Object.getOwnPropertyDescriptor(Xi.prototype,"setDevice"),Xi.prototype),ae(Xi.prototype,"setEnabled",[iU,sU,oU],Object.getOwnPropertyDescriptor(Xi.prototype,"setEnabled"),Xi.prototype),ae(Xi.prototype,"setEncoderConfiguration",[aU,cU],Object.getOwnPropertyDescriptor(Xi.prototype,"setEncoderConfiguration"),Xi.prototype),ae(Xi.prototype,"close",[uU],Object.getOwnPropertyDescriptor(Xi.prototype,"close"),Xi.prototype),Xi);class xT{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(i,s){C(this,"uid",void 0),C(this,"_uintid",void 0),C(this,"_trust_in_room_",!0),C(this,"_trust_audio_enabled_state_",!0),C(this,"_trust_video_enabled_state_",!0),C(this,"_trust_audio_mute_state_",!0),C(this,"_trust_video_mute_state_",!0),C(this,"_audio_muted_",!1),C(this,"_video_muted_",!1),C(this,"_audio_enabled_",!0),C(this,"_video_enabled_",!0),C(this,"_audio_added_",!1),C(this,"_video_added_",!1),C(this,"_trust_video_stream_added_state_",!0),C(this,"_trust_audio_stream_added_state_",!0),C(this,"_audioTrack",void 0),C(this,"_videoTrack",void 0),C(this,"_audioSSRC",void 0),C(this,"_videoSSRC",void 0),C(this,"_audioOrtc",void 0),C(this,"_videoOrtc",void 0),C(this,"_cname",void 0),C(this,"_rtxSsrcId",void 0),this.uid=i,this._uintid=s}}var kne=UP,Lne=_l,Mne=ig;lr({target:"Promise",stat:!0},{try:function(r){var i=Lne.f(this),s=Mne(r);return(s.error?i.reject:i.resolve)(s.value),i.promise}});var UT=kne,xne=lr,Une=M,Vne=c,Fne=Kh,jne=Fi,Bne=uo,Gne=Ho,pU=Og,Wne=Nk,Hne=xk,$ne=ul,fU=Ln("isConcatSpreadable"),mU=9007199254740991,gU="Maximum allowed index exceeded",EU=Une.TypeError,Kne=$ne>=51||!Vne(function(){var r=[];return r[fU]=!1,r.concat()[0]!==r}),qne=Hne("concat"),zne=function(r){if(!jne(r))return!1;var i=r[fU];return i!==void 0?!!i:Fne(r)};xne({target:"Array",proto:!0,forced:!Kne||!qne},{concat:function(r){var i,s,a,u,d,h=Bne(this),m=Wne(h,0),g=0;for(i=-1,a=arguments.length;i<a;i++)if(zne(d=i===-1?h:arguments[i])){if(g+(u=Gne(d))>mU)throw EU(gU);for(s=0;s<u;s++,g++)s in d&&pU(m,g,d[s])}else{if(g>=mU)throw EU(gU);pU(m,g++,d)}return m.length=g,m}});var _U={},Yne=st,Xne=ka,vU=Vm.f,Jne=ES,yU=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];_U.f=function(r){return yU&&Yne(r)=="Window"?function(i){try{return vU(i)}catch{return Jne(yU)}}(r):vU(Xne(r))};var ip={},Qne=Ln;ip.f=Qne;var SU=Go,Zne=Pr,ere=ip,tre=Bs.f,Gn=function(r){var i=SU.Symbol||(SU.Symbol={});Zne(i,r)||tre(i,r,{value:ere.f(r)})},Ql=lr,VT=M,nre=js,rre=K,sp=Fe,ire=w,Zl=de,Eu=Ay,FT=c,rr=Pr,sre=Kh,ore=z,are=Fi,cre=b,jT=by,BT=ji,ure=uo,sE=ka,GT=Dm,TU=Ua,WT=Hn,op=Nh,RU=Gm,lre=Vm,IU=_U,HT=jm,wU=oe,CU=Bs,dre=Bm,AU=be,hre=d0,$T=ml,ap=Pm.exports,bU=Fm,OU=Ly,NU=Ln,pre=ip,fre=Gn,mre=nu,PU=fl,oE=Dk.forEach,bi=Um("hidden"),aE="Symbol",DU=NU("toPrimitive"),gre=PU.set,kU=PU.getterFor(aE),zs=Object.prototype,Ya=VT.Symbol,_u=Ya&&Ya.prototype,LU=VT.TypeError,KT=VT.QObject,cp=nre("JSON","stringify"),MU=wU.f,Xa=CU.f,xU=IU.f,Ere=AU.f,UU=ire([].push),oa=ap("symbols"),up=ap("op-symbols"),qT=ap("string-to-symbol-registry"),zT=ap("symbol-to-string-registry"),_re=ap("wks"),YT=!KT||!KT.prototype||!KT.prototype.findChild,XT=Zl&&FT(function(){return op(Xa({},"a",{get:function(){return Xa(this,"a",{value:7}).a}})).a!=7})?function(r,i,s){var a=MU(zs,i);a&&delete zs[i],Xa(r,i,s),a&&r!==zs&&Xa(zs,i,a)}:Xa,JT=function(r,i){var s=oa[r]=op(_u);return gre(s,{type:aE,tag:r,description:i}),Zl||(s.description=i),s},cE=function(r,i,s){r===zs&&cE(up,i,s),BT(r);var a=GT(i);return BT(s),rr(oa,a)?(s.enumerable?(rr(r,bi)&&r[bi][a]&&(r[bi][a]=!1),s=op(s,{enumerable:WT(0,!1)})):(rr(r,bi)||Xa(r,bi,WT(1,{})),r[bi][a]=!0),XT(r,a,s)):Xa(r,a,s)},QT=function(r,i){BT(r);var s=sE(i),a=RU(s).concat(ZT(s));return oE(a,function(u){Zl&&!sp(VU,s,u)||cE(r,u,s[u])}),r},VU=function(r){var i=GT(r),s=sp(Ere,this,i);return!(this===zs&&rr(oa,i)&&!rr(up,i))&&(!(s||!rr(this,i)||!rr(oa,i)||rr(this,bi)&&this[bi][i])||s)},FU=function(r,i){var s=sE(r),a=GT(i);if(s!==zs||!rr(oa,a)||rr(up,a)){var u=MU(s,a);return!u||!rr(oa,a)||rr(s,bi)&&s[bi][a]||(u.enumerable=!0),u}},jU=function(r){var i=xU(sE(r)),s=[];return oE(i,function(a){rr(oa,a)||rr(bU,a)||UU(s,a)}),s},ZT=function(r){var i=r===zs,s=xU(i?up:sE(r)),a=[];return oE(s,function(u){!rr(oa,u)||i&&!rr(zs,u)||UU(a,oa[u])}),a};if(Eu||($T(_u=(Ya=function(){if(cre(_u,this))throw LU("Symbol is not a constructor");var r=arguments.length&&arguments[0]!==void 0?TU(arguments[0]):void 0,i=OU(r),s=function(a){this===zs&&sp(s,up,a),rr(this,bi)&&rr(this[bi],i)&&(this[bi][i]=!1),XT(this,i,WT(1,a))};return Zl&&YT&&XT(zs,i,{configurable:!0,set:s}),JT(i,r)}).prototype,"toString",function(){return kU(this).tag}),$T(Ya,"withoutSetter",function(r){return JT(OU(r),r)}),AU.f=VU,CU.f=cE,dre.f=QT,wU.f=FU,lre.f=IU.f=jU,HT.f=ZT,pre.f=function(r){return JT(NU(r),r)},Zl&&Xa(_u,"description",{configurable:!0,get:function(){return kU(this).description}})),Ql({global:!0,wrap:!0,forced:!Eu,sham:!Eu},{Symbol:Ya}),oE(RU(_re),function(r){fre(r)}),Ql({target:aE,stat:!0,forced:!Eu},{for:function(r){var i=TU(r);if(rr(qT,i))return qT[i];var s=Ya(i);return qT[i]=s,zT[s]=i,s},keyFor:function(r){if(!jT(r))throw LU(r+" is not a symbol");if(rr(zT,r))return zT[r]},useSetter:function(){YT=!0},useSimple:function(){YT=!1}}),Ql({target:"Object",stat:!0,forced:!Eu,sham:!Zl},{create:function(r,i){return i===void 0?op(r):QT(op(r),i)},defineProperty:cE,defineProperties:QT,getOwnPropertyDescriptor:FU}),Ql({target:"Object",stat:!0,forced:!Eu},{getOwnPropertyNames:jU,getOwnPropertySymbols:ZT}),Ql({target:"Object",stat:!0,forced:FT(function(){HT.f(1)})},{getOwnPropertySymbols:function(r){return HT.f(ure(r))}}),cp&&Ql({target:"JSON",stat:!0,forced:!Eu||FT(function(){var r=Ya();return cp([r])!="[null]"||cp({a:r})!="{}"||cp(Object(r))!="{}"})},{stringify:function(r,i,s){var a=hre(arguments),u=i;if((are(i)||r!==void 0)&&!jT(r))return sre(i)||(i=function(d,h){if(ore(u)&&(h=sp(u,this,d,h)),!jT(h))return h}),a[1]=i,rre(cp,null,a)}}),!_u[DU]){var vre=_u.valueOf;$T(_u,DU,function(r){return sp(vre,this)})}mre(Ya,aE),bU[bi]=!0,Gn("asyncIterator"),Gn("hasInstance"),Gn("isConcatSpreadable"),Gn("iterator"),Gn("match"),Gn("matchAll"),Gn("replace"),Gn("search"),Gn("species"),Gn("split"),Gn("toPrimitive"),Gn("toStringTag"),Gn("unscopables"),nu(M.JSON,"JSON",!0);var yre=Go.Symbol;Gn("asyncDispose"),Gn("dispose"),Gn("matcher"),Gn("metadata"),Gn("observable"),Gn("patternMatch"),Gn("replaceAll");var BU=yre,GU=ip.f("asyncIterator"),Sre=GU;function WU(r){this.wrapped=r}function lp(r){var i,s;function a(d,h){try{var m=r[d](h),g=m.value,p=g instanceof WU;UT.resolve(p?g.wrapped:g).then(function(E){p?a(d==="return"?"return":"next",E):u(m.done?"return":"normal",E)},function(E){a("throw",E)})}catch(E){u("throw",E)}}function u(d,h){switch(d){case"return":i.resolve({value:h,done:!0});break;case"throw":i.reject(h);break;default:i.resolve({value:h,done:!1})}(i=i.next)?a(i.key,i.arg):s=null}this._invoke=function(d,h){return new UT(function(m,g){var p={key:d,arg:h,resolve:m,reject:g,next:null};s?s=s.next=p:(i=s=p,a(d,h))})},typeof r.return!="function"&&(this.return=void 0)}function ws(r){return function(){return new lp(r.apply(this,arguments))}}function Xe(r){return new WU(r)}lp.prototype[typeof BU=="function"&&Sre||"@@asyncIterator"]=function(){return this},lp.prototype.next=function(r){return this._invoke("next",r)},lp.prototype.throw=function(r){return this._invoke("throw",r)},lp.prototype.return=function(r){return this._invoke("return",r)};var Tre=ip.f("iterator");function dp(r,i){var s={},a=!1;function u(d,h){return a=!0,h=new UT(function(m){m(r[d](h))}),{done:!1,value:i(h)}}return s[BU!==void 0&&Tre||"@@iterator"]=function(){return this},s.next=function(d){return a?(a=!1,d):u("next",d)},typeof r.throw=="function"&&(s.throw=function(d){if(a)throw a=!1,d;return u("throw",d)}),typeof r.return=="function"&&(s.return=function(d){return a?(a=!1,d):u("return",d)}),s}var HU=GU,ln={exports:{}};function $U(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function KU(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?$U(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):$U(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}function eR(r,i,s,a,u,d,h){let m=[],g=[],p=[],E=[],v=!1,T=!1;if(ln.exports.parse(r).mediaDescriptions.forEach(I=>{h&&h!==I.attributes.direction||(I.media.mediaType!=="video"||v||(g=I.attributes.payloads,E=I.attributes.extmaps,v=!0),I.media.mediaType!=="audio"||T||(m=I.attributes.payloads,p=I.attributes.extmaps,T=!0))}),!E||g.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!p||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");return g.forEach(I=>{var O;(O=I.rtpMap)!==null&&O!==void 0&&O.clockRate&&(I.rtpMap.clockRate=parseInt(I.rtpMap.clockRate))}),m.forEach(I=>{var O;(O=I.rtpMap)!==null&&O!==void 0&&O.clockRate&&(I.rtpMap.clockRate=parseInt(I.rtpMap.clockRate))}),i&&(m=m.filter(I=>{var O;return((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())!=="rtx"}),g=g.filter(I=>{var O;return((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())!=="rtx"})),s&&(g=g.filter(I=>{var O;return!/(red)|(ulpfec)|(flexfec)/i.test(((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName)||"")})),a&&(m=m.filter(I=>{var O;return!/(red)|(ulpfec)|(flexfec)/i.test(((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(m=m.filter(I=>{var O;return u.includes(((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())||"")})),d&&(d==null?void 0:d.length)>0&&(g=g.filter(I=>{var O;return d.includes(((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLowerCase())||"")})),{audioCodecs:m,videoCodecs:g,audioExtensions:p,videoExtensions:E}}function vu(r){const i=ln.exports.parse(r);let s,a;for(const u of i.mediaDescriptions){if(!s){const d=u.attributes.iceUfrag,h=u.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){const d=u.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&i.attributes.fingerprints.length>0&&(a={fingerprints:i.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function qU(r,i){const s=[],a=r.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),u=r.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=r.attributes.ssrcs;if(u)u.ssrcIds.forEach(h=>{var m;const g=(m=a.find(p=>p.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:i?g:void 0})});else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:i?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function zU(r,i){const{cname:s}=r;let a;i&&i.ip&&typeof i.port=="number"?(a=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip,port:i.port.toString(),type:"host",extension:{}}],D.debug("Using remote candidate from AP ".concat(i.ip,":").concat(i.port)),i.ip6&&(a.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip6,port:i.port.toString(),type:"host",extension:{}}),D.debug("Using IPV6 remote candidate from AP ".concat(i.ip6,":").concat(i.port)))):a=r.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}}));const u={fingerprints:r.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},d={iceUfrag:r.iceParameters.iceUfrag,icePwd:r.iceParameters.icePwd};let h;switch(r.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:u,iceParameters:d,candidates:a,rtpCapabilities:rR(r.rtpCapabilities),setup:h,cname:s}}function Ji(r,i,s){const a=[],u=[];return r.forEach(d=>{let{ssrcId:h,rtx:m}=d;const g=$t(8,"track-"),p={ssrcId:h,attributes:KU({label:g,mslabel:s=s||$t(10,""),msid:"".concat(s," ").concat(g)},i&&{cname:i})};if(a.push(p),m!==void 0){const E={ssrcId:m,attributes:KU({label:g,mslabel:s,msid:"".concat(s," ").concat(g)},i&&{cname:i})};a.push(E),u.push({semantic:"FID",ssrcIds:[h,m]})}}),r.length>1&&u.push({semantic:"SIM",ssrcIds:r.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:u}}function ed(r,i){i instanceof tr&&r.attributes.payloads.forEach(s=>{var a;const u=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!u||["opus","pcmu","pcma","g722"].indexOf(u)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=i._encoderConfig;d&&u!=="pcmu"&&u!=="pcma"&&u!=="g722"&&(d.bitrate&&!tn()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function tR(r){const i=r.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");i!==-1&&r.attributes.unrecognized.splice(i,1)}function nR(r,i){if(!(i instanceof un&&i._encoderConfig&&i._hints.indexOf(Mn.SCREEN_TRACK)===-1))return;const s=i._encoderConfig;er().supportMinBitrate&&s.bitrateMin&&r.attributes.payloads.forEach(a=>{var u;["h264","vp8","vp9","av1"].includes(((u=a.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),er().supportMinBitrate&&!i._hints.includes(Mn.LOW_STREAM)&&s.bitrateMax&&r.attributes.payloads.forEach(a=>{var u;["h264","vp8","vp9","av1"].includes(((u=a.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-start-bitrate"]="".concat(Q("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function YU(r){if(r.media.mediaType!=="video")return;const i=bt();if(i.name!==It.SAFARI&&i.os!==Kn.IOS)return;const s=r.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&r.attributes.extmaps.splice(s,1)}function uE(r,i,s){if(!i)return;let a,u;if(r.media.mediaType==="video"?(a=s.videoExtensions,u=s.videoCodecs):(a=s.audioExtensions,u=s.audioCodecs),i.tcc===!0){const d=a.find(h=>h.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");d&&(r.attributes.extmaps.find(h=>h.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||r.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(h,m){return m.filter(g=>!!h.find(p=>p.payloadType===g.payloadType&&!!p.rtcpFeedbacks.find(E=>E.type==="transport-cc")))}(u,r.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(m=>m.type==="transport-cc")||h.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(i.tcc===!1){const d=r.attributes.extmaps.findIndex(h=>h.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");d!==-1&&r.attributes.extmaps.splice(d,1),r.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(i.remb===!0){const d=a.find(h=>h.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");d&&(r.attributes.extmaps.find(h=>h.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||r.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(h,m){return m.filter(g=>!!h.find(p=>p.payloadType===g.payloadType&&!!p.rtcpFeedbacks.find(E=>E.type==="goog-remb")))}(u,r.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(m=>m.type==="goog-remb")||h.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(i.remb===!1){const d=r.attributes.extmaps.findIndex(h=>h.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");d!==-1&&r.attributes.extmaps.splice(d,1),r.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function XU(r,i,s){if(tn()||r.media.mediaType!=="video"||!(i instanceof un)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!Q("SIMULCAST")||i._scalabiltyMode===void 0||i._scalabiltyMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:i._scalabiltyMode.numSpatialLayers,u=r.attributes.ssrcs[0],d=r.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===u.ssrcId),h={semantic:"SIM",ssrcIds:[u.ssrcId]};for(let m=1;m<a;m++)r.attributes.ssrcs.push({ssrcId:u.ssrcId+m,attributes:cn(u.attributes)}),h.ssrcIds.push(u.ssrcId+m),d&&(r.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:cn(u.attributes)}),r.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[u.ssrcId+m,d.ssrcIds[1]+m]}));r.attributes.ssrcGroups.unshift(h)}async function JU(r,i,s,a,u){const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly"}),d.addTransceiver("audio",{direction:"sendonly"}),d.addTransceiver("video",{direction:"recvonly"}),d.addTransceiver("audio",{direction:"recvonly"});const h=(await d.createOffer()).sdp,m=eR(h,r,i,s,a,u,"sendonly"),g=eR(h,r,i,s,a,u,"recvonly"),p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(lE(m,g,"videoExtensions",p,E,v),lE(m,g,"videoCodecs",p,E,v),lE(m,g,"audioExtensions",p,E,v),lE(m,g,"audioCodecs",p,E,v),Q("RAISE_H264_BASELINE_PRIORITY")){const T=v.videoCodecs.findIndex(I=>{var O,N;return((O=I.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"&&((N=I.fmtp)===null||N===void 0?void 0:N.parameters["profile-level-id"])==="42001f"});if(T!==-1){const I=v.videoCodecs.findIndex(O=>{var N;return((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"});if(I<T){D.debug("raising H264 baseline profile priority");const O=v.videoCodecs[T];v.videoCodecs.splice(T,1),v.videoCodecs.splice(I,0,O)}I!==-1&&(E.videoCodecs=E.videoCodecs.filter(O=>{var N,P;return!(((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((P=O.fmtp)===null||P===void 0?void 0:P.parameters["profile-level-id"])!=="42001f")})),I!==-1&&Q("FILTER_SEND_H264_BASELINE")&&(p.videoCodecs=p.videoCodecs.filter(O=>{var N,P;return!(((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((P=O.fmtp)===null||P===void 0?void 0:P.parameters["profile-level-id"])!=="42001f")}))}}try{d.close()}catch{}return{send:p,recv:E,sendrecv:v}}function lE(r,i,s,a,u,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return r[s].forEach(m=>{i[s].some((g,p)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(p),!0})?d[s].push(m):a[s].push(m)}),void i[s].forEach((m,g)=>{h.indexOf(g)===-1&&u[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return r[s].forEach(m=>{i[s].some((g,p)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(p),!0})?d[s].push(m):a[s].push(m)}),void i[s].forEach((m,g)=>{h.indexOf(g)===-1&&u[s].push(m)})}}function rR(r){const{send:i,recv:s,sendrecv:a}=r;if(!a){if(!i||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:s}}let u,d;return i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...a.audioCodecs],u.videoCodecs=[...i.videoCodecs,...a.videoCodecs],u.audioExtensions=[...i.audioExtensions,...a.audioExtensions],u.videoExtensions=[...i.videoExtensions,...a.videoExtensions]):u=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:u,recv:d}}function Ja(r){r.media.mediaType==="audio"&&r.attributes.payloads.filter(i=>{var s;return((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}(function(r,i){r.exports=(()=>{var s={8:(d,h,m)=>{m.r(h),m.d(h,{Parser:()=>Ce,Printer:()=>ne,parse:()=>pe,print:()=>Oe});const g=`
`,p="".concat("\r").concat(g),E=" ";let v;function T(ce){return ce>="0"&&ce<="9"}function I(ce){return ce>="!"&&ce<="~"}function O(ce){return I(ce)||ce>=""&&ce<="ÿ"}function N(ce){return ce==="!"||ce>="#"&&ce<="'"||ce>="*"&&ce<="+"||ce>="-"&&ce<="."||ce>="0"&&ce<="9"||ce>="A"&&ce<="Z"||ce>="^"&&ce<="~"}function P(ce){return ce>="1"&&ce<="9"}function L(ce){return ce>="A"&&ce<="Z"||ce>="a"&&ce<="z"}function x(ce){return ce==="d"||ce==="h"||ce==="m"||ce==="s"}function W(ce){return ce>""&&ce<"	"||ce>"\v"&&ce<"\f"||ce>""&&ce<"ÿ"}function q(ce){return L(ce)||T(ce)||ce==="+"||ce==="/"}function X(ce){return T(ce)||L(ce)||ce==="+"||ce==="/"||ce==="-"||ce==="_"}function ie(ce){return L(ce)||T(ce)||ce==="+"||ce==="/"}function ee(ce,A){var U=Object.keys(ce);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(ce);A&&(G=G.filter(function(re){return Object.getOwnPropertyDescriptor(ce,re).enumerable})),U.push.apply(U,G)}return U}function le(ce){for(var A=1;A<arguments.length;A++){var U=arguments[A]!=null?arguments[A]:{};A%2?ee(Object(U),!0).forEach(function(G){he(ce,G,U[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ce,Object.getOwnPropertyDescriptors(U)):ee(Object(U)).forEach(function(G){Object.defineProperty(ce,G,Object.getOwnPropertyDescriptor(U,G))})}return ce}function he(ce,A,U){return A in ce?Object.defineProperty(ce,A,{value:U,enumerable:!0,configurable:!0,writable:!0}):ce[A]=U,ce}(function(ce){ce.VERSION="v",ce.ORIGIN="o",ce.SESSION_NAME="s",ce.INFORMATION="i",ce.URI="u",ce.EMAIL="e",ce.PHONE="p",ce.CONNECTION="c",ce.BANDWIDTH="b",ce.TIME="t",ce.REPEAT="r",ce.ZONE_ADJUSTMENTS="z",ce.KEY="k",ce.ATTRIBUTE="a",ce.MEDIA="m"})(v||(v={}));class ue{consumeText(A,U){let G=U;for(;G<A.length;){const re=A[G];if(re==="\0"||re==="\r"||re===g)break;G+=1}if(G-U==0)throw new Error("Invalid text, at ".concat(A));return G}consumeUnicastAddress(A,U,G){return this.consumeTill(A,U,E)}consumeOneOrMore(A,U,G){let re=U;for(;G(A[re]);)re++;if(re-U==0)throw new Error("Invalid rule at ".concat(U,"."));return re}consumeSpace(A,U){if(A[U]===E)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(A,U){let G=U;for(let re=0;re<4;re++)if(G=this.consumeDecimalUChar(A,G),re!==3){if(A[G]!==".")throw new Error("Invalid IP4 address.");G++}return G}consumeDecimalUChar(A,U){let G=U;for(let Ne=0;Ne<3&&T(A[G]);Ne++,G++);if(G-U==0)throw new Error("Invalid decimal uchar.");const re=parseInt(A.slice(U,G));if(re>=0&&re<=255)return G;throw new Error("Invalid decimal uchar")}consumeIP6Address(A,U){let G=this.consumeHexpart(A,U);return A[G]===":"&&(G+=1,G=this.consumeIP4Address(A,G)),G}consumeHexpart(A,U){let G=U;if(A[G]===":"&&A[G+1]===":"){G+=2;try{G=this.consumeHexseq(A,G)}catch{}return G}if(G=this.consumeHexseq(A,G),A[G]===":"&&A[G+1]===":"){G+=2;try{G=this.consumeHexseq(A,G)}catch{}return G}return G}consumeHexseq(A,U){let G=U;for(;G=this.consumeHex4(A,G),A[G]===":"&&A[G+1]!==":";)G+=1;return G}consumeHex4(A,U){let G=0;for(;G<4;G++)if(!((re=A[U+G])>="0"&&re<="9"||re>="a"&&re<="f"||re>="A"&&re<="F")){if(G===0)throw new Error("Invalid hex 4");break}var re;return U+G}consumeFQDN(A,U){let G=U;for(;T(A[G])||L(A[G])||A[G]==="-"||A[G]===".";)G+=1;if(G-U<4)throw new Error("Invalid FQDN");return G}consumeExtnAddr(A,U){return this.consumeOneOrMore(A,U,O)}consumeMulticastAddress(A,U,G){switch(G){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(A,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(A,U);default:try{return this.consumeFQDN(A,U)}catch{return this.consumeExtnAddr(A,U)}}}consumeIP6MulticastAddress(A,U){const G=this.consumeHexpart(A,U);return A[G]==="/"?this.consumeInteger(A,G+1):G}consumeIP4MulticastAddress(A,U){let G=U+3;const re=A.slice(U,G),Ne=parseInt(re);if(Ne<224||Ne>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ht=0;ht<3;ht++){if(A[G]!==".")throw new Error("Invalid IP4 multicast address.");G+=1,G=this.consumeDecimalUChar(A,G)}return A[G]==="/"&&(G+=1),G=this.consumeTTL(A,G),A[G]==="/"&&(G=this.consumeInteger(A,G)),G}consumeInteger(A,U){if(!P(A[U]))throw new Error("Invalid integer.");for(U+=1;T(A[U]);)U+=1;return U}consumeTTL(A,U){if(A[U]==="0")return U+1;if(!P(A[U]))throw new Error("Invalid TTL.");U+=1;for(let G=0;G<2&&T(A[U]);G++)U+=1;return U}consumeToken(A,U){return this.consumeOneOrMore(A,U,N)}consumeTime(A,U){let G=U;if(A[G]==="0")return G+1;for(P(A[G])&&(G+=1);T(A[G]);)G++;if(G-U<10)throw new Error("Invalid time");return G}consumeAddress(A,U){return this.consumeTill(A,U,E)}consumeTypedTime(A,U){let G=U;return G=this.consumeOneOrMore(A,G,T),x(A[G])?G+1:G}consumeRepeatInterval(A,U){if(!P(A[U]))throw new Error("Invalid repeat interval");for(U+=1;T(A[U]);)U+=1;return x(A[U])&&(U+=1),U}consumePort(A,U){return this.consumeOneOrMore(A,U,T)}consume(A,U,G){for(let re=0;re<G.length;re++){if(U+re>=A.length)throw new Error("consume exceeding value length");if(A[U+re]!==G[re])throw new Error("consume ".concat(G," failed at ").concat(re))}return U+G.length}consumeTill(A,U,G){let re=U;for(;re<A.length&&(typeof G!="string"||A[re]!==G)&&(typeof G!="function"||!G(A[re]));)re++;return re}}class Ce extends ue{constructor(){super(),he(this,"records",[]),he(this,"currentLine",0)}parse(A){const U=this.probeEOL(A);this.records=A.split(U).filter(ts=>!!ts.trim()).map(this.parseLine),this.currentLine=0;const G=this.parseVersion(),re=this.parseOrigin(),Ne=this.parseSessionName(),ht=this.parseInformation(),At=this.parseUri(),Et=this.parseEmail(),mn=this.parsePhone(),et=this.parseConnection(),xt=this.parseBandWidth(),ut=this.parseTimeFields(),Vr=this.parseKey(),pt=this.parseSessionAttribute(),kt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:G,origin:re,sessionName:Ne,information:ht,uri:At,emails:Et,phones:mn,connection:et,bandwidths:xt,timeFields:ut,key:Vr,attributes:pt,mediaDescriptions:kt}}getCurrentRecord(){const A=this.records[this.currentLine];if(!A)throw new Error("Record doesn't exit.");return A}probeEOL(A){for(let U=0;U<A.length;U++)if(A[U]===g)return A[U-1]==="\r"?p:g;throw new Error("Invalid newline character.")}parseLine(A,U){if(A.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const G=A[0];if(A[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:G,value:A.slice(2),line:U,cur:0}}parseSessionAttribute(){const A=new je;for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==v.ATTRIBUTE)break;const G={attField:this.extractOneOrMore(U,re=>N(re)&&re!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,G.attValue=this.extractOneOrMore(U,W)),A.parse(G),this.currentLine++}return A.digest()}parseMediaAttributes(A){const U=new fe(A);for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==v.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(G,Ne=>N(Ne)&&Ne!==":"),_cur:0};G.value[G.cur]===":"&&(G.cur+=1,re.attValue=this.extractOneOrMore(G,W)),U.parse(re),this.currentLine++}return U.digest()}parseKey(){const A=this.getCurrentRecord();if(A.type===v.KEY){if(A.value==="prompt"||A.value==="clear:"||A.value==="base64:"||A.value==="uri:")return A.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const A=this.getCurrentRecord();if(A.type===v.ZONE_ADJUSTMENTS){const U=[];for(;;)try{const G=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);let re=!1;A.value[A.cur]==="-"&&(re=!0,A.cur+=1);const Ne=this.extract(A,this.consumeTypedTime);U.push({time:G,typedTime:Ne,back:re})}catch{break}if(U.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){const A=[];for(;;){const U=this.getCurrentRecord();if(U.type!==v.REPEAT)break;{const G=this.extract(U,this.consumeRepeatInterval),re=this.parseTypedTime(U);A.push({repeatInterval:G,typedTimes:re}),this.currentLine++}}return A}parseTypedTime(A){const U=[];for(;;)try{this.consumeSpaceForRecord(A),U.push(this.extract(A,this.consumeTypedTime))}catch{break}if(U.length===0)throw new Error("Invalid typed time.");return U}parseTime(){const A=this.getCurrentRecord(),U=this.extract(A,this.consumeTime);this.consumeSpaceForRecord(A);const G=this.extract(A,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:G}}parseBandWidth(){const A=[];for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==v.BANDWIDTH)break;{const G=this.extractOneOrMore(U,N);if(U.value[U.cur]!==":")throw new Error("Invalid bandwidth field.");U.cur++;const re=this.extractOneOrMore(U,T);A.push({bwtype:G,bandwidth:re}),this.currentLine++}}return A}parseVersion(){const A=this.getCurrentRecord();if(A.type!==v.VERSION)throw new Error("first sdp record must be version");const U=A.value.slice(0,this.consumeOneOrMore(A.value,0,T));if(U.length!==A.value.length)throw new Error('invalid proto version, "v='.concat(A.value,'"'));return this.currentLine++,U}parseOrigin(){const A=this.getCurrentRecord();if(A.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const U=this.extractOneOrMore(A,O);this.consumeSpaceForRecord(A);const G=this.extractOneOrMore(A,T);this.consumeSpaceForRecord(A);const re=this.extractOneOrMore(A,T);this.consumeSpaceForRecord(A);const Ne=this.extractOneOrMore(A,N);this.consumeSpaceForRecord(A);const ht=this.extractOneOrMore(A,N);this.consumeSpaceForRecord(A);const At=this.extract(A,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:G,sessVersion:re,nettype:Ne,addrtype:ht,unicastAddress:At}}parseSessionName(){const A=this.getCurrentRecord();if(A.type===v.SESSION_NAME){const U=this.extract(A,this.consumeText);return this.currentLine++,U}}parseInformation(){const A=this.getCurrentRecord();if(A.type!==v.INFORMATION)return;const U=this.extract(A,this.consumeText);return this.currentLine++,U}parseUri(){const A=this.getCurrentRecord();if(A.type===v.URI)return this.currentLine++,A.value}parseEmail(){const A=[];for(;;){const U=this.getCurrentRecord();if(U.type!==v.EMAIL)break;A.push(U.value),this.currentLine++}return A}parsePhone(){const A=[];for(;;){const U=this.getCurrentRecord();if(U.type!==v.PHONE)break;A.push(U.value),this.currentLine++}return A}parseConnection(){const A=this.getCurrentRecord();if(A.type===v.CONNECTION){const U=this.extractOneOrMore(A,N);this.consumeSpaceForRecord(A);const G=this.extractOneOrMore(A,N);this.consumeSpaceForRecord(A);const re=this.extract(A,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:G,address:re}}}parseMedia(){const A=this.getCurrentRecord(),U=this.extract(A,this.consumeToken);this.consumeSpaceForRecord(A);let G=this.extract(A,this.consumePort);A.value[A.cur]==="/"&&(A.cur+=1,G+=this.extract(A,this.consumeInteger)),this.consumeSpaceForRecord(A);const re=[];for(re.push(this.extract(A,this.consumeToken));A.value[A.cur]==="/";)A.cur+=1,re.push(this.extract(A,this.consumeToken));if(re.length===0)throw new Error("Invalid proto");const Ne=this.parseFmt(A);return this.currentLine++,{mediaType:U,port:G,protos:re,fmts:Ne}}parseTimeFields(){const A=[];for(;this.getCurrentRecord().type===v.TIME;){const U=this.parseTime(),G=this.parseRepeat(),re=this.parseZone();A.push({time:U,repeats:G,zones:re})}return A}parseMediaDescription(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const U=this.parseMedia(),G=this.parseInformation(),re=this.parseConnections(),Ne=this.parseBandWidth(),ht=this.parseKey(),At=this.parseMediaAttributes(U);A.push({media:U,information:G,connections:re,bandwidths:Ne,key:ht,attributes:At})}return A}parseConnections(){const A=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)A.push(this.parseConnection());return A}parseFmt(A){const U=[];for(;;)try{this.consumeSpaceForRecord(A),U.push(this.extract(A,this.consumeToken))}catch{break}if(U.length===0)throw new Error("Invalid fmts");return U}extract(A,U,...G){const re=U.call(this,A.value,A.cur,...G),Ne=A.value.slice(A.cur,re);return A.cur=re,Ne}extractOneOrMore(A,U){const G=this.consumeOneOrMore(A.value,A.cur,U),re=A.value.slice(A.cur,G);return A.cur=G,re}consumeSpaceForRecord(A){if(A.value[A.cur]!==E)throw new Error("Invalid space at ".concat(A.cur,"."));A.cur+=1}}class De extends ue{constructor(...A){super(...A),he(this,"attributes",void 0),he(this,"digested",!1)}extractOneOrMore(A,U,G){const re=this.consumeOneOrMore(A.attValue,A._cur,U),Ne=A.attValue.slice(A._cur,re),[ht,At]=G||[];if(typeof ht=="number"&&Ne.length<ht)throw new Error("error in length, should be more or equal than ".concat(ht," characters."));if(typeof At=="number"&&Ne.length>At)throw new Error("error in length, should be less or equal than ".concat(At," characters."));return A._cur=re,Ne}consumeAttributeSpace(A){if(A.attValue[A._cur]!==E)throw new Error("Invalid space at ".concat(A._cur,"."));A._cur+=1}extract(A,U,...G){if(!A.attValue)throw new Error("Nothing to extract from attValue.");const re=U.call(this,A.attValue,A._cur,...G),Ne=A.attValue.slice(A._cur,re);return A._cur=re,Ne}atEnd(A){if(!A.attValue)throw new Error;return A._cur>=A.attValue.length}peekChar(A){if(!A.attValue)throw new Error;return A.attValue[A._cur]}peek(A,U){if(!A.attValue)throw new Error;for(let G=0;G<U.length;G++)if(U[G]!==A.attValue[A._cur+G])return!1;return!0}parseIceUfrag(A){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(A,q,[4,256])}parseIcePwd(A){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(A,q,[22,256])}parseIceOptions(A){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const U=[];for(;!this.atEnd(A);){U.push(this.extractOneOrMore(A,q));try{this.consumeAttributeSpace(A)}catch(G){if(this.atEnd(A))break;throw G}}this.attributes.iceOptions=U}parseFingerprint(A){const U=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const G=this.extract(A,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:G})}parseExtmap(A){const U=this.extractOneOrMore(A,T);let G;this.peekChar(A)==="/"&&(this.extract(A,this.consume,"/"),G=this.extract(A,this.consumeToken)),this.consumeAttributeSpace(A);const re=this.extract(A,this.consumeTill,E),Ne=le(le({entry:parseInt(U,10)},G&&{direction:G}),{},{extensionName:re});this.peekChar(A)===E&&(this.consumeAttributeSpace(A),Ne.extensionAttributes=this.extract(A,this.consumeTill)),this.attributes.extmaps.push(Ne)}parseSetup(A){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const U=this.extract(A,this.consumeTill);if(U!=="active"&&U!=="passive"&&U!=="actpass"&&U!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class je extends De{constructor(...A){super(...A),he(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"group":this.parseGroup(A);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"fingerprint":this.parseFingerprint(A);break;case"setup":this.parseSetup(A);break;case"tls-id":this.parseTlsId(A);break;case"identity":this.parseIdentity(A);break;case"extmap":this.parseExtmap(A);break;case"msid-semantic":this.parseMsidSemantic(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(U){throw console.error("parsing session attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),U}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(A){const U=this.extract(A,this.consumeToken),G=[];for(;!this.atEnd(A)&&this.peekChar(A)===E;)this.consumeAttributeSpace(A),G.push(this.extract(A,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:G})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(A){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(A,X)}parseIdentity(A){const U=this.extractOneOrMore(A,ie),G=[];for(;!this.atEnd(A)&&this.peekChar(A)===E;){this.consumeAttributeSpace(A);const re=this.extract(A,this.consumeToken);this.extract(A,this.consume,"=");const Ne=this.extractOneOrMore(A,ht=>ht!==E&&W(ht));G.push({name:re,value:Ne})}this.attributes.identities.push({assertionValue:U,extensions:G})}parseMsidSemantic(A){this.peekChar(A)===E&&this.consumeAttributeSpace(A);const U={semantic:this.extract(A,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(A)}catch{break}if(this.peekChar(A)==="*"){this.extract(A,this.consume,"*"),U.applyForAll=!0;break}{const G=this.extract(A,this.consumeTill,E);U.identifierList.push(G)}}this.attributes.msidSemantic=U}}class fe extends De{constructor(A){super(),he(this,"attributes",void 0),A.protos.indexOf("RTP")!==-1||A.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(A){if(this.digested)throw new Error("already digested");try{switch(A.attField){case"extmap":this.parseExtmap(A);break;case"setup":this.parseSetup(A);break;case"ice-ufrag":this.parseIceUfrag(A);break;case"ice-pwd":this.parseIcePwd(A);break;case"ice-options":this.parseIceOptions(A);break;case"candidate":this.parseCandidate(A);break;case"remote-candidate":this.parseRemoteCandidate(A);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(A);break;case"rtpmap":this.parseRtpmap(A);break;case"ptime":this.parsePtime(A);break;case"maxptime":this.parseMaxPtime(A);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(A);break;case"ssrc":this.parseSSRC(A);break;case"fmtp":this.parseFmtp(A);break;case"rtcp-fb":this.parseRtcpFb(A);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(A);break;case"mid":this.parseMid(A);break;case"msid":this.parseMsid(A);break;case"imageattr":this.parseImageAttr(A);break;case"rid":this.parseRid(A);break;case"simulcast":this.parseSimulcast(A);break;case"sctp-port":this.parseSctpPort(A);break;case"max-message-size":this.parseMaxMessageSize(A);break;case"ssrc-group":this.parseSSRCGroup(A);break;default:A.ignored=!0,this.attributes.unrecognized.push(A)}}catch(U){throw console.error("parsing media attribute ".concat(A.attField,' error, "a=').concat(A.attField,":").concat(A.attValue,'"')),U}if(!A.ignored&&A.attValue&&!this.atEnd(A))throw new Error("attribute parsing error")}parseCandidate(A){const U=this.extractOneOrMore(A,q,[1,32]);this.consumeAttributeSpace(A);const G=this.extractOneOrMore(A,T,[1,5]);this.consumeAttributeSpace(A);const re=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const Ne=this.extractOneOrMore(A,T,[1,10]);this.consumeAttributeSpace(A);const ht=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const At=this.extract(A,this.consumePort);this.consumeAttributeSpace(A),this.extract(A,this.consume,"typ"),this.consumeAttributeSpace(A);const Et={foundation:U,componentId:G,transport:re,priority:Ne,connectionAddress:ht,port:At,type:this.extract(A,this.consumeToken),extension:{}};for(this.peek(A," raddr")&&(this.extract(A,this.consume," raddr"),this.consumeAttributeSpace(A),Et.relAddr=this.extract(A,this.consumeAddress)),this.peek(A," rport")&&(this.extract(A,this.consume," rport"),this.consumeAttributeSpace(A),Et.relPort=this.extract(A,this.consumePort));this.peekChar(A)===E;){this.consumeAttributeSpace(A);const mn=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A),Et.extension[mn]=this.extractOneOrMore(A,I)}this.attributes.candidates.push(Et)}parseRemoteCandidate(A){const U=[];for(;;){const G=this.extractOneOrMore(A,T,[1,5]);this.consumeAttributeSpace(A);const re=this.extract(A,this.consumeAddress);this.consumeAttributeSpace(A);const Ne=this.extract(A,this.consumePort);U.push({componentId:G,connectionAddress:re,port:Ne});try{this.consumeAttributeSpace(A)}catch{break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(A){const U=this.extract(A,this.consumeToken);this.consumeAttributeSpace(A);const G=this.extract(A,this.consumeTill,"/");this.extract(A,this.consume,"/");const re={encodingName:G,clockRate:this.extractOneOrMore(A,T)};this.atEnd(A)||this.peekChar(A)!=="/"||(this.extract(A,this.consume,"/"),re.encodingParameters=parseInt(this.extract(A,this.consumeTill),10));const Ne=this.attributes.payloads.find(ht=>ht.payloadType===parseInt(U,10));Ne?Ne.rtpMap=re:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:re,rtcpFeedbacks:[]})}parsePtime(A){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(A,this.consumeTill)}parseMaxPtime(A){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(A,this.consumeTill)}parseDirection(A){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=A.attField}parseSSRC(A){const U=this.extractOneOrMore(A,T);this.consumeAttributeSpace(A);const G=this.extract(A,this.consumeTill,":");let re;this.peekChar(A)===":"&&(this.extract(A,this.consume,":"),re=this.extract(A,this.consumeTill));const Ne=this.attributes.ssrcs.find(ht=>ht.ssrcId===parseInt(U,10));Ne?Ne.attributes[G]=re:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[G]:re}})}parseFmtp(A){const U=this.extract(A,this.consumeTill,E);this.consumeAttributeSpace(A);const G=this.extract(A,this.consumeTill),re={};G.split(";").forEach(ht=>{let[At,Et]=ht.split("=");At=At.trim();const mn=typeof Et=="string"?Et.trim():null;typeof At=="string"&&At.length>0&&(re[At]=mn)});const Ne=this.attributes.payloads.find(ht=>ht.payloadType===parseInt(U,10));Ne?Ne.fmtp={parameters:re}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:re}})}parseFmtParameters(A){const U={},G=this.extract(A,this.consumeTill,"=");A._cur++;const re=this.extract(A,this.consumeTill,";");for(U[G]=re;A.attValue[A._cur]===";";){const Ne=this.extract(A,this.consumeTill,"=");A._cur++;const ht=this.extract(A,this.consumeTill,";");U[Ne]=ht}return U}parseRtcpFb(A){let U="";U=this.peekChar(A)==="*"?this.extract(A,this.consume,"*"):this.extract(A,this.consumeTill,E),this.consumeAttributeSpace(A);const G=this.extract(A,this.consumeTill,E);let re;switch(G){case"trr-int":re={type:G,interval:this.extract(A,this.consumeTill)};break;case"ack":case"nack":default:{const Ne={type:G};this.peekChar(A)===E&&(this.consumeAttributeSpace(A),Ne.parameter=this.extract(A,this.consumeToken),this.peekChar(A)===E&&(Ne.additional=this.extract(A,this.consumeTill))),re=Ne}}if(U==="*")this.attributes.rtcpFeedbackWildcards.push(re);else{const Ne=this.attributes.payloads.find(ht=>ht.payloadType===parseInt(U,10));Ne?Ne.rtcpFeedbacks.push(re):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(A){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const U={port:this.extract(A,this.consumePort)};this.peekChar(A)===E&&(this.consumeAttributeSpace(A),U.netType=this.extractOneOrMore(A,N),this.consumeAttributeSpace(A),U.addressType=this.extractOneOrMore(A,N),this.consumeAttributeSpace(A),U.address=this.extract(A,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(A){const U={id:this.extractOneOrMore(A,N,[1,64])};this.peekChar(A)===E&&(this.consumeAttributeSpace(A),U.appdata=this.extractOneOrMore(A,N,[1,64])),this.attributes.msids.push(U)}parseImageAttr(A){this.attributes.imageattr.push(A.attValue)}parseRid(A){const U=this.extractOneOrMore(A,re=>L(re)||T(re)||re==="_"||re==="-");this.consumeAttributeSpace(A);const G={id:U,direction:this.extract(A,this.consumeToken),params:[]};if(this.peekChar(A)===E){if(this.consumeAttributeSpace(A),this.peek(A,"pt=")){this.extract(A,this.consume,"pt=");const re=[];for(;;){const Ne=this.extract(A,this.consumeToken);re.push(Ne);try{this.extract(A,this.consume,",")}catch{break}}G.payloads=re,this.peekChar(A)===E&&this.extract(A,this.consume,E)}for(;;){const re=this.extract(A,this.consumeToken);switch(re){case"depend":{const Ne={type:re,rids:this.extract(A,this.consume,"=").split(",")};G.params.push(Ne);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const Ne={type:re};this.peekChar(A)==="="&&(this.extract(A,this.consume,"="),Ne.val=this.extract(A,this.consumeTill,";")),G.params.push(Ne)}}try{this.extract(A,this.consume,";")}catch{break}}}this.attributes.rids.push(G)}parseSimulcast(A){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=A.attValue,this.extract(A,this.consumeTill)}parseSctpPort(A){this.attributes.sctpPort=this.extractOneOrMore(A,T,[1,5])}parseMaxMessageSize(A){this.attributes.maxMessageSize=this.extractOneOrMore(A,T,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(A){this.attributes.mid=this.extract(A,this.consumeToken)}parseSSRCGroup(A){const U=this.extract(A,this.consumeToken),G=[];for(;;)try{this.consumeAttributeSpace(A);const re=this.extract(A,this.consumeInteger);G.push(parseInt(re,10))}catch{break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:G})}}function J(ce,A,U){return A in ce?Object.defineProperty(ce,A,{value:U,enumerable:!0,configurable:!0,writable:!0}):ce[A]=U,ce}class ne{constructor(){J(this,"eol",p)}print(A,U){let G="";return U&&(this.eol=U),G+=this.printVersion(A.version),G+=this.printOrigin(A.origin),G+=this.printSessionName(A.sessionName),G+=this.printInformation(A.information),G+=this.printUri(A.uri),G+=this.printEmail(A.emails),G+=this.printPhone(A.phones),G+=this.printConnection(A.connection),G+=this.printBandwidth(A.bandwidths),G+=this.printTimeFields(A.timeFields),G+=this.printKey(A.key),G+=this.printSessionAttributes(A.attributes),G+=this.printMediaDescription(A.mediaDescriptions),G}printVersion(A){return"v=".concat(A).concat(this.eol)}printOrigin(A){return"o=".concat(A.username," ").concat(A.sessId," ").concat(A.sessVersion," ").concat(A.nettype," ").concat(A.addrtype," ").concat(A.unicastAddress).concat(this.eol)}printSessionName(A){return A?"s=".concat(A).concat(this.eol):""}printInformation(A){return A?"i=".concat(A).concat(this.eol):""}printUri(A){return A?"u=".concat(A).concat(this.eol):""}printEmail(A){let U="";for(const G of A)U+="e=".concat(G).concat(this.eol);return U}printPhone(A){let U="";for(const G of A)U+="e=".concat(G).concat(this.eol);return U}printConnection(A){return A?"c=".concat(A.nettype," ").concat(A.addrtype," ").concat(A.address).concat(this.eol):""}printBandwidth(A){let U="";for(const G of A)U+="b=".concat(G.bwtype,":").concat(G.bandwidth).concat(this.eol);return U}printTimeFields(A){let U="";for(const G of A){U+="t=".concat(G.time.startTime," ").concat(G.time.startTime).concat(this.eol);for(const re of G.repeats)U+="r=".concat(re.repeatInterval," ").concat(re.typedTimes.join(" ")).concat(this.eol);G.zoneAdjustments&&(U+="z=",U+="z=".concat(G.zoneAdjustments.map(re=>"".concat(re.time," ").concat(re.back?"-":""," ").concat(re.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(A){return A?"k=".concat(A).concat(this.eol):""}printAttributes(A){let U="";for(const G of A)U+="a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol);return U}printMediaDescription(A){let U="";for(const G of A)U+=this.printMedia(G.media),U+=this.printInformation(G.information),U+=this.printConnections(G.connections),U+=this.printBandwidth(G.bandwidths),U+=this.printKey(G.key),U+=this.printMediaAttributes(G);return U}printConnections(A){let U="";for(const G of A)U+=this.printConnection(G);return U}printMedia(A){return"m=".concat(A.mediaType," ").concat(A.port," ").concat(A.protos.join("/")," ").concat(A.fmts.join(" ")).concat(this.eol)}printSessionAttributes(A){return new Z(this.eol).print(A)}printMediaAttributes(A){return new se(this.eol).print(A)}}class ${constructor(A){J(this,"eol",void 0),this.eol=A}printIceUfrag(A){return A===void 0?"":"a=ice-ufrag:".concat(A).concat(this.eol)}printIcePwd(A){return A===void 0?"":"a=ice-pwd:".concat(A).concat(this.eol)}printIceOptions(A){return A===void 0?"":"a=ice-options:".concat(A.join(E)).concat(this.eol)}printFingerprints(A){return A.length>0?A.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(E).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(A){return A.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(E).concat(U.extensionName).concat(U.extensionAttributes?"".concat(E).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(A){return A===void 0?"":"a=setup:".concat(A).concat(this.eol)}printUnrecognized(A){return A.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class Z extends ${print(A){let U="";return U+=this.printGroups(A.groups),U+=this.printMsidSemantic(A.msidSemantic),U+=this.printIceLite(A.iceLite),U+=this.printIceUfrag(A.iceUfrag),U+=this.printIcePwd(A.icePwd),U+=this.printIceOptions(A.iceOptions),U+=this.printFingerprints(A.fingerprints),U+=this.printSetup(A.setup),U+=this.printTlsId(A.tlsId),U+=this.printIdentity(A.identities),U+=this.printExtmap(A.extmaps),U+=this.printUnrecognized(A.unrecognized),U}printGroups(A){let U="";return A.length>0&&(U+=A.map(G=>"a=group:".concat(G.semantic).concat(G.identificationTag.map(re=>"".concat(E).concat(re)).join("")).concat(this.eol)).join("")),U}printIceLite(A){return A===void 0?"":"a=ice-lite"+this.eol}printTlsId(A){return A?"a=tls-id:".concat(A).concat(this.eol):""}printIdentity(A){return A.length===0?"":A.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(G=>"".concat(E).concat(G.name).concat(G.value?"=".concat(G.value):"")))).join(this.eol)+this.eol}printMsidSemantic(A){if(!A)return"";let U="a=msid-semantic:".concat(A.semantic);return A.applyForAll?U+="".concat(E,"*"):A.identifierList.length>0&&(U+=A.identifierList.map(G=>"".concat(E).concat(G))),U+this.eol}}class se extends ${print(A){const U=A.attributes;let G="";return G+=this.printRTCP(U.rtcp),G+=this.printIceUfrag(U.iceUfrag),G+=this.printIcePwd(U.icePwd),G+=this.printIceOptions(U.iceOptions),G+=this.printCandidates(U.candidates),G+=this.printRemoteCandidatesList(U.remoteCandidatesList),G+=this.printEndOfCandidates(U.endOfCandidates),G+=this.printFingerprints(U.fingerprints),G+=this.printSetup(U.setup),G+=this.printMid(U.mid),G+=this.printExtmap(U.extmaps),G+=this.printRTPRelated(U),G+=this.printPtime(U.ptime),G+=this.printMaxPtime(U.maxPtime),G+=this.printDirection(U.direction),G+=this.printSSRCGroups(U.ssrcGroups),G+=this.printSSRC(U.ssrcs),G+=this.printRTCPMux(U.rtcpMux),G+=this.printRTCPMuxOnly(U.rtcpMuxOnly),G+=this.printRTCPRsize(U.rtcpRsize),G+=this.printMSId(U.msids),G+=this.printImageattr(U.imageattr),G+=this.printRid(U.rids),G+=this.printSimulcast(U.simulcast),G+=this.printSCTPPort(U.sctpPort),G+=this.printMaxMessageSize(U.maxMessageSize),G+=this.printUnrecognized(U.unrecognized),G}printCandidates(A){return A.map(U=>"a=candidate:".concat(U.foundation).concat(E).concat(U.componentId).concat(E).concat(U.transport).concat(E).concat(U.priority).concat(E).concat(U.connectionAddress).concat(E).concat(U.port).concat(E,"typ").concat(E).concat(U.type).concat(U.relAddr?"".concat(E,"raddr").concat(E).concat(U.relAddr):"").concat(U.relPort?"".concat(E,"rport").concat(E).concat(U.relPort):"").concat(Object.keys(U.extension).map(G=>"".concat(E).concat(G).concat(E).concat(U.extension[G])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(A){return A.map(U=>"a=remote-candidates:".concat(U.join(E)).concat(this.eol)).join("")}printEndOfCandidates(A){return A===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(A){if(!A.payloads)return"";const U=A.payloads;let G="";G+=A.rtcpFeedbackWildcards.map(re=>this.printRTCPFeedback("*",re)).join("");for(const re of U)G+=this.printRtpMap(re.payloadType,re.rtpMap),G+=this.printFmtp(re.payloadType,re.fmtp),G+=re.rtcpFeedbacks.map(Ne=>this.printRTCPFeedback(re.payloadType,Ne)).join("");return G}printFmtp(A,U){if(!U)return"";const G=Object.keys(U.parameters);return G.length===1&&U.parameters[G[0]]===null?"a=fmtp:".concat(A).concat(E).concat(G[0]).concat(this.eol):"a=fmtp:".concat(A).concat(E).concat(Object.keys(U.parameters).map(re=>"".concat(re,"=").concat(U.parameters[re])).join(";")).concat(this.eol)}printRtpMap(A,U){return U?"a=rtpmap:".concat(A).concat(E).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(A,U){let G="a=rtcp-fb:".concat(A).concat(E),re=U;switch(re.type){case"trr-int":G+="ttr-int".concat(E).concat(re.interval);break;case"ack":case"nack":default:re=re,G+="".concat(re.type),re.parameter&&(G+="".concat(E).concat(re.parameter),re.additional&&(G+="".concat(E).concat(re.additional)))}return G+this.eol}printPtime(A){return A===void 0?"":"a=ptime:".concat(A).concat(this.eol)}printMaxPtime(A){return A===void 0?"":"a=maxptime:".concat(A).concat(this.eol)}printDirection(A){return A===void 0?"":"a=".concat(A).concat(this.eol)}printSSRC(A){return A.map(U=>Object.keys(U.attributes).map(G=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(E).concat(G).concat(U.attributes[G]?":".concat(U.attributes[G]):"").concat(this.eol)).join("")).join("")}printRTCPMux(A){return A===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(A){return A===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(A){return A===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(A){if(A===void 0)return"";let U="a=rtcp:".concat(A.port);return A.netType&&(U+="".concat(E).concat(A.netType)),A.addressType&&(U+="".concat(E).concat(A.addressType)),A.address&&(U+="".concat(E).concat(A.address)),U+this.eol}printMSId(A){return A.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(E).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(A){return A.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(A){return A.map(U=>{let G="a=rid:".concat(U.id).concat(E).concat(U.direction);return U.payloads&&(G+="".concat(E,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(G+="".concat(E).concat(U.params.map(re=>re.type==="depend"?"depend=".concat(re.rids.join(",")):"".concat(re.type,"=").concat(re.val)).join(";"))),G+this.eol}).join("")}printSimulcast(A){return A===void 0?"":"a=simulcast:".concat(A).concat(this.eol)}printSCTPPort(A){return A===void 0?"":"a=sctp-port:".concat(A).concat(this.eol)}printMaxMessageSize(A){return A===void 0?"":"a=max-message-size:".concat(A).concat(this.eol)}printMid(A){return A===void 0?"":"a=mid:".concat(A).concat(this.eol)}printSSRCGroups(A){return A.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(G=>"".concat(E).concat(G.toString(10))).join("")).concat(this.eol)).join("")}}function pe(ce){return new Ce().parse(ce)}function Oe(ce,A){return new ne().print(ce,A)}}},a={};function u(d){if(a[d])return a[d].exports;var h=a[d]={exports:{}};return s[d](h,h.exports,u),h.exports}return u.d=(d,h)=>{for(var m in h)u.o(h,m)&&!u.o(d,m)&&Object.defineProperty(d,m,{enumerable:!0,get:h[m]})},u.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),u.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},u(8)})()})(ln);class Rre{constructor(i){C(this,"sessionDesc",void 0),C(this,"localCapabilities",void 0),C(this,"rtpCapabilities",void 0),C(this,"candidates",void 0),C(this,"iceParameters",void 0),C(this,"dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),i=cn(i);const{remoteIceParameters:s,remoteDtlsParameters:a,candidates:u,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:m,sdkCodec:g,cname:p}=i,E=ln.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=u,this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=p;for(let v=0;v<E.mediaDescriptions.length;v++){const T=E.mediaDescriptions[v];if(T.attributes.iceUfrag=s.iceUfrag,T.attributes.icePwd=s.icePwd,T.attributes.fingerprints=a.fingerprints,T.attributes.candidates=u,T.attributes.setup=h,T.media.mediaType==="video"){T.media.fmts=d.videoCodecs.map(O=>O.payloadType.toString(10));const I=d.videoCodecs.filter(O=>{var N;return(N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase().includes(g)});if(I.length===0)throw new Error("Codec ".concat(g," not supported by remote SDP."));T.attributes.payloads=I,T.attributes.extmaps=d.videoExtensions}T.media.mediaType==="audio"&&(T.media.fmts=d.audioCodecs.map(I=>I.payloadType.toString(10)),T.attributes.payloads=d.audioCodecs,T.attributes.extmaps=d.audioExtensions),E.mediaDescriptions[v]=this.mungMediaDesc(T)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return ln.exports.print(this.sessionDesc)}send(i,s,a){const{ssrcs:u,ssrcGroups:d}=Ji(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(p=>i===Be.VIDEO?p.media.mediaType==="video":p.media.mediaType==="audio"),m=u[0].attributes.label,g=u[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(u),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:g}}batchSend(i){return i.map(s=>{let{kind:a,ssrcMsg:u}=s;return this.send(a,u,void 0)})}stopSending(i){this.sessionDesc.mediaDescriptions.forEach(s=>{const a=[],u=[],d=[];s.attributes.ssrcs.forEach(h=>{i.includes(h.attributes.label||"")?d.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{d.map(m=>m.ssrcId).includes(h.ssrcIds[0])||u.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=u})}mute(i){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(i){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(i,s,a){i.forEach((u,d)=>{const h=u._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===h.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],u);this.sessionDesc.mediaDescriptions[m]=g})}stopReceiving(i){}restartICE(i){i=cn(i),this.iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=i.iceUfrag,s.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const s=[];for(let a=0;a<i;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(i,s){const a=cn(i);return ed(a,s),nR(a,s),a}updateRecvMedia(i,s){const a=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===i);if(a!==-1){const u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=u}}bumpMid(i){this.currentMidIndex+=i}updateTrackLabel(i,s,a){const u=this.sessionDesc.mediaDescriptions.find(h=>i===Be.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(u){const h=u.attributes.ssrcs.find(m=>m.attributes.label===s);var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(i){const s=cn(i);return tR(s),function(a){const u=a.attributes.extmaps.find(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");u&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(u),1),a.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(i){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===i)return[a]}}function Cs(r){if(Array.isArray(r))return r.map(function(a){return a});if(!QU(r))return r;var i={};for(var s in r)QU(r[s])||Array.isArray(r[s])?i[s]=Cs(r[s]):i[s]=r[s];return i}function QU(r){return!(typeof r!="object"||Array.isArray(r)||!r)}var iR=function(){function r(i){this.input=[],this.size=i}return r.prototype.add=function(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)},r.prototype.diffMean=function(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},r}(),ZU=function(r,i){return(ZU=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var u in a)a.hasOwnProperty(u)&&(s[u]=a[u])})(r,i)};/*! *****************************************************************************
		Copyright (c) Microsoft Corporation. All rights reserved.
		Licensed under the Apache License, Version 2.0 (the "License"); you may not use
		this file except in compliance with the License. You may obtain a copy of the
		License at http://www.apache.org/licenses/LICENSE-2.0

		THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
		KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
		WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
		MERCHANTABLITY OR NON-INFRINGEMENT.

		See the Apache Version 2.0 License for specific language governing permissions
		and limitations under the License.
		***************************************************************************** */function sR(r,i){function s(){this.constructor=r}ZU(r,i),r.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}var yu=function(){return(yu=Object.assign||function(r){for(var i,s=1,a=arguments.length;s<a;s++)for(var u in i=arguments[s])Object.prototype.hasOwnProperty.call(i,u)&&(r[u]=i[u]);return r}).apply(this,arguments)};function oR(r,i,s,a){return new(s||(s=Promise))(function(u,d){function h(p){try{g(a.next(p))}catch(E){d(E)}}function m(p){try{g(a.throw(p))}catch(E){d(E)}}function g(p){p.done?u(p.value):new s(function(E){E(p.value)}).then(h,m)}g((a=a.apply(r,i||[])).next())})}function aR(r,i){var s,a,u,d,h={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return d={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function m(g){return function(p){return function(E){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,a&&(u=2&E[0]?a.return:E[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,E[1])).done)return u;switch(a=0,u&&(E=[2&E[0],u.value]),E[0]){case 0:case 1:u=E;break;case 4:return h.label++,{value:E[1],done:!1};case 5:h.label++,a=E[1],E=[0];continue;case 7:E=h.ops.pop(),h.trys.pop();continue;default:if(u=h.trys,!((u=u.length>0&&u[u.length-1])||E[0]!==6&&E[0]!==2)){h=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){h.label=E[1];break}if(E[0]===6&&h.label<u[1]){h.label=u[1],u=E;break}if(u&&h.label<u[2]){h.label=u[2],h.ops.push(E);break}u[2]&&h.ops.pop(),h.trys.pop();continue}E=i.call(r,h)}catch(v){E=[6,v],a=0}finally{s=u=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([g,p])}}}var As,e3={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},hp={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:e3,remoteCandidate:e3}},t3={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},n3={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},r3={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},i3={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0},cR=function(){function r(i,s){var a=this;this.videoIsReady=!1,this.videoIsReady2={},this.stats=Cs(hp),this.isFirstVideoReceived={},this.isFirstVideoDecoded={},this.isFirstAudioReceived={},this.isFirstAudioDecoded={},this.lossRateWindowStats=[],this.pc=i,this.options=s,this.intervalTimer=window.setInterval(function(){return oR(a,void 0,void 0,function(){return aR(this,function(u){return this.updateStats(),[2]})})},this.options.updateInterval)}return r.prototype.getStats=function(){return this.stats},r.prototype.setVideoIsReady=function(i){this.videoIsReady=i},r.prototype.setVideoIsReady2=function(i,s){this.videoIsReady2[i]=s},r.prototype.getVideoIsReady=function(i){return this.videoIsReady2[i]||!1},r.prototype.setIsFirstAudioDecoded=function(i){},r.prototype.destroy=function(){window.clearInterval(this.intervalTimer),this.pc=void 0},r.prototype.calcLossRate=function(i){var s=this;this.lossRateWindowStats.push(i),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var a=this.lossRateWindowStats.length,u=0,d=0,h=0,m=0,g=function(v){i[v].forEach(function(T,I){if(s.lossRateWindowStats[a-1][v][I]&&s.lossRateWindowStats[0][v][I]){var O=s.lossRateWindowStats[a-1][v][I].packets-s.lossRateWindowStats[0][v][I].packets,N=s.lossRateWindowStats[a-1][v][I].packetsLost-s.lossRateWindowStats[0][v][I].packetsLost;v==="videoSend"||v==="audioSend"?(u+=O,h+=N):(d+=O,m+=N),Number.isNaN(O)||Number.isNaN(O)?T.packetLostRate=0:T.packetLostRate=O<=0||N<=0?0:N/(O+N)}})},p=0,E=["videoSend","audioSend","videoRecv","audioRecv"];p<E.length;p++)g(E[p]);i.sendPacketLossRate=u<=0||h<=0?0:h/(u+h),i.recvPacketLossRate=d<=0||m<=0?0:m/(d+m)},r}(),Ire=function(r){function i(){var s=r!==null&&r.apply(this,arguments)||this;return s._stats=hp,s.lastDecodeVideoReceiverStats=new Map,s}return sR(i,r),i.prototype.updateStats=function(){return oR(this,void 0,void 0,function(){var s,a,u,d;return aR(this,function(h){switch(h.label){case 0:return[4,this._getStats()];case 1:return s=h.sent(),a=this.statsResponsesToObjects(s),this._stats=Cs(hp),u=a.filter(function(m){return m.type==="ssrc"}),this.processSSRCStats(u),(d=a.find(function(m){return m.type==="VideoBwe"}))&&this.processBandwidthStats(d),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},i.prototype.processBandwidthStats=function(s){this._stats.bitrate={actualEncoded:Number(s.googActualEncBitrate),targetEncoded:Number(s.googTargetEncBitrate),retransmit:Number(s.googRetransmitBitrate),transmit:Number(s.googTransmitBitrate)},this._stats.sendBandwidth=Number(s.googAvailableSendBandwidth)},i.prototype.processSSRCStats=function(s){var a=this;s.forEach(function(u){var d=u.id.includes("send");switch("".concat(u.mediaType,"_").concat(d?"send":"recv")){case"video_send":var h=Cs(n3);h.codec=u.googCodecName,h.adaptionChangeReason="none",u.googCpuLimitedResolution&&(h.adaptionChangeReason="cpu"),u.googBandwidthLimitedResolution&&(h.adaptionChangeReason="bandwidth"),h.avgEncodeMs=Number(u.googAvgEncodeMs),h.inputFrame={width:Number(u.googFrameWidthInput)||Number(u.googFrameWidthSent),height:Number(u.googFrameHeightInput)||Number(u.googFrameHeightSent),frameRate:Number(u.googFrameRateInput)},h.sentFrame={width:Number(u.googFrameWidthSent),height:Number(u.googFrameHeightSent),frameRate:Number(u.googFrameRateInput)},h.firsCount=Number(u.googFirReceived),h.nacksCount=Number(u.googNacksReceived),h.plisCount=Number(u.googPlisReceived),h.frameCount=Number(u.framesEncoded),h.bytes=Number(u.bytesSent),h.packets=Number(u.packetsSent),h.packetsLost=Number(u.packetsLost),h.ssrc=Number(u.ssrc),h.rttMs=Number(u.googRtt||0),a._stats.videoSend.push(h),a._stats.rtt=h.rttMs;break;case"video_recv":var m=Cs(t3),g=a.lastDecodeVideoReceiverStats.get(Number(u.ssrc));if(m.codec=u.googCodecName,m.targetDelayMs=Number(u.googTargetDelayMs),m.renderDelayMs=Number(u.googRenderDelayMs),m.currentDelayMs=Number(u.googCurrentDelayMs),m.minPlayoutDelayMs=Number(u.googMinPlayoutDelayMs),m.decodeMs=Number(u.googDecodeMs),m.maxDecodeMs=Number(u.googMaxDecodeMs),m.receivedFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateReceived)},m.decodedFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateDecoded)},m.decodeFrameRate=Number(u.googFrameRateDecoded),m.outputFrame={width:Number(u.googFrameWidthReceived),height:Number(u.googFrameHeightReceived),frameRate:Number(u.googFrameRateOutput)},m.jitterBufferMs=Number(u.googJitterBufferMs),m.firsCount=Number(u.googFirsSent),m.nacksCount=Number(u.googNacksSent),m.plisCount=Number(u.googPlisSent),m.framesDecodeCount=Number(u.framesDecoded),m.bytes=Number(u.bytesReceived),m.packets=Number(u.packetsReceived),m.packetsLost=Number(u.packetsLost),m.ssrc=Number(u.ssrc),m.packets>0&&!a.isFirstVideoReceived[m.ssrc]&&(a.onFirstVideoReceived&&a.onFirstVideoReceived(m.ssrc),a.isFirstVideoReceived[m.ssrc]=!0),m.framesDecodeCount>0&&!a.isFirstVideoDecoded[m.ssrc]&&(a.onFirstVideoDecoded&&a.onFirstVideoDecoded(m.ssrc,m.decodedFrame.width,m.decodedFrame.height),a.isFirstVideoDecoded[m.ssrc]=!0),g){var p=g.stats,E=Date.now()-g.lts;m.framesDecodeFreezeTime=p.framesDecodeFreezeTime,m.framesDecodeInterval=p.framesDecodeInterval,m.framesDecodeCount>p.framesDecodeCount&&a.isFirstVideoDecoded[m.ssrc]?(g.lts=Date.now(),m.framesDecodeInterval=E,m.framesDecodeInterval>=a.options.freezeRateLimit&&(a.getVideoIsReady(parseInt(u.ssrc,10))?m.framesDecodeFreezeTime+=m.framesDecodeInterval:a.setVideoIsReady2(parseInt(u.ssrc,10),!0))):m.framesDecodeCount<g.stats.framesDecodeCount&&(m.framesDecodeInterval=0)}a.lastDecodeVideoReceiverStats.set(m.ssrc,{stats:yu({},m),lts:Date.now()}),a._stats.videoRecv.push(m);break;case"audio_recv":var v=Cs(i3);v.codec=u.googCodecName,v.outputLevel=Math.abs(Number(u.audioOutputLevel))/32767,v.decodingCNG=Number(u.googDecodingCNG),v.decodingCTN=Number(u.googDecodingCTN),v.decodingCTSG=Number(u.googDecodingCTSG),v.decodingNormal=Number(u.googDecodingNormal),v.decodingPLC=Number(u.googDecodingPLC),v.decodingPLCCNG=Number(u.googDecodingPLCCNG),v.expandRate=Number(u.googExpandRate),v.accelerateRate=Number(u.googAccelerateRate),v.preemptiveExpandRate=Number(u.googPreemptiveExpandRate),v.secondaryDecodedRate=Number(u.googSecondaryDecodedRate),v.speechExpandRate=Number(u.googSpeechExpandRate),v.preferredJitterBufferMs=Number(u.googPreferredJitterBufferMs),v.jitterBufferMs=Number(u.googJitterBufferMs),v.jitterMs=Number(u.googJitterReceived),v.bytes=Number(u.bytesReceived),v.packets=Number(u.packetsReceived),v.packetsLost=Number(u.packetsLost),v.ssrc=Number(u.ssrc),v.receivedFrames=Number(u.googDecodingCTN)||Number(u.packetsReceived),v.droppedFrames=Number(u.googDecodingPLC)+Number(u.googDecodingPLCCNG)||Number(u.packetsLost),v.receivedFrames>0&&!a.isFirstAudioReceived[v.ssrc]&&(a.onFirstAudioReceived&&a.onFirstAudioReceived(v.ssrc),a.isFirstAudioReceived[v.ssrc]=!0),v.decodingNormal>0&&!a.isFirstAudioDecoded[v.ssrc]&&(a.onFirstAudioDecoded&&a.onFirstAudioDecoded(v.ssrc),a.isFirstAudioDecoded[v.ssrc]=!0),a._stats.audioRecv.push(v);break;case"audio_send":var T=Cs(r3);T.codec=u.googCodecName,T.inputLevel=Math.abs(Number(u.audioInputLevel))/32767,T.aecReturnLoss=Number(u.googEchoCancellationReturnLoss||0),T.aecReturnLossEnhancement=Number(u.googEchoCancellationReturnLossEnhancement||0),T.residualEchoLikelihood=Number(u.googResidualEchoLikelihood||0),T.residualEchoLikelihoodRecentMax=Number(u.googResidualEchoLikelihoodRecentMax||0),T.bytes=Number(u.bytesSent),T.packets=Number(u.packetsSent),T.packetsLost=Number(u.packetsLost),T.ssrc=Number(u.ssrc),T.rttMs=Number(u.googRtt||0),a._stats.rtt=T.rttMs,a._stats.audioSend.push(T)}})},i.prototype._getStats=function(){var s=this;return new Promise(function(a,u){s.pc.getStats(a,u)})},i.prototype.statsResponsesToObjects=function(s){var a=[];return s.result().forEach(function(u){var d={id:u.id,timestamp:u.timestamp.valueOf().toString(),type:u.type};u.names().forEach(function(h){d[h]=u.stat(h)}),a.push(d)}),a},i}(cR);(function(r){r.CERTIFICATE="certificate",r.CODEC="codec",r.CANDIDATE_PAIR="candidate-pair",r.LOCAL_CANDIDATE="local-candidate",r.REMOTE_CANDIDATE="remote-candidate",r.INBOUND="inbound-rtp",r.TRACK="track",r.OUTBOUND="outbound-rtp",r.PC="peer-connection",r.REMOTE_INBOUND="remote-inbound-rtp",r.REMOTE_OUTBOUND="remote-outbound-rtp",r.TRANSPORT="transport",r.CSRC="csrc",r.DATA_CHANNEL="data-channel",r.STREAM="stream",r.SENDER="sender",r.RECEIVER="receiver"})(As||(As={}));var wt,s3=function(r){function i(){var s=r!==null&&r.apply(this,arguments)||this;return s._stats=hp,s.lastDecodeVideoReceiverStats=new Map,s.lastVideoFramesRecv=new Map,s.lastVideoFramesSent=new Map,s.lastVideoFramesDecode=new Map,s.lastVideoJBDelay=new Map,s.lastAudioJBDelay=new Map,s.mediaBytesSent=new Map,s.mediaBytesRetransmit=new Map,s.mediaBytesTargetEncode=new Map,s.lastEncoderMs=new Map,s}return sR(i,r),i.prototype.updateStats=function(){return oR(this,void 0,void 0,function(){var s,a=this;return aR(this,function(u){switch(u.label){case 0:return s=this,[4,this.pc.getStats()];case 1:return s.report=u.sent(),this._stats=Cs(hp),this.report.forEach(function(d){switch(d.type){case As.OUTBOUND:d.mediaType==="audio"?a.processAudioOutboundStats(d):d.mediaType==="video"&&a.processVideoOutboundStats(d);break;case As.INBOUND:d.mediaType==="audio"?a.processAudioInboundStats(d):d.mediaType==="video"&&a.processVideoInboundStats(d);break;case As.TRANSPORT:var h=a.report.get(d.selectedCandidatePairId);h&&a.processCandidatePairStats(h);break;case As.CANDIDATE_PAIR:d.selected&&a.processCandidatePairStats(d)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},i.prototype.processCandidatePairStats=function(s){if(this._stats.sendBandwidth=s.availableOutgoingBitrate||0,s.currentRoundTripTime&&(this._stats.rtt=1e3*s.currentRoundTripTime),this._stats.videoSend.forEach(function(d){!d.rttMs&&s.currentRoundTripTime&&(d.rttMs=1e3*s.currentRoundTripTime)}),this._stats.audioSend.forEach(function(d){!d.rttMs&&s.currentRoundTripTime&&(d.rttMs=1e3*s.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=s.id,s.localCandidateId){var a=this.report.get(s.localCandidateId);a&&this.processCandidateStats(a)}if(s.remoteCandidateId){var u=this.report.get(s.remoteCandidateId);u&&this.processCandidateStats(u)}},i.prototype.processCandidateStats=function(s){var a;s.type===As.LOCAL_CANDIDATE&&(a=this._stats.selectedCandidatePair.localCandidate),s.type===As.REMOTE_CANDIDATE&&(a=this._stats.selectedCandidatePair.remoteCandidate),a&&(a.type=s.type,a.id=s.id,s.address&&(a.address=s.address),s.candidateType&&(a.candidateType=s.candidateType),s.port&&(a.port=s.port),s.priority&&(a.priority=s.priority),s.protocol&&(a.protocol=s.protocol),s.relayProtocol&&(a.relayProtocol=s.relayProtocol),s.type===As.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==a.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(yu({},a),yu({},this.stats.selectedCandidatePair.localCandidate)),s.type===As.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==a.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(yu({},a),yu({},this.stats.selectedCandidatePair.remoteCandidate)))},i.prototype.processAudioInboundStats=function(s){var a=this._stats.audioRecv.find(function(u){return u.ssrc===s.ssrc});a||(a=Cs(i3),this._stats.audioRecv.push(a)),a.ssrc=s.ssrc,a.packets=s.packetsReceived,a.packetsLost=s.packetsLost,a.bytes=s.bytesReceived,a.jitterMs=1e3*s.jitter,this.processAudioTrackReceiverStats(s,s.trackId,a),s.codecId&&(a.codec=this.getCodecFromCodecStats(s.codecId)),a.receivedFrames||(a.receivedFrames=s.packetsReceived),a.droppedFrames||(a.droppedFrames=s.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.outputLevel&&a.outputLevel>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),typeof s.concealedSamples=="number"&&(a.concealedSamples=s.concealedSamples)},i.prototype.processVideoInboundStats=function(s){var a=this._stats.videoRecv.find(function(v){return v.ssrc===s.ssrc});a||(a=Cs(t3),this._stats.videoRecv.push(a)),a.ssrc=s.ssrc,a.packets=s.packetsReceived,a.packetsLost=s.packetsLost,a.bytes=s.bytesReceived,a.firsCount=s.firCount,a.nacksCount=s.nackCount,a.plisCount=s.pliCount,a.framesDecodeCount=s.framesDecoded,a.totalInterFrameDelay=s.totalInterFrameDelay,a.totalSquaredInterFrameDelay=s.totalSquaredInterFrameDelay;var u=this.lastDecodeVideoReceiverStats.get(a.ssrc),d=this.lastVideoFramesDecode.get(a.ssrc),h=Date.now();if(a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]){var m=a.decodedFrame?a.decodedFrame.width:0,g=a.decodedFrame?a.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,m,g),this.isFirstVideoDecoded[a.ssrc]=!0}if(u){var p=u.stats,E=h-u.lts;a.framesDecodeFreezeTime=p.framesDecodeFreezeTime,a.framesDecodeInterval=p.framesDecodeInterval,!this.isFirstVideoDecoded[a.ssrc]&&E>this.options.firstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(a.ssrc),a.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(u.lts=Date.now(),a.framesDecodeInterval=E,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(s.ssrc))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(s.ssrc,10),!0))):a.framesDecodeCount<p.framesDecodeCount&&(a.framesDecodeInterval=0),s.framesDecoded&&s.qpSum&&(u.stats.framesDecodeCount>s.framesDecoded?a.qpSumPerFrame=s.qpSum/s.framesDecoded:a.qpSumPerFrame=(s.qpSum-u.qpSum)/(s.framesDecoded-u.stats.framesDecodeCount))}d&&h-d.lts>=800?(a.decodeFrameRate=Math.round((a.framesDecodeCount-d.count)/((h-d.lts)/1e3)),this.lastVideoFramesDecode.set(a.ssrc,{count:a.framesDecodeCount,lts:h,rate:a.decodeFrameRate})):d?a.decodeFrameRate=d.rate:this.lastVideoFramesDecode.set(a.ssrc,{count:a.framesDecodeCount,lts:h,rate:0}),s.totalDecodeTime&&(a.decodeMs=1e3*s.totalDecodeTime),this.processVideoTrackReceiverStats(s,s.trackId,a),s.codecId&&(a.codec=this.getCodecFromCodecStats(s.codecId)),s.framerateMean&&(a.framesRateFirefox=s.framerateMean),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:yu({},a),lts:u?u.lts:Date.now(),qpSum:s.qpSum})},i.prototype.processVideoOutboundStats=function(s){var a=this._stats.videoSend.find(function(T){return T.ssrc===s.ssrc});a||(a=Cs(n3),this._stats.videoSend.push(a));var u,d=this.mediaBytesSent.get(s.ssrc);if(d?d.add(s.bytesSent):((m=new iR(10)).add(s.bytesSent),this.mediaBytesSent.set(s.ssrc,m)),s.retransmittedBytesSent!==void 0){var h=this.mediaBytesRetransmit.get(s.ssrc);h?h.add(s.retransmittedBytesSent):((m=new iR(10)).add(s.retransmittedBytesSent),this.mediaBytesRetransmit.set(s.ssrc,m))}if(s.totalEncodedBytesTarget){var m,g=this.mediaBytesTargetEncode.get(s.ssrc);g?g.add(s.totalEncodedBytesTarget):((m=new iR(10)).add(s.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(s.ssrc,m))}if(a.ssrc=s.ssrc,a.bytes=s.bytesSent,a.packets=s.packetsSent,a.firsCount=s.firCount,a.nacksCount=s.nackCount,a.plisCount=s.pliCount,a.frameCount=s.framesEncoded,a.adaptionChangeReason=s.qualityLimitationReason,s.totalEncodeTime&&s.framesEncoded)if(!(u=this.lastEncoderMs.get(s.ssrc))||u.lastFrameCount>s.framesEncoded)a.avgEncodeMs=1e3*s.totalEncodeTime/s.framesEncoded;else{var p=s.framesEncoded-u.lastFrameCount,E=s.totalEncodeTime-u.lastEncoderTime;a.avgEncodeMs=1e3*E/p}if(s.framesEncoded&&s.qpSum&&(!(u=this.lastEncoderMs.get(s.ssrc))||u.lastFrameCount>s.framesEncoded?a.qpSumPerFrame=s.qpSum/s.framesEncoded:a.qpSumPerFrame=(s.qpSum-u.lastQpSum)/(s.framesEncoded-u.lastFrameCount)),this.lastEncoderMs.set(s.ssrc,{lastFrameCount:s.framesEncoded,lastEncoderTime:s.totalEncodeTime,lastQpSum:s.qpSum,lts:Date.now()}),s.codecId&&(a.codec=this.getCodecFromCodecStats(s.codecId)),s.mediaSourceId&&this.processVideoMediaSource(s.mediaSourceId,a),this.processVideoTrackSenderStats(s,s.trackId,a),s.remoteId)this.processRemoteInboundStats(s.remoteId,a);else{var v=this.findRemoteStatsId(s.ssrc,As.REMOTE_INBOUND);v&&this.processRemoteInboundStats(v,a)}},i.prototype.processAudioOutboundStats=function(s){var a=this._stats.audioSend.find(function(d){return d.ssrc===s.ssrc});if(a||(a=Cs(r3),this._stats.audioSend.push(a)),a.ssrc=s.ssrc,a.packets=s.packetsSent,a.bytes=s.bytesSent,s.mediaSourceId&&this.processAudioMediaSource(s.mediaSourceId,a),s.codecId&&(a.codec=this.getCodecFromCodecStats(s.codecId)),this.processAudioTrackSenderStats(s,s.trackId,a),s.remoteId)this.processRemoteInboundStats(s.remoteId,a);else{var u=this.findRemoteStatsId(s.ssrc,As.REMOTE_INBOUND);u&&this.processRemoteInboundStats(u,a)}},i.prototype.findRemoteStatsId=function(s,a){var u=Array.from(this.report.values()).find(function(d){return d.type===a&&d.ssrc===s});return u?u.id:null},i.prototype.processVideoMediaSource=function(s,a){var u=this.report.get(s);u&&u.width&&u.height&&u.framesPerSecond&&(a.inputFrame={width:u.width,height:u.height,frameRate:u.framesPerSecond})},i.prototype.processAudioMediaSource=function(s,a){var u=this.report.get(s);u&&(a.inputLevel=u.audioLevel)},i.prototype.processVideoTrackSenderStats=function(s,a,u){var d,h,m,g=a?this.report.get(a):void 0,p=(d=g==null?void 0:g.framesSent)!==null&&d!==void 0?d:s.framesSent,E=(h=g==null?void 0:g.frameWidth)!==null&&h!==void 0?h:s.frameWidth,v=(m=g==null?void 0:g.frameHeight)!==null&&m!==void 0?m:s.frameHeight;if(typeof p=="number"&&typeof E=="number"&&typeof v=="number"){var T=0,I=Date.now(),O=this.lastVideoFramesSent.get(u.ssrc);O&&I-O.lts>=800?(T=Math.round((p-O.count)/((I-O.lts)/1e3)),this.lastVideoFramesSent.set(u.ssrc,{count:p,lts:I,rate:T})):O?T=O.rate:this.lastVideoFramesSent.set(u.ssrc,{count:p,lts:I,rate:0}),u.sentFrame={width:E,height:v,frameRate:T}}},i.prototype.processVideoTrackReceiverStats=function(s,a,u){var d,h,m,g,p,E=a?this.report.get(a):void 0,v=(d=E==null?void 0:E.framesReceived)!==null&&d!==void 0?d:s.framesReceived,T=(h=E==null?void 0:E.frameWidth)!==null&&h!==void 0?h:s.frameWidth,I=(m=E==null?void 0:E.frameHeight)!==null&&m!==void 0?m:s.frameHeight,O=(g=E==null?void 0:E.jitterBufferDelay)!==null&&g!==void 0?g:s.jitterBufferDelay,N=(p=E==null?void 0:E.jitterBufferEmittedCount)!==null&&p!==void 0?p:s.jitterBufferEmittedCount;if(typeof v=="number"){var P=this.lastVideoFramesRecv.get(u.ssrc),L=Date.now();u.framesReceivedCount=v;var x=0;P&&L-P.lts>=800?(x=Math.round((v-P.count)/((L-P.lts)/1e3)),this.lastVideoFramesRecv.set(u.ssrc,{count:v,lts:L,rate:x})):P?x=P.rate:this.lastVideoFramesRecv.set(u.ssrc,{count:v,lts:L,rate:0}),u.receivedFrame={width:T||0,height:I||0,frameRate:x||0},u.decodedFrame={width:T||0,height:I||0,frameRate:u.decodeFrameRate||0},u.outputFrame={width:T||0,height:I||0,frameRate:u.decodeFrameRate||0}}if(O&&N){var W=this.lastVideoJBDelay.get(u.ssrc);this.lastVideoJBDelay.set(u.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:N}),W||(W={jitterBufferDelay:0,jitterBufferEmittedCount:0});var q=1e3*(O-W.jitterBufferDelay)/(N-W.jitterBufferEmittedCount);u.jitterBufferMs=q,u.currentDelayMs=Math.round(q)}},i.prototype.processAudioTrackSenderStats=function(s,a,u){var d,h,m,g,p=a?this.report.get(a):void 0,E=(h=(d=p==null?void 0:p.echoReturnLoss)!==null&&d!==void 0?d:s.echoReturnLoss)!==null&&h!==void 0?h:0,v=(g=(m=p==null?void 0:p.echoReturnLossEnhancement)!==null&&m!==void 0?m:s.echoReturnLossEnhancement)!==null&&g!==void 0?g:0;u.aecReturnLoss=E,u.aecReturnLossEnhancement=v},i.prototype.processAudioTrackReceiverStats=function(s,a,u){var d,h,m,g,p,E,v,T=a?this.report.get(a):void 0,I=(d=T==null?void 0:T.removedSamplesForAcceleration)!==null&&d!==void 0?d:s.removedSamplesForAcceleration,O=(h=T==null?void 0:T.totalSamplesReceived)!==null&&h!==void 0?h:s.totalSamplesReceived,N=(m=T==null?void 0:T.jitterBufferDelay)!==null&&m!==void 0?m:s.jitterBufferDelay,P=(g=T==null?void 0:T.jitterBufferEmittedCount)!==null&&g!==void 0?g:s.jitterBufferEmittedCount,L=(p=T==null?void 0:T.audioLevel)!==null&&p!==void 0?p:s==null?void 0:s.audioLevel,x=(E=T==null?void 0:T.totalSamplesDuration)!==null&&E!==void 0?E:s==null?void 0:s.totalSamplesDuration,W=(v=T==null?void 0:T.concealedSamples)!==null&&v!==void 0?v:s.concealedSamples;if(I&&O&&(u.accelerateRate=I/O),N&&P){var q=this.lastAudioJBDelay.get(u.ssrc);this.lastAudioJBDelay.set(u.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:P}),q||(q={jitterBufferDelay:0,jitterBufferEmittedCount:0});var X=1e3*(N-q.jitterBufferDelay)/(P-q.jitterBufferEmittedCount);u.jitterBufferMs=Math.round(X)}u.outputLevel=L;var ie=1920;x&&O&&(ie=O/x/50,u.receivedFrames=Math.round(O/ie)),W&&(u.droppedFrames=Math.round(W/ie))},i.prototype.processRemoteInboundStats=function(s,a){var u=this.report.get(s);u&&(a.packetsLost=u.packetsLost,u.roundTripTime&&(a.rttMs=1e3*u.roundTripTime))},i.prototype.getCodecFromCodecStats=function(s){var a=this.report.get(s);if(!a)return"";var u=a.mimeType.match(/\/(.*)$/);return u&&u[1]?u[1]:""},i.prototype.updateSendBitrate=function(){var s=0,a=null,u=null;this.mediaBytesSent.forEach(function(h){s+=h.diffMean()}),this.mediaBytesRetransmit.forEach(function(h){a=a===null?h.diffMean():a+h.diffMean()}),this.mediaBytesTargetEncode.forEach(function(h){u=u===null?h.diffMean():u+h.diffMean()});var d=a!==null?s-a:s;this._stats.bitrate={actualEncoded:8*d/(this.options.updateInterval/1e3),transmit:8*s/(this.options.updateInterval/1e3)},a!==null&&(this._stats.bitrate.retransmit=8*a/(this.options.updateInterval/1e3)),u!==null&&(this._stats.bitrate.targetEncoded=8*u/(this.options.updateInterval/1e3))},i}(cR),wre=function(r){function i(){return r!==null&&r.apply(this,arguments)||this}return sR(i,r),i.prototype.updateStats=function(){return Promise.resolve()},i}(cR);function uR(r,i,s,a,u){i===void 0&&(i=250),s===void 0&&(s=8),a===void 0&&(a=500),u===void 0&&(u=1e4);var d,h=(d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i))&&d[0]?Number(d[0].split("/")[1]):null;return h?h<76?new Ire(r,{updateInterval:i,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:u}):new s3(r,{updateInterval:i,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:u}):function(m){return!!window.RTCStatsReport&&m.getStats()instanceof Promise}(r)?new s3(r,{updateInterval:i,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:u}):new wre(r,{updateInterval:i,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:u})}function o3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function a3(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?o3(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):o3(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}let Cre=(ae((wt=class T_ extends Ng{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(i,s){super(i,s),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"statsFilter",void 0),C(this,"useRTX",!1),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"mutex",new Ir("P2PConnection-mutex")),this.store=s,this.peerConnection=new RTCPeerConnection(T_.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=uR(this.peerConnection,void 0,void 0,tn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(){try{const i=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=vu(i.sdp),a=eR(i.sdp,!this.useRTX,Q("FILTER_VIDEO_FEC"),Q("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=a,this.initialOffer=i,a3(a3({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:i.sdp})}catch(i){throw new j(V.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(i,s,a,u,d,h){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Rre({remoteIceParameters:i,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:u.send,remoteSetup:d,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:h});const m=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}}send(i,s){var a=this;return ws(function*(){const u=yield Xe(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=i.map(T=>a.peerConnection.addTrack(T._mediaStreamTrack)),h=yield Xe(a.peerConnection.createOffer()),m=ln.exports.parse(h.sdp),g=i.map(T=>{const I=T._mediaStreamTrack,O=m.mediaDescriptions.find(N=>N.attributes.mid===I.kind);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(N,P,L){const x=N.attributes.ssrcs.filter(q=>q.attributes.label===P),W=N.attributes.ssrcGroups;if(x.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(W&&x.length>1){const q=W.find(X=>X.ssrcIds.indexOf(x[0].ssrcId)!==-1);return q?[{ssrcId:q.ssrcIds[0],rtx:L?q.ssrcIds[1]:void 0}]:[{ssrcId:x[0].ssrcId}]}return[{ssrcId:x[0].ssrcId}]}(O,I.id,a.useRTX)});let p;try{p=yield g}catch(T){throw d.forEach(I=>{Kr()&&I.replaceTrack(null),a.peerConnection.removeTrack(I)}),T}const E=a.mungSendOfferSDP(h.sdp,i);a.remoteSDP.receive(i,s,p);const v=a.remoteSDP.toString();return yield Xe(a.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield Xe(a.applySendEncodings(d,i)),yield Xe(a.peerConnection.setRemoteDescription({type:"answer",sdp:v})),i.map((T,I)=>{const O=T._mediaStreamTrack.id;return{localSSRC:g[I],id:O}})}catch(d){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{u()}})()}async stopSending(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(d=>{var h;return i.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{Kr()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(i);const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(i,s,a,u){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(i,s,u),m=new _e((E,v)=>{const T=setTimeout(()=>{v(new Error("Cannot receive track, id: ".concat(d)))},1e4),I=O=>{const N=bt();if((N.name==="Safari"&&Number(N.version)===11||dr())&&O.track.id!==d&&O.streams[0].id===h){var P;const L=O.streams[0].getTracks()[0];return(P=this.remoteSDP)===null||P===void 0||P.updateTrackLabel(i,d,O.track.id),this.peerConnection.removeEventListener("track",I),clearTimeout(T),void E(L)}if(O.track.id===d)return this.peerConnection.removeEventListener("track",I),clearTimeout(T),void E(O.track)};this.peerConnection.addEventListener("track",I)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await m,id:d}}catch(d){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){}async unmuteRemote(i){}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(a=>{var u;return i.indexOf(((u=a.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(s.length!==i.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(Kr()&&a.track)a.track.enabled=!1;else{const u=a.getParameters();u.encodings.forEach(d=>d.active=!1),a.setParameters(u)}})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(d=>{var h;return i.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(Kr()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(m=>m.active=!0),await d.setParameters(h)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(){var i=this;return ws(function*(){const s=yield Xe(i.mutex.lock("From P2PConnection.restartICE"));try{const a=yield Xe(i.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=vu(a.sdp),{remoteIceParameters:d}=yield u.iceParameters;if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");i.remoteSDP.restartICE(d);const h=i.remoteSDP.toString();yield Xe(i.peerConnection.setLocalDescription(a)),yield Xe(i.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(a){D.warning("restart ICE failed, abort operation",a)}finally{s()}})()}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),u=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new j(V.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(i,s){const a=this.peerConnection.getSenders().filter(u=>{var d;return((d=u.track)===null||d===void 0?void 0:d.id)===i});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const a=this.peerConnection.getSenders().find(u=>{var d;return((d=u.track)===null||d===void 0?void 0:d.id)===s});a&&await a.replaceTrack(i._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Q("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(Hh(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...T_.turnServerConfigToIceServers(i.turnServer.servers)),Q("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...T_.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async applySendEncodings(i,s){try{if(!er().supportSetRtpSenderParameters||i.length!==s.length)return;for(let u=0;u<i.length;u++){var a;const d=i[u],h=s[u];if(!h)continue;const m={},g={};if(h instanceof un)switch(h._optimizationMode){case"motion":m.degradationPreference="maintain-framerate";break;case"detail":m.degradationPreference="maintain-resolution";break;default:m.degradationPreference="balanced"}if(Q("DSCP_TYPE")&&su()){const v=Q("DSCP_TYPE");["very-low","low","medium","high"].includes(v)&&(g.networkPriority=v)}const p=d.getParameters(),E=(a=p.encodings)===null||a===void 0?void 0:a[0];E&&Object.assign(E,g),Object.assign(p,m),await d.setParameters(p)}}catch{D.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(i,s){const a=ln.exports.parse(i);return s.forEach((u,d)=>{const h=u._mediaStreamTrack,m=a.mediaDescriptions.find(g=>g.attributes.mid===h.kind);m&&ed(m,u)}),ln.exports.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,a)=>{var u;(u=this.onFirstVideoDecoded)===null||u===void 0||u.call(this,i,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,i,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(i).map((d,h)=>{let{id:m,mslabel:g}=d;const{kind:p}=i[h];return new _e((E,v)=>{const T=setTimeout(()=>{v(new Error("Cannot receive track, id: ".concat(m)))},1e4),I=O=>{const N=bt();if(N.name==="Safari"&&Number(N.version)===11&&O.track.id!==m&&O.streams[0].id===g){var P;const L=O.streams[0].getTracks()[0];return(P=this.remoteSDP)===null||P===void 0||P.updateTrackLabel(p,m,O.track.id),this.peerConnection.removeEventListener("track",I),clearTimeout(T),void E({track:L,id:m})}if(O.track.id===m)return this.peerConnection.removeEventListener("track",I),clearTimeout(T),void E({track:O.track,id:m})};this.peerConnection.addEventListener("track",I)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const u=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u),await _e.all(s)}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s==null?void 0:s[0].ssrcId}}).prototype,"connect",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"connect"),wt.prototype),ae(wt.prototype,"stopSending",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"stopSending"),wt.prototype),ae(wt.prototype,"receive",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"receive"),wt.prototype),ae(wt.prototype,"stopReceiving",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"stopReceiving"),wt.prototype),ae(wt.prototype,"muteRemote",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"muteRemote"),wt.prototype),ae(wt.prototype,"unmuteRemote",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"unmuteRemote"),wt.prototype),ae(wt.prototype,"muteLocal",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"muteLocal"),wt.prototype),ae(wt.prototype,"unmuteLocal",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"unmuteLocal"),wt.prototype),ae(wt.prototype,"close",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"close"),wt.prototype),ae(wt.prototype,"updateEncoderConfig",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"updateEncoderConfig"),wt.prototype),ae(wt.prototype,"updateSendParameters",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"updateSendParameters"),wt.prototype),ae(wt.prototype,"replaceTrack",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"replaceTrack"),wt.prototype),ae(wt.prototype,"getRemoteSSRC",[Qi],Object.getOwnPropertyDescriptor(wt.prototype,"getRemoteSSRC"),wt.prototype),wt);function Qi(r,i,s){const a=r[i];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const u=this.mutex,d=await u.lock("Locking from P2PConnection.".concat(i));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}const dE="9",c3=4e4;class Are{get localCapabilities(){return cn(this._localCapabilities)}get rtpCapabilities(){return cn(this._rtpCapabilities)}get candidates(){return cn(this._candidates)}get iceParameters(){return cn(this._iceParameters)}get dtlsParameters(){return cn(this._dtlsParameters)}constructor(i){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),i=cn(i);const{remoteIceParameters:s,remoteDtlsParameters:a,candidates:u,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:m,cname:g}=i,p=ln.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=d,this._candidates=u,this._iceParameters=s,this._dtlsParameters=a,this._localCapabilities=m,this.setup=h,this.cname=g;const E=this.rtpCapabilities.send;for(const v of p.mediaDescriptions){if(v.attributes.iceUfrag=s.iceUfrag,v.attributes.icePwd=s.icePwd,v.attributes.fingerprints=a.fingerprints,v.attributes.candidates=u,v.attributes.setup=h,v.media.mediaType==="video"&&(v.media.fmts=E.videoCodecs.map(T=>T.payloadType.toString(10)),v.attributes.payloads=E.videoCodecs,v.attributes.extmaps=E.videoExtensions,Q("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:I}=Ji([{ssrcId:c3,rtx:Q("USE_RTX")?40001:void 0}],this.cname);v.attributes.ssrcs=T,v.attributes.ssrcGroups=I}if(v.media.mediaType==="audio"&&(v.media.fmts=E.audioCodecs.map(T=>T.payloadType.toString(10)),v.attributes.payloads=E.audioCodecs,v.attributes.extmaps=E.audioExtensions,Ja(v),Q("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:I}=Ji([{ssrcId:2e4}],this.cname);v.attributes.ssrcs=T,v.attributes.ssrcGroups=I}}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}preloadRemoteMedia(){const i=Q("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const s=this.candidates,a=this.dtlsParameters,u=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<i;h++){const m=2*h+2e4,g=2*h+c3,{ssrcs:p,ssrcGroups:E}=Ji([{ssrcId:m}],this.cname),{ssrcs:v,ssrcGroups:T}=Ji([{ssrcId:g,rtx:Q("USE_RTX")?g+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:dE,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:u.iceUfrag,icePwd:u.icePwd,unrecognized:[],candidates:s,extmaps:d.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:dE,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:u.iceUfrag,icePwd:u.icePwd,unrecognized:[],candidates:s,extmaps:d.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return ln.exports.print(this.sessionDesc)}send(i,s,a,u){const{ssrcs:d,ssrcGroups:h}=Ji(s,this.cname,a),m=this.findPreloadMediaDesc(d);if(m){if(tn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),u&&(u.tcc||u.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,u),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(i,d);let p;return g===-1||Kr()||dr()||vD()?(p=this.createOrRecycleSendMedia(i,d,h,"sendonly",u),this.updateBundleMids()):(p=cn(this.sessionDesc.mediaDescriptions[g]),p.attributes.direction="sendonly",p.attributes.ssrcs=d,p.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(p,u)),tn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const s=i.map(d=>{let{kind:h,ssrcMsg:m,mslabel:g}=d;return this.send(h,m,g)}),a=[];let u=!1;return s.forEach(d=>{let{mid:h,needExchangeSDP:m}=d;m&&(u=!0),a.push(h)}),{mids:a,needExchangeSDP:u}}stopSending(i){const s=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&i.indexOf(a.attributes.mid)!==-1);if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");s.forEach(a=>{a.attributes.mid==="0"||tn()||Kr()||dr()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(i){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(i){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}muteRemote(i){const s=this.sessionDesc.mediaDescriptions.filter(a=>i.includes(a.attributes.mid||""));if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(i){const s=this.sessionDesc.mediaDescriptions.filter(a=>i.includes(a.attributes.mid||""));if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(a=>{a.attributes.direction="recvonly"})}receive(i,s,a,u){i.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",s,a,u[h])}),this.updateBundleMids()}stopReceiving(i){const s=this.sessionDesc.mediaDescriptions.filter(a=>i.indexOf(a.attributes.mid)!==-1);if(s.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");s.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(i){i=cn(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=i.iceUfrag,s.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const s=[];for(let a=0;a<i;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}findAvailableMediaIndex(i,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const u=a.media.mediaType===i&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(tn()){if(u){const d=this.firefoxSsrcMidMap.get(s[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return u})}createOrRecycleRecvMedia(i,s,a,u,d,h){const m=i._mediaStreamTrack.kind,g=this.rtpCapabilities.recv,p=this.localCapabilities.send;let E=[];if(m===Be.VIDEO){var v,T;if(Q("H264_PROFILE_LEVEL_ID")&&u==="h264"&&(E=g.videoCodecs.filter(L=>{var x,W;return(((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes(u)&&(L==null||(W=L.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])===Q("H264_PROFILE_LEVEL_ID")})),!E||((v=E)===null||v===void 0?void 0:v.length)===0){const L=p.videoCodecs.filter(x=>{var W;return(((W=x.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())||"").includes(u)});L.length!==0&&(E=g.videoCodecs.filter(x=>L.some(W=>W.payloadType===x.payloadType)))}if(Q("USE_RTX")){const L=E.map(W=>W.payloadType.toString()),x=g.videoCodecs.filter(W=>{var q,X;return((q=W.rtpMap)===null||q===void 0?void 0:q.encodingName)==="rtx"&&L.includes(((X=W.fmtp)===null||X===void 0?void 0:X.parameters.apt)||"")});E=[...E,...x]}E.length===0&&(D.warning("codec ".concat(u," not included in rtpCapabilities, fallback to default payloads: ").concat((T=g.videoCodecs[0].rtpMap)===null||T===void 0?void 0:T.encodingName)),E=g.videoCodecs)}else E=g.audioCodecs.filter(L=>{var x;return(((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes(d)}),E.length===0&&(D.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),E=g.audioCodecs.filter(L=>{var x;return(((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes("opus")}));const I=m===Be.VIDEO?g.videoExtensions:g.audioExtensions;this.currentMidIndex+=1;const O="".concat(this.currentMidIndex);let N={media:{mediaType:m,port:dE,protos:["UDP","TLS","RTP","SAVPF"],fmts:E.map(L=>L.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:E,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(O)}};N=this.mungRecvMediaDsec(N,i,h);const P=this.findFirstClosedMedia(m);if(P){const L=this.sessionDesc.mediaDescriptions.indexOf(P);this.sessionDesc.mediaDescriptions[L]=N}else this.sessionDesc.mediaDescriptions.push(N);return N}createOrRecycleSendMedia(i,s,a,u,d){const h=this.rtpCapabilities.send,m=i===Be.VIDEO?h.videoCodecs:h.audioCodecs,g=i===Be.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let E={media:{mediaType:i,port:dE,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:u,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};E=this.mungSendMediaDesc(E,d);const v=this.findFirstClosedMedia(i);if(v){const T=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[T]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>i.media.port!=="0").map(i=>i.attributes.mid)}mungRecvMediaDsec(i,s,a){const u=cn(i);return tR(u),ed(u,s),nR(u,s),YU(u),uE(u,a,this.localCapabilities.send),u}mungSendMediaDesc(i,s){const a=cn(i);return uE(a,s,this.localCapabilities.recv),Ja(a),a}updateRecvMedia(i,s){const a=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===i);if(a!==-1){const u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=u}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(s=>tn()?s.media.port==="0"&&s.media.mediaType===i:s.media.port==="0")}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(s=>{var a,u;return((a=s.attributes)===null||a===void 0||(u=a.ssrcs[0])===null||u===void 0?void 0:u.ssrcId)===i[0].ssrcId})}getSSRC(i){var s;return(s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i))===null||s===void 0?void 0:s.attributes.ssrcs}}var Ct;function u3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function l3(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?u3(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):u3(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}let bre=(ae((Ct=class R_ extends Ng{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,s){super(i,s),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useRTX",Q("USE_RTX")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"mutex",new Ir("P2PConnection-mutex")),this.store=s,this.peerConnection=new RTCPeerConnection(R_.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=uR(this.peerConnection,void 0,void 0,tn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=vu(i.sdp),a=await JU(!this.useRTX,Q("FILTER_VIDEO_FEC"),Q("FILTER_AUDIO_FEC"));return this.localCapabilities=rR(a),this.initialOffer=i,l3(l3({},s),{},{rtpCapabilities:a,offerSDP:i.sdp})}catch(i){throw new j(V.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(i,s,a,u,d,h){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Are({remoteIceParameters:i,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:u,remoteSetup:d,localCapabilities:this.localCapabilities,cname:h});const m=this.remoteSDP.toString(),g=ln.exports.parse(this.initialOffer.sdp),p=g.mediaDescriptions.find(I=>I.media.mediaType==="audio");p&&Ja(p);const E=ln.exports.print(g),v=this.logSDPExchange(E||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:E}),v==null||v(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m});const T=this.peerConnection.getTransceivers()[0];if(T!=null&&T.receiver&&this.tryBindTransportEvents(T.receiver),Q("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const I=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:I});const O=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(O)}}catch(m){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}}send(i,s,a){var u=this;return ws(function*(){const d=yield Xe(u.mutex.lock("From P2PConnection.send"));try{if(!u.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];i.forEach(N=>{const P=u.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});h.push(P)}),tn()&&Q("SIMULCAST")===!0&&(yield Xe(u.applySimulcastForFirefox(h,i)));const m=yield Xe(u.peerConnection.createOffer()),g=u.remoteSDP.predictReceivingMids(i.length),p=u.mungSendOfferSDP(m.sdp,i,g),E=ln.exports.parse(p),v=g.map(N=>{const P=E.mediaDescriptions.find(L=>L.attributes.mid===N);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return qU(P,u.useRTX)});let T;try{T=yield v}catch(N){T=[],u.remoteSDP.receive(i,s,a,T);const P=u.remoteSDP.toString();throw yield Xe(u.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Xe(u.peerConnection.setRemoteDescription({type:"answer",sdp:P})),yield Xe(u.stopSending(g,!0)),N}u.remoteSDP.receive(i,s,a,T);const I=u.remoteSDP.toString(),O=u.logSDPExchange(p,"offer","local","send");return yield Xe(u.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Xe(u.applySimulcastEncodings(h,i)),yield Xe(u.applySendEncodings(h,i)),O==null||O(I),yield Xe(u.peerConnection.setRemoteDescription({type:"answer",sdp:I})),h.map((N,P)=>{const L=g[P];return{localSSRC:v[P],id:L,transceiver:N}})}catch(h){throw h instanceof j?h:new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(i,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const u=this.peerConnection.getTransceivers().filter(g=>i.indexOf(g.mid)!==-1);if(u.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");u.map(g=>{var p;g.direction="inactive",(p=g.stop)===null||p===void 0||p.call(g)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(i);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(u){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(u.toString()))}finally{a&&a()}}async receive(i,s,a,u){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(i,s,a,u);if(h){const g=this.remoteSDP.toString(),p=this.logSDPExchange(g,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(E.sdp,d,i);p==null||p(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),D.debug("[P2PConnection] receive ".concat(i," by exchanging SDP."))}else D.debug("[P2PConnection] receive ".concat(i," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d}}catch(d){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(i);if(a){const u=this.remoteSDP.toString(),d=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();d==null||d(h.sdp||""),await this.peerConnection.setLocalDescription(h),D.debug("[P2PConnection] batchReceive by exchanging SDP.")}else D.debug("[P2PConnection] batchReceive no need to exchange SDP.");return s.map(u=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===u);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:u}})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const u=await this.peerConnection.createAnswer();a==null||a(u.sdp||""),await this.peerConnection.setLocalDescription(u)}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const u=await this.peerConnection.createAnswer();a==null||a(u.sdp||""),await this.peerConnection.setLocalDescription(u)}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const u=await this.peerConnection.createAnswer();a==null||a(u.sdp||""),await this.peerConnection.setLocalDescription(u)}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&i.indexOf(h.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),u=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(i);const d=this.remoteSDP.toString();u==null||u(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&i.indexOf(h.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),u=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(i);const d=this.remoteSDP.toString();u==null||u(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(){var i=this;return ws(function*(){const s=yield Xe(i.mutex.lock("From P2PConnection.restartICE"));try{const a=yield Xe(i.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=vu(a.sdp),{remoteIceParameters:d}=yield u.iceParameters;if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");i.remoteSDP.restartICE(d);const h=i.remoteSDP.toString(),m=i.logSDPExchange(a.sdp||"","offer","local","restartICE");yield Xe(i.peerConnection.setLocalDescription(a)),m==null||m(h),yield Xe(i.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(a){D.warning("restart ICE failed, abort operation",a)}finally{s()}})()}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),u=this.mungSendOfferSDP(a.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new j(V.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(i,s){const a=this.peerConnection.getTransceivers().filter(u=>u.mid===i);a.length===1&&(this.isVP8Simulcast(s)?tn()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const a=this.peerConnection.getTransceivers().find(u=>u.mid===s);a&&await a.sender.replaceTrack(i._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Q("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[]};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(Hh(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...R_.turnServerConfigToIceServers(i.turnServer.servers)),Q("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...R_.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),Q("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ug(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!Q("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}tryBindTransportEvents(i){i.transport&&(this.transportEventReceiver=i,i.transport.onstatechange=()=>{var s,a;(s=i.transport)!==null&&s!==void 0&&s.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,i.transport.state))},i.transport.onerror=s=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,s.error)},i.transport.iceTransport&&(i.transport.iceTransport.onstatechange=()=>{var s,a,u;(s=i.transport)!==null&&s!==void 0&&s.iceTransport.state&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,(u=i.transport)===null||u===void 0?void 0:u.iceTransport.state))}))}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(i,s){try{if(!er().supportSetRtpSenderParameters||i.length!==s.length)return;for(let p=0;p<i.length;p++){const E=i[p],v=s[p];if(v&&v instanceof un){var a,u;if(this.isVP8Simulcast(v))continue;const T={},I={};switch(v._optimizationMode){case"motion":T.degradationPreference="maintain-framerate";break;case"detail":T.degradationPreference="maintain-resolution";break;default:T.degradationPreference="balanced"}var d,h,m,g;if((a=v._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&(I.maxBitrate=1e3*((d=v._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)),v._hints.includes(Mn.LOW_STREAM)&&((h=v._encoderConfig)!==null&&h!==void 0&&h.frameRate&&(I.maxFramerate=ta(v._encoderConfig.frameRate)),(m=v._encoderConfig)!==null&&m!==void 0&&m.scaleResolutionDownBy&&((g=v._encoderConfig)===null||g===void 0?void 0:g.scaleResolutionDownBy)>1&&(I.scaleResolutionDownBy=v._encoderConfig.scaleResolutionDownBy)),Q("DSCP_TYPE")&&su()){const P=Q("DSCP_TYPE");["very-low","low","medium","high"].includes(P)&&(I.networkPriority=P)}const O=E.sender.getParameters(),N=(u=O.encodings)===null||u===void 0?void 0:u[0];tn()&&!N&&(T.encodings=[I]),N&&Object.assign(N,I),Object.assign(O,T),await E.sender.setParameters(O)}}}catch{D.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(i,s,a){const u=ln.exports.parse(i);return s.forEach((d,h)=>{const m=a[h],g=u.mediaDescriptions.find(p=>p.attributes.mid===m);g&&(ed(g,d),XU(g,d,this.store.codec))}),ln.exports.print(u)}mungReceiveAnswerSDP(i,s,a){const u=ln.exports.parse(i),d=u.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&a===Be.AUDIO&&d.media.mediaType==="audio"&&Ja(d),ln.exports.print(u)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,a)=>{var u;(u=this.onFirstVideoDecoded)===null||u===void 0||u.call(this,i,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let m=0;m<i.length;m++){var a,u,d,h;const g=i[m],p=s[m];if(p instanceof un&&!p._hints.includes(Mn.LOW_STREAM)&&(a=p._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((u=p._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(d=p._scalabiltyMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=p._scalabiltyMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const T=g.sender.getParameters();await g.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(i,s){if(!tn()&&i.length===s.length)for(let a=0;a<i.length;a++){const u=s[a];if(u instanceof un&&this.isVP8Simulcast(u)){const d=i[a],h={},m={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(i){var s,a,u,d;return!!(i instanceof un&&Q("SIMULCAST")&&this.store.codec==="vp8"&&!i._hints.includes(Mn.LOW_STREAM)&&(s=i._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=i._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(u=i._scalabiltyMode)!==null&&u!==void 0&&u.numSpatialLayers&&((d=i._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(i,s,a,u){if(Q("SDP_LOGGING"))return D.upload("exchanging ".concat(a," ").concat(s," SDP during P2PConnection.").concat(u,`
`),i),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",u)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s==null?void 0:s[0].ssrcId}}).prototype,"connect",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"connect"),Ct.prototype),ae(Ct.prototype,"receive",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"receive"),Ct.prototype),ae(Ct.prototype,"batchReceive",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"batchReceive"),Ct.prototype),ae(Ct.prototype,"stopReceiving",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"stopReceiving"),Ct.prototype),ae(Ct.prototype,"muteRemote",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"muteRemote"),Ct.prototype),ae(Ct.prototype,"unmuteRemote",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"unmuteRemote"),Ct.prototype),ae(Ct.prototype,"muteLocal",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"muteLocal"),Ct.prototype),ae(Ct.prototype,"unmuteLocal",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"unmuteLocal"),Ct.prototype),ae(Ct.prototype,"close",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"close"),Ct.prototype),ae(Ct.prototype,"updateEncoderConfig",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"updateEncoderConfig"),Ct.prototype),ae(Ct.prototype,"updateSendParameters",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"updateSendParameters"),Ct.prototype),ae(Ct.prototype,"replaceTrack",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"replaceTrack"),Ct.prototype),ae(Ct.prototype,"getRemoteSSRC",[Zi],Object.getOwnPropertyDescriptor(Ct.prototype,"getRemoteSSRC"),Ct.prototype),Ct);function Zi(r,i,s){const a=r[i];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const u=this.mutex,d=await u.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function d3(r,i){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=ta(i.width),a.height=ta(i.height);const u=ta(i.framerate||15);document.body.append(s),document.body.append(a);let d=r._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=a.getContext("2d");if(!h)throw new j(V.UNEXPECTED_ERROR,"can not get canvas context");const m=er(),g=a.captureStream(m.supportRequestFrame?0:u).getVideoTracks()[0],p=$S(()=>(()=>{if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const v=s.videoWidth,T=s.videoHeight/v,I=a.width*T;Math.abs(I-a.height)>=2&&(D.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(I)),a.height=I)}h.drawImage(s,0,0,a.width,a.height),g.requestFrame&&g.requestFrame(),d!==r._mediaStreamTrack&&(d=r._mediaStreamTrack,s.srcObject=new MediaStream([d]))})(),u),E=g.stop;return g.stop=()=>{E.call(g),p(),s&&(s.remove(),s=null),a&&(a.width=0,a.remove(),a=null),D.debug("clean low stream renderer")},g}var h3,p3,f3,m3,es,g3,E3,_3,v3,y3,S3,pr;function T3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function hE(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?T3(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):T3(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}class R3 extends Hk{getUserId(){return this._userId}constructor(i,s,a,u){super(i,"track-".concat(i.kind,"-").concat(s,"-").concat(u.clientId,"_").concat($t(5,""))),C(this,"_userId",void 0),C(this,"_uintId",void 0),C(this,"_isDestroyed",!1),C(this,"store",void 0),C(this,"processor",void 0),C(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=u}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,D.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let pE=(h3=ke({argsMap:(r,i,s)=>[r.getTrackId(),typeof i=="string"?i:"HTMLElement",s]}),p3=ke({argsMap:r=>[r.getTrackId()]}),f3=ke({argsMap:(r,i)=>[r.getTrackId(),i.name]}),m3=ke({argsMap:r=>[r.getTrackId()]}),ae((es=class extends R3{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Yn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(r,i,s,a){super(r,i,s,a),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"trackMediaType","video"),C(this,"_videoWidth",void 0),C(this,"_videoHeight",void 0),C(this,"_player",void 0),C(this,"processorDestination",void 0),C(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new UL(this.getTrackId(),"remote"),this.processorDestination=new xL(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return qh(()=>{D.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),go(this,xe.GET_STATS)||hE({},Rk)}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const a=document.getElementById(r);a?r=a:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback"),JSON.stringify(i));const s=hE(hE({fit:"cover"},i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(s):(this._player=new Ax(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.emit(Ml.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.emit(Ml.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},Q("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){XL(this._originMediaStreamTrack).then(r=>{let[i,s]=r;this._videoHeight=s,this._videoWidth=i}).catch(Fg)}_updatePlayerSource(){D.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var r,i;const s=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),a={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:u,slot:d}=a;if(this.isPlaying&&u instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=lU.checkOneElementVisible(u),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new j(V.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(r){if(this.processor===r)return r;if(r._source)throw new j(V.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Zn.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Zn.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[h3],Object.getOwnPropertyDescriptor(es.prototype,"play"),es.prototype),ae(es.prototype,"stop",[p3],Object.getOwnPropertyDescriptor(es.prototype,"stop"),es.prototype),ae(es.prototype,"pipe",[f3],Object.getOwnPropertyDescriptor(es.prototype,"pipe"),es.prototype),ae(es.prototype,"unpipe",[m3],Object.getOwnPropertyDescriptor(es.prototype,"unpipe"),es.prototype),es),fE=(g3=ke({argsMap:(r,i)=>[r.getTrackId(),i],throttleTime:300}),E3=ke({argsMap:(r,i)=>[r.getTrackId(),i]}),_3=ke({argsMap:r=>[r.getTrackId()]}),v3=ke({argsMap:r=>[r.getTrackId()]}),y3=ke({argsMap:(r,i)=>[r.getTrackId(),i.name]}),S3=ke({argsMap:r=>[r.getTrackId()]}),ae((pr=class extends R3{get isPlaying(){return this._useAudioElement?pi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(r,i,s,a){super(r,i,s,a),C(this,"trackMediaType","audio"),C(this,"_source",void 0),C(this,"_useAudioElement",!0),C(this,"_volume",100),C(this,"processorContext",void 0),C(this,"processorDestination",void 0),C(this,"_played",!1),C(this,"_bypassWebAudio",!1),Q("DISABLE_WEBAUDIO")?(this._source=new jL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Yk(r,!0),Q("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Yr.RECEIVE_TRACK_BUFFER,()=>{this.emit(Ml.FIRST_FRAME_DECODED)}),this.processorContext=new FL(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new VL(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Yr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!r)return this._source.removeAllListeners(Yr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(Yr.ON_AUDIO_BUFFER),this._source.on(Yr.ON_AUDIO_BUFFER,s=>r(s))}setVolume(r){this._volume=r,this._useAudioElement?pi.setVolume(this.getTrackId(),r):this._source.setVolume(r/100)}async setPlaybackDevice(r){if(!this._useAudioElement)throw new j(V.NOT_SUPPORTED,"your browser does not support setting the audio output device");await pi.setSinkID(this.getTrackId(),r)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return qh(()=>{D.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),go(this,xe.GET_STATS)||hE({},Tk)}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] use audio element to play")),pi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?pi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let r=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&pi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(r){if(this._bypassWebAudio)throw new j(V.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===r)return r;if(r._source)throw new j(V.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(this._bypassWebAudio)throw new j(V.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const i=this.processor;(r=this._source.processSourceNode)===null||r===void 0||r.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Zn.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Zn.ON_NODE,r=>{this._source.processedNode=r;const i=!r;this._useAudioElement!==i&&(this._played?(this.stop(),this._useAudioElement=i,this.play()):this._useAudioElement=i)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Zn.ON_TRACK),this.processorDestination.removeAllListeners(Zn.ON_NODE)}}).prototype,"setVolume",[g3],Object.getOwnPropertyDescriptor(pr.prototype,"setVolume"),pr.prototype),ae(pr.prototype,"setPlaybackDevice",[E3],Object.getOwnPropertyDescriptor(pr.prototype,"setPlaybackDevice"),pr.prototype),ae(pr.prototype,"play",[_3],Object.getOwnPropertyDescriptor(pr.prototype,"play"),pr.prototype),ae(pr.prototype,"stop",[v3],Object.getOwnPropertyDescriptor(pr.prototype,"stop"),pr.prototype),ae(pr.prototype,"pipe",[y3],Object.getOwnPropertyDescriptor(pr.prototype,"pipe"),pr.prototype),ae(pr.prototype,"unpipe",[S3],Object.getOwnPropertyDescriptor(pr.prototype,"unpipe"),pr.prototype),pr);function I3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function w3(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?I3(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):I3(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}class Ore extends Wt{constructor(){super(),C(this,"uplinkStatsUploadInterval",void 0),C(this,"uplinkStatsUploadSlowInterval",void 0),C(this,"uplinkRelatedStatsUploadInterval",void 0),C(this,"uplinkDenoiserStatsUploadInterval",void 0),C(this,"transportStatsUploadInterval",void 0),C(this,"uplinkExtensionStatsUploadInterval",void 0),C(this,"downlinkExtensionStatsUploadInterval",void 0),C(this,"extensionUsageStatsUploadInterval",void 0),C(this,"downlinkStatsUploadInterval",void 0),C(this,"downlinkStatsUploadSlowInterval",void 0),C(this,"downlinkRelatedStatsUploadInterval",void 0),C(this,"lastStats",void 0),C(this,"uploadUnplinkStarted",!1),C(this,"uploadDownlinkStarted",!1),C(this,"uploadTransportStarted",!1),C(this,"uploadExtensionUsageStarted",!1),C(this,"requestStats",void 0),C(this,"requestLocalMedia",void 0),C(this,"requestRemoteMedia",void 0),C(this,"requestAllTracks",void 0),C(this,"requestVideoIsReady",void 0),C(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&this.uploadTransportStats(s)},6e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const i=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var s,a,u;const d=Date.now(),h={connectionInterval:Q("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:d};let m=[];const g=((s=this.requestAllTracks)===null||s===void 0?void 0:s.call(this))||[];for(const T of g)!T.muted&&T.enabled&&(m=m.concat(await T.getProcessorUsage()));const p=((a=this.requestRemoteMedia)===null||a===void 0?void 0:a.call(this))||[];for(const[T,I]of p)I.has(Be.VIDEO)&&T.videoTrack&&(m=m.concat(await T.videoTrack.getProcessorUsage())),I.has(Be.AUDIO)&&T.audioTrack&&(m=m.concat(await T.audioTrack.getProcessorUsage()));if(m.length===0)return;h.details=function(T,I){const O={};for(const{id:x,value:W,level:q,direction:X}of T){var N;const ie=(N=I.get(x))!==null&&N!==void 0?N:0,ee=W===2?ie+Q("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ie;var P,L;I.set(x,ee),O[x]?(W===2&&(O[x].value=W),q>O[x].level&&(O[x].level=q),X==="remote"&&(O[x].remoteUidCount+=1),O[x].totalTs=(P=I.get(x))!==null&&P!==void 0?P:0):O[x]={value:W,level:q,remoteUidCount:X==="local"?0:1,totalTs:(L=I.get(x))!==null&&L!==void 0?L:0}}return Object.keys(O).map(x=>{const{level:W,value:q,totalTs:X}=O[x];return{id:x,level:W,value:q,totalTs:X}})}(m,i);const E=Date.now(),v=E>d?E:d+1;(u=this.requestUpload)===null||u===void 0||u.call(this,zr.EXTENSION_USAGE_STATS,{usageStats:h,sendTs:v})},Q("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&(this.uploadUplinkStats(s,this.lastStats),this.lastStats=s)},3e3),this.uplinkStatsUploadSlowInterval&&window.clearInterval(this.uplinkStatsUploadSlowInterval),this.uplinkStatsUploadSlowInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&this.uploadSlowUplinkStats(s)},6e4),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&this.uploadRelatedUplinkStats(s,this.lastStats),this.lastStats=s},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestAllTracks)===null||i===void 0?void 0:i.call(this);s&&this.uploadDenoiserStats(s)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestAllTracks)===null||i===void 0?void 0:i.call(this);s&&this.uploadExtensionStats(s)},2e3))}uploadTransportStats(i){ys(()=>{var s;(s=this.requestUpload)===null||s===void 0||s.call(this,zr.TRANSPORT_STATS,function(a){const u={connectionType:100};if(a.selectedCandidatePair.localCandidate.candidateType==="relay"){const d=a.selectedCandidatePair.localCandidate.relayProtocol;d==="udp"&&(u.connectionType=101),d==="tcp"&&(u.connectionType=103),d==="tls"&&(u.connectionType=104)}return u}(i))})}uploadUplinkStats(i,s){var a;(((a=this.requestLocalMedia)===null||a===void 0?void 0:a.call(this))||[]).forEach(u=>{let[d,{track:h,ssrcs:m}]=u;switch(d){case ve.LocalVideoLowTrack:case ve.LocalVideoTrack:{const g=function(v,T,I){var O;const N=T.videoSend.find(L=>L.ssrc===v);if(!N)return null;const P={id:$t(10,""),timestamp:new Date(T.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:N.ssrc.toString()};switch(P.A_vstd=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?"1":"0",N.sentFrame&&(P.A_fhs=N.sentFrame.height.toString(),P.A_frs=N.sentFrame.frameRate.toString(),P.A_fws=N.sentFrame.width.toString()),N.adaptionChangeReason){case"none":P.A_ac="0";break;case"cpu":P.A_ac="1";break;case"bandwidth":P.A_ac="2";break;case"other":P.A_ac="3"}return P.A_lvps=wS[I._player?I._player.videoElementStatus:"uninit"].toString(),P.A_nr=(O=N.nacksCount)===null||O===void 0?void 0:O.toString(),N.avgEncodeMs&&(P.A_aem=N.avgEncodeMs.toFixed(0).toString()),P}(m[0].ssrcId,i,h),p=qL(m[0].ssrcId,i,s);g&&ys(()=>{var v;return(v=this.requestUpload)===null||v===void 0?void 0:v.call(this,zr.PUBLISH_STATS,{stream_type:d===ve.LocalVideoLowTrack?"low":"high",stats:w3(w3({},g),p)})});const E=function(v){const T={id:"bweforvideo",timestamp:new Date(v.timestamp).toISOString(),type:"VideoBwe"};return v.bitrate.retransmit&&(T.A_rb=v.bitrate.retransmit.toString()),v.bitrate.targetEncoded&&(T.A_teb=v.bitrate.targetEncoded.toString()),T.A_aeb=v.bitrate.actualEncoded.toString(),T.A_tb=v.bitrate.transmit.toString(),v.sendBandwidth!==void 0&&(T.A_asb=v.sendBandwidth.toString()),T}(i);E&&setTimeout(()=>{var v;return(v=this.requestUpload)===null||v===void 0?void 0:v.call(this,zr.PUBLISH_STATS,{stream_type:d===ve.LocalVideoLowTrack?"low":"high",stats:E})},1e3);break}case ve.LocalAudioTrack:{const g=function(p,E,v){const T=E.audioSend.find(O=>O.ssrc===p);if(!T)return null;const I={id:$t(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:T.ssrc.toString()};return I.A_astd=v._originMediaStreamTrack.enabled&&v._mediaStreamTrack.enabled?"0":"1",T.inputLevel?I.A_ail=Math.round(100*T.inputLevel).toString():I.A_ail=Math.round(100*v._source.getAccurateVolumeLevel()).toString(),I.A_apil=Math.round(100*v._source.getAccurateVolumeLevel()).toString(),T.aecReturnLoss&&(I.A_ecrl=Math.round(T.aecReturnLoss).toString()),T.aecReturnLossEnhancement&&(I.A_ecrle=Math.round(T.aecReturnLossEnhancement).toString()),I}(m[0].ssrcId,i,h);g&&ys(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,zr.PUBLISH_STATS,{stream_type:"high",stats:g})});break}}})}uploadSlowUplinkStats(i){var s;(((s=this.requestLocalMedia)===null||s===void 0?void 0:s.call(this))||[]).filter(a=>{let[u]=a;return u===ve.LocalVideoLowTrack||u===ve.LocalVideoTrack}).forEach(a=>{let[u,{ssrcs:d}]=a;const h=qL(d[0].ssrcId,i);h&&ys(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,zr.PUBLISH_STATS,{stream_type:u===ve.LocalVideoLowTrack?"low":"high",stats:h})})})}uploadRelatedUplinkStats(i,s){var a;(((a=this.requestLocalMedia)===null||a===void 0?void 0:a.call(this))||[]).filter(u=>{let[d]=u;return d===ve.LocalVideoLowTrack||d===ve.LocalVideoTrack}).forEach(u=>{let[d,{ssrcs:h}]=u;const m=function(g,p){const E=p.videoSend.find(v=>v.ssrc===g);return E?{mediaType:"video",isVideoMute:!1,frameRateInput:E.inputFrame&&E.inputFrame.frameRate.toString(),frameRateSent:E.sentFrame&&E.sentFrame.frameRate.toString(),googRtt:E.rttMs.toString(),qpSumPerFrame:Math.floor(E.qpSumPerFrame).toString()}:null}(h[0].ssrcId,i);m&&ys(()=>{var g;(g=this.requestUpload)===null||g===void 0||g.call(this,zr.PUBLISH_RELATED_STATS,{stream_type:d===ve.LocalVideoLowTrack?"low":"high",stats:m})})})}uploadDenoiserStats(i){for(let d=0;d<i.length;d++){const h=i[d];if(h instanceof Mg){var s,a,u;const m=(s=(a=h._external).getDenoiserStats)===null||s===void 0?void 0:s.call(a);return void(m&&((u=this.requestUpload)===null||u===void 0||u.call(this,zr.DENOISER_STATS,m)))}}}uploadExtensionStats(i){for(let s=0;s<i.length;s++)i[s].getProcessorStats().forEach(a=>{var u;(u=this.requestUpload)===null||u===void 0||u.call(this,a.type,a.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let i;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let s=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var a;const u=(a=this.requestStats)===null||a===void 0?void 0:a.call(this);u&&(this.uploadDownlinkStats(u,s,i),i=u),s=!s},3e3),this.downlinkStatsUploadSlowInterval&&window.clearInterval(this.downlinkStatsUploadSlowInterval),this.downlinkStatsUploadSlowInterval=window.setInterval(()=>{var a;const u=(a=this.requestStats)===null||a===void 0?void 0:a.call(this);u&&this.uploadSlowDownlinkStats(u)},6e4),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var a;const u=(a=this.requestStats)===null||a===void 0?void 0:a.call(this);u&&(this.uploadRelatedDownlinkStats(u,this.lastStats),this.lastStats=u)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var a;const u=(a=this.requestRemoteMedia)===null||a===void 0?void 0:a.call(this);u&&this.uploadDownlinkExtensionStats(u)},2e3)}uploadDownlinkStats(i,s,a){var u;(((u=this.requestRemoteMedia)===null||u===void 0?void 0:u.call(this))||[]).forEach(d=>{let[h,m]=d;if(m.has(Be.VIDEO)&&h.videoTrack){const g=h.videoTrack?function(p,E,v,T,I){const O=E.videoRecv.find(x=>x.ssrc===p);if(!O)return null;const N={id:$t(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};var P,L;if(N.bytesReceived=O.bytes.toString(),N.packetsLost=O.packetsLost.toString(),N.packetsReceived=O.packets.toString(),O.framesRateFirefox&&(N.A_frr=O.framesRateFirefox.toString()),O.receivedFrame?(N.A_frr=O.receivedFrame.frameRate.toString(),N.A_fhr=O.receivedFrame.height.toString(),N.A_fwr=O.receivedFrame.width.toString()):(N.A_fhr=(P=T._videoHeight)===null||P===void 0?void 0:P.toString(),N.A_fwr=(L=T._videoWidth)===null||L===void 0?void 0:L.toString()),N.A_frd=O.decodeFrameRate.toString(),O.outputFrame&&(N.A_fro=O.outputFrame.frameRate.toString()),O.jitterBufferMs!==void 0&&(N.A_jbm=Math.floor(O.jitterBufferMs).toString()),O.currentDelayMs!==void 0&&(N.A_cdm=Math.floor(O.currentDelayMs).toString()),N.A_fs=O.firsCount.toString(),N.A_ns=O.nacksCount.toString(),N.A_ps=O.plisCount.toString(),T&&(N.A_vrtd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1"),T._player&&T._player.freezeTimeCounterList.length>0&&(N.A_vrft=Math.round(T._player.freezeTimeCounterList.splice(0,1)[0]).toString()),I&&T._player&&ea.visibility==="visible"){const x=Math.min(6e3,T._player.renderFreezeAccTime);N.A_vrrft=Math.round(x).toString(),T._player.renderFreezeAccTime=Math.max(0,T._player.renderFreezeAccTime-x)}if(N.A_rvps=wS[T._player?T._player.videoElementStatus:"uninit"].toString(),v){const x=v.videoRecv.find(W=>W.ssrc===p);if(x&&O.totalInterFrameDelay!==void 0&&O.totalSquaredInterFrameDelay!==void 0&&x.totalInterFrameDelay!==void 0&&x.totalSquaredInterFrameDelay!==void 0){const W=O.totalInterFrameDelay-x.totalInterFrameDelay,q=O.totalSquaredInterFrameDelay-x.totalSquaredInterFrameDelay,X=O.framesDecodeCount-x.framesDecodeCount,ie=W/X*1e3,ee=Math.round(1e3*Math.sqrt((q-Math.pow(W,2)/X)/X));!isNaN(ee)&&ie+ee>Math.max(3*ie,ie+150)&&(N.A_ifdsd=ee.toString())}}return N}(h._videoSSRC,i,a,h.videoTrack,s):void 0;g&&ys(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,zr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:g})})}if(m.has(Be.AUDIO)&&h.audioTrack){const g=h.audioTrack?function(p,E,v,T){const I=E.audioRecv.find(N=>N.ssrc===p);if(!I)return null;const O={id:$t(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:I.ssrc.toString()};if(O.bytesReceived=I.bytes.toString(),O.packetsLost=I.packetsLost.toString(),O.packetsReceived=I.packets.toString(),I.outputLevel?O.A_aol=Math.round(100*I.outputLevel).toString():O.A_aol=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),O.A_apol=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),T&&(O.A_artd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1"),O.A_jr=I.jitterMs.toString(),O.A_jbm=Math.floor(I.jitterBufferMs).toString(),O.A_cdm=Math.floor(I.jitterBufferMs).toString(),O.A_raps=wS[pi.getPlayerState(T.getTrackId())].toString(),v){const N=v.audioRecv.find(P=>P.ssrc===p);if(N){const P=I.concealedSamples-N.concealedSamples;P>0&&(O.A_cs=Math.round(P).toString())}}return O}(h._audioSSRC,i,a,h.audioTrack):void 0;g&&ys(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,zr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:g})})}})}uploadSlowDownlinkStats(i){}uploadRelatedDownlinkStats(i,s){var a;(((a=this.requestRemoteMedia)===null||a===void 0?void 0:a.call(this))||[]).forEach(u=>{let[d,h]=u;if(h.has(Be.VIDEO)&&d.videoTrack){var m;const g=(d._videoSSRC&&((m=this.requestVideoIsReady)===null||m===void 0?void 0:m.call(this,d._videoSSRC))||!1)===!0,p=function(E,v,T,I,O,N){const P=T.videoRecv.find(q=>q.ssrc===E),L=O?O.videoRecv.find(q=>q.ssrc===E):void 0;if(!P)return null;const x=Fl.isRemoteVideoFreeze(N,P,L)&&v,W={mediaType:"video",isVideoMute:!1,peerId:I,frameRateReceived:P.receivedFrame&&P.receivedFrame.frameRate.toString(),frameRateDecoded:P.decodedFrame&&P.decodedFrame.frameRate.toString(),isFreeze:x,bytesReceived:P.bytes.toString(),packetsReceived:P.packets.toString(),packetsLost:P.packetsLost.toString(),qpSumPerFrame:Math.floor(P.qpSumPerFrame).toString()};return P.framesRateFirefox&&(W.frameRateDecoded=P.framesRateFirefox.toString(),W.frameRateReceived=P.framesRateFirefox.toString()),W}(d._videoSSRC,g,i,d.uid,s,d.videoTrack);p&&ys(()=>{var E;(E=this.requestUpload)===null||E===void 0||E.call(this,zr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:p})})}if(h.has(Be.AUDIO)&&d.audioTrack){const g=function(p,E,v,T){const I=E.audioRecv.find(N=>N.ssrc===p);if(!I)return null;const O=Fl.isRemoteAudioFreeze(T);return{mediaType:"audio",isAudioMute:!1,peerId:v,googJitterReceived:I.jitterMs.toString(),isFreeze:O,bytesReceived:I.bytes.toString(),packetsReceived:I.packets.toString(),packetsLost:I.packetsLost.toString(),frameReceived:I.receivedFrames.toString(),frameDropped:I.droppedFrames.toString()}}(d._audioSSRC,i,d.uid,d.audioTrack);g&&ys(()=>{var p;(p=this.requestUpload)===null||p===void 0||p.call(this,zr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:g})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(i){i.forEach(s=>{let[a,u]=s;u.has(Be.VIDEO)&&a.videoTrack&&a.videoTrack.getProcessorStats().forEach(d=>{var h;(h=this.requestUpload)===null||h===void 0||h.call(this,d.type,d.stats)}),u.has(Be.AUDIO)&&a.audioTrack&&a.audioTrack.getProcessorStats().forEach(d=>{var h;(h=this.requestUpload)===null||h===void 0||h.call(this,d.type,d.stats)})})}}const C3=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,mE="9",lR=2e4,dR=4e4;class Nre{get localCapabilities(){return cn(this._localCapabilities)}get rtpCapabilities(){return cn(this._rtpCapabilities)}get candidates(){return cn(this._candidates)}get iceParameters(){return cn(this._iceParameters)}get dtlsParameters(){return cn(this._dtlsParameters)}constructor(i){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),i=cn(i);const{remoteIceParameters:s,remoteDtlsParameters:a,candidates:u,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:m,cname:g}=i,p=ln.exports.parse(C3);this._rtpCapabilities=d,this._candidates=u,this._iceParameters=s,this._dtlsParameters=a,this._localCapabilities=m,this.setup=h,this.cname=g;const E=this.rtpCapabilities.send;for(const v of p.mediaDescriptions){if(v.attributes.iceUfrag=s.iceUfrag,v.attributes.icePwd=s.icePwd,v.attributes.fingerprints=a.fingerprints,v.attributes.candidates=u,v.attributes.setup=h,v.media.mediaType==="application"&&(v.attributes.sctpPort="5000"),v.media.mediaType==="video"&&(v.media.fmts=E.videoCodecs.map(T=>T.payloadType.toString(10)),v.attributes.payloads=E.videoCodecs,v.attributes.extmaps=E.videoExtensions,Q("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:I}=Ji([{ssrcId:dR,rtx:Q("USE_RTX")?40001:void 0}],this.cname);v.attributes.ssrcs=T,v.attributes.ssrcGroups=I}if(v.media.mediaType==="audio"&&(v.media.fmts=E.audioCodecs.map(T=>T.payloadType.toString(10)),v.attributes.payloads=E.audioCodecs,v.attributes.extmaps=E.audioExtensions,Ja(v),Q("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:I}=Ji([{ssrcId:lR}],this.cname);v.attributes.ssrcs=T,v.attributes.ssrcGroups=I}}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}updateRemoteRTPCapabilities(i){const s=ln.exports.parse(C3);this._rtpCapabilities=i;const a=this.rtpCapabilities.send;for(const u of s.mediaDescriptions){if(u.attributes.iceUfrag=this._iceParameters.iceUfrag,u.attributes.icePwd=this._iceParameters.icePwd,u.attributes.fingerprints=this._dtlsParameters.fingerprints,u.attributes.candidates=this._candidates,u.attributes.setup=this.setup,u.media.mediaType==="application"&&(u.attributes.sctpPort="5000"),u.media.mediaType==="video"&&(u.media.fmts=a.videoCodecs.map(d=>d.payloadType.toString(10)),u.attributes.payloads=a.videoCodecs,u.attributes.extmaps=a.videoExtensions,Q("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Ji([{ssrcId:dR,rtx:Q("USE_RTX")?40001:void 0}],this.cname);u.attributes.ssrcs=d,u.attributes.ssrcGroups=h}if(u.media.mediaType==="audio"&&(u.media.fmts=a.audioCodecs.map(d=>d.payloadType.toString(10)),u.attributes.payloads=a.audioCodecs,u.attributes.extmaps=a.audioExtensions,Q("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Ji([{ssrcId:lR}],this.cname);u.attributes.ssrcs=d,u.attributes.ssrcGroups=h}}this.sessionDesc=s,this.currentMidIndex=s.mediaDescriptions.length-1}preloadRemoteMedia(i){this.rtpCapabilities;const s=this.candidates,a=this.dtlsParameters,u=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<i;h++){const m=2*h+lR,g=2*h+dR,{ssrcs:p,ssrcGroups:E}=Ji([{ssrcId:m}],this.cname),{ssrcs:v,ssrcGroups:T}=Ji([{ssrcId:g,rtx:Q("USE_RTX")?g+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:mE,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:u.iceUfrag,icePwd:u.icePwd,unrecognized:[],candidates:s,extmaps:d.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:mE,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:u.iceUfrag,icePwd:u.icePwd,unrecognized:[],candidates:s,extmaps:d.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return ln.exports.print(this.sessionDesc)}send(i,s,a,u){const{ssrcs:d,ssrcGroups:h}=Ji(s,this.cname,a),m=this.findPreloadMediaDesc(d);if(m){if(tn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),u&&(u.tcc||u.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,u),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(i,d);let p;return g===-1||Kr()||dr()||vD()?(p=this.createOrRecycleSendMedia(i,d,h,"sendonly",u),this.updateBundleMids()):(p=cn(this.sessionDesc.mediaDescriptions[g]),p.attributes.direction="sendonly",p.attributes.ssrcs=d,p.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(p,u)),tn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const s=i.map(d=>{let{kind:h,ssrcMsg:m,mslabel:g}=d;return this.send(h,m,g)}),a=[];let u=!1;return s.forEach(d=>{let{mid:h,needExchangeSDP:m}=d;m&&(u=!0),a.push(h)}),{mids:a,needExchangeSDP:u}}stopSending(i){const s=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&i.indexOf(a.attributes.mid)!==-1);if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");s.forEach(a=>{a.attributes.mid==="0"||tn()||Kr()||dr()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(i){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(i){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}muteRemote(i){const s=this.sessionDesc.mediaDescriptions.filter(a=>i.includes(a.attributes.mid||""));if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(i){const s=this.sessionDesc.mediaDescriptions.filter(a=>i.includes(a.attributes.mid||""));if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(a=>{a.attributes.direction="recvonly"})}receive(i,s,a,u){i.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",s,a,u[h])}),this.updateBundleMids()}stopReceiving(i){const s=this.sessionDesc.mediaDescriptions.filter(a=>i.indexOf(a.attributes.mid)!==-1);if(s.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");s.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(i){i=cn(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=i.iceUfrag,s.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const s=[];for(let a=0;a<i;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}findAvailableMediaIndex(i,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const u=a.media.mediaType===i&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(tn()){if(u){const d=this.firefoxSsrcMidMap.get(s[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return u})}createOrRecycleRecvMedia(i,s,a,u,d,h){const m=i._mediaStreamTrack.kind,g=this.rtpCapabilities.recv,p=this.localCapabilities.send;let E=[];if(m===Be.VIDEO){var v,T;if(Q("H264_PROFILE_LEVEL_ID")&&u==="h264"&&(E=g.videoCodecs.filter(L=>{var x,W;return(((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes(u)&&(L==null||(W=L.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"])===Q("H264_PROFILE_LEVEL_ID")})),!E||((v=E)===null||v===void 0?void 0:v.length)===0){const L=p.videoCodecs.filter(x=>{var W;return(((W=x.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())||"").includes(u)});L.length!==0&&(E=g.videoCodecs.filter(x=>L.some(W=>W.payloadType===x.payloadType)))}if(Q("USE_RTX")){const L=E.map(W=>W.payloadType.toString()),x=g.videoCodecs.filter(W=>{var q,X;return((q=W.rtpMap)===null||q===void 0?void 0:q.encodingName)==="rtx"&&L.includes(((X=W.fmtp)===null||X===void 0?void 0:X.parameters.apt)||"")});E=[...E,...x]}E.length===0&&(D.warning("codec ".concat(u," not included in rtpCapabilities, fallback to default payloads: ").concat((T=g.videoCodecs[0].rtpMap)===null||T===void 0?void 0:T.encodingName)),E=g.videoCodecs)}else E=g.audioCodecs.filter(L=>{var x;return(((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes(d)}),E.length===0&&(D.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),E=g.audioCodecs.filter(L=>{var x;return(((x=L.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes("opus")}));const I=m===Be.VIDEO?g.videoExtensions:g.audioExtensions;this.currentMidIndex+=1;const O="".concat(this.currentMidIndex);let N={media:{mediaType:m,port:mE,protos:["UDP","TLS","RTP","SAVPF"],fmts:E.map(L=>L.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:E,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(O)}};N=this.mungRecvMediaDsec(N,i,h);const P=this.findFirstClosedMedia(m);if(P){const L=this.sessionDesc.mediaDescriptions.indexOf(P);this.sessionDesc.mediaDescriptions[L]=N}else this.sessionDesc.mediaDescriptions.push(N);return N}createOrRecycleSendMedia(i,s,a,u,d){const h=this.rtpCapabilities.send,m=i===Be.VIDEO?h.videoCodecs:h.audioCodecs,g=i===Be.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let E={media:{mediaType:i,port:mE,protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:u,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};E=this.mungSendMediaDesc(E,d);const v=this.findFirstClosedMedia(i);if(v){const T=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[T]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>i.media.port!=="0").map(i=>i.attributes.mid)}mungRecvMediaDsec(i,s,a){const u=cn(i);return tR(u),ed(u,s),nR(u,s),YU(u),uE(u,a,this.localCapabilities.send),u}mungSendMediaDesc(i,s){const a=cn(i);return uE(a,s,this.localCapabilities.recv),Ja(a),a}updateRecvMedia(i,s){const a=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===i);if(a!==-1){const u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=u}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(s=>tn()?s.media.port==="0"&&s.media.mediaType===i:s.media.port==="0")}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(s=>{var a,u;return((a=s.attributes)===null||a===void 0||(u=a.ssrcs[0])===null||u===void 0?void 0:u.ssrcId)===i[0].ssrcId})}getSSRC(i){var s;return(s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i))===null||s===void 0?void 0:s.attributes.ssrcs}}var vt;function A3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function gE(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?A3(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):A3(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}let Pre=(ae((vt=class fA extends Ng{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,s,a){super(i,s),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useRTX",Q("USE_RTX")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"mutex",new Ir("NVExtentionsConnection-mutex")),C(this,"rtcMedia",void 0),this.store=s,this.peerConnection=a,this.statsFilter=uR(this.peerConnection,void 0,void 0,tn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(i){try{const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=vu(s.sdp),u=await JU(!this.useRTX,Q("FILTER_VIDEO_FEC"),Q("FILTER_AUDIO_FEC"));return this.localCapabilities=u,this.initialOffer=s,gE(gE({},a),{},{rtpCapabilities:u,offerSDP:s.sdp})}catch(s){throw new j(V.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(i,s,a,u,d,h){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new Nre({remoteIceParameters:i,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:u,remoteSetup:d,localCapabilities:rR(this.localCapabilities),cname:h});const m=this.remoteSDP.toString(),g=ln.exports.parse(this.initialOffer.sdp),p=g.mediaDescriptions.find(T=>T.media.mediaType==="audio");p&&Ja(p);const E=ln.exports.print(g),v=this.logSDPExchange(E||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:E}),v==null||v(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new j(V.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}}async updateRemoteConnect(i){var s,a,u;(s=this.remoteSDP)===null||s===void 0||s.updateRemoteRTPCapabilities(i),(a=this.remoteSDP)===null||a===void 0||a.preloadRemoteMedia(2);const d=(u=this.remoteSDP)===null||u===void 0?void 0:u.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),D.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(i,s,a){var u=this;return ws(function*(){const d=yield Xe(u.mutex.lock("From NVExtentionsConnection.send"));try{if(!u.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];i.forEach(N=>{const P=u.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});h.push(P)}),tn()&&Q("SIMULCAST")===!0&&(yield Xe(u.applySimulcastForFirefox(h,i)));const m=yield Xe(u.peerConnection.createOffer()),g=u.remoteSDP.predictReceivingMids(i.length),p=u.mungSendOfferSDP(m.sdp,i,g),E=ln.exports.parse(p),v=g.map(N=>{const P=E.mediaDescriptions.find(L=>L.attributes.mid===N);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return qU(P,u.useRTX)});let T;try{T=yield v}catch(N){T=[],u.remoteSDP.receive(i,s,a,T);const P=u.remoteSDP.toString();throw yield Xe(u.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Xe(u.peerConnection.setRemoteDescription({type:"answer",sdp:P})),yield Xe(u.stopSending(g,!0)),N}u.remoteSDP.receive(i,s,a,T);const I=u.remoteSDP.toString(),O=u.logSDPExchange(p,"offer","local","send");return yield Xe(u.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Xe(u.applySimulcastEncodings(h,i)),yield Xe(u.applySendEncodings(h,i)),O==null||O(I),yield Xe(u.peerConnection.setRemoteDescription({type:"answer",sdp:I})),h.map((N,P)=>{const L=g[P];return{localSSRC:v[P],id:L,transceiver:N}})}catch(h){throw h instanceof j?h:new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(i,s){const a=s?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const u=this.peerConnection.getTransceivers().filter(g=>i.indexOf(g.mid)!==-1);if(u.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");u.map(g=>{var p;g.direction="inactive",(p=g.stop)===null||p===void 0||p.call(g)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(i);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(u){throw new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(u.toString()))}finally{a&&a()}}async receive(i,s,a,u){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(i," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(i,s,a,u);if(h){const g=this.remoteSDP.toString(),p=this.logSDPExchange(g,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(E.sdp,d,i);p==null||p(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),D.debug("[NVExtentionsConnection] receive ".concat(i," by exchanging SDP."))}else D.debug("[NVExtentionsConnection] receive ".concat(i," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d}}catch(d){throw new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(d.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(i);if(a){const u=this.remoteSDP.toString(),d=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();d==null||d(h.sdp||""),await this.peerConnection.setLocalDescription(h),D.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else D.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return s.map(u=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===u);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:u}})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const u=await this.peerConnection.createAnswer();a==null||a(u.sdp||""),await this.peerConnection.setLocalDescription(u)}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const u=await this.peerConnection.createAnswer();a==null||a(u.sdp||""),await this.peerConnection.setLocalDescription(u)}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const u=await this.peerConnection.createAnswer();a==null||a(u.sdp||""),await this.peerConnection.setLocalDescription(u)}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&i.indexOf(h.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),u=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(i);const d=this.remoteSDP.toString();u==null||u(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&i.indexOf(h.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),u=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(i);const d=this.remoteSDP.toString();u==null||u(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new j(V.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(){var i=this;return ws(function*(){const s=yield Xe(i.mutex.lock("From NVExtentionsConnection.restartICE"));try{const a=yield Xe(i.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=vu(a.sdp),{remoteIceParameters:d}=yield u.iceParameters;if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");i.remoteSDP.restartICE(d);const h=i.remoteSDP.toString(),m=i.logSDPExchange(a.sdp||"","offer","local","restartICE");yield Xe(i.peerConnection.setLocalDescription(a)),m==null||m(h),yield Xe(i.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(a){D.warning("restart ICE failed, abort operation",a)}finally{s()}})()}close(){var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),u=this.mungSendOfferSDP(a.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new j(V.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(i,s){const a=this.peerConnection.getTransceivers().filter(u=>u.mid===i);a.length===1&&(this.isVP8Simulcast(s)?tn()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const a=this.peerConnection.getTransceivers().find(u=>u.mid===s);a&&await a.sender.replaceTrack(i._mediaStreamTrack)}getP2PConnectionParams(){var i;if((i=this.peerConnection.currentLocalDescription)===null||i===void 0||!i.sdp||!this.localCapabilities)throw new Error;return gE(gE({},vu(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Q("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[]};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(Hh(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...fA.turnServerConfigToIceServers(i.turnServer.servers)),Q("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...fA.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),Q("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ug(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!Q("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async applySendEncodings(i,s){try{if(!er().supportSetRtpSenderParameters||i.length!==s.length)return;for(let p=0;p<i.length;p++){const E=i[p],v=s[p];if(v&&v instanceof un){var a,u;if(this.isVP8Simulcast(v))continue;const T={},I={};switch(v._optimizationMode){case"motion":T.degradationPreference="maintain-framerate";break;case"detail":T.degradationPreference="maintain-resolution";break;default:T.degradationPreference="balanced"}var d,h,m,g;if((a=v._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&(I.maxBitrate=1e3*((d=v._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)),v._hints.includes(Mn.LOW_STREAM)&&((h=v._encoderConfig)!==null&&h!==void 0&&h.frameRate&&(I.maxFramerate=ta(v._encoderConfig.frameRate)),(m=v._encoderConfig)!==null&&m!==void 0&&m.scaleResolutionDownBy&&((g=v._encoderConfig)===null||g===void 0?void 0:g.scaleResolutionDownBy)>1&&(I.scaleResolutionDownBy=v._encoderConfig.scaleResolutionDownBy)),Q("DSCP_TYPE")&&su()){const P=Q("DSCP_TYPE");["very-low","low","medium","high"].includes(P)&&(I.networkPriority=P)}const O=E.sender.getParameters(),N=(u=O.encodings)===null||u===void 0?void 0:u[0];tn()&&!N&&(T.encodings=[I]),N&&Object.assign(N,I),Object.assign(O,T),await E.sender.setParameters(O)}}}catch{D.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(i,s,a){const u=ln.exports.parse(i);return s.forEach((d,h)=>{const m=a[h],g=u.mediaDescriptions.find(p=>p.attributes.mid===m);g&&(ed(g,d),XU(g,d,this.store.codec))}),ln.exports.print(u)}mungReceiveAnswerSDP(i,s,a){const u=ln.exports.parse(i),d=u.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&a===Be.AUDIO&&d.media.mediaType==="audio"&&Ja(d),ln.exports.print(u)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,a)=>{var u;(u=this.onFirstVideoDecoded)===null||u===void 0||u.call(this,i,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let m=0;m<i.length;m++){var a,u,d,h;const g=i[m],p=s[m];if(p instanceof un&&!p._hints.includes(Mn.LOW_STREAM)&&(a=p._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((u=p._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(d=p._scalabiltyMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=p._scalabiltyMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const E={},v={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:v.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:v.high}];const T=g.sender.getParameters();await g.sender.setParameters(Object.assign(T,E))}}}async applySimulcastEncodings(i,s){if(!tn()&&i.length===s.length)for(let a=0;a<i.length;a++){const u=s[a];if(u instanceof un&&this.isVP8Simulcast(u)){const d=i[a],h={},m={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(i){var s,a,u,d;return!!(i instanceof un&&Q("SIMULCAST")&&this.store.codec==="vp8"&&!i._hints.includes(Mn.LOW_STREAM)&&(s=i._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=i._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(u=i._scalabiltyMode)!==null&&u!==void 0&&u.numSpatialLayers&&((d=i._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(i,s,a,u){if(Q("SDP_LOGGING"))return D.upload("exchanging ".concat(a," ").concat(s," SDP during NVExtentionsConnection.").concat(u,`
`),i),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",u)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s==null?void 0:s[0].ssrcId}}).prototype,"connect",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"connect"),vt.prototype),ae(vt.prototype,"updateRemoteConnect",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"updateRemoteConnect"),vt.prototype),ae(vt.prototype,"receive",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"receive"),vt.prototype),ae(vt.prototype,"batchReceive",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"batchReceive"),vt.prototype),ae(vt.prototype,"stopReceiving",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"stopReceiving"),vt.prototype),ae(vt.prototype,"muteRemote",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"muteRemote"),vt.prototype),ae(vt.prototype,"unmuteRemote",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"unmuteRemote"),vt.prototype),ae(vt.prototype,"muteLocal",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"muteLocal"),vt.prototype),ae(vt.prototype,"unmuteLocal",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"unmuteLocal"),vt.prototype),ae(vt.prototype,"close",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"close"),vt.prototype),ae(vt.prototype,"updateEncoderConfig",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"updateEncoderConfig"),vt.prototype),ae(vt.prototype,"updateSendParameters",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"updateSendParameters"),vt.prototype),ae(vt.prototype,"replaceTrack",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"replaceTrack"),vt.prototype),ae(vt.prototype,"getRemoteSSRC",[Oi],Object.getOwnPropertyDescriptor(vt.prototype,"getRemoteSSRC"),vt.prototype),vt);function Oi(r,i,s){const a=r[i];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const u=this.mutex,d=await u.lock("From NVExtentionsConnection.".concat(i));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}var Nt;function b3(r){var i,s,a,u=2;for(typeof Symbol<"u"&&(s=HU,a=Symbol.iterator);u--;){if(s&&(i=r[s])!=null)return i.call(r);if(a&&(i=r[a])!=null)return new hR(i.call(r));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function hR(r){function i(s){if(Object(s)!==s)return _e.reject(new TypeError(s+" is not an object."));var a=s.done;return _e.resolve(s.value).then(function(u){return{value:u,done:a}})}return(hR=function(s){this.s=s,this.n=s.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?_e.resolve({value:s,done:!0}):i(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?_e.reject(s):i(a.apply(this.s,arguments))}},new hR(r)}let pR=(ae((Nt=class I_ extends Ng{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,s){super(i,s),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"cname",void 0),C(this,"mutex",new Ir("DataChannelConnection-mutex")),C(this,"dataChannel",void 0),C(this,"_p2pConnection",void 0),C(this,"_nvMedia",void 0),this.store=s,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(I_.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Pre(i,s,this.peerConnection),this.bindPCEvents()}async establish(){var i;const s=(i=this._nvMedia)===null||i===void 0?void 0:i.getLocalRtpCapabilities();return await this._p2pConnection.establish(s)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(i,s,a,u,d,h){return this.cname=h,await this._p2pConnection.connect(i,s,a,u,d,h),await new _e((m,g)=>{const p=setTimeout(()=>{this.closeSignal(),g(new j(V.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(a))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(p),void m()},this.dataChannel.onerror=E=>{this.closeSignal(),g(E)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(i,s,a){var u=this;return ws(function*(){const d=yield Xe(u.mutex.lock("From DataChannelConnection.send"));try{return yield*dp(b3(u._p2pConnection.send(i,s,a)),Xe)}finally{d()}})()}async stopSending(i,s){return this._p2pConnection.stopSending(i,s)}async receive(i,s,a,u){return this._nvMedia?(D.debug("[DataChannelConnection] receive ".concat(i," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(i,s,this.cname)):(D.debug("[DataChannelConnection] receive ".concat(i," by WebRTC.")),await this._p2pConnection.receive(i,s,a,u))}async batchReceive(i){return[...await this._p2pConnection.batchReceive(i)]}async stopReceiving(i){return await this._p2pConnection.stopReceiving(i)}async muteRemote(i){return await this._p2pConnection.muteRemote(i)}async unmuteRemote(i){return await this._p2pConnection.unmuteRemote(i)}async muteLocal(i){return await this._p2pConnection.muteLocal(i)}async unmuteLocal(i){return await this._p2pConnection.unmuteLocal(i)}restartICE(){var i=this;return ws(function*(){return yield*dp(b3(i._p2pConnection.restartICE()),Xe)})()}close(){var i;(i=this._nvMedia)===null||i===void 0||i.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(i){return this._p2pConnection.getRemoteVideoIsReady(i)}updateRemoteConnect(i){var s;(s=this._nvMedia)===null||s===void 0||s.setRemoteRtpCapabilities(i),this._p2pConnection.updateRemoteConnect(i)}async updateEncoderConfig(i,s){return await this._p2pConnection.updateEncoderConfig(i,s)}async updateSendParameters(i,s){return await this._p2pConnection.updateSendParameters(i,s)}setStatsRemoteVideoIsReady(i,s){this._p2pConnection.setStatsRemoteVideoIsReady(i,s)}async replaceTrack(i,s){return await this._p2pConnection.replaceTrack(i,s)}async getRemoteSSRC(i){return this._p2pConnection.getRemoteSSRC(i)}logSDPExchange(i,s,a,u){if(Q("SDP_LOGGING"))return D.upload("exchanging ".concat(a," ").concat(s," SDP during DataChannelConnection.").concat(u,`
`),i),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",u)}:void 0}static resolvePCConfiguration(i){const s={iceServers:[]};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(Hh(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...I_.turnServerConfigToIceServers(i.turnServer.servers)),Q("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...I_.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),Q("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ug(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!Q("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=i=>{var s;return(s=this.onICEConnectionStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onConnectionStateChange=i=>{var s;return(s=this.onConnectionStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onDTLSTransportStateChange=i=>{var s;return(s=this.onDTLSTransportStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onDTLSTransportError=i=>{var s;return(s=this.onDTLSTransportError)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onICETransportStateChange=i=>{var s;return(s=this.onICETransportStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstAudioReceived=i=>{var s;return(s=this.onFirstAudioReceived)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstVideoReceived=i=>{var s;return(s=this.onFirstVideoReceived)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstAudioDecoded=i=>{var s;return(s=this.onFirstAudioDecoded)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstVideoDecoded=(i,s,a)=>{var u;return(u=this.onFirstVideoDecoded)===null||u===void 0?void 0:u.call(this,i,s,a)},this._p2pConnection.onFirstVideoDecodedTimeout=i=>{var s;return(s=this.onFirstVideoDecodedTimeout)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onSelectedLocalCandidateChanged=(i,s)=>{var a;return(a=this.onSelectedLocalCandidateChanged)===null||a===void 0?void 0:a.call(this,i,s)},this._p2pConnection.onSelectedRemoteCandidateChanged=(i,s)=>{var a;return(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0?void 0:a.call(this,i,s)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}}).prototype,"connect",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"connect"),Nt.prototype),ae(Nt.prototype,"receive",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"receive"),Nt.prototype),ae(Nt.prototype,"stopReceiving",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"stopReceiving"),Nt.prototype),ae(Nt.prototype,"muteRemote",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"muteRemote"),Nt.prototype),ae(Nt.prototype,"unmuteRemote",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"unmuteRemote"),Nt.prototype),ae(Nt.prototype,"muteLocal",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"muteLocal"),Nt.prototype),ae(Nt.prototype,"unmuteLocal",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"unmuteLocal"),Nt.prototype),ae(Nt.prototype,"close",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"close"),Nt.prototype),ae(Nt.prototype,"updateEncoderConfig",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"updateEncoderConfig"),Nt.prototype),ae(Nt.prototype,"updateSendParameters",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"updateSendParameters"),Nt.prototype),ae(Nt.prototype,"replaceTrack",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"replaceTrack"),Nt.prototype),ae(Nt.prototype,"getRemoteSSRC",[bs],Object.getOwnPropertyDescriptor(Nt.prototype,"getRemoteSSRC"),Nt.prototype),Nt);function bs(r,i,s){const a=r[i];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const u=this.mutex,d=await u.lock("From DataChannelConnection.".concat(i));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}var ct;function O3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function Qa(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?O3(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):O3(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}function fR(r){var i,s,a,u=2;for(typeof Symbol<"u"&&(s=HU,a=Symbol.iterator);u--;){if(s&&(i=r[s])!=null)return i.call(r);if(a&&(i=r[a])!=null)return new mR(i.call(r));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function mR(r){function i(s){if(Object(s)!==s)return _e.reject(new TypeError(s+" is not an object."));var a=s.done;return _e.resolve(s.value).then(function(u){return{value:u,done:a}})}return(mR=function(s){this.s=s,this.n=s.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?_e.resolve({value:s,done:!0}):i(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?_e.reject(s):i(a.apply(this.s,arguments))}},new mR(r)}let Dre=(ae((ct=class extends Wt{get state(){return this._state}set state(r){const i=this._state;this._state=r,this.emit(ot.StateChange,i,this._state)}constructor(r,i){super(),C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"connection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"statsCollector",void 0),C(this,"isPlanB",!1),C(this,"iceFailedCount",0),C(this,"dtlsFailedCount",0),C(this,"mutex",new Ir("P2PChannel-mutex")),C(this,"_state",Qn.Disconnected),C(this,"handleMuteLocalTrack",async(s,a,u)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Qn.Connected)return void u(new j(V.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find(p=>p[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(p=>{let[,{id:E}]=p;return E}));const g=this.createMuteMessage(h);await Jt(this,ot.RequestMuteLocal,g),a()}catch(h){u(h)}finally{d()}}),C(this,"handleUnmuteLocalTrack",async(s,a,u)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Qn.Connected)return void u(new j(V.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find(p=>p[0]==="videoLowTrack");if(m){const p=m[1];if(p.track._originMediaStreamTrack.stop(),er().supportDualStreamEncoding){const E=s._mediaStreamTrack.clone();p.track._mediaStreamTrack=E,p.track._originMediaStreamTrack=E}else{const E=d3(s,hu(this,ot.RequestLowStreamParameter));p.track._mediaStreamTrack=E,p.track._originMediaStreamTrack=E}await new _e((E,v)=>{this.handleReplaceTrack(p.track,E,v,!0)})}await this.connection.unmuteLocal(h.map(p=>{let[,{id:E}]=p;return E}));const g=this.createUnmuteMessage(h);await Jt(this,ot.RequestUnmuteLocal,g),a()}catch(h){u(h)}finally{d()}}),C(this,"handleUpdateVideoEncoder",async(s,a,u)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const h=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Qn.Connected)return void a();const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),await this.connection.updateEncoderConfig(m,g),this.emit(ot.UpdateVideoEncoder,g),a()}catch(h){u(h)}finally{d()}}),C(this,"handleSetOptimizationMode",async(s,a,u)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const h=this.localTrackMap.get(ve.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Qn.Connected)return;const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),a()}catch(h){u(h)}finally{d()}}),C(this,"handleReplaceTrack",async(s,a,u,d)=>{let h;D.debug("P2PChannel handleReplaceTrack for [track-id-".concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const p=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:v}]=E;return s===v});if(!this.connection||!p||this.state!==Qn.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,p[1].id)),this.isPlanB){const E=p[1];E.id=s._mediaStreamTrack.id,this.localTrackMap.set(p[0],E)}if(p[0]===ve.LocalVideoTrack&&er().supportDualStreamEncoding){const E=this.localTrackMap.get(ve.LocalVideoLowTrack);if(E){const v=s._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=v,E.track._originMediaStreamTrack=v,await new _e((T,I)=>{this.handleReplaceTrack(E.track,T,I,!0)})}}a()}catch(p){u(p)}finally{var g;(g=h)===null||g===void 0||g()}}),C(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),C(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=r,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new Ore,this.bindStatsUploaderEvents(),this.isPlanB=!er().supportUnifiedPlan||Q("CHROME_FORCE_PLAN_B")&&su()}async startP2PConnection(r,i){return this.state=Qn.New,this.connection=i?new pR(r,this.store):this.isPlanB?new Cre(r,this.store):new bre(r,this.store),this.bindConnectionEvents(this.connection),this.connection.establish()}async connect(r,i,s,a,u,d){if(!this.connection)throw new j(V.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof pR?this.connection.updateRemoteConnect(a):(this.store.peerConnectionStart(),await this.connection.connect(r,i,s,a,u,d),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Qn.Connected)}async preConnect(r,i,s,a,u,d){if(!this.connection)throw new j(V.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const h=await this.connection.connect(r,i,s,a,u,d);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Qn.Connected,h}getEstablishParams(){if(this.connection instanceof pR)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(r,i,s){var a=this;return ws(function*(){const u=yield Xe(a.mutex.lock("From P2PChannel.publish"));try{if(!a.connection||a.state!==Qn.Connected){if(a.state===Qn.Disconnected)throw new j(V.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(r);const h=r.filter(m=>a.pendingLocalTracks.indexOf(m)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(h))}a.store.pubId=a.store.pubId+1,qi.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(r,i,s);if(d.length===0)return void(yield Xe(a.tryToUnmuteAudio(r)));yield*dp(fR(a.doPublish(a.connection,d)),Xe)}finally{u()}})()}doPublish(r,i){var s=this;return ws(function*(){i.forEach(p=>{let{track:E,type:v}=p;const T=Date.now();s.store.publish(E.getTrackId(),v===ve.LocalAudioTrack?"audio":"video",T)}),s.bindLocalTrackEvents(i);const a=yield Xe(r.send(i.map(p=>{let{track:E}=p;return E}),s.store.codec,s.store.audioCodec)),u=(yield Xe(a.next())).value,d=s.createGatewayPublishMessage(i,u);let h;try{h=yield d}catch(p){throw a.throw(p),(p==null?void 0:p.code)===V.WS_ABORT&&i.forEach(E=>{let{track:v}=E;s.pendingLocalTracks.indexOf(v)===-1&&s.pendingLocalTracks.push(v)}),s.unbindLocalTrackEvents(i),p}const m=s.mapPubResToRemoteConfig(d,h),g=(yield Xe(a.next(m))).value;i.forEach(p=>{let{type:E}=p;s.statsCollector.addLocalStats(E)}),s.assignLocalTracks(i,g),s.statsUploader.startUploadUplinkStats(),i.forEach(p=>{let{track:E,type:v}=p;const T=Date.now();s.store.publish(E.getTrackId(),v===ve.LocalAudioTrack?"audio":"video",void 0,T)})})()}publishLowStream(r){var i=this;return ws(function*(){if(!i.connection||i.state!==Qn.Connected)return;const s=yield Xe(i.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const u=i.localTrackMap.get(ve.LocalVideoTrack);if(!u)throw new j(V.UNEXPECTED_ERROR,"Could not find high stream");if(i.localTrackMap.has(ve.LocalVideoLowTrack))throw new j(V.UNEXPECTED_ERROR,"[".concat(i.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:i.getLowVideoTrack(u.track,r),type:ve.LocalVideoLowTrack}];if(yield*dp(fR(i.doPublish(i.connection,d)),Xe),u.track.muted||!u.track.enabled){var a;const h=(a=i.localTrackMap.get(ve.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield Xe(i.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("Emit P2PChannelEvents.RequestRePublish to republish tracks."),await nr(this,ot.RequestRePublish,this.pendingLocalTracks),this.emit(ot.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(r){for(let i=this.pendingRemoteTracks.length-1;i>=0;i--){const{user:s,kind:a}=this.pendingRemoteTracks[i];(a!==Be.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==Be.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(i,1)}if(r)await nr(this,ot.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:i,kind:s}of this.pendingRemoteTracks)await this.subscribe(i,s,s===Be.VIDEO?i._videoSSRC:i._audioSSRC);this.pendingRemoteTracks.forEach(i=>{let{user:s}=i;this.emit(ot.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(r){if(!this.connection||this.state!==Qn.Connected)return void r.forEach(a=>{const u=this.pendingLocalTracks.indexOf(a);u!==-1&&this.pendingLocalTracks.splice(u,1)});const i=this.filterTobeUnpublishedTracks(r);if(i.length===0)return;const s=i.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,i)}async unpublishLowStream(){if(!this.connection||this.state!==Qn.Connected)return;const r=this.localTrackMap.get(ve.LocalVideoLowTrack);if(!r)return;r.track.close();const i=[[ve.LocalVideoLowTrack,r]];return this.doUnpublish(this.connection,i)}async doUnpublish(r,i){const s=this.createGatewayUnpublishMessage(i);return await r.stopSending(i.map(a=>{let[,{id:u}]=a;return u})),this.withdrawLocalTracks(i),this.unbindLocalTrackEvents(i.map(a=>{let[u,{track:d}]=a;return{type:u,track:d}})),i.forEach(a=>{let[u]=a;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),s}async subscribe(r,i,s,a,u){var d;if(!this.connection||this.state!==Qn.Connected)throw new j(V.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(r))!==null&&d!==void 0&&d.has(i))return;let h,m;if(u){const E=u.find(T=>{let{stream_type:I}=T;return I===i});if(!E)throw new j(V.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(i," for user: ").concat(r.uid," because subscribe answer from gateway does not contain stream_type: ").concat(i,"."));const v=await this.connection.receive(i,E.ssrcs,String(r._uintid),E.attributes);h=v.track,m=v.id}else{const E=await this.connection.receive(i,[{ssrcId:s,rtx:a}],String(r._uintid),void 0);h=E.track,m=E.id}i===Be.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(h):(r._audioTrack=new fE(h,r.uid,r._uintid,this.store),D.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(h):(r._videoTrack=new pE(h,r.uid,r._uintid,this.store),D.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(r,r._videoTrack));const g=this.remoteUserMap.get(r);g?g.set(i,m):this.remoteUserMap.set(r,new Map([[i,m]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadDownlinkStats();const p=this.pendingRemoteTracks.findIndex(E=>{let{user:v,kind:T}=E;return v.uid===r.uid&&i===T});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(ot.MediaReconnectEnd,r.uid))}async massSubscribe(r){return this.massSubscribeNoLock(r)}async massSubscribeNoLock(r){if(!this.connection||this.state!==Qn.Connected)throw new j(V.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");r=r.filter(s=>{var a;let{user:u,mediaType:d}=s;return!((a=this.remoteUserMap.get(u))!==null&&a!==void 0&&a.has(d))});const i=await this.connection.batchReceive(r.map(s=>{let{user:a,mediaType:u,ssrcId:d,rtxSsrcId:h}=s;return{kind:u,ssrcMsg:[{ssrcId:d,rtx:h}],mslabel:String(a._uintid)}}));r.forEach((s,a)=>{let{user:u,mediaType:d}=s;const{track:h,id:m}=i[a];d===Be.AUDIO?(u._audioTrack?u._audioTrack._updateOriginMediaStreamTrack(h):(u._audioTrack=new fE(h,u.uid,u._uintid,this.store),D.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(u._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(u,u._audioTrack)):(u._videoTrack?u._videoTrack._updateOriginMediaStreamTrack(h):(u._videoTrack=new pE(h,u.uid,u._uintid,this.store),D.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(u._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(u,u._videoTrack));const g=this.remoteUserMap.get(u);g?g.set(d,m):this.remoteUserMap.set(u,new Map([[d,m]])),this.statsCollector.addRemoteStats(u.uid),this.statsUploader.startUploadDownlinkStats();const p=this.pendingRemoteTracks.findIndex(E=>{let{user:v,kind:T}=E;return v.uid===u.uid&&d===T});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(ot.MediaReconnectEnd,u.uid))})}async unsubscribe(r,i,s){const a=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return i!==void 0?m.uid===r.uid&&i===g:m.uid===r.uid});if(a.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection||s||a.forEach(h=>{let{kind:m}=h;var g;if(m===Be.AUDIO)(g=r._audioTrack)===null||g===void 0||g._destroy(),r._audioTrack=void 0;else if(m===Be.VIDEO){var p;(p=r._videoTrack)===null||p===void 0||p._destroy(),r._videoTrack=void 0}}),!this.connection)return;const u=this.filterTobeUnSubscribedTracks(r,i);if(u.length===0)return;await this.connection.stopReceiving(u.map(h=>{let[,{id:m}]=h;return m}));const d=this.createUnsubscribeMessage(u);return this.withdrawRemoteTracks(u),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),u.forEach(h=>{let[m,{kind:g}]=h;var p,E;if(g===Be.VIDEO&&m._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===Be.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((E=m._videoTrack)===null||E===void 0||E._destroy(),m._videoTrack=void 0);else if(g===Be.AUDIO){var v;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((v=m._audioTrack)===null||v===void 0||v._destroy(),m._audioTrack=void 0)}}),d}async massUnsubscribe(r){return this.massUnsubscribeNoLock(r)}async massUnsubscribeNoLock(r){let i=[];for(const{user:u,mediaType:d}of r){const h=this.pendingRemoteTracks.filter(m=>{let{user:g,kind:p}=m;return d!==void 0?g.uid===u.uid&&d===p:g.uid===u.uid});h.forEach(m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)}),i=i.concat(h)}if(!this.connection)return void i.forEach(u=>{let{user:d,kind:h}=u;var m;if(h===Be.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===Be.VIDEO){var g;(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0}});const s=xa(r).call(r,(u,d)=>{let{user:h,mediaType:m}=d;const g=this.filterTobeUnSubscribedTracks(h,m);return u.concat(g)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(u=>{let[,{id:d}]=u;return d}));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),s.forEach(u=>{let[d,{kind:h}]=u;var m,g;if(h===Be.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===Be.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0;else if(h===Be.AUDIO){var p;this.unbindRemoteTrackEvents(d._audioTrack),(p=d._audioTrack)===null||p===void 0||p._destroy(),d._audioTrack=void 0}}),a}async muteRemote(r,i){if(!this.connection)return;const s=this.remoteUserMap.get(r);if(!s)return void D.warning("P2PChannel.muteRemote has no remote user ".concat(r.uid,"."));if(!s.get(i))return void D.warning("P2PChannel.muteRemote has no remote user ".concat(r.uid," media type ").concat(i,"."));const a=i===Be.VIDEO?r._videoSSRC:r._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(r,i){return this.unmuteRemoteNoLock(r,i)}async unmuteRemoteNoLock(r,i){if(!this.connection)return;const s=this.remoteUserMap.get(r);if(!s)return void D.warning("P2PChannel.unmuteRemote has no remote user ".concat(r.uid,"."));s.get(i)||D.warning("P2PChannel.unmuteRemote has no remote user ".concat(r.uid," media type ").concat(i,"."))}getAllTracks(r){const i=this.localTrackMap.get(ve.LocalAudioTrack);if((i==null?void 0:i.track)instanceof Ki){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[u]=a;return u!==ve.LocalAudioTrack}).filter(a=>{let[u]=a;return!(r&&u===ve.LocalVideoLowTrack)}).map(a=>{let[,{track:u}]=a;return u}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(r&&a===ve.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(r,i,s,a,u){if(r){const h=this.localTrackMap.get(ve.LocalAudioTrack),m=a?this.localTrackMap.get(ve.LocalVideoLowTrack):this.localTrackMap.get(ve.LocalVideoTrack);Ie.publish(this.store.sessionId,{eventElapse:qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:i,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Mn.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:u})}else{var d;s||(s=[]);const h=s.find(g=>g instanceof tr),m=a?(d=this.localTrackMap.get(ve.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(g=>g instanceof un);Ie.publish(this.store.sessionId,{eventElapse:qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:i,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Mn.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:u})}}reportSubscribeEvent(r,i,s,a){const u=a===Be.VIDEO?s._videoSSRC:s._audioSSRC;u&&Ie.subscribe(this.store.sessionId,{succ:r,ec:i,video:a===Be.VIDEO,audio:a===Be.AUDIO,peerid:s.uid,subscribeRequestid:a===Be.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:qi.measureFromSubscribeStart(this.store.clientId,u)})}reset(){D.debug("P2PChannel.reset"),this.mutex=new Ir("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Qn.Disconnected}getStats(){var r;return(r=this.connection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(r){var i;return((i=this.connection)===null||i===void 0?void 0:i.getRemoteVideoIsReady(r))||!1}getLocalAudioVolume(){const r=this.localTrackMap.get(ve.LocalAudioTrack);if(r)return r.track.getVolumeLevel()}getLocalVideoSize(){const r=this.localTrackMap.get(ve.LocalVideoTrack);if(r)return{width:r.track._videoWidth||0,height:r.track._videoHeight||0}}getEncoderConfig(r){const i=this.localTrackMap.get(r);return i&&i.track instanceof un||i&&i.track instanceof tr?i.track._encoderConfig:void 0}getLocalMedia(r){return this.localTrackMap.get(r)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(r,i){if(!r)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(r);return!!s&&(!i||s.has(i))}async hasRemoteMediaWithLock(r,i){if(!r)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(r);return!!s&&(!i||s.has(i))}getRemoteMedia(r){var i;const s=Array.from(cu(i=this.remoteUserMap).call(i)).find(a=>a.uid===r);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let r=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(ve.LocalAudioTrack);return i&&r.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),r=SS(r).call(r,(s,a)=>s.level-a.level),r}async disconnectForReconnect(){this.connection&&(D.debug("P2PChannel.disconnectForReconnect closing P2PConnection"),this.state=Qn.Reconnecting,this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s}]=r;switch(i){case ve.LocalVideoTrack:s._hints.includes(Mn.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case ve.LocalAudioTrack:s instanceof Ki?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);break;case ve.LocalVideoLowTrack:}}),this.emit(ot.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i,s]=r;Array.from(cu(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(i,a)}),this.emit(ot.MediaReconnectStart,i.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),D.debug("P2PChannel disconnected, waiting to reconnect."))}hasPendingRemoteMedia(r,i){for(const s of this.pendingRemoteTracks){const{user:a,kind:u}=s;if((r instanceof xT?r.uid:r)===a.uid&&i===u)return!0}return!1}setPendingRemoteMedia(r,i){this.hasPendingRemoteMedia(r,i)||this.pendingRemoteTracks.push({user:r,kind:i})}restartICE(){var r=this;return ws(function*(){if(!r.connection)throw new Error;const i=yield Xe(r.mutex.lock("From P2PChannel.restartICE"));try{yield*dp(fR(r.connection.restartICE()),Xe)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const r=this.connection.getStats(),i=this.localTrackMap.get(ve.LocalVideoTrack),s=this.localTrackMap.get(ve.LocalAudioTrack),a=r.videoSend.find(I=>I.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId)),u=r.audioSend.find(I=>I.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!u)return 1;const d=go(this,ot.NeedSignalRTT),h=a?a.rttMs:void 0,m=u?u.rttMs:void 0,g=h&&m?(h+m)/2:h||m,p=(g&&d?(g+d)/2:g||d)||0,E=100*r.sendPacketLossRate*.7/50+.3*p/1500,v=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,T=i==null?void 0:i.track;if(T&&T._encoderConfig&&T._hints.indexOf(Mn.SCREEN_TRACK)===-1){const I=T._encoderConfig.bitrateMax,O=r.bitrate.actualEncoded;if(I&&O){const N=(1e3*I-O)/(1e3*I);return EQ[N<.15?0:N<.3?1:N<.45?2:N<.6?3:4][v]}}return v}getDownlinkNetworkQuality(){if(!this.connection)return 0;const r=this.connection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const u=a._audioSSRC,d=a._videoSSRC,h=r.audioRecv.find(O=>O.ssrc===u),m=r.videoRecv.find(O=>O.ssrc===d);if(!h&&!m)return void(i+=1);const g=go(this,ot.NeedSignalRTT),p=r.rtt,E=(p&&g?(p+g)/2:p||g)||0,v=h?h.jitterMs:void 0,T=r.recvPacketLossRate;let I=.7*T*100/50+.3*E/1500;v&&(I=.6*T*100/50+.2*E/1500+.2*v/400),i+=I<.1?1:I<.17?2:I<.36?3:I<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}async muteLocalTrack(r){return new _e((i,s)=>{this.handleMuteLocalTrack(r,i,s)})}filterTobePublishedTracks(r,i,s){const a=[],u=er(),d=this.getAllTracks();r=JL(r=r.filter(g=>d.indexOf(g)===-1));let h=!1,m=!1;for(const g of r){if(g instanceof un&&(this.localTrackMap.has(ve.LocalVideoTrack)||h?new j(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:ve.LocalVideoTrack}),h=!0),i)){const p=this.getLowVideoTrack(g,s);a.push({track:p,type:ve.LocalVideoLowTrack})}if(g instanceof tr){const p=this.localTrackMap.get(ve.LocalAudioTrack);if(p){if(!(p.track instanceof Ki))throw new j(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new j(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const E=a.find(v=>{let{type:T}=v;return T===ve.LocalAudioTrack});if(!(E.track instanceof Ki))throw new j(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new j(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g)}else{if(!u.webAudioMediaStreamDest||g instanceof Ki||g._bypassWebAudio)a.push({track:g,type:ve.LocalAudioTrack});else{const E=new Ki;E.addAudioTrack(g),a.push({track:E,type:ve.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(r){const i=[],s=this.getAllTracks();r=JL(r=r.filter(a=>s.indexOf(a)!==-1));for(const a of r){if(a instanceof tr){const u=this.localTrackMap.get(ve.LocalAudioTrack);if(!u)continue;u.track instanceof Ki?(u.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),u.track.trackList.length===0&&(i.push([ve.LocalAudioTrack,u]),u.track.close())):i.push([ve.LocalAudioTrack,u])}if(a instanceof un){const u=this.localTrackMap.get(ve.LocalVideoTrack);if(!u)continue;i.push([ve.LocalVideoTrack,u]);const d=this.localTrackMap.get(ve.LocalVideoLowTrack);d&&i.push([ve.LocalVideoLowTrack,d])}}return i}bindLocalTrackEvents(r){r.forEach(i=>{let{track:s,type:a}=i;switch(a){case ve.LocalVideoTrack:s.addListener(xe.GET_STATS,this.handleGetLocalVideoStats),s.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(xe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(xe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.addListener(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);break;case ve.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(r,i){r instanceof Ki?r.trackList.forEach(s=>{s.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(xe.GET_STATS,this.handleGetLocalAudioStats),s.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.addListener(xe.GET_STATS,this.handleGetLocalAudioStats),r.addListener(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||r.addListener(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(r){r||(r=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:a}]=i;return{track:a,type:s}})),r.forEach(i=>{let{track:s,type:a}=i;switch(a){case ve.LocalVideoTrack:s.off(xe.GET_STATS,this.handleGetLocalVideoStats),s.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(xe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(xe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.off(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ve.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);break;case ve.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(r){r instanceof Ki?r.trackList.forEach(i=>{i.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(xe.GET_STATS,this.handleGetLocalAudioStats),i.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.off(xe.GET_STATS,this.handleGetLocalAudioStats),r.off(xe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(xe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(xe.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(xe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(xe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(r,i){i instanceof pE&&i.addListener(xe.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(r))}),i instanceof fE&&i.addListener(xe.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(r))})}unbindRemoteTrackEvents(r){r&&r.removeAllListeners(xe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i,s]=r;s.has(Be.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(Be.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(r,i){return r.map((s,a)=>{let u,d,{track:h,type:m}=s;switch(m){case ve.LocalAudioTrack:u=pn.Audio,d={dtx:h instanceof Mg&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ve.LocalVideoTrack:u=h._hints.includes(Mn.SCREEN_TRACK)?pn.Screen:pn.High,d=Qa(Qa({},KL(h)),{},{codec:this.store.codec});break;case ve.LocalVideoLowTrack:u=pn.Low,d=Qa(Qa({},KL(h)),{},{codec:this.store.codec})}return{stream_type:u,attributes:d,ssrcs:i[a]}})}createGatewayUnpublishMessage(r){return r.map(i=>{let s,[a,{track:u,ssrcs:d,id:h}]=i;switch(a){case ve.LocalVideoTrack:s=u._hints.includes(Mn.SCREEN_TRACK)?pn.Screen:pn.High;break;case ve.LocalAudioTrack:s=pn.Audio;break;case ve.LocalVideoLowTrack:s=pn.Low}return{stream_type:s,ssrcs:d,mid:h}})}assignLocalTracks(r,i){r.forEach((s,a)=>{let{track:u,type:d}=s;this.localTrackMap.set(d,{track:u,id:i[a].id,ssrcs:i[a].localSSRC})})}withdrawLocalTracks(r){r.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(r){r.onConnectionStateChange=async i=>{if(D.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(i,")")),this.emit(ot.PeerConnectionStateChange,i),i!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),i==="disconnected"&&r.iceConnectionState==="disconnected")return setTimeout(()=>{r.iceConnectionState==="disconnected"&&Q("ICE_RESTART")&&go(this,ot.QueryClientConnectionState)==="CONNECTED"&&this.emit(ot.RequestRestartICE)},800),void setTimeout(()=>{r.peerConnectionState==="disconnected"&&(D.debug("P2PConnection disconnected timeout 4000ms, force reconnect"),setTimeout(()=>this.emit(ot.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);i==="failed"&&(D.debug("P2PConnection state failed, force reconnect"),setTimeout(()=>this.emit(ot.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())},r.onICEConnectionStateChange=i=>{i!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(i,")")),Ie.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:i,tag:Ht.TRACER}).onSuccess(),this.emit(ot.IceConnectionStateChange,i)},r.onICETransportStateChange=i=>{D.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(i,")"))},r.onDTLSTransportStateChange=i=>{D.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(i,")"))},r.onDTLSTransportError=i=>{D.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(i,")"))},r.onFirstAudioDecoded=i=>{var s;const a=Array.from(cu(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===i);var u;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(u=a.audioTrack)===null||u===void 0||u.emit(Ml.FIRST_FRAME_DECODED),Ie.firstRemoteFrame(this.store.sessionId,Xn.FIRST_AUDIO_DECODE,qt.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId}))},r.onFirstAudioReceived=i=>{var s;const a=Array.from(cu(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===i);a&&Ie.firstRemoteFrame(this.store.sessionId,Xn.FIRST_AUDIO_RECEIVED,qt.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},r.onFirstVideoDecoded=(i,s,a)=>{this.reportVideoFirstFrameDecoded(i,s,a)},r.onFirstVideoReceived=i=>{var s;const a=Array.from(cu(s=this.remoteUserMap).call(s)).find(u=>u._videoSSRC===i);a&&Ie.firstRemoteFrame(this.store.sessionId,Xn.FIRST_VIDEO_RECEIVED,qt.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},r.onSelectedLocalCandidateChanged=(i,s)=>{const a=i.candidateType==="relay",u=s.candidateType==="relay";s.candidateType!=="unknown"&&a===u||this.emit(ot.ConnectionTypeChange,a),D.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Vg(s))," -> ").concat(JSON.stringify(Vg(i)),")"))},r.onSelectedRemoteCandidateChanged=(i,s)=>{D.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Vg(s))," -> ").concat(JSON.stringify(Vg(i)),")"))},r.onFirstVideoDecodedTimeout=i=>{this.reportVideoFirstFrameDecoded(i,void 0,void 0,!0)}}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(r){const i=[];if(this.getAllTracks().indexOf(r)===-1)return i;const s=this.localTrackMap.get(ve.LocalAudioTrack);if(r instanceof tr&&(s==null?void 0:s.track)instanceof Ki)return s.track.isActive||i.push([ve.LocalAudioTrack,s]),i;const a=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:d}]=u;return r===d});if(a&&(i.push(a),a[0]===ve.LocalVideoTrack)){const u=this.localTrackMap.get(ve.LocalVideoLowTrack);u&&i.push([ve.LocalVideoLowTrack,u])}return i}filterTobeUnmutedTracks(r){const i=[],s=this.localTrackMap.get(ve.LocalAudioTrack);if(r instanceof tr&&(s==null?void 0:s.track)instanceof Ki)return s.track.isActive&&i.push([ve.LocalAudioTrack,s]),i;const a=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:d}]=u;return r===d});if(a)if(a[0]===ve.LocalVideoTrack){i.push(a);const u=this.localTrackMap.get(ve.LocalVideoLowTrack);u&&i.push([ve.LocalVideoLowTrack,u])}else i.push(a);return i}createMuteMessage(r){return r.map(i=>{let s,[a,{track:u,ssrcs:d,id:h}]=i;switch(a){case ve.LocalAudioTrack:s=pn.Audio;break;case ve.LocalVideoTrack:s=u._hints.includes(Mn.SCREEN_TRACK)?pn.Screen:pn.High;break;case ve.LocalVideoLowTrack:s=pn.Low}return{stream_type:s,ssrcs:d,mid:h}})}createUnmuteMessage(r){return r.map(i=>{let s,[a,{track:u,ssrcs:d,id:h}]=i;switch(a){case ve.LocalAudioTrack:s=pn.Audio;break;case ve.LocalVideoTrack:s=u._hints.includes(Mn.SCREEN_TRACK)?pn.Screen:pn.High;break;case ve.LocalVideoLowTrack:s=pn.Low}return{stream_type:s,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(r,i){const s=[],a=this.remoteUserMap.get(r);if(!a)return s;if(i){const u=a.get(i);if(!u)return s;s.push([r,{kind:i,id:u}])}else Array.from(a.entries()).forEach(u=>{let[d,h]=u;s.push([r,{kind:d,id:h}])});return s}createUnsubscribeMessage(r){const i=[];return r.forEach(s=>{let[a,{kind:u,id:d}]=s;switch(u){case Be.VIDEO:return void(a._videoSSRC&&i.push({stream_type:Be.VIDEO,ssrcId:a._videoSSRC}));case Be.AUDIO:return void(a._audioSSRC&&i.push({stream_type:Be.AUDIO,ssrcId:a._audioSSRC}))}}),i}createUnsubscribeAllMessage(r){const i=new Map;return r.forEach(s=>{let[a,{kind:u}]=s;if(i.has(a)){let d=i.get(a);u===Be.VIDEO?d|=on.Video:d|=on.Audio,i.set(a,d)}else u===Be.VIDEO?i.set(a,on.Video):i.set(a,on.Audio)}),{users:Array.from(i.entries()).map(s=>{let[a,u]=s;return{stream_id:a.uid,stream_type:u}})}}withdrawRemoteTracks(r){r.forEach(i=>{let[s,{kind:a}]=i;const u=this.remoteUserMap.get(s);u&&(u.delete(a),Array.from(u.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(r){const i=this.localTrackMap.get(ve.LocalVideoTrack),s=this.localTrackMap.get(ve.LocalVideoLowTrack);i&&await i.track.setBitrateLimit(r.uplink),s&&r.low_stream_uplink&&await s.track.setBitrateLimit({max_bitrate:r.low_stream_uplink.bitrate,min_bitrate:r.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(r,i){return r.map((s,a)=>{var u;let{stream_type:d}=s;return(u=i.find(h=>{let{stream_type:m}=h;return d===m}))===null||u===void 0?void 0:u.attributes})}async tryToUnmuteAudio(r){for(let s=0;s<r.length;s++)if(r[s]instanceof tr){var i;const a=this.filterTobeUnmutedTracks(r[s]);if(a.length===0)continue;await((i=this.connection)===null||i===void 0?void 0:i.unmuteLocal(a.map(d=>{let[,{id:h}]=d;return h})));const u=this.createUnmuteMessage(a);return void await Jt(this,ot.RequestUnmuteLocal,u)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=r=>{var i;return!((i=this.connection)===null||i===void 0||!i.getRemoteVideoIsReady(r))},this.statsUploader.requestUpload=(r,i)=>this.emit(ot.RequestUploadStats,r,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Bn(lS(this.dtlsFailedCount,vn)),this.emit(ot.RequestReconnect)}async reconnectP2P(){const r=Array.from(this.localTrackMap.entries()),i=this.createGatewayUnpublishMessage(r);Array.from(this.remoteUserMap.entries()),i.length>0&&await nr(this,ot.RequestUnpublishForReconnectPC,i),this.disconnectForReconnect(),this.emit(ot.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ve.LocalVideoTrack)||this.pendingLocalTracks.some(r=>r instanceof un)}throwIfTrackTypeNotMatch(r){if(r.filter(i=>i instanceof un).length>1)throw new j(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r.filter(i=>i instanceof tr).length>1&&(r.some(i=>i instanceof tr&&i._bypassWebAudio)||!er().webAudioMediaStreamDest))throw new j(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of r){if(i instanceof un&&this.pendingLocalTracks.some(s=>s instanceof un))throw new j(V.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof tr&&this.pendingLocalTracks.some(s=>s instanceof tr)&&(!er().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof tr&&s._bypassWebAudio)))throw new j(V.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(r,i){const s=er().supportDualStreamEncoding,a=Qa(Qa({},{width:160,height:120,framerate:15,bitrate:50}),i);let u;u=s?r._mediaStreamTrack.clone():d3(r,a);const d=$t(8,"track-low-"),h=new un(u,Qa(Qa({},s&&{scaleResolutionDownBy:vee(a,r)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h._hints.push(Mn.LOW_STREAM),r.addListener(xe.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}reportVideoFirstFrameDecoded(r,i,s,a){var u;const d=Array.from(cu(u=this.remoteUserMap).call(u)).find(h=>h._videoSSRC===r);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===d.uid&&g.type==="video");Ie.firstRemoteVideoDecode(this.store.sessionId,Xn.FIRST_VIDEO_DECODE,qt.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:i,videoheight:s,subscribeElapse:qi.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(r,i,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(r);if(!a)return!1;const u=a.get(i);if(!u)return!1;const d=await this.connection.getRemoteSSRC(u);return d!==void 0&&d!==s}}).prototype,"startP2PConnection",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"startP2PConnection"),ct.prototype),ae(ct.prototype,"connect",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"connect"),ct.prototype),ae(ct.prototype,"preConnect",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"preConnect"),ct.prototype),ae(ct.prototype,"unpublish",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"unpublish"),ct.prototype),ae(ct.prototype,"unpublishLowStream",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"unpublishLowStream"),ct.prototype),ae(ct.prototype,"subscribe",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"subscribe"),ct.prototype),ae(ct.prototype,"massSubscribe",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"massSubscribe"),ct.prototype),ae(ct.prototype,"unsubscribe",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"unsubscribe"),ct.prototype),ae(ct.prototype,"massUnsubscribe",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"massUnsubscribe"),ct.prototype),ae(ct.prototype,"muteRemote",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"muteRemote"),ct.prototype),ae(ct.prototype,"unmuteRemote",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"unmuteRemote"),ct.prototype),ae(ct.prototype,"hasRemoteMediaWithLock",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"hasRemoteMediaWithLock"),ct.prototype),ae(ct.prototype,"disconnectForReconnect",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"disconnectForReconnect"),ct.prototype),ae(ct.prototype,"updateBitrateLimit",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"updateBitrateLimit"),ct.prototype),ae(ct.prototype,"remoteMediaSsrcChanged",[fi],Object.getOwnPropertyDescriptor(ct.prototype,"remoteMediaSsrcChanged"),ct.prototype),ct);function fi(r,i,s){const a=r[i];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const u=this.mutex,d=await u.lock("From P2PChannel.".concat(i));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function Os(r){return"Minified Redux error #"+r+"; visit https://redux.js.org/Errors?code="+r+" for the full message or use the non-minified dev environment for full errors. "}var tt,N3=typeof Symbol=="function"&&Symbol.observable||"@@observable",gR=function(){return Math.random().toString(36).substring(7).split("").join(".")},P3={INIT:"@@redux/INIT"+gR(),REPLACE:"@@redux/REPLACE"+gR(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+gR()}};function kre(r){if(typeof r!="object"||r===null)return!1;for(var i=r;Object.getPrototypeOf(i)!==null;)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(r)===i}function D3(r,i,s){var a;if(typeof i=="function"&&typeof s=="function"||typeof s=="function"&&typeof arguments[3]=="function")throw new Error(Os(0));if(typeof i=="function"&&s===void 0&&(s=i,i=void 0),s!==void 0){if(typeof s!="function")throw new Error(Os(1));return s(D3)(r,i)}if(typeof r!="function")throw new Error(Os(2));var u=r,d=i,h=[],m=h,g=!1;function p(){m===h&&(m=h.slice())}function E(){if(g)throw new Error(Os(3));return d}function v(N){if(typeof N!="function")throw new Error(Os(4));if(g)throw new Error(Os(5));var P=!0;return p(),m.push(N),function(){if(P){if(g)throw new Error(Os(6));P=!1,p();var L=m.indexOf(N);m.splice(L,1),h=null}}}function T(N){if(!kre(N))throw new Error(Os(7));if(N.type===void 0)throw new Error(Os(8));if(g)throw new Error(Os(9));try{g=!0,d=u(d,N)}finally{g=!1}for(var P=h=m,L=0;L<P.length;L++)(0,P[L])();return N}function I(N){if(typeof N!="function")throw new Error(Os(10));u=N,T({type:P3.REPLACE})}function O(){var N,P=v;return(N={subscribe:function(L){if(typeof L!="object"||L===null)throw new Error(Os(11));function x(){L.next&&L.next(E())}return x(),{unsubscribe:P(x)}}})[N3]=function(){return this},N}return T({type:P3.INIT}),(a={dispatch:T,subscribe:v,getState:E,replaceReducer:I})[N3]=O,a}function k3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function Ae(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?k3(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):k3(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}(function(r){r.SET_SESSION_ID="SET_SESSION_ID",r.SET_P2P_ID="SET_P2P_id",r.SET_DC_ID="SET_DC_id",r.SET_UID="SET_UID",r.SET_PUB_ID="SET_PUB_ID",r.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",r.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",r.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",r.AVOID_JOIN_START="AVOID_JOIN_START",r.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",r.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",r.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",r.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",r.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",r.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",r.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",r.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",r.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",r.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",r.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",r.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",r.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",r.RESET_KEY_METRICS="RESET_KEY_METRICS"})(tt||(tt={}));class Lre{constructor(i,s,a,u){C(this,"store",void 0),C(this,"reducer",void 0);const d={codec:i,audioCodec:s,mode:a,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled"};this.reducer=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:d,m=arguments.length>1?arguments[1]:void 0;switch(m.type){case tt.SET_SESSION_ID:return Ae(Ae({},h),{},{sessionId:m.sessionId});case tt.SET_P2P_ID:return Ae(Ae({},h),{},{p2pId:m.p2pId});case tt.SET_UID:return Ae(Ae({},h),{},{uid:m.uid});case tt.SET_PUB_ID:return Ae(Ae({},h),{},{pubId:m.pubId});case tt.KEY_METRIC_CLIENT_CREATED:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{clientCreated:m.metric})});case tt.KEY_METRIC_JOIN_START:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{joinStart:m.metric})});case tt.AVOID_JOIN_START:return Ae(Ae({},h),{},{avoidJoinStart:m.avoidJoinStart});case tt.KEY_METRIC_JOIN_END:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{joinEnd:m.metric})});case tt.KEY_METRIC_REQUEST_AP_START:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{requestAPStart:m.metric})});case tt.KEY_METRIC_REQUEST_AP_END:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{requestAPEnd:m.metric})});case tt.KEY_METRIC_JOIN_GATEWAY_START:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{joinGatewayStart:m.metric})});case tt.KEY_METRIC_JOIN_GATEWAY_END:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{joinGatewayEnd:m.metric})});case tt.KEY_METRIC_PEER_CONNECTION_START:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{peerConnectionStart:m.metric})});case tt.KEY_METRIC_PEER_CONNECTION_END:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{peerConnectionEnd:m.metric})});case tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{signalChannelOpen:m.metric})});case tt.KEY_METRIC_ICE_CONNECTION_END:return Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{iceConnectionEnd:m.metric})});case tt.KEY_METRIC_PUBLISH:{const g=h.keyMetrics.publish,p=g.findIndex(E=>E.trackId===m.metric.trackId);return p!==-1?(g[p]=Ae(Ae({},g[p]),m.metric),Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{publish:[...g]})})):Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{publish:[...h.keyMetrics.publish,m.metric]})})}case tt.KEY_METRIC_SUBSCRIBE:{const g=h.keyMetrics.subscribe,p=g.findIndex(E=>E.userId===m.metric.userId&&E.type===m.metric.type);return p!==-1?(g[p]=Ae(Ae({},g[p]),m.metric),Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{subscribe:[...g]})})):Ae(Ae({},h),{},{keyMetrics:Ae(Ae({},h.keyMetrics),{},{subscribe:[...h.keyMetrics.subscribe,m.metric]})})}case tt.SET_CLOUD_PROXY_SERVER_MODE:return h.cloudProxyServerMode=m.mode,h;case tt.RECORD_JOIN_CHANNEL_SERVICE:return typeof m.index!="number"?h.joinChannelServiceRecords=[...h.joinChannelServiceRecords,m.record]:(h.joinChannelServiceRecords[m.index]=Ae(Ae({},h.joinChannelServiceRecords[m.index]),m.record),h.joinChannelServiceRecords=[...h.joinChannelServiceRecords]),h;case tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return h.joinChannelServiceRecords=[],h;case tt.RESET_KEY_METRICS:return h.keyMetrics={publish:[],subscribe:[]},h;default:return h}},this.store=D3(this.reducer)}set sessionId(i){this.store.dispatch({type:tt.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.store.getState().sessionId}get codec(){return this.store.getState().codec}get audioCodec(){return this.store.getState().audioCodec}get clientId(){return this.store.getState().clientId}set p2pId(i){this.store.dispatch({type:tt.SET_P2P_ID,p2pId:i})}get p2pId(){return this.store.getState().p2pId}set dcId(i){this.store.dispatch({type:tt.SET_DC_ID,dcId:i})}get dcId(){return this.store.getState().dcId}set uid(i){this.store.dispatch({type:tt.SET_UID,uid:i})}get uid(){return this.store.getState().uid}set pubId(i){this.store.dispatch({type:tt.SET_PUB_ID,pubId:i})}get pubId(){return this.store.getState().pubId}set cloudProxyServerMode(i){this.store.dispatch({type:tt.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.store.getState().cloudProxyServerMode}clientCreated(){this.store.dispatch({type:tt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.store.dispatch({type:tt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.store.dispatch({type:tt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.store.dispatch({type:tt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.store.dispatch({type:tt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.store.dispatch({type:tt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.store.dispatch({type:tt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.store.dispatch({type:tt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.store.dispatch({type:tt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}signalChannelOpen(){this.store.dispatch({type:tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.store.dispatch({type:tt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,a,u){this.store.dispatch({type:tt.KEY_METRIC_PUBLISH,metric:Ae(Ae({trackId:i,type:s},a&&{publishStart:a}),u&&{publishEnd:u})})}subscribe(i,s,a,u,d,h,m){this.store.dispatch({type:tt.KEY_METRIC_SUBSCRIBE,metric:Ae(Ae(Ae(Ae(Ae({userId:i,type:s},a&&{subscribeStart:a}),u&&{subscribeEnd:u}),d&&{firstFrame:d}),h&&{streamAdded:h}),m&&{firstDecoded:m})})}massSubscribe(i,s,a,u){i.forEach(d=>{this.store.dispatch({type:tt.KEY_METRIC_SUBSCRIBE,metric:Ae(Ae(Ae({userId:d.userId,type:d.type},s&&{subscribeStart:s}),a&&{subscribeEnd:a}),u&&{firstFrame:u})})})}get keyMetrics(){return this.store.getState().keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.store.dispatch({type:tt.RECORD_JOIN_CHANNEL_SERVICE,record:Ae(Ae({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.store.getState().joinChannelServiceRecords.length-1):(s<0||s>=this.store.getState().joinChannelServiceRecords.length||this.store.dispatch({type:tt.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.store.dispatch({type:tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.store.dispatch({type:tt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.store.getState().joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.store.getState().avoidJoinStart}set avoidJoinStart(i){this.store.dispatch({type:tt.AVOID_JOIN_START,avoidJoinStart:i})}}let EE;const Mre=()=>(EE||EE||(EE=(window.location.protocol.split(":")[0]||"").toUpperCase(),EE))==="HTTPS",L3=()=>window.isSecureContext!==void 0;function xre(r){let i=U3();return function(s,a){let u=s.appId;u!==void 0&&(gt(a,10),yo(a,u));let d=s.cid;d!==void 0&&(gt(a,16),gt(a,d));let h=s.cname;h!==void 0&&(gt(a,26),yo(a,h));let m=s.deviceId;m!==void 0&&(gt(a,34),yo(a,m));let g=s.elapse;g!==void 0&&(gt(a,40),Za(a,g));let p=s.fileSize;p!==void 0&&(gt(a,48),Za(a,td(p)));let E=s.height;E!==void 0&&(gt(a,56),Za(a,td(E)));let v=s.jpg;v!==void 0&&(gt(a,66),gt(a,v.length),function(ne,$){let Z=nd(ne,$.length);ne.bytes.set($,Z)}(a,v));let T=s.networkType;T!==void 0&&(gt(a,72),Za(a,td(T)));let I=s.osType;I!==void 0&&(gt(a,80),Za(a,td(I)));let O=s.requestId;O!==void 0&&(gt(a,90),yo(a,O));let N=s.sdkVersion;N!==void 0&&(gt(a,98),yo(a,N));let P=s.sequence;P!==void 0&&(gt(a,104),Za(a,td(P)));let L=s.sid;L!==void 0&&(gt(a,114),yo(a,L));let x=s.timestamp;x!==void 0&&(gt(a,120),Za(a,x));let W=s.uid;W!==void 0&&(gt(a,128),gt(a,W));let q=s.vid;q!==void 0&&(gt(a,136),gt(a,q));let X=s.width;X!==void 0&&(gt(a,144),Za(a,td(X)));let ie=s.service;ie!==void 0&&(gt(a,152),gt(a,ie));let ee=s.callbackData;ee!==void 0&&(gt(a,162),yo(a,ee));let le=s.jpgEncryption;le!==void 0&&(gt(a,168),gt(a,le));let he=s.requestType;he!==void 0&&(gt(a,176),gt(a,he));let ue=s.scorePorn;ue!==void 0&&(gt(a,185),SR(a,ue));let Ce=s.scoreSexy;Ce!==void 0&&(gt(a,193),SR(a,Ce));let De=s.scoreNeutral;De!==void 0&&(gt(a,201),SR(a,De));let je=s.scene;je!==void 0&&(gt(a,208),gt(a,je));let fe=s.ossFilePrefix;fe!==void 0&&(gt(a,218),yo(a,fe));let J=s.serviceVendor;if(J!==void 0)for(let ne of J){gt(a,226);let $=U3();Fre(ne,$),gt(a,$.limit),Wre(a,$),Gre($)}}(r,i),function(s){let a=s.bytes,u=s.limit;return a.length===u?a:a.subarray(0,u)}(i)}function Ure(r){return function(s){let a={};e:for(;!V3(s);){let u=So(s);switch(u>>>3){case 0:break e;case 1:a.code=So(s);break;case 2:a.msg=F3(s,So(s));break;case 3:{let d=jre(s);a.data=Vre(s),s.limit=d;break}default:M3(s,7&u)}}return a}({bytes:i=r,offset:0,limit:i.length});var i}function Vre(r){let i={};e:for(;!V3(r);){let s=So(r);switch(s>>>3){case 0:break e;case 1:i.requestId=F3(r,So(r));break;case 2:i.requestType=So(r)>>>0;break;case 3:i.scorePorn=yR(r);break;case 4:i.scoreSexy=yR(r);break;case 5:i.scoreNeutral=yR(r);break;case 6:i.requestScene=So(r)>>>0;break;case 7:i.scene=So(r)>>>0;break;default:M3(r,7&s)}}return i}function Fre(r,i){let s=r.service;s!==void 0&&(gt(i,8),gt(i,s));let a=r.vendor;a!==void 0&&(gt(i,16),gt(i,a));let u=r.token;u!==void 0&&(gt(i,26),yo(i,u));let d=r.callbackUrl;d!==void 0&&(gt(i,34),yo(i,d))}function jre(r){let i=So(r),s=r.limit;return r.limit=r.offset+i,s}function M3(r,i){switch(i){case 0:for(;128&j3(r););break;case 2:_R(r,So(r));break;case 5:_R(r,4);break;case 1:_R(r,8);break;default:throw new Error("Unimplemented type: "+i)}}let Bre=new Float32Array(1);new Uint8Array(Bre.buffer);let ER=new Float64Array(1),Qr=new Uint8Array(ER.buffer);function td(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}let x3=[];function U3(){const r=x3.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}function Gre(r){x3.push(r)}function _R(r,i){if(r.offset+i>r.limit)throw new Error("Skip past limit");r.offset+=i}function V3(r){return r.offset>=r.limit}function nd(r,i){let s=r.bytes,a=r.offset,u=r.limit,d=a+i;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),r.bytes=h}return r.offset=d,d>u&&(r.limit=d),a}function vR(r,i){let s=r.offset;if(s+i>r.limit)throw new Error("Read past limit");return r.offset+=i,s}function F3(r,i){let s=vR(r,i),a=String.fromCharCode,u=r.bytes,d="�",h="";for(let m=0;m<i;m++){let g,p,E,v,T=u[m+s];128&T?(224&T)==192?m+1>=i?h+=d:(g=u[m+s+1],(192&g)!=128?h+=d:(v=(31&T)<<6|63&g,v<128?h+=d:(h+=a(v),m++))):(240&T)==224?m+2>=i?h+=d:(g=u[m+s+1],p=u[m+s+2],(49344&(g|p<<8))!=32896?h+=d:(v=(15&T)<<12|(63&g)<<6|63&p,v<2048||v>=55296&&v<=57343?h+=d:(h+=a(v),m+=2))):(248&T)==240?m+3>=i?h+=d:(g=u[m+s+1],p=u[m+s+2],E=u[m+s+3],(12632256&(g|p<<8|E<<16))!=8421504?h+=d:(v=(7&T)<<18|(63&g)<<12|(63&p)<<6|63&E,v<65536||v>1114111?h+=d:(v-=65536,h+=a(55296+(v>>10),56320+(1023&v)),m+=3))):h+=d:h+=a(T)}return h}function yo(r,i){let s=i.length,a=0;for(let h=0;h<s;h++){let m=i.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+i.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}gt(r,a);let u=nd(r,a),d=r.bytes;for(let h=0;h<s;h++){let m=i.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+i.charCodeAt(++h)-56613888),m<128?d[u++]=m:(m<2048?d[u++]=m>>6&31|192:(m<65536?d[u++]=m>>12&15|224:(d[u++]=m>>18&7|240,d[u++]=m>>12&63|128),d[u++]=m>>6&63|128),d[u++]=63&m|128)}}function Wre(r,i){let s=nd(r,i.limit),a=r.bytes,u=i.bytes;for(let d=0,h=i.limit;d<h;d++)a[d+s]=u[d]}function j3(r){return r.bytes[vR(r,1)]}function B3(r,i){let s=nd(r,1);r.bytes[s]=i}function yR(r){let i=vR(r,8),s=r.bytes;return Qr[0]=s[i++],Qr[1]=s[i++],Qr[2]=s[i++],Qr[3]=s[i++],Qr[4]=s[i++],Qr[5]=s[i++],Qr[6]=s[i++],Qr[7]=s[i++],ER[0]}function SR(r,i){let s=nd(r,8),a=r.bytes;ER[0]=i,a[s++]=Qr[0],a[s++]=Qr[1],a[s++]=Qr[2],a[s++]=Qr[3],a[s++]=Qr[4],a[s++]=Qr[5],a[s++]=Qr[6],a[s++]=Qr[7]}function So(r){let i,s=0,a=0;do i=j3(r),s<32&&(a|=(127&i)<<s),s+=7;while(128&i);return a}function gt(r,i){for(i>>>=0;i>=128;)B3(r,127&i|128),i>>>=7;B3(r,i)}function Za(r,i){let s=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,u=i.high>>>24,d=u===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:u<128?9:10,h=nd(r,d),m=r.bytes;switch(d){case 10:m[h+9]=u>>>7&1;case 9:m[h+8]=d!==9?128|u:127&u;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}var G3={};Object.defineProperty(G3,"__esModule",{value:!0});var W3=function(){function r(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return r.hashStr=function(i,s){return s===void 0&&(s=!1),this.onePassHasher.start().appendStr(i).end(s)},r.hashAsciiStr=function(i,s){return s===void 0&&(s=!1),this.onePassHasher.start().appendAsciiStr(i).end(s)},r._hex=function(i){var s,a,u,d,h=r.hexChars,m=r.hexOut;for(d=0;d<4;d+=1)for(a=8*d,s=i[d],u=0;u<8;u+=2)m[a+1+u]=h.charAt(15&s),s>>>=4,m[a+0+u]=h.charAt(15&s),s>>>=4;return m.join("")},r._md5cycle=function(i,s){var a=i[0],u=i[1],d=i[2],h=i[3];u=((u+=((d=((d+=((h=((h+=((a=((a+=(u&d|~u&h)+s[0]-680876936|0)<<7|a>>>25)+u|0)&u|~a&d)+s[1]-389564586|0)<<12|h>>>20)+a|0)&a|~h&u)+s[2]+606105819|0)<<17|d>>>15)+h|0)&h|~d&a)+s[3]-1044525330|0)<<22|u>>>10)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u&d|~u&h)+s[4]-176418897|0)<<7|a>>>25)+u|0)&u|~a&d)+s[5]+1200080426|0)<<12|h>>>20)+a|0)&a|~h&u)+s[6]-1473231341|0)<<17|d>>>15)+h|0)&h|~d&a)+s[7]-45705983|0)<<22|u>>>10)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u&d|~u&h)+s[8]+1770035416|0)<<7|a>>>25)+u|0)&u|~a&d)+s[9]-1958414417|0)<<12|h>>>20)+a|0)&a|~h&u)+s[10]-42063|0)<<17|d>>>15)+h|0)&h|~d&a)+s[11]-1990404162|0)<<22|u>>>10)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u&d|~u&h)+s[12]+1804603682|0)<<7|a>>>25)+u|0)&u|~a&d)+s[13]-40341101|0)<<12|h>>>20)+a|0)&a|~h&u)+s[14]-1502002290|0)<<17|d>>>15)+h|0)&h|~d&a)+s[15]+1236535329|0)<<22|u>>>10)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u&h|d&~h)+s[1]-165796510|0)<<5|a>>>27)+u|0)&d|u&~d)+s[6]-1069501632|0)<<9|h>>>23)+a|0)&u|a&~u)+s[11]+643717713|0)<<14|d>>>18)+h|0)&a|h&~a)+s[0]-373897302|0)<<20|u>>>12)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u&h|d&~h)+s[5]-701558691|0)<<5|a>>>27)+u|0)&d|u&~d)+s[10]+38016083|0)<<9|h>>>23)+a|0)&u|a&~u)+s[15]-660478335|0)<<14|d>>>18)+h|0)&a|h&~a)+s[4]-405537848|0)<<20|u>>>12)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u&h|d&~h)+s[9]+568446438|0)<<5|a>>>27)+u|0)&d|u&~d)+s[14]-1019803690|0)<<9|h>>>23)+a|0)&u|a&~u)+s[3]-187363961|0)<<14|d>>>18)+h|0)&a|h&~a)+s[8]+1163531501|0)<<20|u>>>12)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u&h|d&~h)+s[13]-1444681467|0)<<5|a>>>27)+u|0)&d|u&~d)+s[2]-51403784|0)<<9|h>>>23)+a|0)&u|a&~u)+s[7]+1735328473|0)<<14|d>>>18)+h|0)&a|h&~a)+s[12]-1926607734|0)<<20|u>>>12)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u^d^h)+s[5]-378558|0)<<4|a>>>28)+u|0)^u^d)+s[8]-2022574463|0)<<11|h>>>21)+a|0)^a^u)+s[11]+1839030562|0)<<16|d>>>16)+h|0)^h^a)+s[14]-35309556|0)<<23|u>>>9)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u^d^h)+s[1]-1530992060|0)<<4|a>>>28)+u|0)^u^d)+s[4]+1272893353|0)<<11|h>>>21)+a|0)^a^u)+s[7]-155497632|0)<<16|d>>>16)+h|0)^h^a)+s[10]-1094730640|0)<<23|u>>>9)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u^d^h)+s[13]+681279174|0)<<4|a>>>28)+u|0)^u^d)+s[0]-358537222|0)<<11|h>>>21)+a|0)^a^u)+s[3]-722521979|0)<<16|d>>>16)+h|0)^h^a)+s[6]+76029189|0)<<23|u>>>9)+d|0,u=((u+=((d=((d+=((h=((h+=((a=((a+=(u^d^h)+s[9]-640364487|0)<<4|a>>>28)+u|0)^u^d)+s[12]-421815835|0)<<11|h>>>21)+a|0)^a^u)+s[15]+530742520|0)<<16|d>>>16)+h|0)^h^a)+s[2]-995338651|0)<<23|u>>>9)+d|0,u=((u+=((h=((h+=(u^((a=((a+=(d^(u|~h))+s[0]-198630844|0)<<6|a>>>26)+u|0)|~d))+s[7]+1126891415|0)<<10|h>>>22)+a|0)^((d=((d+=(a^(h|~u))+s[14]-1416354905|0)<<15|d>>>17)+h|0)|~a))+s[5]-57434055|0)<<21|u>>>11)+d|0,u=((u+=((h=((h+=(u^((a=((a+=(d^(u|~h))+s[12]+1700485571|0)<<6|a>>>26)+u|0)|~d))+s[3]-1894986606|0)<<10|h>>>22)+a|0)^((d=((d+=(a^(h|~u))+s[10]-1051523|0)<<15|d>>>17)+h|0)|~a))+s[1]-2054922799|0)<<21|u>>>11)+d|0,u=((u+=((h=((h+=(u^((a=((a+=(d^(u|~h))+s[8]+1873313359|0)<<6|a>>>26)+u|0)|~d))+s[15]-30611744|0)<<10|h>>>22)+a|0)^((d=((d+=(a^(h|~u))+s[6]-1560198380|0)<<15|d>>>17)+h|0)|~a))+s[13]+1309151649|0)<<21|u>>>11)+d|0,u=((u+=((h=((h+=(u^((a=((a+=(d^(u|~h))+s[4]-145523070|0)<<6|a>>>26)+u|0)|~d))+s[11]-1120210379|0)<<10|h>>>22)+a|0)^((d=((d+=(a^(h|~u))+s[2]+718787259|0)<<15|d>>>17)+h|0)|~a))+s[9]-343485551|0)<<21|u>>>11)+d|0,i[0]=a+i[0]|0,i[1]=u+i[1]|0,i[2]=d+i[2]|0,i[3]=h+i[3]|0},r.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(r.stateIdentity),this},r.prototype.appendStr=function(i){var s,a,u=this._buffer8,d=this._buffer32,h=this._bufferLength;for(a=0;a<i.length;a+=1){if((s=i.charCodeAt(a))<128)u[h++]=s;else if(s<2048)u[h++]=192+(s>>>6),u[h++]=63&s|128;else if(s<55296||s>56319)u[h++]=224+(s>>>12),u[h++]=s>>>6&63|128,u[h++]=63&s|128;else{if((s=1024*(s-55296)+(i.charCodeAt(++a)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");u[h++]=240+(s>>>18),u[h++]=s>>>12&63|128,u[h++]=s>>>6&63|128,u[h++]=63&s|128}h>=64&&(this._dataLength+=64,r._md5cycle(this._state,d),h-=64,d[0]=d[16])}return this._bufferLength=h,this},r.prototype.appendAsciiStr=function(i){for(var s,a=this._buffer8,u=this._buffer32,d=this._bufferLength,h=0;;){for(s=Math.min(i.length-h,64-d);s--;)a[d++]=i.charCodeAt(h++);if(d<64)break;this._dataLength+=64,r._md5cycle(this._state,u),d=0}return this._bufferLength=d,this},r.prototype.appendByteArray=function(i){for(var s,a=this._buffer8,u=this._buffer32,d=this._bufferLength,h=0;;){for(s=Math.min(i.length-h,64-d);s--;)a[d++]=i[h++];if(d<64)break;this._dataLength+=64,r._md5cycle(this._state,u),d=0}return this._bufferLength=d,this},r.prototype.getState=function(){var i=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[i[0],i[1],i[2],i[3]]}},r.prototype.setState=function(i){var s,a=i.buffer,u=i.state,d=this._state;for(this._dataLength=i.length,this._bufferLength=i.buflen,d[0]=u[0],d[1]=u[1],d[2]=u[2],d[3]=u[3],s=0;s<a.length;s+=1)this._buffer8[s]=a.charCodeAt(s)},r.prototype.end=function(i){i===void 0&&(i=!1);var s=this._bufferLength,a=this._buffer8,u=this._buffer32,d=1+(s>>2);this._dataLength+=s;var h=8*this._dataLength;if(a[s]=128,a[s+1]=a[s+2]=a[s+3]=0,u.set(r.buffer32Identity.subarray(d),d),s>55&&(r._md5cycle(this._state,u),u.set(r.buffer32Identity)),h<=4294967295)u[14]=h;else{var m=h.toString(16).match(/(.*?)(.{0,8})$/);if(m===null)return;var g=parseInt(m[2],16),p=parseInt(m[1],16)||0;u[14]=g,u[15]=p}return r._md5cycle(this._state,u),i?this._state:r._hex(this._state)},r.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),r.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),r.hexChars="0123456789abcdef",r.hexOut=[],r.onePassHasher=new r,r}(),Hre=G3.Md5=W3;if(W3.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");const $re=async(r,i,s)=>await(async(a,u,d)=>{const h=""+u+d,m=new Uint8Array(Hre.hashStr(h,!0).buffer).slice(0,16),g=m.slice(0,12),p=await window.crypto.subtle.importKey("raw",m,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:g},p,a))})(r.buffer,i,s);function H3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}const Kre=new Map([["moderation",1],["supervise",2]]);class _E extends Wt{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const s=this._connectionState;this._connectionState=i,this.emit(fn.CONNECTION_STATE_CHANGE,s,i)}get inspectType(){return this._inspectType}set inspectType(i){var s;this._inspectMode=xa(s=i.map(a=>Kre.get(a)||0)).call(s,(a,u)=>a+u),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),C(this,"name","AgoraRTCVideoContentInspect"),C(this,"_connectionState",wi.CONNECTING),C(this,"_innerConnectionState",void 0),C(this,"sequence",0),C(this,"inspectStartTime",void 0),C(this,"workerManagerConnection",void 0),C(this,"workerConnection",void 0),C(this,"workerMessageLengthLimit",void 0),C(this,"inspectIntervalMinimum",void 0),C(this,"qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",gs.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"wmSequence",0),C(this,"inspectInterval",void 0),C(this,"inspectTimer",null),C(this,"ossFilePrefix",void 0),C(this,"extraInfo",void 0),C(this,"_inspectType",void 0),C(this,"_inspectMode",void 0),C(this,"_quality",1),C(this,"qualityTimer",null),C(this,"_inspectId",void 0),C(this,"_needWorkUrlOnly",!1),C(this,"inspectImage",()=>{if(this.connectionState!==wi.CONNECTED)throw new j(V.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===wi.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=$t(5,"inspect-"),this.workerMessageLengthLimit=Q("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Q("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Q("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Yl("worker-manager-"+this._inspectId,vn),this.on(fn.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,D.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ci[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Yl("worker-"+this._inspectId,vn),this.handleWorkerEvents()}async init(i,s){this.emit(fn.STATE_CHANGE,Ci.CONNECT_AP),this._connectInfo=i;const a=this._cancelTokenSource.token;return this._retryConfig=s,new _e((u,d)=>{this.on(fn.CONNECTION_STATE_CHANGE,(h,m)=>{m===wi.CONNECTED&&u()}),this.requestAP(i,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(i,s,a){const u=Q("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,g,p,E){let{appId:v,areaCode:T,cname:I,sid:O,token:N,uid:P}=g;PT++;const L="image_moderation_api",x={service_name:L,json_body:JSON.stringify({appId:v,areaCode:T,cname:I,command:"allocateEdge",requestId:PT,seq:PT,sid:O,token:N,ts:Date.now(),uid:P+""})};let W,q,X=m[0];return po(async()=>{W=Date.now();const ie=await Hs(X,{data:x,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(q=Date.now()-W,ie.code!==0){const ue=new j(V.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ie.code,{retry:!0,responseTime:q});throw D.error(ue.toString()),ue}const ee=JSON.parse(ie.json_body);if(ee.code!==200){const ue=new j(V.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ee.code,", reason: ").concat(ee.reason),{code:ee.code,responseTime:q});throw D.error(ue.toString()),ue}if(!ee.servers||!Array.isArray(ee.servers)||ee.servers.length===0){const ue=new j(V.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ee.code,responseTime:q});throw D.error(ue.toString()),ue}const le=Q("VIDEO_INSPECT_WORKER_MANAGER_HOST"),he=Q("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ee.servers.map(ue=>{let{address:Ce,wss:De}=ue;if(Ce&&De)return"wss://".concat(Ce.replace(/\./g,"-"),".").concat(le,":").concat(he||De)}).filter(ue=>!!ue),workerToken:ee.workerToken,vid:ee.vid,responseTime:q}},(ie,ee)=>(Ie.apworkerEvent(O,{success:!0,sc:200,serviceName:L,responseDetail:JSON.stringify(ie.addressList),firstSuccess:ee===0,responseTime:q,serverIp:m[ee%m.length]}),!1),(ie,ee)=>(Ie.apworkerEvent(O,{success:!1,sc:ie.data&&ie.data.code||200,serviceName:L,responseTime:q,serverIp:m[ee%m.length]}),!!(ie.code!==V.OPERATION_ABORTED&&ie.code!==V.UNEXPECTED_RESPONSE||ie.data&&ie.data.retry)&&(X=m[(ee+1)%m.length],!0)),E)}(u,i,s,a);this.emit(fn.STATE_CHANGE,Ci.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(i){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(fn.STATE_CHANGE,Ci.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(i,1e4)}async connectWorker(i){await this.workerConnection.init([i])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ge.CONNECTED,async()=>{this.emit(fn.STATE_CHANGE,Ci.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.16.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ge.CLOSED,()=>{this._innerConnectionState<Ci.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ge.FAILED,()=>{this._innerConnectionState<Ci.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ge.RECONNECTING,()=>{this._innerConnectionState<Ci.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ge.ON_MESSAGE,async i=>{this.emit(fn.STATE_CHANGE,Ci.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(i.data);if(a.code!==200)throw D.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new j(V.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw D.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new j(V.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const u=Q("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(u));this.emit(fn.STATE_CHANGE,Ci.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(fn.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(Ge.WILL_RECONNECT,(i,s)=>{s(i)}),this.workerManagerConnection.on(Ge.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}handleWorkerEvents(){this.workerConnection.on(Ge.CONNECTED,async()=>{this.emit(fn.STATE_CHANGE,Ci.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=wi.CONNECTED}),this.workerConnection.on(Ge.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const a=Ure(new Uint8Array(i.data));if(Q("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&D.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(fn.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const u={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=xa(s=Object.keys(u)).call(s,(m,g)=>u[m]>u[g]?m:g,"porn"),h=Object.keys(u).find(m=>m===d);this.emit(fn.INSPECT_RESULT,h)}else this.emit(fn.INSPECT_RESULT,void 0,new j(V.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(fn.INSPECT_RESULT,void 0,new j(V.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else D.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(fn.INSPECT_RESULT,void 0,new j(V.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ge.CLOSED,()=>{this.connectionState=wi.CLOSED}),this.workerConnection.on(Ge.FAILED,()=>{this.connectionState=wi.CLOSED}),this.workerConnection.on(Ge.RECONNECTING,()=>{this.connectionState=this.connectionState===wi.CONNECTED?wi.RECONNECTING:wi.CONNECTING}),this.workerConnection.on(Ge.WILL_RECONNECT,(i,s)=>{i==="recover"&&s(i),s("tryNext")}),this.workerConnection.on(Ge.REQUEST_NEW_URLS,(i,s)=>{this.workerManagerConnection.close(),this.once(fn.REQUEST_NEW_WORKER_URL,a=>{i([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}async requestToInspectImage(){this.sequence++;const i=go(this,fn.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void this.emit(fn.INSPECT_RESULT,void 0,new j(V.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(i,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(fn.INSPECT_RESULT,void 0,new j(V.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(i,s){let{appId:a,cname:u,cid:d,vid:h,sid:m,uid:g}=s;const p=Date.now(),E=await i.getCurrentFrameImage("image/jpeg",this.quality),v=await $re(E,a,u),T=this.sequence+"-"+d+"-"+g+"-"+p+"-"+$t(12,""),I={appId:a,cid:d,cname:u,deviceId:"",elapse:_E.intToLong(Number(p-this.inspectStartTime)),fileSize:v.byteLength,jpgEncryption:2,height:E.height,width:E.width,jpg:v,networkType:6,osType:7,requestId:T,sdkVersion:"4.16.1",sequence:this.sequence,sid:m,timestamp:_E.intToLong(p),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete I.callbackData,this.ossFilePrefix===void 0&&delete I.ossFilePrefix;const O=xre(I);if(O.byteLength<this.workerMessageLengthLimit){if(Q("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const N=function(P){for(var L=1;L<arguments.length;L++){var x=arguments[L]!=null?arguments[L]:{};L%2?H3(Object(x),!0).forEach(function(W){C(P,W,x[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(x)):H3(Object(x)).forEach(function(W){Object.defineProperty(P,W,Object.getOwnPropertyDescriptor(x,W))})}return P}({},I);delete N.jpg,D.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(N))}return O}{const N=this.quality*this.qualityRatio;return this.quality=N,await this.generateRequestData(i,{appId:a,cname:u,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=gs.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=wi.CLOSED,this.emit(fn.STATE_CHANGE,Ci.CLOSED)}}var $3,K3,q3,z3,Y3,X3,J3,Q3,Z3,e4,t4,n4,r4,i4,s4,o4,a4,c4,u4,l4,d4,h4,p4,f4,m4,g4,E4,_4,v4,y4,S4,T4,R4,I4,w4,C4,A4,b4,me;function O4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function pp(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?O4(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):O4(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}let qre=($3=ke(),K3=ke({argsMap:(r,i)=>(Array.isArray(i)||(i=[i]),i.map(s=>s?Object(s).toString():"null"))}),q3=ke({argsMap:(r,i)=>(i||(i=[]),Array.isArray(i)||(i=[i]),i.map(s=>s.getTrackId()))}),z3=ke({argsMap:(r,i,s)=>[i.uid,s]}),Y3=ke({argsMap:(r,i)=>i.map(s=>{let{user:a,mediaType:u}=s;return[a==null?void 0:a.uid,u]})}),X3=ke({argsMap:(r,i,s)=>[i.uid,s]}),J3=ke({argsMap:(r,i)=>i.map(s=>{let{user:a,mediaType:u}=s;return{uid:a==null?void 0:a.uid,mediaType:u}})}),Q3=ke(),Z3=ke(),e4=ke(),t4=ke(),n4=ke(),r4=ke(),i4=ke(),s4=ke(),o4=ke(),a4=ke(),c4=ke(),u4=ke(),l4=ke(),d4=ke(),h4=ke({argsMap:(r,i)=>[i]}),p4=ke(),f4=ke(),m4=ke(),g4=ke(),E4=ke(),_4=ke(),v4=ke(),y4=ke(),S4=ke(),T4=ke(),R4=ke({argsMap:(r,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),I4=ke(),w4=ke(),C4=ke(),A4=ke({reportResult:!0}),b4=ke(),ae((me=class extends Wt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(r){let i;if(super(),C(this,"store",void 0),C(this,"_uid",void 0),C(this,"_channelName",void 0),C(this,"_uintUid",void 0),C(this,"_users",[]),C(this,"_codec",void 0),C(this,"_mode",void 0),C(this,"_config",void 0),C(this,"_clientId",void 0),C(this,"_appId",void 0),C(this,"_sessionId",null),C(this,"_key",void 0),C(this,"_joinInfo",void 0),C(this,"_gateway",void 0),C(this,"_statsCollector",void 0),C(this,"_configDistribute",void 0),C(this,"_leaveMutex",new Ir("client-leave")),C(this,"_publishMutex",new Ir("client-publish")),C(this,"_renewTokenMutex",new Ir("client-renewtoken")),C(this,"_subscribeMutex",new Ir("client-subscribe")),C(this,"_encryptionMode","none"),C(this,"_encryptionSecret",null),C(this,"_encryptionSalt",null),C(this,"_proxyServer",void 0),C(this,"_turnServer",{servers:[],mode:"auto"}),C(this,"_cloudProxyServerMode","disabled"),C(this,"_isDualStreamEnabled",!1),C(this,"_defaultStreamFallbackType",void 0),C(this,"_lowStreamParameter",void 0),C(this,"_streamFallbackTypeCacheMap",new Map),C(this,"_remoteStreamTypeCacheMap",new Map),C(this,"_axiosCancelSource",gs.CancelToken.source()),C(this,"_audioVolumeIndicationInterval",void 0),C(this,"_networkQualityInterval",void 0),C(this,"_userOfflineTimeout",void 0),C(this,"_streamRemovedTimeout",void 0),C(this,"_injectStreamingClient",void 0),C(this,"_liveTranscodeStreamingClient",void 0),C(this,"_liveRawStreamingClient",void 0),C(this,"_channelMediaRelayClient",void 0),C(this,"_networkQualitySensitivity","normal"),C(this,"_p2pChannel",void 0),C(this,"_useLocalAccessPoint",!1),C(this,"_setLocalAPVersion",void 0),C(this,"_joinAndNotLeaveYet",!1),C(this,"_numberOfJoinCount",0),C(this,"_remoteDefaultVideoStreamType",void 0),C(this,"_inspect",void 0),C(this,"_license",void 0),C(this,"_handleLocalTrackEnable",(s,a,u)=>{this.publish(s,!1).then(a).catch(u)}),C(this,"_handleLocalTrackDisable",(s,a,u)=>{this.unpublish(s).then(a).catch(u)}),C(this,"_handleUserOnline",s=>{this.isStringUID&&typeof s.uid!="string"&&D.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const a=this._users.find(u=>u.uid===s.uid);if(a)a._trust_in_room_=!0;else{const u=new xT(s.uid,s.uint_id||s.uid);this._users.push(u),D.debug("[".concat(this._clientId,"] user online"),s.uid),this.emit(Ye.USER_JOINED,u)}}),C(this,"_handleUserOffline",s=>{const a=this._users.find(u=>u.uid===s.uid);a&&(this._handleRemoveStream(s),JS(this._users,a),this._remoteStreamTypeCacheMap.delete(a.uid),this._streamFallbackTypeCacheMap.delete(a.uid),D.debug("[".concat(this._clientId,"] user offline"),s.uid,"reason:",s.reason),this.emit(Ye.USER_LEAVED,a,s.reason))}),C(this,"_handleAddAudioOrVideoStream",(s,a,u,d,h,m,g)=>{const p=this._users.find(v=>v.uid===a);if(!p)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(s)),this.store.subscribe(p.uid,s,void 0,void 0,void 0,Date.now());const E=s==="audio"?p.hasAudio:p.hasVideo;p._uintid||(p._uintid=h||a),s==="audio"?p._trust_audio_stream_added_state_=!0:p._trust_video_stream_added_state_=!0,s==="audio"?(p._audio_added_=!0,u!==void 0&&(p._audioSSRC=u),d!==void 0&&(p._cname=d),m&&(p._audioOrtc=m)):(p._video_added_=!0,u!==void 0&&(p._videoSSRC=u),d!==void 0&&(p._cname=d),g!==void 0&&(p._rtxSsrcId=g),m&&(p._videoOrtc=m)),(s==="audio"?p.hasAudio:p.hasVideo)&&!E&&(D.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published ").concat(s)),this.emit(Ye.USER_PUBLISHED,p,s)),s==="video"?Ie.onGatewayStream(this._sessionId,Xn.ON_ADD_VIDEO_STREAM,qt.ON_ADD_VIDEO_STREAM,{peer:h||a}):Ie.onGatewayStream(this._sessionId,Xn.ON_ADD_AUDIO_STREAM,qt.ON_ADD_AUDIO_STREAM,{peer:h||a}),this._p2pChannel.remoteMediaSsrcChanged(p,s,u).then(v=>{if(v)return D.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(p.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(p,s,!0).then(()=>this._subscribe(p,s,!0).catch(T=>{D.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(p,s)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(p.uid," after reconnect.")),this._subscribe(p,s,!0).catch(v=>{D.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),C(this,"_handleRemoveStream",s=>{const a=this._users.find(d=>d.uid===s.uid);if(!a)return void D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));D.debug("[".concat(this._clientId,"] stream removed with uid ").concat(s.uid));let u=()=>{};a.hasAudio&&a.hasVideo?u=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.emit(Ye.USER_UNPUBLISHED,a,"audio"),D.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.emit(Ye.USER_UNPUBLISHED,a,"video")}:a.hasVideo?u=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.emit(Ye.USER_UNPUBLISHED,a,"video")}:a.hasAudio&&(u=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.emit(Ye.USER_UNPUBLISHED,a,"audio")}),a._trust_audio_stream_added_state_=!0,a._trust_video_stream_added_state_=!0,a._audio_added_=!1,a._video_added_=!1,this._p2pChannel.unsubscribe(a).then(d=>{if(d)return this._gateway.unsubscribe(d,a.uid)}),a._audioSSRC=void 0,a._videoSSRC=void 0,a._audioOrtc=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0,Ie.onGatewayStream(this._sessionId,Xn.ON_REMOVE_STREAM,qt.ON_REMOVE_STREAM,{peer:s.uint_id||s.uid}),u()}),C(this,"_handleSetStreamLocalEnable",(s,a,u)=>{const d=this._users.find(g=>g.uid===a);if(!d)return void D.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));D.debug("[".concat(this._clientId,"] local ").concat(s," ").concat(u?"enabled":"disabled"," with uid ").concat(a));const h=s==="audio"?d.hasAudio:d.hasVideo;if(s==="audio"){d._trust_audio_enabled_state_=!0;const g=d._audio_enabled_;if(d._audio_enabled_=u,d._audio_enabled_===g)return;{const p=d._audio_enabled_?"enable-local-audio":"disable-local-audio";D.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(a,", msg: ").concat(p)),this.emit(Ye.USER_INFO_UPDATED,a,p)}}else{d._trust_video_enabled_state_=!0;const g=d._video_enabled_;if(d._video_enabled_=u,d._video_enabled_===g)return;{const p=d._video_enabled_?"enable-local-video":"disable-local-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(p)),this.emit(Ye.USER_INFO_UPDATED,a,p)}}const m=s==="audio"?d.hasAudio:d.hasVideo;return h!==m?!h&&m?(D.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(s)),void this.emit(Ye.USER_PUBLISHED,d,s)):(s==="video"&&d._videoTrack&&d._videoTrack._destroy(),s==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,s),D.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(s)),void this.emit(Ye.USER_UNPUBLISHED,d,s)):void 0}),C(this,"_handleMuteStream",(s,a,u)=>{D.debug("[".concat(this._clientId,"] receive mute message"),s,a,u);const d=this._users.find(g=>g.uid===s);if(!d)return void D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s));const h=a==="audio"?d.hasAudio:d.hasVideo;if(a==="audio"){d._trust_audio_mute_state_=!0;const g=d._audio_muted_;if(d._audio_muted_=u,d._audio_muted_===g)return;{const p=d._audio_muted_?"mute-audio":"unmute-audio";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(p)),this.emit(Ye.USER_INFO_UPDATED,s,p)}}else{d._trust_video_mute_state_=!0;const g=d._video_muted_;if(d._video_muted_=u,d._video_muted_===g)return;{const p=d._video_muted_?"mute-video":"unmute-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(p)),this.emit(Ye.USER_INFO_UPDATED,s,p)}}const m=a==="audio"?d.hasAudio:d.hasVideo;if(h!==m){if(!h&&m)return(a==="audio"?d._audioSSRC:d._videoSSRC)?(D.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(a)),void this.emit(Ye.USER_PUBLISHED,d,a)):void D.warning("[".concat(this._clientId,"] remote user ").concat(s," receive ").concat(a," unmute message  before add stream message, ").concat(a," SSRC doesn't exist yet."));a==="video"&&d._videoTrack&&d._videoTrack._destroy(),a==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,a),D.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(a)),this.emit(Ye.USER_UNPUBLISHED,d,a)}}),C(this,"_handleP2PLost",async s=>{D.debug("[".concat(this._clientId,"] receive p2p lost"),s),parseInt(s.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():D.warning("P2PLost stream not found",s)}),C(this,"_handleTokenWillExpire",()=>{D.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(Ye.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),C(this,"_handleBeforeUnload",s=>{s.type==="beforeunload"&&s.returnValue!==void 0&&s.returnValue!==""||(this.leave(),D.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),C(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(Ye.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const s={downlinkNetworkQuality:0,uplinkNetworkQuality:0};s.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),s.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit(Ye.NETWORK_QUALITY,s)}),this._codec=r.codec,this._mode=r.mode,this._clientId=$t(5,"client-"),this.store=new Lre(r.codec,r.audioCodec,r.mode,this._clientId),this.store.clientCreated(),r.proxyServer&&this.setProxyServer(r.proxyServer,!0),r.turnServer&&this.setTurnServer(r.turnServer,!0),D.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Hi," build: ").concat(hS,", mode: ").concat(this._mode,", codec: ").concat(this._codec)),r.clientRoleOptions)try{Sk(r.clientRoleOptions),i=Object.assign({},r.clientRoleOptions)}catch(s){D.warning("[".concat(this._clientId,"] ").concat(s.toString()))}this._statsCollector=new Fl(this.store),this._statsCollector.onStatsException=(s,a,u)=>{D.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(s,", msg: ").concat(a,", uid: ").concat(u)),this.emit(Ye.EXCEPTION,{code:s,msg:a,uid:u})},this._statsCollector.onUploadPublishDuration=(s,a,u,d)=>{const h=this._users.find(m=>m.uid===s);h&&Ie.peerPublishStatus(this._sessionId,{subscribeElapse:d,audioPublishDuration:a,videoPublishDuration:u,peer:h._uintid})},this._gateway=new tne(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:r.websocketRetryConfig||vn,httpRetryConfig:r.httpRetryConfig||vn,forceWaitGatewayResponse:r.forceWaitGatewayResponse===void 0||r.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:r.role,clientRoleOptions:i}),this._config=r,this._configDistribute=new lne,this._p2pChannel=new Dre(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(r,i,s,a,u){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=Mre(),m=L3()?window.isSecureContext:"Browser Not Support";if(!L3()&&!h||!window.isSecureContext){const I="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";D.warning(I)}const g=XS();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),D.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const p=Ie.reportApiInvoke(g,{name:dn.JOIN,options:[r,i,s,a],states:{isHttps:h,isSecureContext:m},tag:Ht.TRACER});Ie.setAppId(r);try{if(!s&&s!==null)throw new j(V.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&zn(s,"token",1,2047),zn(r,"appid",1,2047),RS(i),a&&IS(a),u&&zn(u,"optionalInfo",1,2047)}catch(I){throw p.onError(I),I}if(D.info("[".concat(this._clientId,"] start join channel ").concat(i,", join number: ").concat(d)),this._leaveMutex.isLocked&&(D.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),D.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const I=new j(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw p.onError(I),I}this._sessionId||(this._sessionId=g,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const E=pp({clientId:this._clientId,appId:r,sid:this._sessionId,cname:i,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||r,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:u,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(E.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(E.stringUid=a,this._uintUid?(E.uid=this._uintUid,this._uintUid=void 0):E.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(E.aesmode=this._encryptionMode,E.aespassword=await(async I=>{const O=QS(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),N=await window.crypto.subtle.importKey("spki",O,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),P=GS(I),L=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},N,P);return jg(new Uint8Array(L))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new j(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(E.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:i,appId:r});const v=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&v===this._sessionId&&Ie.joinChannelTimeout(this._sessionId,5)},5e3);try{let I;const O=E.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(O)){const x=Q("PROXY_SERVER_TYPE3");Array.isArray(x)?E.proxyServer=x[0]:E.proxyServer=x}if(Ie.setProxyServer(E.proxyServer),D.setProxyServer(E.proxyServer),this.store.requestAPStart(),E.stringUid&&!E.uid){const x=await mx(E.stringUid,E,this._axiosCancelSource.token,this._config.httpRetryConfig||vn,this.store);D.debug("getUserAccount Success ".concat(E.stringUid," => ").concat(x)),E.uid=x,I=await fx(E,this._axiosCancelSource.token,this._config.httpRetryConfig||vn,!0,this.store)}else I=await fx(E,this._axiosCancelSource.token,this._config.httpRetryConfig||vn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new j(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(E,this._axiosCancelSource.token),this._configDistribute.on($h.UPDATE_BITRATE_LIMIT,x=>{this._p2pChannel.updateBitrateLimit(x)})},0),this._key=s||r;const N=I.gatewayInfo;this._joinInfo=pp(pp({},E),{},{cid:N.cid,uid:E.uid?E.uid:N.uid,vid:N.vid,apResponse:N.res,uni_lbs_ip:N.uni_lbs_ip,gatewayAddrs:N.gatewayAddrs});const P=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new j(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(P),this._appId=r,this._channelName=E.cname,this._uid=P,this.store.uid=P,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Kr()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const L=E.stringUid?"string uid: ".concat(E.stringUid,",uid: ").concat(E.uid):"uid: ".concat(this._uid);return D.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(i,",").concat(L)),setTimeout(()=>{D.startUpload()},5e3),this.store.joinEnd(),T=this,Dl.includes(T)||Dl.push(T),P}catch(I){const O=Array.isArray(I)?I[0]:I;throw D.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),O),O.code!==V.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(O),O}var T}_joinGateway(){if(!this._joinInfo||!this._key)throw new j(V.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Q("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(r=>r).catch(r=>{if(r.code===V.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,_t.FALLBACK),r;if(r.code===V.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,_t.FALLBACK),r;throw r}).then(r=>{if(r instanceof j){if(r.code===V.INIT_WEBSOCKET_TIMEOUT){if(D.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new j(V.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const i=Q("PROXY_SERVER_TYPE3");if(Array.isArray(i))if(this._joinInfo.apUrl){const a=new JM(this._joinInfo.apUrl).host.split("."),u=a.slice(a.length-2).join(".");i.forEach(d=>{this._joinInfo&&d.includes(u)&&(this._joinInfo.proxyServer=d)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=i[0])}else this._joinInfo.proxyServer=i[0];else this._joinInfo.proxyServer=i;const s=Q("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return s&&s[1]&&s[1]!=="443"&&D.setProxyServer(this._joinInfo.proxyServer),Q("STATS_COLLECTOR_PORT").toString()!=="443"&&Ie.setProxyServer(this._joinInfo.proxyServer),Ie.reportApiInvoke(this._sessionId,{name:dn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Ht.TRACER}).onSuccess(),this.emit(Ye.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),this._gateway.join(this._joinInfo,this._key)}if(D.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new j(V.INVALID_OPERATION);return Ie.reportApiInvoke(this._sessionId,{name:dn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Ht.TRACER}).onSuccess(),this._joinGateway()}return r}).then(r=>r)}async leave(){D.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Kr()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(i){const s=Dl.indexOf(i);s!==-1&&Dl.splice(s,1)}(this);const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return D.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void r();await this._gateway.leave(this.connectionState!=="CONNECTED"),D.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),r()}async publish(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(r)||(r=[r]),r.length===0)throw new j(V.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new j(V.INVALID_OPERATION,"audience can not publish stream");for(const a of r){if(!(a instanceof WS))throw new j(V.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&i)throw new j(V.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}D.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(a=>"".concat(a.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),i&&r.forEach(a=>{const u=this._configDistribute.getBitrateLimit();a instanceof un&&u&&a.setBitrateLimit(u.uplink)});const s=await this._publishMutex.lock();try{await this._publishHighStream(r),D.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw D.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{s()}}async unpublish(r){if(!this._joinInfo||this._uid===void 0)throw new j(V.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");r?Array.isArray(r)||(r=[r]):r=this._p2pChannel.getAllTracks(!0),D.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.unpublish(s,this._uid),D.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(a=>"".concat(a.getTrackId()))))}catch(s){throw D.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async subscribe(r,i){return this._subscribe(r,i)}async _subscribe(r,i,s){if(qn(i,"mediaType",["audio","video"]),!this._joinInfo)throw new j(V.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(V.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===r)){const g=new j(V.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),g}if(!r.hasAudio&&!r.hasVideo){const g=new j(V.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),g}if(!(s||(i!=="audio"||r.hasAudio&&r._audioSSRC!==void 0)&&(i!=="video"||r.hasVideo&&r._videoSSRC!==void 0))){const g=new j(V.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(i,", remote track is not published")),g}const a=i==="audio"?r._audioSSRC:r._videoSSRC,u=i==="audio"?r._audioOrtc:r._videoOrtc,d=i==="video"?r._rtxSsrcId:void 0,h={stream_type:i==="audio"?Be.AUDIO:Be.VIDEO,ssrcId:a},m=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(r.uid,", mediaType: ").concat(i));try{if(await this._p2pChannel.hasRemoteMediaWithLock(r,i))await this._p2pChannel.unmuteRemote(r,i);else try{qi.markSubscribeStart(this.store.clientId,a),this.store.subscribe(r.uid,i,Date.now()),await this._p2pChannel.subscribe(r,i,a,d,u);try{await this._gateway.subscribe(r.uid,h,!0)}catch(p){if((p==null?void 0:p.code)!==V.WS_ABORT)throw await this._p2pChannel.unsubscribe(r,i),p;await this._p2pChannel.unsubscribe(r,i,!0),this._p2pChannel.setPendingRemoteMedia(r,i)}this.store.subscribe(r.uid,i,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,r,i)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,r,i),p}D.info("[".concat(this._clientId,"] subscribe success user ").concat(r.uid,", mediaType: ").concat(i)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(r.uid,this._defaultStreamFallbackType).catch(p=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const g=i==="audio"?r._audioTrack:r._videoTrack;if(!g)throw new j(V.UNEXPECTED_ERROR,"can not find remote track in user object");return g}catch(g){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(r.uid," error"),g),g}finally{m()}}async massSubscribe(r){if(Jo(r,"subscribeList"),!this._joinInfo)throw new j(V.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(V.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const i=Date.now(),s=new Map,a=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"]start massSubscribe user ").concat(r.map(m=>{let{user:g,mediaType:p}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(p)}).join("; ")));const u=(r=[...r]).map(m=>{let{user:g,mediaType:p}=m;return{user:g,mediaType:p}}),d=await this._p2pChannel.globalLock();try{var h;for(let g=r.length-1;g>=0;g--){const p=r[g],{user:E,mediaType:v}=p;if(qn(v,"mediaType",["audio","video"]),!E){const O=new j(V.INVALID_PARAMS,"user property does not exist in subscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),O}if(!this._users.find(O=>O===E)){const O=new j(V.INVALID_REMOTE_USER,"user is not in the channel");D.error("[".concat(this._clientId,"] can not massSubscribe ").concat(E.uid,", this user is not in the channel")),u[g].error=O,r.splice(g,1);continue}if(v==="audio"&&(!E.hasAudio||E._audioSSRC===void 0)||v==="video"&&(!E.hasVideo||E._videoSSRC===void 0)){const O=new j(V.REMOTE_USER_IS_NOT_PUBLISHED);D.error("[".concat(this._clientId,"] can not subscribe ").concat(E.uid," with mediaType ").concat(v,", remote user is not published")),u[g].error=O,r.splice(g,1);continue}const T=on.Video|on.LwoVideo,I=s.get(E);if(I){if(v==="video"?I&T:I&on.Audio){r.splice(g,1),D.warning("repeat massSubscribe user:".concat(E.uid,", mediaType:").concat(v," twice"));continue}s.set(E,I|(v==="video"?T:on.Audio))}else s.set(E,v==="video"?T:on.Audio)}for(let g=r.length-1;g>=0;g--){const p=r[g],{user:E,mediaType:v}=p,T=on.Video|on.LwoVideo;if(this._p2pChannel.hasRemoteMedia(E,v)){await this._p2pChannel.unmuteRemoteNoLock(E,v);const I=s.get(E);s.set(E,v==="video"?I^T:I^on.Audio),r.splice(g,1)}}this.store.massSubscribe(r.map(g=>({userId:g.user.uid,type:g.mediaType})),i);const m=xa(h=Array.from(s.entries())).call(h,(g,p)=>{let[E,v]=p;if(v===0)return g;const T={stream_id:E.uid,stream_type:v};return v&on.Audio&&(T.audio_ssrc=E._audioSSRC),v&on.Video&&(T.video_ssrc=E._videoSSRC),g.push(T),g},[]);try{r.length>0&&await this._p2pChannel.massSubscribeNoLock(r.map(p=>{let{user:E,mediaType:v}=p;return{user:E,mediaType:v,ssrcId:v===Be.VIDEO?E._videoSSRC:E._audioSSRC,rtxSsrcId:E._rtxSsrcId}}));const g=new Map;if(m.length>0){const p=await this._gateway.subscribeAll(m,!0);((p==null?void 0:p.users)||[]).forEach(E=>{let{stream_id:v,video_error_code:T,audio_error_code:I,error_code:O}=E;(T||I||O)&&g.set(v,{video_error_code:T,audio_error_code:I,error_code:O})})}if(Array.from(g.entries()).length>0){const p=Array.from(g.entries()).map(E=>{let v,[T,I]=E;return I.error_code||I.video_error_code&&I.audio_error_code?v=void 0:I.video_error_code?v=Be.VIDEO:I.audio_error_code&&(v=Be.AUDIO),{user:this.remoteUsers.find(O=>O.uid===T),mediaType:v}});await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of u){const E=g.get(p.user.uid);if(E){const v=E.error_code||p.mediaType==="audio"&&E.audio_error_code||p.mediaType==="video"&&E.video_error_code;if(v){const T=np(v);D.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(T.desc)),p.error=new j(V.SUBSCRIBE_FAILED,"code ".concat(v,": ").concat(T.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(u.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),u.forEach(p=>{var E;Ie.subscribe(this.store.sessionId,{succ:!!p.error,ec:((E=p.error)===null||E===void 0?void 0:E.code)||null,video:p.mediaType===Be.VIDEO,audio:p.mediaType===Be.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===Be.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-i)},!0)}),D.info("[".concat(this._clientId,"] massSubscribe success ").concat(r.map(p=>{let{user:E,mediaType:v}=p;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(v)}).join("; "))),u}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(r),g}}finally{d(),a()}}async unsubscribe(r,i){if(i&&qn(i,"mediaType",["audio","video"]),!this._joinInfo)throw new j(V.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===r)){const s=new j(V.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),s}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(r.uid,", mediaType: ").concat(i));try{const s=await this._p2pChannel.unsubscribe(r,i);s&&await this._gateway.unsubscribe(s,r.uid),D.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(r.uid,", mediaType: ").concat(i))}catch(s){if(s.code===V.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(r.uid," error"),s.toString()),s}}async massUnsubscribe(r){if(Jo(r,"unsubscribeList"),!this._joinInfo)throw new j(V.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");D.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(r.map(s=>{let{user:a,mediaType:u}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(u,";")}).join())),r=[...r];const i=new Map;for(let s=r.length-1;s>=0;s--){const{user:a,mediaType:u}=r[s];if(!a){const h=new j(V.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(qn(u,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===a)){D.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),r.splice(s,1);continue}const d=on.Video|on.LwoVideo;if(i.has(a)){const h=i.get(a);let m;switch(u){case"video":m=h&d;break;case"audio":m=h&on.Audio;break;default:m=h&(on.Audio|d)}if(m){D.warning("repeat massUnsubscribe user:".concat(a.uid,",mediaType:").concat(u," twice.")),r.splice(s,1);continue}u?u==="audio"?i.set(a,h|on.Audio):u==="video"&&i.set(a,h|d):i.set(a,h|on.Audio|d)}else u?u==="audio"?i.set(a,on.Audio):u==="video"&&i.set(a,d):i.set(a,on.Audio|d)}try{const s=await this._p2pChannel.massUnsubscribe(r);s&&await this._gateway.massUnsubscribe(s),D.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(r.map(a=>{let{user:u,mediaType:d}=a;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===V.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}setLowStreamParameter(r){(function(s){if(!s)throw new j(V.INVALID_PARAMS);Ft(s.width)||TS(s.width,"streamParameter.width"),Ft(s.height)||TS(s.height,"streamParameter.height"),Ft(s.framerate)||TS(s.framerate,"streamParameter.framerate"),Ft(s.bitrate)||Ot(s.bitrate,"streamParameter.bitrate")})(r),(!r.width&&r.height||r.width&&!r.height)&&D.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),D.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(r));const i=this._configDistribute.getLowStreamConfigDistribute();i&&i.bitrate&&r.bitrate&&i.bitrate<r.bitrate&&(r.bitrate=i.bitrate),this._lowStreamParameter=r}async enableDualStream(){if(!er().supportDualStream)throw Ie.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new j(V.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new j(V.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(r){throw Ie.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}this._isDualStreamEnabled=!0,Ie.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),D.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new j(V.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ve.LocalVideoLowTrack))try{const r=await this._p2pChannel.unpublishLowStream();r&&await this._gateway.unpublish(r,this._joinInfo.stringUid||this._joinInfo.uid)}catch(r){throw Ie.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}this._isDualStreamEnabled=!1,Ie.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),D.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(r,i){if(function(s){qn(s,"role",["audience","host"])}(r),i&&Sk(i),this._mode==="rtc")throw D.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new j(V.INVALID_OPERATION,"rtc mode can not use setClientRole");if(i&&i.level&&r==="host")throw new j(V.INVALID_OPERATION,"host mode can not set audience latency level");if(r==="audience"&&this._p2pChannel.hasLocalMedia())throw new j(V.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(r,i),D.info("[".concat(this._clientId,"] set client role to ").concat(r,", level: ").concat(i&&i.level))}setProxyServer(r,i){if(zn(r,"proxyServer"),!i){if(this.connectionState!=="DISCONNECTED")throw new j(V.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new j(V.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=r,Ie.setProxyServer(this._proxyServer),D.setProxyServer(this._proxyServer),D.info("[".concat(this._clientId,"] Set proxy server ").concat(i?"by initialize call":""," success."))}setTurnServer(r,i){if(Array.isArray(r)||(r=[r]),!i){if(this.connectionState!=="DISCONNECTED")throw new j(V.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new j(V.INVALID_OPERATION,"You have already set the proxy")}if(Hh(r))return this._turnServer={servers:r,mode:"original-manual"},void D.info("[".concat(this._clientId,"] Set original turnserver ").concat(i?"by initialize call":""," success: ").concat(r.map(s=>s.urls).join(","),"."));r.forEach(s=>yk(s)),this._turnServer={servers:r,mode:"manual"},D.info("[".concat(this._clientId,"] Set turnserver ").concat(i?"by initialize call":""," success."))}setLicense(r){if(this.connectionState!=="DISCONNECTED")throw new j(V.INVALID_OPERATION,"you should set license before join channel");if(zn(r,"license",32,32),!/^[A-Za-z\d]+$/.test(r))throw new j(V.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=r,D.info("[".concat(this._clientId,"] set license success"),r)}startProxyServer(r){if(this.connectionState!=="DISCONNECTED")throw new j(V.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new j(V.INVALID_OPERATION,"You have already set the proxy");const i=[3,4,5];let s;switch(r===void 0&&(r=3),r){case 1:case 2:throw new j(V.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new j(V.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new j(V.INVALID_OPERATION,"Stop proxy server after leave channel");Ie.setProxyServer(),D.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(r){if(!r.accessPoints)throw new j(V.INVALID_PARAMS,"accessPoints is required.");Jo(r.accessPoints.serverList,"accessPoints.serverList"),zn(r.accessPoints.domain,"accessPoints.domain");const i=(T,I)=>{Ot(T,I,0,65535,!0)};let s=443;if(r.accessPoints.port&&(i(r.accessPoints.port,"accessPoints.port"),s=r.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new j(V.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Q("CLOSE_AFB_FOR_LOCAL_AP")&&(Dt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Dt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,u=r.accessPoints.domain,d=r.accessPoints.serverList.map(T=>a.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(u):T),h=d.map(T=>"".concat(T,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Dt("WEBCS_DOMAIN",h),Dt("WEBCS_DOMAIN_BACKUP_LIST",h),Dt("GATEWAY_DOMAINS",[u]),r.report&&r.report.hostname&&Array.isArray(r.report.hostname)&&r.report.hostname.length?(Jo(r.report.hostname,"report.hostname"),Dt("EVENT_REPORT_DOMAIN",r.report.hostname[0]),Dt("EVENT_REPORT_BACKUP_DOMAIN",r.report.hostname[1]||r.report.hostname[0])):(Dt("EVENT_REPORT_DOMAIN",d[0]),Dt("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;r.report&&r.report.port&&(i(r.report.port,"report.port"),m=r.report.port),Dt("STATS_COLLECTOR_PORT",m),r.report?Dt("ENABLE_EVENT_REPORT",!0):Dt("ENABLE_EVENT_REPORT",!1);let g="";r.log&&r.log.hostname&&Array.isArray(r.log.hostname)&&r.log.hostname.length?(Jo(r.log.hostname,"log.hostname"),g=r.log.hostname[0]):g=d[0];let p=6444;r.log&&r.log.port&&(i(r.log.port,"log.port"),p=r.log.port),Dt("LOG_UPLOAD_SERVER","".concat(g,":").concat(p));let E=[];r.cds&&r.cds.hostname&&Array.isArray(r.cds.hostname)&&r.cds.hostname.length?(Jo(r.cds.hostname,"cds.hostname"),E=r.cds.hostname):E=d;let v=443;r.cds&&r.cds.port&&(i(r.cds.port,"cds.port"),v=r.cds.port),Dt("CDS_AP",E.map(T=>"".concat(T,":").concat(v))),r.cds?Dt("ENABLE_CONFIG_DISTRIBUTE",!0):Dt("ENABLE_CONFIG_DISTRIBUTE",!1),D.info("set local access point v2 success")}setLocalAccessPoints(r,i){if(Jo(r,"serverList"),zn(i,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new j(V.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;r=r.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(i):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Dt("WEBCS_DOMAIN",r),Dt("WEBCS_DOMAIN_BACKUP_LIST",r),Dt("GATEWAY_DOMAINS",[i]),Dt("EVENT_REPORT_DOMAIN",r[0]),Dt("EVENT_REPORT_BACKUP_DOMAIN",r[1]||r[0]),Dt("LOG_UPLOAD_SERVER","".concat(r[0],":6444")),D.info("set local access point success")}async setRemoteDefaultVideoStreamType(r){if(qn(r,"streamType",[0,1]),this._remoteDefaultVideoStreamType=r,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(r),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(i){throw D.error("[".concat(this._clientId,"] set default remote video stream type error"),i.toString()),i}else D.debug("haven't joined yet, cache remoteDefaultVideoStreamType ".concat(r))}async setRemoteVideoStreamType(r,i){qn(i,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(r,i),setTimeout(()=>{const s=this._users.find(a=>a.uid===r);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw D.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}D.info("[".concat(this._clientId,"] set remote ").concat(r," video stream type to ").concat(i)),this._remoteStreamTypeCacheMap.set(r,i)}async setStreamFallbackOption(r,i){qn(i,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(r,i)}catch(s){throw D.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}D.info("[".concat(this._clientId,"] set remote ").concat(r," stream fallback type to ").concat(i)),this._streamFallbackTypeCacheMap.set(r,i)}setEncryptionConfig(r,i,s){if(function(a){qn(a,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(r),zn(i,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(r)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new j(V.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new j(V.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(i)||D.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=r,this._encryptionSecret=i,s&&(this._encryptionSalt=jg(s))}async renewToken(r){if(zn(r,"token",1,2047),!this._key||!this._joinInfo)throw new j(V.INVALID_OPERATION,"renewToken should not be called before user join");const i=this._key;this._key=r,this._joinInfo&&(this._joinInfo.token=r);const s=await this._renewTokenMutex.lock();try{if(Q("USE_NEW_TOKEN")){D.debug("start renew token with ticket from unilbs");const a=await une(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||vn);D.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:r,ticket:a})}else D.debug("start renew token without ticket"),await this._gateway.renewToken({token:r});D.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=i,this._joinInfo.token=i,D.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?D.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const r=this._p2pChannel.getAudioLevels();this.emit(Ye.VOLUME_INDICATOR,r)},Q("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const r=this._statsCollector.getRTCStats(),i=this._gateway.getInChannelInfo();return r.Duration=Math.round(i.duration/1e3),r}async startLiveStreaming(r,i){if(!i){if(this._codec!=="h264")throw new j(V.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new j(V.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(r)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(r))throw new j(V.LIVE_STREAMING_TASK_CONFLICT);const s=i?hn.TRANSCODE:hn.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(r,s)}setLiveTranscoding(r){return this._createLiveStreamingClient(hn.TRANSCODE).setTranscodingConfig(r)}async stopLiveStreaming(r){const i=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(r));if(!i.length)throw new j(V.INVALID_PARAMS,"can not find live streaming url to stop");await _e.all(i.map(s=>s&&s.stopLiveStreamingTask(r)))}async addInjectStreamUrl(r,i){if(!this._joinInfo)throw new j(V.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const s=this._createLiveStreamingClient(hn.INJECT);s.setInjectStreamConfig(i,0),await s.startLiveStreamingTask(r,hn.INJECT)}async removeInjectStreamUrl(){var r;const i=this._createLiveStreamingClient(hn.INJECT),s=Array.from(Zo(r=i.streamingTasks).call(r)).find(a=>a.mode===hn.INJECT);if(!this._joinInfo||!s)throw new j(V.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await i.stopLiveStreamingTask(s.url)}async startChannelMediaRelay(r){Rx(r),await this._createChannelMediaRelayClient().startChannelMediaRelay(r)}async updateChannelMediaRelay(r){Rx(r),await this._createChannelMediaRelayClient().updateChannelMediaRelay(r)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay()}sendStreamMessage(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new j(V.INVALID_OPERATION,"can not send data stream, not joined");if(typeof r=="string"&&(r=new TextEncoder().encode(r)),new Blob([r]).size>1024)throw new j(V.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Le.DATA_STREAM,{payload:jg(r)},!i)}sendMetadata(r){if(!this._joinInfo)throw new j(V.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([r]).size>1024)throw new j(V.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Le.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:jg(r)})}async sendCustomReportMessage(r){if(Array.isArray(r)||(r=[r]),r.forEach(qQ),!this._joinInfo)throw new j(V.INVALID_OPERATION,"can not send custom report, not joined");await Ie.sendCustomReportMessage(this._joinInfo.sid,r)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(r,i){qn(i.spatialLayer,"spatialLayer",[0,1,2,3]),qn(i.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(r,i)}catch(s){throw D.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}_reset(){if(D.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=gs.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(r=>{r._audioTrack&&r._audioTrack._destroy(),r._videoTrack&&r._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ir("client-publish"),this._subscribeMutex=new Ir("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}}_startSession(r,i){const s=r||XS();r?D.debug("[".concat(this._clientId,"] new Session ").concat(s)):D.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s)),this._sessionId=s,this.store.sessionId=s,i?Ie.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:i.channel,appid:i.appId,mode:this._mode}):this._joinInfo?Ie.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&Ie.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(r){if(!this._joinInfo||this._uid===void 0)throw new j(V.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(V.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Q("FORCE_TURN")&&!Q("TURN_ENABLE_TCP")&&!Q("TURN_ENABLE_UDP"))throw new j(V.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");D.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(r,this._isDualStreamEnabled,this._lowStreamParameter),a=(await s.next()).value;if(a){var i;let u;try{u=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==V.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((i=u)===null||i===void 0?void 0:i.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const u of r)u instanceof un&&u._encoderConfig&&this._gateway.setVideoProfile(u._encoderConfig),!u.muted&&u.enabled||await this._p2pChannel.muteLocalTrack(u)}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,r),(s==null?void 0:s.code)===V.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new j(V.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new j(V.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));D.debug("[".concat(this._clientId,"] publish low stream"));const r=this._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&r.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=r.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var i;let u;try{u=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==V.DISCONNECT_P2P)throw s.throw(d),d}s.next(((i=u)===null||i===void 0?void 0:i.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===V.WS_ABORT)return;throw s}}_createLiveStreamingClient(r){if(!this._joinInfo||!this._appId)return new j(V.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=()=>new hne(this._joinInfo,this._config.websocketRetryConfig||vn,this._config.httpRetryConfig||vn),s=a=>{a.onLiveStreamError=(u,d)=>{Ie.reportApiInvoke(this._sessionId,{name:dn.ON_LIVE_STREAM_ERROR,options:[u,d],tag:Ht.TRACER}).onSuccess(),this.emit(Ye.LIVE_STREAMING_ERROR,u,d)},a.onLiveStreamWarning=(u,d)=>{Ie.reportApiInvoke(this._sessionId,{name:dn.ON_LIVE_STREAM_WARNING,options:[u,d],tag:Ht.TRACER}).onSuccess(),this.emit(Ye.LIVE_STREAMING_WARNING,u,d)},a.on(Ll.REQUEST_WORKER_MANAGER_LIST,(u,d,h)=>{if(!this._joinInfo)return h(new j(V.INVALID_OPERATION,"can not find join info to get worker manager"));Ex(u,this._joinInfo,this._axiosCancelSource.token,vn).then(d).catch(h)})};switch(r){case hn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=i(),s(this._liveRawStreamingClient)),this._liveRawStreamingClient;case hn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=i(),s(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case hn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=i(),this._injectStreamingClient.on(Ll.REQUEST_WORKER_MANAGER_LIST,(a,u,d)=>{if(!this._joinInfo)return d(new j(V.INVALID_OPERATION,"can not find join info to get worker manager"));Ex(a,this._joinInfo,this._axiosCancelSource.token,vn).then(u).catch(d)}),this._injectStreamingClient.onInjectStatusChange=(a,u,d)=>{this.emit(Ye.INJECT_STREAM_STATUS,a,u,d)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new fne(this._joinInfo,this._clientId,this._config.websocketRetryConfig||vn,this._config.httpRetryConfig||vn),this._channelMediaRelayClient.on("state",r=>{r===Lr.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Ye.CHANNEL_MEDIA_RELAY_STATE,r)}),this._channelMediaRelayClient.on("event",r=>{this.emit(Ye.CHANNEL_MEDIA_RELAY_EVENT,r)})),this._channelMediaRelayClient):new j(V.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Gt.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Gt.CONNECTION_STATE_CHANGE,(r,i,s)=>{var a;if(s===_t.FALLBACK)return;const u=()=>{this.emit(Ye.CONNECTION_STATE_CHANGE,r,i,s)};if(Ie.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:dn.CONNECTION_STATE_CHANGE,options:[r,i,s],tag:Ht.TRACER}).onSuccess(JSON.stringify({cur:r,prev:i,reason:s})),D.info("[".concat(this._clientId,"] connection state change: ").concat(i," -> ").concat(r)),r==="DISCONNECTED")return this._reset(),void u();if(r==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._audioSSRC=void 0,h._videoSSRC=void 0,h._videoOrtc=void 0,h._audioOrtc=void 0,h._cname=void 0,h._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(r==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(g=>{D.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(g=>{D.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{D.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{D.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{D.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,"audio",!1)),h._trust_video_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,"video",!1)),h._trust_audio_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(D.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3)}u()}),this._gateway.on(Gt.REQUEST_NEW_GATEWAY_LIST,(r,i)=>{if(!this._joinInfo)return i(new j(V.UNEXPECTED_ERROR,"can not recover, no join info"));kT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||vn,this.store).then(s=>{this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip),r(s.gatewayInfo.gatewayAddrs.map(a=>{if(this._joinInfo&&this._joinInfo.proxyServer){const u=a.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(u[0],"&p=").concat(u[1])}return"wss://".concat(a.address)}))}).catch(i)}),this._gateway.on(Gt.NETWORK_QUALITY,r=>{this._networkQualitySensitivity==="normal"&&this.emit(Ye.NETWORK_QUALITY,r)}),this._gateway.on(Gt.STREAM_TYPE_CHANGE,(r,i)=>{this.emit(Ye.STREAM_TYPE_CHANGED,r,i),Ie.reportApiInvoke(this._sessionId,{name:dn.STREAM_TYPE_CHANGE,options:[r,i],tag:Ht.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:i}))}),this._gateway.on(Gt.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(Gt.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Gt.REQUEST_P2P_CONNECTION_PARAMS,async(r,i,s)=>{try{i(await this._p2pChannel.startP2PConnection(r))}catch(a){s(a)}}),this._gateway.on(Gt.JOIN_RESPONSE,(r,i)=>{const{dtlsParameters:s,iceParameters:a,candidates:u,rtpCapabilities:d,setup:h,cname:m}=zU(r.ortc,i);this._p2pChannel.connect(a,s,u,d,h,m)}),this._gateway.on(Gt.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(Gt.RESET_CONNECTION_EVENTS,()=>{this._handleGatewaySignalEvents()}),this._gateway.on(Gt.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Gt.DATACHANNEL_PRECONNECT,async(r,i,s,a)=>{var u,d,h,m,g,p;await this._p2pChannel.startP2PConnection({turnServer:(u=this._joinInfo)===null||u===void 0?void 0:u.turnServer},!0);const E=function(v,T){let I;return T&&T.ip&&typeof T.port=="number"?(I=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip,port:T.port.toString(),type:"host",extension:{}}],D.debug("Using remote candidate from AP ".concat(T.ip,":").concat(T.port)),T.ip6&&(I.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip6,port:T.port.toString(),type:"host",extension:{}}),D.debug("Using IPV6 remote candidate from AP ".concat(T.ip6,":").concat(T.port)))):I=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:v.ip,port:v.port.toString(),type:"host",extension:{}}],I}(r,i);return this._p2pChannel.preConnect({iceUfrag:"".concat((d=this._joinInfo)===null||d===void 0?void 0:d.apResponse.cid,"_").concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cert),icePwd:"".concat((m=this._joinInfo)===null||m===void 0?void 0:m.apResponse.cid,"_").concat((g=this._joinInfo)===null||g===void 0?void 0:g.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(p=Q("FINGERPRINT"))!==null&&p!==void 0?p:r.fingerprint}]},E,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(s).catch(a)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ke.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ke.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ke.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(Ke.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(Ke.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ke.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ke.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,"audio",!0)),this._gateway.signal.on(Ke.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,"audio",!1)),this._gateway.signal.on(Ke.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,"video",!0)),this._gateway.signal.on(Ke.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,"video",!1)),this._gateway.signal.on(Ke.RECEIVE_METADATA,r=>{const i=QS(r.metadata);this.emit(Ye.RECEIVE_METADATA,r.uid,i)}),this._gateway.signal.on(Ke.ON_DATA_STREAM,r=>{r.seq&&delete r.seq,r.payload=QS(r.payload),this.emit(Ye.STREAM_MESSAGE,r.uid,r.payload),this.onStreamMessage&&this.onStreamMessage(r)}),this._gateway.signal.on(Ke.ON_CRYPT_ERROR,()=>{qh(()=>{D.warning("[".concat(this._clientId,"] on crypt error")),this.emit(Ye.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ke.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{D.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.emit(Ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ke.ON_STREAM_FALLBACK_UPDATE,r=>{D.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.emit(Ye.STREAM_FALLBACK,r.stream_id,r.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ke.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),D.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(Ke.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(Ke.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(Te.REQUEST_TIMEOUT,(r,i)=>{if(this._joinInfo)switch(r){case Le.PUBLISH:{if(!i)return;const h=(i=i).ortc;if(h){var s,a,u,d;const m=h.some(E=>{let{stream_type:v}=E;return v===pn.Audio}),g=h.some(E=>{let{stream_type:v}=E;return v!==pn.Audio}),p=h.some(E=>{let{stream_type:v}=E;return v===pn.Screen||v===pn.ScreenLow});i.state==="offer"&&Ie.publish(this._joinInfo.sid,{eventElapse:qi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:V.TIMEOUT,audio:m,video:g,p2pid:i.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:m?(s=h.find(E=>{let{stream_type:v}=E;return v===pn.Audio}))===null||s===void 0||(a=s.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0,videoName:g?(u=h.find(E=>{let{stream_type:v}=E;return v!==pn.Audio}))===null||u===void 0||(d=u.ssrcs[0])===null||d===void 0?void 0:d.ssrcId.toString():void 0})}break}case Le.SUBSCRIBE:(i=i)&&Ie.subscribe(this._joinInfo.sid,{succ:!1,ec:V.TIMEOUT,audio:i.stream_type===Be.AUDIO,video:i.stream_type===Be.VIDEO,peerid:i.stream_id,subscribeRequestid:i.ssrcId,p2pid:this.store.p2pId,eventElapse:qi.measureFromSubscribeStart(this.store.clientId,i.ssrcId)})}}),this._gateway.signal.on(Ke.ON_P2P_OK,r=>{this.uid,this._uid}),this._gateway.signal.on(Ke.ON_PUBLISHED_USER_LIST,r=>{if(r==null||!r.users)return;const i=[],s=[];for(const a of r.users){let u=this._users.find(p=>p.uid===a.stream_id);u?u._trust_in_room_=!0:(u=new xT(a.stream_id,a.stream_id),this._users.push(u),this.getListeners(Ye.PUBLISHED_USER_LIST).length===0&&(D.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.emit(Ye.USER_JOINED,u)));const d=on.Audio&a.stream_type,h=(on.Video|on.LwoVideo)&a.stream_type,m=d&&u.hasAudio,g=h&&u.hasVideo;h&&(u._trust_video_stream_added_state_=!0,u._video_added_=!0,u._videoSSRC=a.video_ssrc),d&&(u._trust_audio_stream_added_state_=!0,u._audio_added_=!0,u._audioSSRC=a.audio_ssrc),d&&!m&&this.getListeners(Ye.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published audio")),this.emit(Ye.USER_PUBLISHED,u,"audio")),h&&!g&&this.getListeners(Ye.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published video")),this.emit(Ye.USER_PUBLISHED,u,"video")),(d&&!m||h&&!g)&&i.push(u),h&&this._p2pChannel.hasPendingRemoteMedia(u,"video")&&s.push({user:u,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(u,"audio")&&s.push({user:u,mediaType:"audio"})}s.length>0&&(D.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{D.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(Ye.PUBLISHED_USER_LIST).length>0?(D.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(i.map(a=>a.uid).join(", "))),this.emit(Ye.PUBLISHED_USER_LIST,i)):D.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(i.map(a=>a.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(ot.RequestMuteLocal,async(r,i,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(r,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(a){a.code===V.DISCONNECT_P2P?i():s(a)}else i()}),this._p2pChannel.on(ot.RequestUnmuteLocal,async(r,i,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(r,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(a){a.code===V.DISCONNECT_P2P?i():s(a)}else i()}),this._p2pChannel.on(ot.RequestRePublish,(r,i,s)=>{this.publish(r,!1).then(i).catch(s)}),this._p2pChannel.on(ot.RequestReSubscribe,async(r,i,s)=>{try{for(const{user:a,kind:u}of r)u===Be.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");i()}catch(a){s(a)}}),this._p2pChannel.on(ot.RequestUploadStats,(r,i)=>{this._gateway.uploadStats(r,i)}),this._p2pChannel.on(ot.MediaReconnectStart,r=>{this.emit(Ye.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(ot.MediaReconnectEnd,r=>{this.emit(Ye.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(ot.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(ot.RequestRestartICE,async()=>{const r=await this._p2pChannel.restartICE(),i=await r.next();if(i.done)return;const s=i.value;let a;try{a=await this._gateway.restartICE({iceParameters:s})}catch(d){return void r.throw(d)}const{iceParameters:u}=function(d){const h=d.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(a);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(ot.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ot.RequestReconnectPC,async()=>{var r;const{iceParameters:i,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer}),{gatewayEstablishParams:u,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:i,dtlsParameters:s,rtpCapabilities:a}),{dtlsParameters:h,iceParameters:m,candidates:g,rtpCapabilities:p,setup:E,cname:v}=zU(u,d);await this._p2pChannel.connect(m,h,g,p,E,v),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ot.RequestUnpublishForReconnectPC,async(r,i,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(r,this._uid),i()):s()}),this._p2pChannel.on(ot.P2PLost,()=>{this.emit(Ye.P2P_LOST,this.store.uid)}),this._p2pChannel.on(ot.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(ot.ConnectionTypeChange,r=>{this.emit(Ye.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(ot.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(ot.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(r){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new j(V.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new j(V.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!r)throw new j(V.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!r.inspectType||!Array.isArray(r.inspectType))throw new j(V.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const i=[...new Set(r.inspectType)];i.forEach(s=>{if(!["supervise","moderation"].includes(s))throw new j(V.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(s," is not a valid inspect type."))}),r.inspectType=i}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new j(V.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const i=new _E(r);this._inspect=i,this.handleVideoInspectEvents(this._inspect),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},vn)}catch(i){throw Array.isArray(i)?i[0]:i}}async disableContentInspect(){if(!this._inspect)throw new j(V.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}handleVideoInspectEvents(r){r.on(fn.CONNECTION_STATE_CHANGE,(i,s)=>{switch(this.emit(Ye.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,i,s),s){case wi.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(Ye.CONTENT_INSPECT_ERROR,new j(V.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));r.inspectImage()}}),r.on(fn.INSPECT_RESULT,(i,s)=>{var a;if((s==null?void 0:s.code)===V.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return D.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.emit(Ye.CONTENT_INSPECT_RESULT,i,s)}),r.on(fn.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return D.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(r){Gh(r,"enabled"),Dt("ENABLE_PUBLISH_AUDIO_FILTER",r),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(r)}_handleResetAddStream(r,i){switch(i){case"audio":r._audio_added_=!1,r._trust_audio_stream_added_state_=!0;break;case"video":r._video_added_=!1,r._trust_video_stream_added_state_=!0}}}).prototype,"leave",[$3],Object.getOwnPropertyDescriptor(me.prototype,"leave"),me.prototype),ae(me.prototype,"publish",[K3],Object.getOwnPropertyDescriptor(me.prototype,"publish"),me.prototype),ae(me.prototype,"unpublish",[q3],Object.getOwnPropertyDescriptor(me.prototype,"unpublish"),me.prototype),ae(me.prototype,"subscribe",[z3],Object.getOwnPropertyDescriptor(me.prototype,"subscribe"),me.prototype),ae(me.prototype,"massSubscribe",[Y3],Object.getOwnPropertyDescriptor(me.prototype,"massSubscribe"),me.prototype),ae(me.prototype,"unsubscribe",[X3],Object.getOwnPropertyDescriptor(me.prototype,"unsubscribe"),me.prototype),ae(me.prototype,"massUnsubscribe",[J3],Object.getOwnPropertyDescriptor(me.prototype,"massUnsubscribe"),me.prototype),ae(me.prototype,"setLowStreamParameter",[Q3],Object.getOwnPropertyDescriptor(me.prototype,"setLowStreamParameter"),me.prototype),ae(me.prototype,"enableDualStream",[Z3],Object.getOwnPropertyDescriptor(me.prototype,"enableDualStream"),me.prototype),ae(me.prototype,"disableDualStream",[e4],Object.getOwnPropertyDescriptor(me.prototype,"disableDualStream"),me.prototype),ae(me.prototype,"setClientRole",[t4],Object.getOwnPropertyDescriptor(me.prototype,"setClientRole"),me.prototype),ae(me.prototype,"setProxyServer",[n4],Object.getOwnPropertyDescriptor(me.prototype,"setProxyServer"),me.prototype),ae(me.prototype,"setTurnServer",[r4],Object.getOwnPropertyDescriptor(me.prototype,"setTurnServer"),me.prototype),ae(me.prototype,"setLicense",[i4],Object.getOwnPropertyDescriptor(me.prototype,"setLicense"),me.prototype),ae(me.prototype,"startProxyServer",[s4],Object.getOwnPropertyDescriptor(me.prototype,"startProxyServer"),me.prototype),ae(me.prototype,"stopProxyServer",[o4],Object.getOwnPropertyDescriptor(me.prototype,"stopProxyServer"),me.prototype),ae(me.prototype,"setLocalAccessPointsV2",[a4],Object.getOwnPropertyDescriptor(me.prototype,"setLocalAccessPointsV2"),me.prototype),ae(me.prototype,"setLocalAccessPoints",[c4],Object.getOwnPropertyDescriptor(me.prototype,"setLocalAccessPoints"),me.prototype),ae(me.prototype,"setRemoteDefaultVideoStreamType",[u4],Object.getOwnPropertyDescriptor(me.prototype,"setRemoteDefaultVideoStreamType"),me.prototype),ae(me.prototype,"setRemoteVideoStreamType",[l4],Object.getOwnPropertyDescriptor(me.prototype,"setRemoteVideoStreamType"),me.prototype),ae(me.prototype,"setStreamFallbackOption",[d4],Object.getOwnPropertyDescriptor(me.prototype,"setStreamFallbackOption"),me.prototype),ae(me.prototype,"setEncryptionConfig",[h4],Object.getOwnPropertyDescriptor(me.prototype,"setEncryptionConfig"),me.prototype),ae(me.prototype,"renewToken",[p4],Object.getOwnPropertyDescriptor(me.prototype,"renewToken"),me.prototype),ae(me.prototype,"enableAudioVolumeIndicator",[f4],Object.getOwnPropertyDescriptor(me.prototype,"enableAudioVolumeIndicator"),me.prototype),ae(me.prototype,"startLiveStreaming",[m4],Object.getOwnPropertyDescriptor(me.prototype,"startLiveStreaming"),me.prototype),ae(me.prototype,"setLiveTranscoding",[g4],Object.getOwnPropertyDescriptor(me.prototype,"setLiveTranscoding"),me.prototype),ae(me.prototype,"stopLiveStreaming",[E4],Object.getOwnPropertyDescriptor(me.prototype,"stopLiveStreaming"),me.prototype),ae(me.prototype,"addInjectStreamUrl",[_4],Object.getOwnPropertyDescriptor(me.prototype,"addInjectStreamUrl"),me.prototype),ae(me.prototype,"removeInjectStreamUrl",[v4],Object.getOwnPropertyDescriptor(me.prototype,"removeInjectStreamUrl"),me.prototype),ae(me.prototype,"startChannelMediaRelay",[y4],Object.getOwnPropertyDescriptor(me.prototype,"startChannelMediaRelay"),me.prototype),ae(me.prototype,"updateChannelMediaRelay",[S4],Object.getOwnPropertyDescriptor(me.prototype,"updateChannelMediaRelay"),me.prototype),ae(me.prototype,"stopChannelMediaRelay",[T4],Object.getOwnPropertyDescriptor(me.prototype,"stopChannelMediaRelay"),me.prototype),ae(me.prototype,"sendCustomReportMessage",[R4],Object.getOwnPropertyDescriptor(me.prototype,"sendCustomReportMessage"),me.prototype),ae(me.prototype,"pickSVCLayer",[I4],Object.getOwnPropertyDescriptor(me.prototype,"pickSVCLayer"),me.prototype),ae(me.prototype,"enableContentInspect",[w4],Object.getOwnPropertyDescriptor(me.prototype,"enableContentInspect"),me.prototype),ae(me.prototype,"disableContentInspect",[C4],Object.getOwnPropertyDescriptor(me.prototype,"disableContentInspect"),me.prototype),ae(me.prototype,"getJoinChannelServiceRecords",[A4],Object.getOwnPropertyDescriptor(me.prototype,"getJoinChannelServiceRecords"),me.prototype),ae(me.prototype,"setPublishAudioFilterEnabled",[b4],Object.getOwnPropertyDescriptor(me.prototype,"setPublishAudioFilterEnabled"),me.prototype),me);class zre extends zk{set currentState(i){i!==this._currentState&&(this._currentState=i,this.emit(Yr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),C(this,"audioBuffer",void 0),C(this,"sourceNode",void 0),C(this,"startPlayTime",0),C(this,"startPlayOffset",0),C(this,"pausePlayTime",0),C(this,"options",void 0),C(this,"currentLoopCount",0),C(this,"_currentState","stopped"),this.audioBuffer=i,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(i){this.currentState==="stopped"?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):D.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=i,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const N4=new Map;async function Yre(r,i){let s=null;if(typeof r=="string"){const u=N4.get(r);if(u)return D.debug("use cached audio resource: ",r),u;try{s=(await po(()=>gs.get(r,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new j(V.FETCH_AUDIO_FILE_FAILED,d.toString())}}else s=await new _e((d,h)=>{const m=new FileReader;m.onload=g=>{g.target?d(g.target.result):h(new j(V.READ_LOCAL_AUDIO_FILE_ERROR))},m.onerror=()=>{h(new j(V.READ_LOCAL_AUDIO_FILE_ERROR))},m.readAsArrayBuffer(r)});const a=await function(u){const d=Ul();return new _e((h,m)=>{d.decodeAudioData(u,g=>{h(g)},g=>{m(new j(V.DECODE_AUDIO_FILE_FAILED,g.toString()))})})}(s);return typeof r=="string"&&i&&N4.set(r,a),a}function P4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);i&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),s.push.apply(s,a)}return s}function vE(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?P4(Object(s),!0).forEach(function(a){C(r,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):P4(Object(s)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(s,a))})}return r}function TR(r,i,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=vE(vE({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(i.contentHint=s.optimizationMode,i.contentHint===s.optimizationMode?D.debug("[".concat(r,"] set content hint to"),s.optimizationMode):D.debug("[".concat(r,"] set content hint failed")))):D.warning("[".concat(r,"] can not apply optimization mode bitrate config, no encoderConfig")))}const Xre=bt().name;function Jre(r,i,s,a){let u,d=0,h=null;return new _e((m,g)=>{setTimeout(()=>{u&&(u(),m(d))},i),u=$S(()=>{(function(){d>a&&u&&(u(),m(d));const p=s.getContext("2d");if(!p){const T=new j(V.UNEXPECTED_ERROR,"can not get canvas 2d context.");return D.error(T.toString()),void g(T)}p.drawImage(r,0,0,160,120);const E=p.getImageData(0,0,s.width,s.height),v=Math.floor(E.data.length/3);if(h){for(let T=0;T<v;T+=3)if(E.data[T]!==h[T])return d+=1,void(h=E.data);h=E.data}else h=E.data})()},30)})}class fp{constructor(i,s){C(this,"id",0),C(this,"element",void 0),C(this,"peerPair",void 0),C(this,"context",void 0),C(this,"audioPlayerElement",void 0),C(this,"audioTrack",void 0),fp.count+=1,this.id=fp.count,this.element=i,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const s=document.createElement("audio");s.srcObject=new MediaStream([i.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const i=async(a,u)=>{const d=u==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new _e(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,u)=>await a.setRemoteDescription(u);try{const a=await i(this.peerPair[0],"offer");await s(this.peerPair[1],a);const u=await i(this.peerPair[1],"answer");await s(this.peerPair[0],u)}catch(a){throw new j(V.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(i){if(this.audioTrack)return this.audioTrack;let s;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(i).connect(s)}catch(u){throw new j(V.LOCAL_AEC_ERROR,u.toString()).print()}if(!s)throw new j(V.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const i=this.element,s=await this.getTracksFromMediaElement(i);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){D.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var D4,yE;C(fp,"count",0);const Qre=window.AudioContext||window.webkitAudioContext,Zre=new(D4=ke({report:Ie}),ae((yE=class{constructor(){C(this,"units",[]),C(this,"context",void 0)}processExternalMediaAEC(r){if(!this._doesEnvironmentNeedAEC())return D.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Qre);let i=this.units.find(s=>s&&s.getElement()===r);return i||(i=new fp(r,this.context),this.units.push(i)),i.startEchoCancellation(),D.debug("start processing local audio echo cancellation, id is",i.id),i.id}_doesEnvironmentNeedAEC(){return bt().name!==It.SAFARI}}).prototype,"processExternalMediaAEC",[D4],Object.getOwnPropertyDescriptor(yE.prototype,"processExternalMediaAEC"),yE.prototype),yE);Dt("PROCESS_ID","process-".concat($t(8,""),"-").concat($t(4,""),"-").concat($t(4,""),"-").concat($t(4,""),"-").concat($t(12,""))),function(){const r=bt();Mr.getDisplayMedia=function(i){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Mr.getStreamFromExtension=r.name===It.CHROME&&Number(r.version)>34,Mr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let s=!1;try{i.addTransceiver("audio"),s=!0}catch{}return i.close(),s}(),Mr.supportMinBitrate=r.name===It.CHROME||r.name===It.EDGE,Mr.supportSetRtpSenderParameters=function(){const i=bt();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!su()||!(!Kr()&&!gg())||i.name===It.FIREFOX&&Number(i.version)>=64}(),r.name===It.SAFARI&&(Number(r.version)>=14?Mr.supportDualStream=!0:Mr.supportDualStream=!1),Mr.webAudioMediaStreamDest=function(){const i=bt();return!(i.name===It.SAFARI&&Number(i.version)<12)}(),Mr.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Mr.supportWebGL=typeof WebGLRenderingContext<"u",Mr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,su()||(Mr.webAudioWithAEC=!0),Mr.supportShareAudio=function(){const i=bt();return(i.os===Kn.WIN_10||i.os===Kn.WIN_81||i.os===Kn.WIN_7||i.os===Kn.LINUX||i.os===Kn.MAC_OS)&&i.name===It.CHROME&&Number(i.version)>=74}(),Mr.supportDualStreamEncoding=function(){const i=bt();return Q("DISABLE_WEBAUDIO")?!0:i.name==="Safari"&&Number(i.version)>=14||!!(i.name==="Chrome"&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&Q("CHROME_DUAL_STREAM_USE_ENCODING"))}(),Mr.supportDataChannel=function(){return!!(function(i){const s=bt();return!(s.name!==It.CHROME||!s.osVersion)&&Number(s.version)>=i}(76)||function(i){const s=bt();return!(s.name!==It.FIREFOX||!s.osVersion)&&Number(s.version)>=i}(68)||function(i){const s=bt();return!(s.name!==It.SAFARI||!s.osVersion)&&Number(s.version)>=i}(14))}(),D.info("browser compatibility",JSON.stringify(Mr),JSON.stringify(r))}(),function(){let r;try{r=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void D.error("Error loading sdk config",i.message)}if(r)try{const i=JSON.parse(window.atob(r)),s=Date.now();D.debug("Loading global parameters from cache",i),Object.keys(i).forEach(a=>{if(Object.prototype.hasOwnProperty.call(qr,a)){const{value:u,expires:d}=i[a];if(d&&d<=s)return;mS[a]=u,qr[a]=u}})}catch(i){D.error("Error loading mutableParamsCache: ".concat(r),i.message)}}();const Ur={__CLIENT_LIST__:Dl,__TRACK_LIST__:Bh,VERSION:Hi,BUILD:hS,setParameter:(r,i,s)=>{D.debug("setParameter key:".concat(r,", value:").concat(JSON.stringify(i))),Dt(r,i,s)},getParameter:Q,getSupportedCodec:async function(){let r={audio:[],video:[]};try{let i=new RTCPeerConnection;i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(await i.createOffer()).sdp;if(!s)return r;i.close(),i=null,r=function(a){const u={video:[],audio:[]};return a.match(/ VP8/i)&&u.video.push("VP8"),a.match(/ VP9/i)&&u.video.push("VP9"),a.match(/ AV1/i)&&u.video.push("AV1"),a.match(/ H264/i)&&u.video.push("H264"),a.match(/ opus/i)&&u.audio.push("OPUS"),a.match(/ PCMU/i)&&u.audio.push("PCMU"),a.match(/ PCMA/i)&&u.audio.push("PCMA"),a.match(/ G722/i)&&u.audio.push("G722"),u}(s)}catch(i){throw new j(V.CREATE_OFFER_FAILED,i.toString&&i.toString()).print()}return r},checkSystemRequirements:function(){const r=Ie.reportApiInvoke(null,{name:dn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Ht.TRACER});let i=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;i=!!(d&&h&&m)}catch(d){return D.error("check system requirement failed: ",d),!1}let s=!1;const a=bt();a.name===It.CHROME&&Number(a.version)>=58&&(!SJ()||yJ())&&(s=!0),a.name===It.FIREFOX&&Number(a.version)>=56&&(s=!0),a.name===It.OPERA&&Number(a.version)>=45&&(s=!0),a.name===It.SAFARI&&Number(a.version)>=11&&(s=!0),(TD()||bt().name===It.QQ)&&(s=!0),D.debug("checkSystemRequirements, api:",i,"browser",s);const u=i&&s;return r.onSuccess(u),u},getDevices:function(r){return hi.enumerateDevices(!0,!0,r)},getMicrophones:function(r){return hi.getRecordingDevices(r)},getCameras:function(r){return hi.getCamerasDevices(r)},getElectronScreenSources:Jk,getPlaybackDevices:function(r){return hi.getSpeakers(r)},createClient:function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=Ie.reportApiInvoke(null,{name:dn.CREATE_CLIENT,options:[r],tag:Ht.TRACER});try{YQ(r)}catch(s){throw i.onError(s),s}return r.audioCodec===void 0&&(r.audioCodec="opus"),i.onSuccess(),new qre(pp(pp({forceWaitGatewayResponse:!0},r),{},{role:r.mode==="rtc"?"host":r.role}))},createCameraVideoTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{encoderConfig:"480p_1"};const i=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CREATE_CAM_VIDEO_TRACK,options:[vE({},r)]}),s=MT(r),a=$t(8,"track-cam-");let u=null;D.info("start create camera video track with config",JSON.stringify(r),"trackId",a);try{u=(await vs({video:s},a)).getVideoTracks()[0]||null}catch(h){throw i.onError(h),h}if(!u){const h=new j(V.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw()}r.optimizationMode&&TR(a,u,r,r.encoderConfig&&Nl(r.encoderConfig));const d=new hU(u,r,s,r.scalabiltyMode?Ag(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,a);return i.onSuccess(d.getTrackId()),D.info("create camera video success, trackId:",a),d},createCustomVideoTrack:function(r){const i=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CREATE_CUSTOM_VIDEO_TRACK,options:[r]}),s=new un(r.mediaStreamTrack,{bitrateMax:r.bitrateMax,bitrateMin:r.bitrateMin},r.scalabiltyMode?Ag(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode);return i.onSuccess(s.getTrackId()),D.info("create custom video track success with config",r,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CREATE_SCREEN_VIDEO_TRACK,options:[vE({},r),i]});r.encoderConfig?typeof r.encoderConfig=="string"||r.encoderConfig.width&&r.encoderConfig.height||(r.encoderConfig.width={max:1920},r.encoderConfig.height={max:1080}):r.encoderConfig="1080p_2";const a=Dne(r),u=$t(8,"track-scr");let d=null,h=null;const m=er();if(!m.supportShareAudio&&i==="enable"){const E=new j(V.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(E),E.throw()}D.info("start create screen video track with config",r,"withAudio",i,"trackId",u);try{const E=await vs({screen:a,screenAudio:i==="auto"?m.supportShareAudio:i==="enable"},u);d=E.getVideoTracks()[0]||null,h=E.getAudioTracks()[0]||null}catch(E){throw s.onError(E),E}if(!d){const E=new j(V.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(E),E.throw()}if(!h&&i==="enable"){d&&d.stop();const E=new j(V.SHARE_AUDIO_NOT_ALLOWED);return s.onError(E),E.throw()}r.optimizationMode||(r.optimizationMode="detail"),r.optimizationMode&&(TR(u,d,r,r.encoderConfig&&fS(r.encoderConfig)),r.encoderConfig&&typeof r.encoderConfig!="string"&&(r.encoderConfig.bitrateMin=r.encoderConfig.bitrateMax));const g=new un(d,r.encoderConfig?fS(r.encoderConfig):{},r.scalabiltyMode?Ag(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,u,[Mn.SCREEN_TRACK]);if(!h)return s.onSuccess(g.getTrackId()),D.info("create screen video track success","video:",g.getTrackId()),g;const p=new tr(h);return s.onSuccess([g.getTrackId(),p.getTrackId()]),D.info("create screen video track success","video:",g.getTrackId(),"audio:",p.getTrackId()),[g,p]},createMicrophoneAndCameraTracks:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{encoderConfig:"480p_1"};const s=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CREATE_MIC_AND_CAM_TRACKS,options:[r,i]}),a=MT(i),u=Lx(r),d=$t(8,"track-mic-"),h=$t(8,"track-cam-");let m=null,g=null;D.info("start create camera video track(".concat(h,") and microphone audio track(").concat(d,") with config, audio: ").concat(JSON.stringify(r),", video: ").concat(JSON.stringify(i)));try{const v=await vs({audio:u,video:a},"".concat(d,"-").concat(h));m=v.getAudioTracks()[0],g=v.getVideoTracks()[0]}catch(v){throw s.onError(v),v}if(!m||!g){const v=new j(V.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(v),v.throw()}i.optimizationMode&&TR(h,g,i,i.encoderConfig&&Nl(i.encoderConfig));const p=new Mg(m,r,u,d),E=new hU(g,i,a,i.scalabiltyMode?Ag(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,h);return s.onSuccess([p.getTrackId(),E.getTrackId()]),D.info("create camera video track(".concat(h,") and microphone audio track(").concat(d,") success")),[p,E]},createMicrophoneAudioTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CREATE_MIC_AUDIO_TRACK,options:[r]}),s=Lx(r),a=$t(8,"track-mic-");let u=null;D.info("start create microphone audio track with config",JSON.stringify(r),"trackId",a);try{u=(await vs({audio:s},a)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!u){const h=new j(V.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw()}const d=new Mg(u,r,s,a);return i.onSuccess(d.getTrackId()),D.info("create microphone audio track success, trackId:",a),d},createCustomAudioTrack:function(r){const i=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CREATE_CUSTOM_AUDIO_TRACK,options:[r]}),s=new tr(r.mediaStreamTrack,r.encoderConfig?bg(r.encoderConfig):{});return D.info("create custom audio track success with config",r,"trackId",s.getTrackId()),i.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(r){const i=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CREATE_BUFFER_AUDIO_TRACK,options:[r]});if(Q("DISABLE_WEBAUDIO"))throw new j(V.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const s=$t(8,"track-buf-");D.info("start create buffer source audio track with config",JSON.stringify(r),"trackId",s);const a=r.source;if(!(r.source instanceof AudioBuffer))try{r.source=await Yre(r.source,r.cacheOnlineFile)}catch(h){return i.onError(h),h.throw()}const u=new zre(r.source),d=new gee(a,u,r.encoderConfig?bg(r.encoderConfig):{},s);return D.info("create buffer source audio track success, trackId:",s),i.onSuccess(d.getTrackId()),d},setAppType:function(r){if(D.debug("setAppType: ".concat(r)),!(Number.isInteger(r)&&r>=0))throw D.debug("Invalid appType"),new j(V.INVALID_PARAMS,"invalid app type",r);Dt("APP_TYPE",Math.floor(r))},setLogLevel:function(r){D.setLogLevel(r)},enableLogUpload:function(){Q("USE_NEW_LOG")?Dt("UPLOAD_LOG",!0):D.enableLogUpload()},disableLogUpload:function(){Q("USE_NEW_LOG")?Dt("UPLOAD_LOG",!1):D.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Tx},checkAudioTrackIsActive:async function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[i]});if(!(r instanceof tr||r instanceof fE)){const g=new j(V.INVALID_TRACK,"the parameter is not a audio track");return s.onError(g),g.throw()}i&&i<1e3&&(i=1e3);const a=r instanceof tr?r.getTrackLabel():"remote_track",u=r.getVolumeLevel();let d=u,h=u;const m=Date.now();return new _e(g=>{const p=setInterval(()=>{const E=r.getVolumeLevel();d=E>d?E:d,h=E<h?E:h;const v=d-h>1e-4,T=Date.now()-m;if(v||T>i){clearInterval(p);const I=v,O={duration:T,deviceLabel:a,maxVolumeLevel:d,result:I};D.info("[track-".concat(r.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(O))),s.onSuccess(O),g(I)}},200)})},checkVideoTrackIsActive:async function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ie.reportApiInvoke(null,{tag:Ht.TRACER,name:dn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[i]});if(!(r instanceof un||r instanceof pE)){const T=new j(V.INVALID_TRACK,"the parameter is not a video track");return s.onError(T),T.throw()}const a=4;i&&i<1e3&&(i=1e3);const u=r instanceof un?r.getTrackLabel():"remote_track",d=r.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Kr()||gg())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const m=document.createElement("canvas");m.width=160,m.height=120;let g=0,p=0;try{const T=Date.now();g=await Jre(h,i,m,a),p=Date.now()-T}catch(T){throw s.onError(T),T}Xre===It.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const E=g>a,v={duration:p,changedPicNum:g,deviceLabel:u,result:E};return D.info("[track-".concat(r.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),s.onSuccess(v),E},setArea:function(r){const i=Ie.reportApiInvoke(null,{name:dn.SET_AREA,options:r,tag:Ht.TRACER});try{let s=[];if(typeof r=="string"&&(s=[r]),Array.isArray(r)&&(r.forEach(u=>{if(!eZ.includes(u))throw new j(V.INVALID_PARAMS,"invalid area code")}),s=r),Object.prototype.toString.call(r)==="[object Object]"){const{areaCode:u,excludedArea:d}=r;if(!u)throw new j(V.INVALID_PARAMS,"area code is needed");let h=u;typeof u=="string"&&(h=[u]),s=d?one(h,d):h}Dt("AREAS",s);const a=(u=>{const d={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return u.map(h=>{const m=LS[h],g=Object.keys(m);g&&g.map(p=>{p!=="CODE"&&(d[p]=d[p].concat(m[p]))})}),d})(s);Object.keys(a).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Dt(u,a[u][0]):Dt(u,a[u])}),D.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()},audioElementPlayCenter:pi,processExternalMediaAEC:function(r){Zre.processExternalMediaAEC(r)},registerExtensions:function(r){r.forEach(i=>{const s=i;s.__registered__=!0,s.logger.hookLog=D.extLog,s.reporter.hookApiInvoke=Ie.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(a=>{s.parameters[a]=Q(a)})})},ChannelMediaRelayError:Ga,ChannelMediaRelayEvent:Ws,ChannelMediaRelayState:Lr,RemoteStreamFallbackType:kS,RemoteStreamType:DS,ConnectionDisconnectedReason:_t,AudienceLatencyLevelType:AS,AREAS:mt},RR=window||document;return Object.defineProperties(Ur,{onAudioAutoplayFailed:{get:()=>Ai.onAudioAutoplayFailed,set:r=>{Ai.onAudioAutoplayFailed=r}},onAutoplayFailed:{get:()=>Ai.onAutoplayFailed,set:r=>{Ai.onAutoplayFailed=r}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ur._onSecurityPolicyViolation,set(r){if(Ur._onSecurityPolicyViolation=r,!RR)return;const i=a=>{if(!(a&&a.blockedURI&&Ur.onSecurityPolicyViolation))return;const u=a.blockedURI;Q("CSP_DETECTED_HOSTNAME_LIST").some(d=>u.includes(d))&&Ur.onSecurityPolicyViolation&&typeof Ur.onSecurityPolicyViolation=="function"&&Ur.onSecurityPolicyViolation(a)},s=Ur._cspEventHandlerPointer;s&&RR.removeEventListener("securitypolicyviolation",s),r&&typeof r=="function"&&RR.addEventListener("securitypolicyviolation",i),Ur._cspEventHandlerPointer=i}}}),hi.on(Qo.CAMERA_DEVICE_CHANGED,r=>{D.info("camera device changed",JSON.stringify(r)),Ur.onCameraChanged&&Ur.onCameraChanged(r)}),hi.on(Qo.RECORDING_DEVICE_CHANGED,r=>{D.info("microphone device changed",JSON.stringify(r)),Ur.onMicrophoneChanged&&Ur.onMicrophoneChanged(r)}),hi.on(Qo.PLAYOUT_DEVICE_CHANGED,r=>{D.debug("playout device changed",JSON.stringify(r)),Ur.onPlaybackDeviceChanged&&Ur.onPlaybackDeviceChanged(r)}),pi.onAutoplayFailed=()=>{D.info("detect audio element autoplay failed"),Ai.onAudioAutoplayFailed&&Ai.onAudioAutoplayFailed()},Ze.on("autoplay-failed",()=>{D.info("detect webaudio autoplay failed"),Ai.onAudioAutoplayFailed&&Ai.onAudioAutoplayFailed()}),window&&(window.__ARTC__=Ur),Ur})})(OSe);const iw=mA(pA),NSe="/assets/video-solid-1107bb86.svg",PSe="/assets/microphone-solid-c8baa094.svg",DSe="/assets/phone-solid-2bf73df7.svg";let wr={localAudioTrack:null,localVideoTrack:null,remoteAudioTrack:null,remoteVideoTrack:null,remoteUid:null};const kSe=function({channelId:t}){const e=te.useRef(null),n=te.useRef(null),o=te.useRef(!1),c=co();let l={appId:"b9f3d9ef339c433b8775e509a4c1ee44",channel:t,token:"",uid:Je.currentUser.uid},f;const _=async function(){try{await f.join(l.appId,l.channel,l.token,l.uid),wr.localAudioTrack=await iw.createMicrophoneAudioTrack(),wr.localVideoTrack=await iw.createCameraVideoTrack(),console.log("Tracks:",wr.localVideoTrack,wr.localAudioTrack),await f.publish([wr.localAudioTrack,wr.localVideoTrack]),wr.localVideoTrack.play(e.current),o.current=!0}catch(b){console.log("Error:",b.message)}finally{console.log("publish success!")}},y=async function(){var b,k;(b=wr.localAudioTrack)==null||b.close(),(k=wr.localVideoTrack)==null||k.close(),await f.leave(),c("/channels",{replace:!0})};async function S(){try{f=iw.createClient({mode:"rtc",codec:"vp8"}),f.on("user-published",async(b,k)=>{await f.subscribe(b,k),console.log("subscribe success"),k=="video"&&(wr.remoteVideoTrack=b.videoTrack,wr.remoteAudioTrack=b.audioTrack,wr.remoteUid=b.uid.toString(),n.current.id=b.uid.toString(),wr.remoteUid=b.uid.toString(),wr.remoteVideoTrack.play(n.current)),k=="audio"&&(wr.remoteAudioTrack=b.audioTrack,wr.remoteAudioTrack.play()),f.on("user-unpublished",M=>{console.log(M.uid+"has left the channel")})})}catch(b){console.log("Error:",b.message)}}const R=async function(b){const k=wr.localVideoTrack;k!=null&&k.enabled?(k.setEnabled(!1),b.currentTarget.style.backgroundColor="#eb5757"):(k==null||k.setEnabled(!0),b.currentTarget.style.backgroundColor="rgb(179, 102, 249, 0.9)")},w=async function(b){const k=wr.localAudioTrack;k!=null&&k.enabled?(k.setEnabled(!1),b.currentTarget.style.backgroundColor="#eb5757"):(k==null||k.setEnabled(!0),b.currentTarget.style.backgroundColor="rgb(179, 102, 249, 0.9)")};return te.useEffect(()=>(fetch(`https://chat-application-nu-one.vercel.app/?uid=${Je.currentUser.uid}&channelName=${t}`).then(b=>b.json()).then(b=>{l.token=b.token,S(),_()}),window.addEventListener("beforeunload",y),()=>{window.removeEventListener("beforeunload",y),o&&y()}),[]),Pt("div",{className:"call-interface",children:[ge("div",{className:"local-player player",id:l.uid,ref:e}),ge("div",{className:"remote-player player",ref:n}),Pt("div",{className:"controls",children:[ge("div",{className:"control-container",id:"camera-btn",onClick:R,children:ge("img",{src:NSe,alt:"camera"})}),ge("div",{className:"control-container",id:"mic-btn",onClick:w,children:ge("img",{src:PSe,alt:"microphone"})}),ge("div",{className:"control-container",id:"leave-btn",onClick:y,children:ge("img",{src:DSe,alt:"leave"})})]})]})};const LSe={hidden:{x:"100vw"},visible:{x:0,transition:{when:"beforeChildren"}},exit:{x:"100vw"}},MSe={visible:{width:0,transition:{duration:3}}},xSe=function({message:t}){return Pt(Pa.div,{className:"popup",variants:LSe,initial:"hidden",animate:"visible",exit:"exit",children:[ge("p",{children:t}),ge(Pa.div,{className:"progress",variants:MSe})]})},USe=function(t,e){return e.payload},VSe={channelName:"DEFAULT CHANNEL",channelId:"16A4w32PivaHAasvXbflX1676971533389",channelDesc:"Test channel for all users",channelMembers:[{id:Rb(),photoURL:$ye,name:"Xanthe Neal",email:"xan@gmail.com"}],channelMessages:[]};let cF;const FSe=function(){const t=mh(),e=co(),[n,o]=te.useReducer(USe,VSe),[c,l]=te.useState(!1),[f,_]=te.useState(!1),y=oC(R=>R.errorMessage),S=oC(R=>R);return te.useEffect(()=>{Ode(Je,w=>{w&&t(Pc.login({user:w,navigateFn:e}))});const R=Ao(ks,"channels",n.channelId);(async()=>{const b=(await Hge(R)).data();o({type:"initial",payload:{channelName:"DEFAULT CHANNEL",channelId:"16A4w32PivaHAasvXbflX1676971533389",channelDesc:"Test channel for all users",channelMembers:b.members,channelMessages:b.messages}})})(),_(!0)},[]),te.useEffect(()=>(cF=setTimeout(()=>{t(Pc.resetErrorMessage(""))},3100),()=>clearTimeout(cF)),[y]),Pt(i2,{children:[y&&ge(xSe,{message:y},Rb()),Pt(bae,{children:[ge(ca,{path:"/login",element:ge(Hye,{})}),ge(ca,{path:"/signup",element:ge(ASe,{})}),ge(ca,{path:"/join/:channelId",element:ge(bSe,{})}),S.user&&Pt(EF,{children:[ge(ca,{path:"/call",element:ge(kSe,{channelId:n.channelId})}),Pt(ca,{path:"/",element:ge(TSe,{isModalOpen:c,setIsNavOpen:_,setIsModalOpen:l,channelInfo:n}),children:[ge(ca,{path:":name",element:ge(Zye,{isNavOpen:f,channelInfo:n,channelDispatch:o,setIsNavOpen:_})}),ge(ca,{path:"channels",element:ge(CSe,{isNavOpen:f,setIsModalOpen:l,channelInfo:n,channelDispatch:o,setIsNavOpen:_})})]})]}),ge(ca,{path:"*",element:ge(wae,{to:"/login"})})]})]})};ow.createRoot(document.getElementById("root")).render(ge(lh.StrictMode,{children:ge(Rce,{store:bEe,children:ge(kae,{children:ge(FSe,{})})})}));
